//$Id$
/**
 * IMPORTANT NOTE: This compressed javascript includes thirdparty javascripts
 * listed at sheet.zoho.com/html/thirdparty.html
 * The original javascript sources are available in the above location.
 */

var tabEnter=function(){function e(){i||(i=!0,r={currRow:ActiveCellInfo.getEndRow(),currCol:currCol})}function o(){i=!1,t=!1}function n(){if(i&&t){var e=Row.findNextNonHiddenRow(r.currRow);focusCell(e,r.currCol),o()}}var t=!1,r={},i=!1,c=!1;appEvent.on("cell.keyDown",function(n){if(browser_ie)var n=window.event,r=(n.srcElement,n.keyCode);else if(browser_nn6)var r=(n.target,n.which);9!==r||n.shiftKey||(e(),t=!0),(37===r||38===r||39===r||40===r)&&(RangeSelector.isActive()||o())}),appEvent.on("grid.cellFieldKeyDown",function(n){if(c=!1,browser_ie)var n=window.event,r=(n.srcElement,n.keyCode);else if(browser_nn6)var r=(n.target,n.which);9!==r||n.shiftKey||(e(),t=!0),13===r&&(c=!0),(37===r||38===r||39===r||40===r)&&(RangeSelector.isActive()||o())}),appEvent.on("cellfield.focus",function(){e()}),appEvent.on("celledit.enterkeypressed",function(){return t?(n(),appEvent.preventDefault()):(o(),!1)}),appEvent.on("celledit.focusCellInfo",function(e){if(t&&i)if(c){var o=Row.findNextNonHiddenRow(r.currRow);Goto.doGoto(e.sourceSheet,o,o,r.currCol,r.currCol,!1,!0)}else{var n=e.col===getColMax()?e.col:e.col+1;Goto.doGoto(e.sourceSheet,e.row,e.row,n,n,!1,!0)}}),appEvent.on("celledit.istabKeypressed",function(){return t&&i?appEvent.preventDefault():!1}),appEvent.on("book.onbeforesheetswitch",function(){RangeSelector.isActive()||o()}),appEvent.on("grid.mousedown",function(e,n,t,r){RangeSelector.isActive()||r||o()})}(jQuery);var Solver=function(e){var t=!1,l=!1,i=0,o=0,a=0,n=!1,s=!1,r=void 0,d=void 0,c=void 0,u=void 0,v=void 0,g=void 0,h=void 0,f=void 0,p=void 0,C=void 0,S=void 0,m=void 0,w=function(){var t={closeOnEscape:!1,minHeight:10,width:550,title:jsMsg["Solver.UI.Solver"]};sheetdialog.open("solverdialog",t,{set:function(e){var t=e.action;"_showHideValueBox"==t&&N()},init:function(){setTimeout(function(){A()},200),e("#objectiveCell").focus(function(){var e=this;RangeSelector.on({el:e,single:!0,appendSheetName:!0})}),e("#decisionVariable").focus(function(){var t=this;RangeSelector.on({el:t,appendSheetName:!0,callback:function(t){var t=DataValidation.util.getDvRangeValues(t);return ProtectedRanges.isRangeLocked(t.startRow,t.startCol,t.endRow,t.endCol)?void e("#decisionVariable").val(""):void 0}})});var t=e(e("#dynamicChangediv").children()[0]),l=e(t.children()[0]).children();e(l).focus(function(){var e=this;RangeSelector.on({el:e,single:!0,appendSheetName:!0})});var i=e(t.children()[2]).children();e(i).focus(function(){var e=this;RangeSelector.on({el:e,single:!0,appendSheetName:!0})})},destroy:function(){var e=RangeSelector.returnsourceSheet();e!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open"),RangeSelector.off()}})},b=function(){t=!1,delete window.isValidConstraint,delete window.focusVariable,o=0,a=0,delete window.isValueboxSelected,delete window.isNonNegRes,delete window.objectiveCell,delete window.oCellSheetName,delete window.vCellsSheetName,delete window.vCellStartRow,delete window.vCellStartCol,delete window.vCellEndRow,delete window.vCellEndCol,delete window.specificValue,delete window.variableCellValues,delete window.oldValues,delete window.variableNewvalue,delete window.variableOldvalue,delete window.goalType,delete window.focusConstraint,clearCellRangeFill(),0!=e("#FreezeLayer").length&&e("#FreezeLayer").remove()},R=function(){e("#SolverDialog").is(":visible")?(sheetdialog&&sheetdialog.close(),b()):e("#SolverResultDialog").is(":visible")&&(U(),b())},E=function(){i=0,m=void 0,setTimeout(function(){e("#SpecValue").focus()},280)},N=function(){var t=e("#optimize select").val();"VALUE"==t?(e("#SpecValue").css({left:"-142px",position:"relative",width:"126px",display:""}),setTimeout(function(){e("#SpecValue").focus()},300),e("#SpecValue").bind("click",E)):e("#SpecValue").css({left:"-142px",position:"relative",width:"126px",display:"none"})},A=function(){e("#deletebutton").hide();var l=e(".ui-dialog").filter(":visible").find(".ui-icon-closethick");e(l).bind("mousedown",R);e(".ui-dialog").filter(":visible");e(".ui-dialog-titlebar-close").filter(":visible").css("display",""),t=!0;var i=ActiveCellInfo.getStartRow(),o=ActiveCellInfo.getStartCol();e("#objectiveCell").val(CellUtils.addApostrophe(CURRSHEETNAME+"."+getColHeadLabel(o+1)+getRowHeadLabel(i))),e("#decisionVariable").focus()},y=function(){if(e("#SolverDialog").is(":visible")){if(!CellUtils.checkCellLbl(e("#objectiveCell").val()))return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),void e("#objectiveCell").focus();if(!CellUtils.checkCellLbl(e("#decisionVariable").val(),2))return showAlertDialog(jsMsg["Solver.Error.Range"]),void e("#decisionVariable").focus();if(S=e("#optimize select").val(),n="VALUE"===S?!0:!1,n&&(C=e("#SpecValue").val(),0===C.length))return showAlertDialog(jsMsg["Solver.Error.NotNumber"]),void e("#SpecValue").focus();s=e("#SolverDialog input[type=checkbox]").is(":checked");var t=[],i=[];l=!1;for(var o=e("#dynamicChangediv .textField"),a=0,f=1,p=o.length;p>f;a+=2,f+=2)if(""==e(o[a]).val()&&""!=e(o[f]).val()||""!=e(o[a]).val()&&""==e(o[f]).val()){l=!0;break}if(l)return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),void(""==e(o[a]).val()?(e(o[a]).val(""),e(o[a]).focus()):(e(o[f]).val(""),e(o[f]).focus()));for(var a=0,p=o.length;p>a;a++)if(a%2==0&&""!==e(o[a]).val()&&!CellUtils.checkCellLbl(e(o[a]).val(),3)){l=!0;break}if(l)return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),e(o[a]).val(""),void e(o[a]).focus();for(var m=0,w=e("#dynamicChangediv select"),b=0,R=1,p=o.length;p>R;b+=2,R+=2){if(""!=e(o[b]).val()&&""!=e(o[R]).val()){var E=e(o[b]).val(),N=e(w[m]).val(),A=e(o[R]).val();t.push(E),i.push(N),t.push(A)}m++}r=CellUtils.getCellRef(e("#objectiveCell").val());var y=e("#decisionVariable").val(),x=CellUtils.getLabelsSplitFromRange(y),k=(x[0],x[1],getDataFrom2DRangeText(y));if(d=CellUtils.getSheetNameFromCelLbl(e("#objectiveCell").val()),c=CellUtils.getSheetNameFromCelLbl(y),u=k.sR,v=k.sC,g=k.eR,h=k.eC,cellRangeContainsMergeCells(k.sR,k.sC,k.eR,k.eC))return void showAlertDialog(jsMsg["Solver.Error.MergeCells"]);for(var L=[],U=[],M=[],j=0,T=1,F=0,p=t.length;p>T;j+=2,T+=2,F++){var I=CellUtils.getSheetNameFromCelLbl(t[j]),O=CellUtils.getCellRef(t[j]);L.push(I),L.push(O),U.push(i[F]),M.push(t[T])}var P=RangeSelector.returnsourceSheet();P!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(P),"open");var H=new RequestParameters(ActionConstants.SOLVER);H.setParameters(WorkSheets.getSheetCodeFromName(CURRSHEETNAME),u,v,g,h,c,r,d,S,n,s,L,U,M),n&&H.setParameters(WorkSheets.getSheetCodeFromName(CURRSHEETNAME),u,v,g,h,c,r,d,S,n,s,L,U,M,C);var q=new AjaxRequest;q.init("POST",H.getURL(),!0,H.getParametersAsString()),q.addEventListener("onComplete",function(e){V(e.responseText)}),q.sendRequest()}else D()},V=function(t){var l=parseJSON(t),i=l.message,o=l.solution,a=l.noNumber,n=l.exceptionformulaConstraint,s=l.exceptionformula,r=l.exception;if(null!=i&&showAlertDialog(i),null!=a)return showAlertDialog(a),void(a==jsMsg["Solver.Error.NotNumber"]?e("#SpecValue").focus():e("#decisionVariable").focus());if(null!=s)return showAlertDialog(s),void e("#objectiveCell").focus();if(null!=n)return showAlertDialog(n),void e("#decisionVariable").focus();if(null!=o){var d=l.clientUpdateJson,c=l.resultValue;return updateJson(d),f=l.variableCellValues,p=l.oldValues,e(".ui-dialog-titlebar-close").filter(":visible").css("display","none"),e("#SolverDialog").css({display:"none"}),e("#SolverResultDialog").css({display:"block"}),e("#message").text(o),e("#Result").text(c),closeOnEscKey=!1,freezeBackground({BGColor:"",opacity:""}),setFreezeLayerHeight(),e("#FreezeLayer").css("zIndex",1e3+BASEZINDEX),document.getElementById("solverSubmit").firstChild.textContent=jsMsg.OK,e(".ui-dialog").filter(":visible").focus(),e(".ui-dialog").filter(":visible").click(function(){e(".ui-dialog").filter(":visible").focus()}),void e("#FreezeLayer").click(function(){e(".ui-dialog").filter(":visible").focus()})}if(null!=r){var d=l.clientUpdateJson;return updateJson(d),R(),void showAlertDialog(r)}},x=function(){a++;var t="inEquality"+a,l=document.getElementById("dynamicChangediv"),n=document.createElement("div");e(n).addClass("constraints"),t+=a;for(var s,r=["lhsInputDiv","rhsInputDiv"],d=["lhsInputElement","rhsInputElement"],c=["LEQ","GEQ","EQ"],u=["<=",">=","="],v=0;2>v;v++){var g=r[v],h=d[v],g=document.createElement("div");e(g).attr("style","float:left;padding-right:10px"),e(g).attr("title",jsMsg["CellReference.SingleSelection.Tooltip"]);var h=document.createElement("input");if(e(h).attr("type","text"),e(h).addClass("textField cR"),e(h).focus(function(){var e=this;RangeSelector.on({el:e,single:!0,appendSheetName:!0})}),1==v)e(h).attr("maxlength","30"),e(h).css({float:"center"});else{var f=document.createElement("div");e(f).attr("style","float:left;padding-right:10px"),e(f).attr("title",jsMsg["CellReference.SolverEQL"]),e(f).click(function(){i=0});var p=document.createElement("select");e(p).css({width:"70px"}),e(p).attr("ctype","zcombo"),e(p).attr("data","{componentOptions:{type: 'text_only','editable': false}}");for(var C=0;3>C;C++){var S="option"+C,S=document.createElement("Option");e(p).attr("id",t),e(S).attr("value",c[C]),e(S).text(u[C]),e(p).append(S)}f.appendChild(p)}e(h).css("width","163px"),g.appendChild(h),n.appendChild(g),0==v&&(n.appendChild(f),s=h)}var m=document.createElement("span"),w=document.createElement("input");e(w).attr("type","button"),e(w).attr("id","deletebutton"),e(w).addClass("closeIconSmall"),e(w).click(function(){L(this)}),m.appendChild(w),n.appendChild(m),l.appendChild(n),e.ui.utils.initComponents(e(p)),s.focus(),o++,o>0&&e("#deletebutton").show(),10==e(".closeIconSmall").length&&e("#addLink").hide()},k=function(e){var t;return t=window.event?window.event.keyCode:e.which,13==t?y():t==Event.KEY_ESC?R():!1},L=function(t){var l=e(t).parent().parent();e(l).slideUp(200,function(){0!=Solver.cnt&&(e(t).parent().parent().remove(),Solver.cnt--),0==Solver.cnt&&e("#deletebutton").hide(),e(".closeIconSmall").length<=9&&e("#addLink").show()});var i=e(l).siblings(),o=e(i).last(),a=e(o).children().find("input");e(a[0]).focus(),2===e(".closeIconSmall").length&&e(".closeIconSmall").hide()},U=function(){var e=new RequestParameters(ActionConstants.SOLVER_CANCEL);e.setParameters(WorkSheets.getSheetCodeFromName(CURRSHEETNAME),u,v,g,h,c,p);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText),l=t.clientUpdateJson;updateJson(l),sheetdialog.close()}),t.sendRequest()},D=function(){var e=new RequestParameters(ActionConstants.COPY_PASTE_CONTENT);e.setParameters(WorkSheets.getSheetCodeFromName(CURRSHEETNAME),u,v,f);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t),sheetdialog.close(),b()};return{init:w,destroy:R,submit:y,addConstraints:x,submitOnEnter:k,delConstraint:L}}(jQuery);var TypeAhead=function(){var e=[],t=!1,r=!1,n=!0,i=0,a=!1,l=!1,o="",s=!1,u=function(){return n},c=function(){n=n?!1:!0},f=function(r,n,i){if(e=[],s)return!0;if(!rowsInPage.length)return!0;for(var o,u,c=rowsInPage[0],f=rowsInPage[rowsInPage.length-1],v=n-1;v>=c;v-=1){if(v&&v==c||!rowsInPage.contains(v)){t=!0;break}if(o=getCell(v,i),u=getCellValue(o),""==u||null==u)break;0===u||0|u||!e.contains(u)&&e.push(u)}if(!t||a)for(var v=n+1,g=getRowMax();f>=v;v+=1){if(v==f&&v!=g||!rowsInPage.contains(v)){t=!0;break}if(o=getCell(v,i),u=getCellContent(o),""==u||null==u)break;0===u||0|u||!e.contains(u)&&e.push(u)}if(!a&&t){e=[],s=!0,t=!1;var w=getCellRange(),L=new RequestParameters(ActionConstants.PICK_LIST);L.setParameters(WorkSheets.getAssociatedActiveSheetName(),w.startRow,w.startCol,!0);var h=new AjaxRequest;return h.init("POST",L.getURL(),!0,L.getParametersAsString()),h.addEventListener("onComplete",function(t){var n=parseJSON(t.responseText);if(e=n.result,!e)return e=[],l=!0,!0;var i=d(r,e);i&&C(i,r.length)}),h.sendRequest(),!0}return e.sort(formulaMenuUtil.ignoreCaseSort),!1},v=function(){l||(clearTimeout(i),i=setTimeout(function(){var t=cellField,n=t.value,i=n.slice(0,cellField.selectionStart),a=currRow,l=currCol;if(o&&0==o.toLowerCase().indexOf(i.toLowerCase()))return void C(o);var s=new RegExp("[a-zA-Z]");if(s.test(i)&&!r&&t.selectionEnd===t.selectionStart&&t.value.length===t.selectionStart){var u=e.length;if(u||!f(i,a,l)){var c=d(i,e);c&&C(c,i.length)}}},10))},C=function(e){if(e){var t=cellField,r=t.value.slice(0,t.selectionStart),n=r.length,i=e.length;if(n>=i)return;if(-1==e.toLowerCase().indexOf(r.toLowerCase()))return;var a=e.slice(n,i);t.value=r+a,setSelectionRange(t,n,t.value.length),o=e}},d=function(e,t){for(var n="",i=!1,a=t.length,l=0,o=a-1,s=e.toLowerCase();o>=l;){var u=(o+l)/2|0,c=t[u],f=c.toLowerCase();if(c&&0==t[u].toLowerCase().indexOf(s)){n&&n.toLowerCase()==f&&(i=!1),n=t[u];var v=t[u-1],C=t[u+1];if(v&&f!=v.toLowerCase()&&0==v.toLowerCase().indexOf(s)||C&&f!=C.toLowerCase()&&0==C.toLowerCase().indexOf(e.toLowerCase()))return;if(i)return;i=!0}if(t[u].toLowerCase()<s)l=u+1;else{if(!(t[u].toLowerCase()>s))return;o=u-1}}return""===n&&(r=!0),n},g=function(){e=[],r=!1,l=!1,o="",s=!1};appEvent.on("grid.cellFieldKeyUp",function(e){var t=e.keyCode;!u()||isCellFieldSPANHided()||e.altKey||e.ctrlKey||e.metaKey||(8===t||46===t)&&(r=!1,o="")}),appEvent.on("cellField.keyPress",function(e){var t=e.keyCode?e.keyCode:e.which;if(0!=e.which){if(void 0===isDvListCell&&currCell){var r=currCell.getAttribute("dv"),n=$.parseJSON(r);isDvListCell=n&&n.list}if(isDvListCell!==!0&&u()&&!isCellFieldSPANHided()&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&8!==t){var i=cellField.value;0!==i&&0!==i.indexOf("=")&&v()}}}),appEvent.on("grid.cellFieldKeyDown",function(e){var t=e.keyCode;(e.ctrlKey||e.metaKey)&&e.shiftKey&&81===t&&c()}),appEvent.on("grid.resetGlobalVariables",function(){g()})}();var GoalSeek=function(e){var t=!1,l=void 0,i=void 0,o=void 0,a=void 0,s=void 0,n=void 0,r=void 0,c=void 0,u=void 0,d=void 0,v=void 0,g=function(){var t={closeOnEscape:!1,width:320,title:jsMsg["GoalSeek.UI.GoalSeek"]},l={init:function(){setTimeout(function(){f()},200),e("#targetCell").focus(function(){var e=this;RangeSelector.on({el:e,single:!0,appendSheetName:!0})}),e("#variableCell").focus(function(){var t=this;RangeSelector.on({el:t,single:!0,appendSheetName:!0,callback:function(t){var l=CellUtils.getCellPosByLabel(t.substring(t.indexOf(".")+1,t.length));return ProtectedRanges.isRangeLocked(l.row,l.col,l.row,l.col)?void(e("#variableCell")[0].value=""):void 0}})}),e("#desiredValue").focus(function(){clearCellRangeFill()})},destroy:function(){C()}};sheetdialog.open("goalseekdialog",t,l)},C=function(){t=!1,l=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,d=void 0,v=void 0,clearCellRangeFill(),0!=e("#FreezeLayer").length&&e("#FreezeLayer").remove();var n=RangeSelector.returnsourceSheet();n!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(n),"open"),sheetdialog.close(),RangeSelector.off()},f=function(){var o=e(".ui-dialog").filter(":visible").find(".ui-icon-closethick");e(o).bind("mousedown",C),t=!0,i=getObj("variableCell"),l=getObj("targetCell");var a=currCell.getAttribute("fn");a&&0===a.indexOf("=")?(l.value=CellUtils.constructCellName(ActiveCellInfo.getActiveRow(),ActiveCellInfo.getActiveCol(),ActiveCellInfo.getActiveRow(),ActiveCellInfo.getActiveCol(),!1,CURRSHEETNAME),i.focus()):l.focus()},S=function(){var t=i.value.replace("!","."),o=l.value.replace("!",".");if(!CellUtils.isSingleCell(t))return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),void i.focus();if(!CellUtils.isSingleCell(o))return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),void l.focus();if(s=getObj("desiredValue").value,0==s.length)return showAlertDialog(jsMsg["GoalSeek.Msg.Blank"]),void getObj("desiredValue").focus();n=CellUtils.getSheetNameFromCelLbl(t);var a=CellUtils.getSheetNameFromCelLbl(o);r=CellUtils.getCellRef(t);var c=CellUtils.getCellRef(o);if(n===CURRSHEETNAME){var u=CellUtils.getCellPosByLabel(r);if(ProtectedRanges.isRangeLocked(u.row,u.col,u.row,u.col))return void(e("#variableCell")[0].value="")}var d=RangeSelector.returnsourceSheet();d!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(d),"open");var v=new RequestParameters(ActionConstants.GOAL_SEEK);v.setParameters(WorkSheets.getAssociatedActiveSheetName(),n,a,r,c,getObj("desiredValue").value);var g=new AjaxRequest;g.init("POST",v.getURL(),!0,v.getParametersAsString()),g.addEventListener("onComplete",function(e){h(e.responseText)}),g.sendRequest()},h=function(t){var l=parseJSON(t),i=l.message,o=l.solution;if(null!=o){var a=l.clientUpdateJson;updateJson(a);var s=l.TargetCellValue;c=l.value,u=l.rowIndex,d=l.columnIndex,v=l.solution,e(".ui-dialog-titlebar-close").filter(":visible").css("display","none"),e("#goalSeekResultDialog").css("display","block"),e("#goalSeekDialog").css("display","none"),closeOnEscKey=!1,freezeBackground({BGColor:"",opacity:""}),setFreezeLayerHeight(),e("#FreezeLayer").css("zIndex",1e4),e("#message").html(escapeSpecialCharacters(i)),e("#targetCellValue").html(escapeSpecialCharacters(s)),e("#content").html(escapeSpecialCharacters(o)),e(".ui-dialog").filter(":visible").focus(),e(".ui-dialog").filter(":visible").click(function(){e(".ui-dialog").filter(":visible").focus()}),e("#FreezeLayer").click(function(){e(".ui-dialog").filter(":visible").focus()})}else{var n=l[JSONConstants.FOCUS_TYPE];showAlertDialog(i),n?getObj(n).focus():getObj("desiredValue").focus()}},m=function(){var e=new RequestParameters(ActionConstants.GOAL_SEEK_CANCEL);e.setParameters(WorkSheets.getAssociatedActiveSheetName(),n,r);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText),l=t.clientUpdateJson;updateJson(l),C()}),t.sendRequest()},R=function(){var e=new RequestParameters(ActionConstants.SUBMIT);e.setParameters(WorkSheets.getSheetCodeFromName(n),u,d,encodeURIComponent(v),!1,u,d,u,d,null);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t),C()},A=function(e){var t;return t=window.event?window.event.keyCode:e.which,13===t?S():t===Event.KEY_ESC?C():!1};return{init:g,submitCancel:m,submitOk:R,submitOnEnter:A,submit:S}}(jQuery);var Print=function(e){var t={a4:{n:"A4",w:"8.27",h:"11.69",i:"0",iW:"53px",iH:"72px"},letter:{n:"Letter",w:"8.5",h:"11",i:"1",iW:"59px",iH:"70px"},legal:{n:"Legal",w:"8.5",h:"14",i:"2",iW:"59px",iH:"78px"},executive:{n:"Executive",w:"7.25",h:"10.5",i:"3",iW:"50px",iH:"69px"},envelope10:{n:"Envelope #10",w:"4.13",h:"9.5",i:"4",iW:"26px",iH:"61px",dO:"1"}},n=5,r=!1,a="A4",s=null,o=null,l="0.5",p="0.5",g="0.5",u="0.5",c=0,d=0,h=0,v=!1,f=!1,m=null,w=null,P=null,b=!1,C="",_=[],R=function(){return allowExport?(T(),void A()):!1},T=function(){v=!1,d=0,h=0,$=0,et=0,_=[],r=!1},A=function(){var e={width:560,modal:!0,title:jsMsg["Print.PrintSettings"]},t={set:function(e,t){var n=e.action;switch(n){case"changePaperSize":S();break;case"changePageDimension":N();break;case"changeMargin":O(e.arg,t);break;case"changeOption":ct(e.arg);break;case"changeOrientation":F(e.arg)}},init:function(){setTimeout(function(){j()},200)}};sheetdialog.open("printdialog",e,t)},E=function(){sheetdialog.close()},S=function(){var n=e("#print_paperSize").zcombo("getValue");if("custom"==n)return D(!1),a="Custom",!1;if(a==t[n].n)return!1;D(!0),a=t[n].n;var i=0==c?t[n].w:t[n].h,r=0==c?t[n].h:t[n].w;M(i,r),k(t[n])},D=function(t){return t&&I()?!1:void(t?(e("#print_previewDiv").show(),e("#print_previewImgLabelHeight").show(),e("#print_noPreview").hide()):(e("#print_previewDiv").hide(),e("#print_previewImgLabelHeight").hide(),e("#print_noPreview").show()))},I=function(){return e("#print_previewDiv").is(":visible")},M=function(t,n){s=t,o=n,e("#print_paperWidth").zspinner("setValue",t+'"'),e("#print_paperHeight").zspinner("setValue",n+'"')},k=function(n){if(!I())return!1;"string"==typeof n&&(n=t[n]);var i=0==c?n.w:n.h,r=0==c?n.h:n.w,a=0==c?n.iW:n.iH,s=0==c?n.iH:n.iW,o=e("#print_previewImgLabelHeight");o.html(r+"&quot;"),e("#print_previewImgLabelWidth").html(i+"&quot;");var l=e("#print_previewImg");l.width(a),l.height(s);var p=0==c?"30px":4!=n.i?"22px":"8px";o.css("marginTop",p)},N=function(){var e=V();if(isNaN(e.w)||isNaN(e.h))return!1;var n=e.w,i=e.h;for(x in t){var r=Math.abs(0==c?n:i),l=Math.abs(0==c?i:n);if(s=r,o=l,s==t[x].w&&o==t[x].h)return z(t[x].i),k(t[x]),a=t[x].n,!1}z(),a="Custom"},V=function(){return{w:e("#print_paperWidth").zspinner("getValue"),h:e("#print_paperHeight").zspinner("getValue")}},z=function(t){t?D(!0):(t=n,D(!1)),e("#print_paperSize").zcombo("setSelectedIndex",t)},O=function(e,t){switch(e){case"l":l=t;break;case"r":p=t;break;case"t":g=t;break;case"b":u=t}},W=function(){var e=L(l)+"px",t=L(p)+"px",n=L(g)+"px",i=L(u)+"px",r="margin:"+n+" "+t+" "+i+" "+e;return r},L=function(e){return Math.round(96*e)},j=function(){var n=a.replace(/\#/g,"").replace(" ","").toLowerCase(),i="custom"==n.toLowerCase()?!1:!0;e("#print_paperSize").zcombo("setValue",n),"custom"!=n.toLowerCase()&&(s=c?t[n].h:t[n].w,o=c?t[n].w:t[n].h),s&&o&&(e("#print_paperWidth").zspinner("setValue",s+'"'),e("#print_paperHeight").zspinner("setValue",o+'"')),D(i),k(n),F(c);var d=getCellRange();r=isCellRange()&&d.startRow<=usedCursRow&&d.startCol<=usedCursCol?!0:!1,r?(q(),w=!1,m=!1,P=!1):(U(),null==w&&null==m&&null==P&&(w=ole.getObjects("img").length>0?!0:!1,m=ole.getObjects("chart").length>0?!0:!1,P=ole.getObjects("button").length>0?!0:!1)),e("#print_addCharts").attr("checked",m),e("#print_addImages").attr("checked",w),e("#print_addGridLines").attr("checked",f),e("#print_addButtons").attr("checked",P),e("#print_fitToWidth").attr("checked",b),e("#buttonSpn").show(),jsREMOTE_SAVE_VIEW&&e("#buttonSpn").hide(),e("#print_leftMargin").zspinner("setValue",l),e("#print_rightMargin").zspinner("setValue",p),e("#print_topMargin").zspinner("setValue",g),e("#print_bottomMargin").zspinner("setValue",u)},F=function(t){var n=null!=t&&c==t?!1:!0;if(null!=t&&"1"==t?y():H(),n){var i=V();M(i.h,i.w),k(e("#print_paperSize").val())}},H=function(){c=0,e("#print_portraitOrient").attr("checked",!0)},y=function(){c=1,e("#print_landscapeOrient").attr("checked",!0)},q=function(){var t=e("#imageSpn"),n=e("#chartSpn"),i=e("#buttonSpn");t.children("input").attr("disabled",!0),n.children("input").attr("disabled",!0),i.children("input").attr("disabled",!0),t.addClass("hideImage"),n.addClass("hideImage"),i.addClass("hideImage")},U=function(){var t=e("#imageSpn"),n=e("#chartSpn"),i=e("#buttonSpn");t.children("input").attr("disabled",!1),n.children("input").attr("disabled",!1),i.children("input").attr("disabled",!1),t.removeClass("hideImage"),n.removeClass("hideImage"),i.removeClass("hideImage")},B=function(){return{l:e("#print_leftMargin").zspinner("getValue"),r:e("#print_rightMargin").zspinner("getValue"),t:e("#print_topMargin").zspinner("getValue"),b:e("#print_bottomMargin").zspinner("getValue")}},G=function(t){l="undefined"!=typeof t?t.l:e("#print_leftMargin").zspinner("getValue"),p="undefined"!=typeof t?t.r:e("#print_rightMargin").zspinner("getValue"),g="undefined"!=typeof t?t.t:e("#print_topMargin").zspinner("getValue"),u="undefined"!=typeof t?t.b:e("#print_bottomMargin").zspinner("getValue")},J=function(){var e=usedCursCol,t=usedCursRow;if(!r&&(m||w||P)){if(0!=ole.getObjects().length){for(var n=ole.getObjectsLeft(),i=ole.getObjectsTop(),a=[],s=[],o=0;o<ole.getObjects().length;o++)a[o]=n[o]+ole.getObjects()[o].width,s[o]=i[o]+ole.getObjects()[o].height;var l=Q(a),p=Q(s),g=findColInXPos(l,!0),u=findRowInYPos(p,!0);e=g>usedCursCol?g:usedCursCol,t=u>usedCursRow?u:usedCursRow}var c=Z(0,0,t,e);t=c.row,e=c.col}return{uR:t,uC:e}},Z=function(e,t,n,i){var r=Merge.getIterator(e,t,n,i),a={row:n,col:i};r.initData(a),r.setDataProcessor(function(e,t){var n=this.getData();return n.row=n.row<e?e:n.row,n.col=n.col<t?t:n.col,n}),r.iterate(function(e,t){var n=this.getMerge().getRowSpan()+e,i=this.getMerge().getColSpan()+t;this.processData(n,i)});var s=r.getData();return s},Q=function(e){var t=e[0];for(i=1;i<e.length;i++)e[i]>t&&(t=e[i]);return t},X=function(t){var n=V();if(isNaN(n.w)||isNaN(n.h)||n.w<1||n.h<1)return showAlertDialog(jsMsg["Print.InvalidPageFormat"]),!1;var i=B();if(isNaN(i.l)||isNaN(i.r)||isNaN(i.t)||isNaN(i.b))return showAlertDialog(jsMsg["Print.InvalidPageMargin"]),!1;if(n.w-(parseFloat(i.l)+parseFloat(i.r))<1||n.h-(parseFloat(i.t)+parseFloat(i.b))<1)return showAlertDialog(jsMsg["Print.InvalidPageMargin"]),!1;e("#hintCallout").hide(),G(i),"custom"==a.toLowerCase()&&(s=n.w,o=n.h);var r=J();return h=r.uR,d=r.uC,0!=h||0!=d||getCellValue(getCell(0,0))||showConfirmDialog(jsMsg["Print.BlankSheetWarningMessage"])?(focusRemembering.setWorkbookData(),E(),void("PREVIEW"===t?it(t):Y(t))):!1},Y=function(e){var t=s,n=o,i="SHEET",a=g+":"+l+":"+u+":"+p,v="0:0:"+h+":"+d;if(r){var C=getCellRange();v=C.startRow+":"+C.startCol+":"+C.endRow+":"+C.endCol,i="RANGE"}exportFlag=!0;var _=document.pdfFORM;_.sheetName.value=CURRSHEETNAME,_.margin.value=a,_.range.value=v,_.paperWidth.value=t,_.paperHeight.value=n,_.addGridLine.value=f,_.addChart.value=m,_.addButton.value=P,_.addImage.value=w,_.fitToWidth.value=b,_.orientation.value=c,_.outputType.value=e,_.printType.value=i;var R=new RequestParameters(ActionConstants.PDF_PRINT);if(_.action=R.getURL()+"?"+R.getParametersAsString(),isPublished||(_.target="hid_imp_doc"),_.method="POST",!_[csrfParamName]){var T=document.createElement("input");T.setAttribute("type","hidden"),T.setAttribute("name",csrfParamName),T.setAttribute("value",readCookie(csrfCookieName)),_.appendChild(T)}_.submit(),exportFlag=!1},K=!1,$=0,et=0,tt=1,nt=!1,it=function(t){K||(e.ui.utils.initComponents(e("#printToolbar")),e("#printPageContainer").on("scroll",function(){mt(this)}),e("#currPageIdx").on("change",function(){wt(this)}),e(".Pagination_Btn").on("click",function(){wt(this)}),K=!0),showProgressMessage(jsMsg["Print.ProgressMessage1"]),dt();var n=s,i=o,a="SHEET",v=g+":"+l+":"+u+":"+p,C="0:0:"+h+":"+d;if(r){var _=getCellRange();C=_.startRow+":"+_.startCol+":"+_.endRow+":"+_.endCol,a="RANGE"}var R=new RequestParameters(ActionConstants.PDF_PRINT_PREVIEW);R.setParameters(1,CURRSHEETNAME,v,C,n,i,f,m,w,P,b,c,t,a);var T=new AjaxRequest;T.init("POST",R.getURL(),!0,R.getParametersAsString()),T.addEventListener("onComplete",function(e){hideProgressMessage();var t=parseJSON(e.responseText);at(t)}),T.sendRequest(),rt(),ot(1),st(1)},rt=function(){e("#widgetDIV").hide(),e("#printPreviewDiv").show(),e("#imgContainer").html("");{var t=L(s);L(o)}e("#imgContainer").css("width",t),e("#printPreviewContainer").css("width",clientWidth)},at=function(t){if(t)if("NO DATA"==t.RESULT||"FAILED"==t.RESULT){var n=jsMsg["Print.PreviewNotAvailable"]+", "+jsMsg["Error.Alert.Suffix.WhileOpeningtheDocument"];sheetdialog.showAlertDialog(n),R()}else"PREVIEW"==t.A&&(e("#imgContainer").html(""),C=t.CT,et=t.GPC,$=t.TPC,nt=t.WD,ot($),st($));else{var n=jsMsg["Print.ErrorMsg"],i=jsMsg["Print.PleaseTryAgain"];showBannerMessage("ERROR",n+" "+i,!0)}},st=function(t){e("#totPages").html(t),e("#currPageIdx").val(1),ht(),e("#printPageContainer").scrollTop(0)},ot=function(t){for(var n=e("#imgContainer"),i=L(s),r=L(o)-72,a="margin-bottom:10px; width:"+i+"px;  height: "+r+"px",l=W(),p=1;t>=p;p++){var g=e("<div/>",{style:a,class:"shadow"}).appendTo(n),u=e("<div/>",{id:"loading_"+p,class:"spinner"}).appendTo(g);e("<div/>",{class:"bounce1"}).appendTo(u),e("<div/>",{class:"bounce2"}).appendTo(u),e("<div/>",{class:"bounce3"}).appendTo(u);var c=e("<img/>",{id:"pImg_"+p,style:l}).appendTo(g);pt(c,p),et>=p&&(lt(c,p),_.push(p))}},lt=function(t,n,r){e("#progressBarFill_"+i).animate({width:"90%"},1e3);var a=WorkSheets.getAssociatedActiveSheetName().replace("#",""),s=a+"_"+n,o=new RequestParameters(ActionConstants.PDF_DATA);o.setParameters("image",C,s);var l=o.getURL()+"?"+o.getParametersAsString();r&&(l+="#"+r),t.attr("src",l)},pt=function(t,n){t.on("error",function(){var i=e(t).parent();e(t).hide(),e("#loading_"+n).hide();var r=WorkSheets.getAssociatedActiveSheetName().replace("#",""),a=r+"_"+n;if(!e("#imgFailContiner_"+n).length){var s=e("<div/>",{id:"imgFailContiner_"+n,class:"imgFailContiner"}).appendTo(i);e("<div/>",{class:"warningIconGrey animatedBounce",style:"margin:0 auto; margin-bottom:5px"}).appendTo(s);var o=e("<span/>",{text:jsMsg["Print.PreviewNotAvailable"]+", ",style:"font-size:14px; color:#7C7272"}).appendTo(s),l=e("<a/>",{href:"#",text:jsMsg["Print.TryAgain"],style:"color:#0094FF; font:inherit"}).appendTo(o);l.on("click",function(){gt(a,n)})}}).on("load",function(){e("#loading_"+n).remove()})},gt=function(t,n){var i=new RequestParameters(ActionConstants.PDF_DATA),r=new AjaxRequest;i.setParameters("refresh",C,t),r.init("POST",i.getURL(),!0,i.getParametersAsString()),r.addEventListener("onComplete",function(){var t=e("#pImg_"+n);t.show(),lt(t,n,Date.now()),e("#imgFailContiner_"+n).remove()}),r.sendRequest()},ut=function(t){var n=new RequestParameters(ActionConstants.PDF_PRINT_PREVIEW);n.setParameters(t);var r=new AjaxRequest;r.init("POST",n.getURL(),!0,n.getParametersAsString()),r.addEventListener("onComplete",function(t){var n=parseJSON(t.responseText);if("NO DATA"!=n.RESULT){var r=n.LOADED,a=r.length;for(et=n.GPC,nt=n.WD,i=0;a>i;i++){var s=e("#pImg_"+r[i]);lt(s,r[i]),_.push(r[i])}}}),r.sendRequest()},ct=function(e){switch(e){case"gridLines":f=!f;break;case"charts":m=!m;break;case"images":w=!w;break;case"buttons":P=!P;break;case"fitToWidth":b=!b;break;case"download":v=!v}},dt=function(){var e=new RequestParameters(ActionConstants.PDF_DATA),t=new AjaxRequest;e.setParameters("delete",C),t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()},ht=function(){clientDim=findClientDim();var t=(clientDim.height,clientDim.width),n=e("#printToolbar").length>0?e("#printToolbar").height():45,i=e("#main").length>0?e("#main").offset().top:35,r=e("#wmstoolbar").length>0?e("#wmstoolbar").height():0;0==r&&e("#editorDialog").css("bottom","0px");var a=clientHeight-(n+i+r);try{e("#printPageContainer").css({height:a+"px",width:t+"px"}),e("#printToolbar").css("width",t+"px");var s=e("#imgContainer"),o=t-(s.offset().left+s.width()+10);e("#printBtnCont").css("right",o+"px")}catch(e){}},vt=function(){dt(),e("#pageIframe").attr("src",ctxpath+"pages/blank.html"),e("#printPreviewDiv").hide(),e("#widgetDIV").show(),ISFREEZED&&SHEET.FREEZE.resetVariables(),sheetopen("open",!0),resizeHScrollbarToDefaultWidth()},ft=function(e){switch(e){case"backToEditor":vt();break;case"saveAsPDF":Y("PDF");break;case"Print":Y("PRINT");case"Close":E()}},mt=e.debounce(300,function(t){var n=L(o)-72,i=t.scrollTop,r=Math.ceil(i/n);tt!=r&&r>0&&(e("#currPageIdx").val(r),tt=r,_.contains(r)||nt||ut(r))}),wt=function(t){var n=1,i=t.id;switch(i){case"fImg":n=1;break;case"pImg":n=tt-1;break;case"nImg":n=tt+1;break;case"lImg":n=$;break;default:n=t.value}if($>=n){var r=e("#imgContainer").children()[n-1].offsetTop;e("#printPageContainer").stop().animate({scrollTop:r},1500,"easeInOutCubic"),_.contains(n)||nt||ut(n)}};return appEvent.on("print.resize",function(){ht()}),{init:R,validate:X,doAction:ft}}(jQuery);var FormatCells=function(e){var t,a,o="",r=!1,s=!1,n=!1,l=!1,m=!1,c=!1,u=!1,d=!1,g=!1,f=!1,v=!1,p=!1,_=!1,F="",C="",b=!0,O=!0,T=!1,y=!0,A=!0,j="",h=!1,E="",R=function(){r=!1,n=!1,l=!1,m=!1,c=!1,u=!1,d=!1,g=!1,f=!1,v=!1,p=!1,_=!1},S=function(){if(R(),"format_automatic"==o)r=!0,T=!0;else if("format_numbers"==o){n=!0,T=!0;var t=e("#decimals_format_numbers"),a=e("#leading_zeroes_format_numbers");t.val()<0&&t.zspinner("setValue",2),a.val()<0&&a.zspinner("setValue",1)}else if("format_currency"==o){l=!0,T=!0;var s=e("#decimals_format_currency"),i=e("#leading_zeroes_format_currency");s.val()<0&&s.zspinner("setValue",2),i.val()<0&&i.zspinner("setValue",1)}else if("format_datetime"==o)m=!0,T=!0;else if("format_duration"==o)c=!0,T=!0;else if("format_percentage"==o){u=!0,T=!0;var F=e("#decimals_format_percentage");F.val()<0&&F.zspinner("setValue",2)}else if("format_fraction"==o)d=!0,T=!0;else if("format_scientific"==o){g=!0,T=!0;var C=e("#decimals_format_scientific");C.val()<0&&C.zspinner("setValue",2)}else"format_text"==o?(f=!0,T=!0):"format_regional"==o?(v=!0,T=!0):"format_special"==o?(p=!0,T=!0):"format_custom"==o&&(_=!0,T=!0)},M=function(e,t){var a={init:function(){getObj("div_language_format_numbers").style.display="none",getObj("div_language_format_currency").style.display="none",getObj("div_language_format_datetime").style.display="none",getObj("div_language_format_percentage").style.display="none",getObj("div_language_format_scientific").style.display="none","showCustomTab"==j?(o="format_custom",S(),U(getObj(o))):D()},set:function(e){var t=e.action;switch(t){case"negative_format_currency":case"negative_format_numbers":case"language_format_numbers":case"currencySymbol":case"decimals_format_currency":case"decimals_format_numbers":case"leading_zeroes_format_numbers":case"decimals_format_percentage":case"decimals_format_scientific":H(t,"generate");break;default:H(void 0,"generate")}}};isUndefined(e)&&(e=""),currRow=ActiveCellInfo.getActiveRow(),currCol=ActiveCellInfo.getActiveCol();var r=isCellRange();if(r)var s=getCellRange();var n=r?s.startRow:currRow,i=r?s.startCol:currCol,l=r?s.endRow:currRow,m=r?s.endCol:currCol;if(!ProtectedRanges.isRangeLocked(n,i,l,m)){scrollCellIntoView(n,i);var c=new RequestParameters(ActionConstants.JSP_FORMATCELLS);c.setParameters(n,l,i,m,currRow,currCol,CURRSHEETNAME,e,t),j=e;var u=c.getURL()+"?"+c.getParametersAsString(),d={width:575,modal:!0,title:jsMsg.FormatCells,close:function(){dt()}};setTimeout(function(){sheetdialog.open("formatCellsDialog",d,a,void 0,u)},100)}},D=function(){var t=e("#formatType").val();o=t,S();var a=e("#formatString").val(),s=e("#negFrmt").val(),i=e("#langCntry").val(),f=e("#isGroupingUsed").val(),p=e("#decimals").val(),b=e("#leadingzeroes").val(),O=e("#symbol").val(),T=e("#dateFrmt").val(),y=e("#timeFrmt").val(),A=e("#durationFrmt").val(),j=e("#regionalFrmt").val();if(F=a,C=e("#isCustomFormat").val(),r);else if(n||l){if(x(e("#language_"+t),i),n&&(e("#decimals_format_numbers").zspinner("setValue",p),e("#leading_zeroes_format_numbers").zspinner("setValue",b),e("#negative_format_numbers").zcombo("setSelectedIndex",s)),l&&(e("#decimals_format_currency").zspinner("setValue",p),e("#leading_zeroes_format_currency").zspinner("setValue",b),e("#negative_format_currency").zcombo("setSelectedIndex",s)),"true"==f){var h="thousands_"+t;getObj(h).checked="checked"}else{var h="thousands_"+t;getObj(h).checked=""}x(e("#language_"+t),i),l&&x(getObj("currencySymbol"),O)}else m?(x(getObj("time"),y),x(getObj("date"),T),x(getObj("#language_format_datetime"),i)):c?x(getObj("duration"),A):u?(e("#decimals_format_percentage").zspinner("setValue",p),x(e("#language_"+t),i)):d?x(getObj("fraction_Format"),a):g?(e("#decimals_format_scientific").zspinner("setValue",p),x(e("#language_"+t),i)):v?(x(getObj("country"),i),x(getObj("regionalFormat"),j)):_&&(F=a);U(getObj(t)),getObj("formatCategory").focus()},I=function(){var e=new RequestParameters(ActionConstants.JSP_CUSTOM),t=e.getURL()+"?"+e.getParametersAsString(),a={width:810,modal:!0,title:jsMsg.FormatCells,close:function(){N()}};sheetdialog.close(),sheetdialog.open("customfrmtdialog",a,w,void 0,t)},w=function(){e("#customFormat").focus()},N=function(){O&&M("showCustomTab")},U=function(t){if(null!=t){""!=o&&(getObj(o+"_table").style.display="none",getObj(o).className=""),t="formatCategory"==t.id?t.options[t.selectedIndex].value:t.value;var a=getObj(t);if(a.className="selected",o=a.id,S(),e("#"+a.id+"_table").show(),x(getObj("formatCategory"),o),_){{getObj("customFormats"),e("#quickApplyCusFrmt")}e("#quickApplyCusFrmt").each(function(){this.value=e(this).attr("title"),e(this).addClass("frmttext-label")}),H(void 0,"readCustomFormats")}else H(void 0,"generate")}},P=function(e){if("tab1"==e){getObj("previewDIV").style.display="",getObj("formatCodeDIV").style.display="none";var t=getObj(e);if(-1==t.className.indexOf("selected")){t.className+=" selected";var a=getObj("tab2").className,o=a.replace("selected","");getObj("tab2").className=o}}else if("tab2"==e){getObj("formatCodeDIV").style.display="",getObj("previewDIV").style.display="none";var r=getObj(e);if(-1==r.className.indexOf("selected")){r.className+=" selected";var a=getObj("tab1").className,o=a.replace("selected","");getObj("tab1").className=o}}},x=function(e,t){if(e&&e.options)for(i=0;i<e.options.length;i++){var a=e.options[i].value.toUpperCase();if(a==t.toUpperCase())return e.selectedIndex=i,!0}return!1},L=function(e){var t=e.selectedIndex;return t},V=function(e){var t,a=e.selectedIndex;return-1!=a&&(t=e.options[a].value),t},k=function(e,t){var a=t.id,o=a.split("_")[1];e=o;var r=getObj("customFormatSPAN_"+e);if(-1!=a.indexOf("customFormatEditTD_"))mt(),E=r,r.style.display="none",getObj("customFormatEditTD_"+e).style.display="none",getObj("customFormatDeleteTD_"+e).style.display="none",getObj("customFormatINPUT_"+e).innerHTML=r.innerHTML,getObj("customFormatINPUT_"+e).style.display="",getObj("customFormatUpdateTD_"+e).style.display="",getObj("customFormatCancelTD_"+e).style.display="",getObj("customFormatINPUT_"+e).focus();else if(-1!=a.indexOf("customFormatUpdateTD_")){var s=getObj("customFormatINPUT_"+e).value;if(""==s.trim())return getObj("customFormatINPUT_"+e).focus(),void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"]);if(it(s))return void getObj("customFormatINPUT_"+e).focus();var n=getObj("customFormatTR_"+e),i=parseInt(n.getAttribute("index"));q(i,s)}else if(-1!=a.indexOf("customFormatCancelTD_")){var l=getObj("customFormatINPUT_"+e);r.style.display="",getObj("customFormatEditTD_"+e).style.display="",getObj("customFormatDeleteTD_"+e).style.display="",l.style.display="none",getObj("customFormatUpdateTD_"+e).style.display="none",getObj("customFormatCancelTD_"+e).style.display="none"}else if(-1!=a.indexOf("customFormatDeleteTD_")){var n=getObj("customFormatTR_"+e),i=parseInt(n.getAttribute("index"));B(i,e)}},z=function(e,t){var a,o;if(window.event)a=window.event.keyCode;else{if(!t)return!0;a=t.which}if(o=String.fromCharCode(a),13==a)if("customFormat"==e.id)H(void 0,"saveCustomFormats");else{var r=e.id.split("_"),s=r[1],n=getObj("customFormatTR_"+s),i=getObj(n).innerHTML;if(""==i.trim())return void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"]);var l=n.getAttribute("index"),m=getObj("customFormatINPUT_"+s).value;q(l,m)}},q=function(e,t){var a=/^\[.*\]$/g;a.exec(t)&&(t+=" ");var o="CUSTOM",r="updateCustomFormats",s="{";s+='"formatType":"'+o+'","frmtAction":"'+r+'","format":"'+encodeURIComponent(t)+'","index":"'+e+'"',s+="}",ot(s,"updateCustomFormats")},B=function(e,t){var a="CUSTOM",o="deleteCustomFormats",r="{";r+='"formatType":"'+a+'","frmtAction":"'+o+'","index":"'+e+'"',r+="}",ot(r,"deleteCustomFormats",t)},H=function(t,a,o){if(_){var s=getObj("quickApplyCusFrmt");s&&s.value!=s.title&&("submit"===a&&(a="saveAndApplyCustomFormats"),"generate"===a&&(s.value=s.title,e("#quickApplyCusFrmt").addClass("frmttext-label")));var i=e("#customFormats").find(":selected").text();s&&s.value==s.title&&"submit"===a&&""==i&&(_=!1,r=!0)}if(_&&"frmtGridAction"==o&&h&&"saveAndApplyCustomFormats"!=a)return sheetdialog.close(),!1;("negative_format_numbers"==t||"negative_format_currency"==t)&&st(t),b="regionalFormat"==t?!1:!0,y="dateTimeFormat"==t?!1:!0,A="durationFormat"==t?!1:!0;var F="";if("generate"==a)t=document.forms.formatCellsForm;else if(m){var C=getObj("date"),O=getObj("time"),T=L(C),j=L(O);if("none"==C.options[T].value&&"none"==O.options[j].value)return showAlertDialog(jsMsg["FormatCells.DateTime.AlertMessage"]),!1}if(r)F+=W();else if(n)F+=Y();else if(l)F+=J();else if(m)F+=Q();else if(c)F+=X();else if(u)F+=$();else if(d)F+=Z();else if(g)F+=K();else if(f)F+=et();else if(v)F+=tt();else if(p)F+=appendNVPforSpecial(t);else if(_)if("readCustomFormats"!=a){if("saveCustomFormats"==a||"saveAndApplyCustomFormats"==a){var E=getObj("quickApplyCusFrmt");E||(E=getObj("customFormat"));var R=E.value;if(R=R.replace(/,/g,""),""==R.trim())return E.focus(),void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"])}var s=getObj("quickApplyCusFrmt");s&&s.value===s.title;var S=at(t,a);if(!S)return;F+=S}else"generate"!=a&&(F+=at(t,a));return ot(F,a,o),!1},G=function(e,t,a,o,r){isUndefined(e)&&(e="false");var s=getAvailableStartRow(),n=getAvailableEndRow();if(isUndefined(t))if(isCellRange()){var i=getCellRange();t=i.startRow,a=i.startCol,o=i.endRow,r=i.endCol}else t=o=currRow;var l="docid="+DOCUMENT_ID+"&sheetname="+encodeURIComponent(CURRSHEETNAME)+"&curtime="+CURRENTTIME+"&viewType="+getViewType();return l+="&readwrite="+ALLOW_TO_WRITE+"&docowner="+CURR_DOC_OWNERNAME+"&collabid="+COLLAB_ID+"&collabEditing="+COLLABORATIVE_EDITING,l+="&currentSelection="+getCurrentSelection(),l+="&afterRTC="+e+"&startColumn="+a+"&endColumn="+r+"&startRow="+t+"&endRow="+o+"&currRow="+currRow+"&currCol="+currCol+"&isDocSaved="+isDocSaved(),l+="&availableStartRow="+s+"&availableEndRow="+n+"&totCols="+totCols,l+="&isColSelected="+isColSelected()+"&isRowSelected="+isRowSelected(),"true"==e&&(l+="&isSameSheet="+ISSAMESHEET+"&rtcSheetName="+encodeURIComponent(RTCSHEETNAME)),l},W=function(){var e="AUTOMATIC",t="generate",a="{";return a+='"formatType":"'+e+'","frmtAction":"'+t+'"',a+="}"},Y=function(){var t=e("#negative_format_numbers").zcombo("getSelectedIndex"),a=e("#thousands_format_numbers").is(":checked"),o=e("#decimals_format_numbers").zspinner("getValue"),r=e("#leading_zeroes_format_numbers").zspinner("getValue"),s=V(getObj("language_format_numbers")),n="NUMBER",i="generate",l="{";return l+='"formatType":"'+n+'","negFrmt":"'+t+'","thousandsep":"'+a+'","decimals":"'+o+'","leadingzeroes":"'+r+'","language":"'+s+'","frmtAction":"'+i+'"',l+="}",ct(s),l},J=function(){var t=V(getObj("currencySymbol")),a=V(getObj("negative_format_currency")),o=e("#thousands_format_currency").is(":checked"),r=e("#decimals_format_currency").zspinner("getValue"),s=e("#leading_zeroes_format_currency").zspinner("getValue"),n=V(getObj("language_format_currency")),i="CURRENCY",l="generate",m="{";return m+='"formatType":"'+i+'","negFrmt":"'+a+'","thousandsep":"'+o+'","decimals":"'+r+'","leadingzeroes":"'+s+'","language":"'+n+'","symbol":"'+t+'","frmtAction":"'+l+'"',m+="}",ct(n),m},Q=function(){var e="DATETIME",t="generate",o="",r=V(getObj("date")),s=V(getObj("time"));"none"==s?e="DATE":o=s,"none"==r?"none"!=s&&(e="TIME"):o=""!=o?r+" "+o:r,a=V(getObj("language_format_datetime")),ct(a);var n="{";return n+='"formatType":"'+e+'","format":"'+o+'","language":"'+a+'","frmtAction":"'+t+'"',n+="}"},X=function(){var e="TIME",t="generate",a=V(getObj("duration")),o="{";return o+='"formatType":"'+e+'","format":"'+encodeURIComponent(a)+'","frmtAction":"'+t+'"',o+="}"},$=function(){var t=e("#decimals_format_percentage").zspinner("getValue"),a=V(getObj("language_format_percentage"));ct(a);var o="PERCENTAGE",r="generate",s="{";return s+='"formatType":"'+o+'","decimals":"'+t+'","language":"'+a+'","frmtAction":"'+r+'"',s+="}"},Z=function(){if(getObj("fraction_Format"))var e=V(getObj("fraction_Format"));else var e=fractionType;var t="FRACTION",a="generate",o="{";return o+='"formatType":"'+t+'","format":"'+e+'","frmtAction":"'+a+'"',o+="}"},K=function(){var t=e("#decimals_format_scientific").zspinner("getValue"),a=V(getObj("language_format_scientific"));ct(a);var o="SCIENTIFIC",r="generate",s="{";return s+='"formatType":"'+o+'","decimals":"'+t+'","language":"'+a+'","frmtAction":"'+r+'"',s+="}"},et=function(){var e="TEXT",t="generate",a="{";return a+='"formatType":"'+e+'","frmtAction":"'+t+'"',a+="}"},tt=function(){var e=V(getObj("country")),t=V(getObj("regionalFormat")),a="REGIONAL",o="generate",r="{";return r+='"formatType":"'+a+'","format":"'+t+'","language":"'+e+'","frmtAction":"'+o+'"',r+="}"},at=function(e,t){if("saveCustomFormats"==t||"saveAndApplyCustomFormats"==t){var a=getObj("quickApplyCusFrmt");a||(a=getObj("customFormat")),e=a.value}else{var o=getObj("customFormats");if("readCustomFormats"!=t&&!o)return sheetdialog.close(),!1;("generate"==t||"submit"==t)&&(e=getObj("customFormats").value)}var r=/^\[.*\]$/g;r.exec(e)&&(e+=" ");var s="CUSTOM",n=t,i="{";return i+="readCustomFormats"==t?'"formatType":"'+s+'","frmtAction":"'+n+'"':'"formatType":"'+s+'","format":"'+encodeURIComponent(e)+'","frmtAction":"'+n+'"',i+="}"},ot=function(e,t,a){if(!T&&"true"!=s)return void sheetdialog.close();isUndefined(t)&&(t="",loadon()),O="saveAndApplyCustomFormats"==t?!1:!0;var o=getCellRange(),r=o.startRow,n=o.startCol,i=o.endRow,l=o.endCol;if(void 0!=a&&"frmtGridAction"==a)if("saveAndApplyCustomFormats"==t){var m=new RequestParameters(ActionConstants.FORMATCELLS_CLIENT);m.setParameters(WorkSheets.getAssociatedActiveSheetName(),r,n,i,l,currRow,currCol,e);var c=new AjaxRequest;c.init("POST",m.getURL(),!0,m.getParametersAsString()),c.addEventListener("onComplete",function(t){var a=parseJSON(t.responseText);if(null!=a.cusFrmtStatus&&"FormatNotSupported"==a.cusFrmtStatus){var o=getObj("UpdatingFrmt");return o&&(o.style.display="none"),void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"])}var s=new RequestParameters(ActionConstants.FORMATCELLS_GRID);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),r,n,i,l,e);var m=new AjaxRequest;m.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(m),T=!1,y=!0,sheetdialog.close()}),c.sendRequest()}else{var m=new RequestParameters(ActionConstants.FORMATCELLS_GRID);m.setParameters(WorkSheets.getAssociatedActiveSheetName(),r,n,i,l,e);var c=new AjaxRequest;c.init("POST",m.getURL(),!0,m.getParametersAsString()),actionManager.addRequest(c),T=!1,y=!0,sheetdialog.close()}else{var m=new RequestParameters(ActionConstants.FORMATCELLS_CLIENT);m.setParameters(WorkSheets.getAssociatedActiveSheetName(),r,n,i,l,currRow,currCol,e);var c=new AjaxRequest;c.init("POST",m.getURL(),!0,m.getParametersAsString()),c.addEventListener("onComplete",function(e){var a=parseJSON(e.responseText);rt(t,a)}),c.sendRequest()}},rt=function(a,o){if("generate"==a){var r,s,i,u,d,g,f,p=null,_=o.format;if(_){var T=_.preview,j=decodeURIComponent(_.formatcode);if(p=_.color,n){var E=e("#negative_format_numbers"),R=E.find("option");r=_.firstoption,s=_.secondoption,i=_.thirdoption,u=_.fourthoption,d=_.fifthoption,R.eq(0).text(r),R.eq(1).text(s),R.eq(2).text(i),R.eq(3).text(u),R.eq(4).text(d),E.zcombo("refresh")}if(l){var S=e("#negative_format_currency"),M=S.find("option");r=_.firstoption,s=_.secondoption,i=_.thirdoption,u=_.fourthoption,d=_.fifthoption,M.eq(0).text(r),M.eq(1).text(s),M.eq(2).text(i),M.eq(3).text(u),M.eq(4).text(d),S.zcombo("refresh")}if(y&&m){var D=getObj("date"),I=getObj("time");f=_.datetimepatterns;var w=f.datePatterns,N=f.timePatterns;D.options.length=w.length,I.options.length=N.length;for(var U=0;U<w.length;U++)D.options[U]=new Option(w[U],w[U]),D.options[0].selected="selected";for(var U=0;U<N.length;U++)I.options[U]=new Option(N[U],N[U]),I.options[0].selected="selected";var P=e("#dateFrmt").val(),L=e("#timeFrmt").val();if(x(getObj("time"),L),x(getObj("date"),P),"none"==L&&"none"==P)return getObj("previewDIV").innerHTML="",void(getObj("formatCodeText").value="");H("dateTimeFormat","generate")}if(A&&c){var V=getObj("duration");f=_.datetimepatterns;var k=f.durationPatterns;V.options.length=k.length;for(var U=0;U<k.length;U++){var z=decodeURIComponent(k[U]);V.options[U]=new Option(z,z)}V.options[0].selected="selected";var q=e("#durationFrmt").val();x(getObj("duration"),q),H("durationFormat","generate")}var B=0;if(b&&v){g=_.regional;var G=getObj("regionalFormat");for(var W in g){B+=1;{var Y=W;g[W]}G.options[B-1]=new Option(jsMsg["FormatCells."+Y],Y),1==B&&(G.options[0].selected="selected")}0==B?(G.options.length=0,T="",j=""):(x(getObj("regionalFormat"),e("#regionalFrmt").val()),H("regionalFormat","generate"))}getObj("previewDIV").innerHTML=escapeSpecialCharacters(T),getObj("previewDIV").style.color=null!=p?p:"#000000",getObj("formatCodeText").value=j}}else if("readCustomFormats"==a){var J=0,Q="",X=getObj("customFormatsTD"),$=!0,Z=o,K=Z.USERLEVELCUSTOMFORMATS;t=K;var et="submit",tt="generate",at="<select id='customFormats' size='9' style='width:100%' onchange=\"return FormatCells.submitCustomFormatData(undefined,'"+tt+"');\"ondblclick=\"return FormatCells.submitCustomFormatData(undefined,'"+et+"','frmtGridAction');\">",ot=getViewType();if("false"==C&&($=!1),"PUBLIC_VIEW"!=ot&&"REMOTE_VIEW"!=ot&&"REMOTE_SAVE_VIEW"!=ot&&void 0!=K&&(J=K.length,J>0)){X.vAlign="top";var rt="";at+="<optgroup label='"+jsMsg["FormatCells.UserLevelFormats"]+"'>";for(var U=0;J>U;U++){Q="";var st=decodeURIComponent(K[U]);$&&""!=F&&st==F&&(Q="selected",$=!1),rt=st,rt=rt instanceof Array?nt(st):escapeSpecialCharacters(nt(st)),at+="<option value='"+st+"'title ='"+st+"'"+Q+">"+rt+"</option>"}at+="</optgroup>",getObj("manageBtn").style.display="block"}$&&""!=F&&(X.vAlign="top","PUBLIC_VIEW"!=ot&&"REMOTE_VIEW"!=ot&&"REMOTE_SAVE_VIEW"!=ot&&(at+="<optgroup label='"+jsMsg["FormatCells.DocumentLevelFormat"]+"'>"),Q="selected",at+="<option value='"+F+"'title ='"+F+"'"+Q+">"+escapeSpecialCharacters(nt(F))+"</option>",Q="",at+="</optgroup>",0==J&&(getObj("manageBtn").style.display="block")),at+="</select>",X.innerHTML=at,""==F&&0==J?(X.vAlign="middle",X.className="manageFrmt",X.innerHTML="0 "+jsMsg["FormatCells.CustomFormats"],getObj("manageBtn").style.display="block",getObj("addBtn").style.display="none",getObj("previewDIV").innerHTML="",getObj("formatCodeText").value="",h=!0):(h=!1,H(void 0,"generate")),("PUBLIC_VIEW"==ot||"REMOTE_VIEW"==ot||"REMOTE_SAVE_VIEW"==ot)&&(getObj("manageBtn").style.display="none",getObj("addBtn").style.display="none",getObj("quickApplyCusFrmt").style.display="none")}else if("saveCustomFormats"==a){if(null!=o.cusFrmtStatus&&"FormatNotSupported"==o.cusFrmtStatus)return void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"]);var mt=getObj("customFormat"),Z=o;if(jQuery.isEmptyObject(Z))return void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"]);var ct=Z.COUNT,dt=Z.CUSTOMFORMAT;if(it(dt))return void getObj("customFormat").focus();var gt=getObj("customFormatTR");if(null!=gt&&!isUndefined(gt)){var ft=gt.parentNode;ft.removeChild(gt)}var vt=getObj("customFormatTbl"),pt=vt.rows.length,_t=getObj("customFormatTBody");void 0!=t?t.push(dt):(t=[],t.push(dt)),gt=document.createElement("TR"),gt.id="customFormatTR_"+pt,gt.className="trOdd ht",gt.setAttribute("index",ct);var Ft=dt;Ft=Ft instanceof Array?dt:escapeSpecialCharacters(dt);var Ct=document.createElement("TD");Ct.className="breakWrap",Ct.style.width="250px",Ct.style.valign="top",Ct.id="customFormatTD_"+pt,Ct.innerHTML="<textarea style='display: none;'  id='customFormatINPUT_"+pt+"' onkeypress='javascript:FormatCells.updateCustomFormatEnter(this, event);' class='editCusFormat'></textarea><span title='"+decodeURIComponent(Ft)+"' id='customFormatSPAN_"+pt+"'>"+decodeURIComponent(Ft)+"</span></td>",gt.appendChild(Ct);var bt=document.createElement("TD");bt.style.width="80px",bt.style.valign="top",bt.align="center",bt.innerHTML="<a href='javascript:void(0);'  onclick='FormatCells.customFormatActions(0, this);' id='customFormatEditTD_"+pt+"' class='trActionLink'>Edit</a><a href='javascript:void(0);'   onclick='FormatCells.customFormatActions(0, this);' style='display: none;' id='customFormatUpdateTD_"+pt+"' class='trActionLink'>Update</a><span class='linkSep'> | </span><a href='javascript:void(0);' onclick='FormatCells.customFormatActions(0, this);' style='display: none;' id='customFormatCancelTD_"+pt+"' class='trActionLink'  >Cancel</a><a href='javascript:void(0);' onclick='FormatCells.customFormatActions(0, this);' id='customFormatDeleteTD_"+pt+"' class='trActionLink'  >Delete</a>",gt.appendChild(bt),_t.appendChild(gt),mt.value=""}else if("updateCustomFormats"==a){if(null!=o.cusFrmtStatus&&"FormatNotSupported"==o.cusFrmtStatus)return void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"]);var Z=o;if(jQuery.isEmptyObject(Z))return void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"]);var ct=Z.COUNT,dt=decodeURIComponent(Z.CUSTOMFORMAT),Ot=getObj("customFormatSPAN_"+ct),mt=getObj("customFormatINPUT_"+ct);lt(Ot.innerHTML),t.push(mt.value);var Tt=dt;Tt=Tt instanceof Array?dt:escapeSpecialCharacters(dt),Ot.innerHTML=Tt,Ot.style.display="",getObj("customFormatEditTD_"+ct).style.display="",getObj("customFormatDeleteTD_"+ct).style.display="",mt.style.display="none",getObj("customFormatUpdateTD_"+ct).style.display="none",getObj("customFormatCancelTD_"+ct).style.display="none"}else if("deleteCustomFormats"==a){var ct=o.cnt,gt=getObj("customFormatTR_"+ct);lt(getObj("customFormatSPAN_"+ct).innerHTML);var ft=gt.parentNode;ft.removeChild(gt);var vt=getObj("customFormatTbl"),yt=vt.rows.length;if(0==yt){var _t=getObj("customFormatTBody");gt=document.createElement("TR"),gt.id="customFormatTR",gt.className="trOdd";var At="<td align='center' height='305'> 0 "+jsMsg["FormatCells.CustomFormats"]+"</td>";gt.innerHTML=At,_t.appendChild(gt)}else ut()}else if("saveAndApplyCustomFormats"==a&&(O=!1,null!=o.cusFrmtStatus&&"FormatNotSupported"==o.cusFrmtStatus))return getObj("UpdatingFrmt").style.display="none",void showAlertDialog(jsMsg["FormatCells.CustomFormat.AlertMessage"])},st=function(t){var a=document.getElementById(t),o="#"+t,r=e(o).zcombo("getSelectedIndex");a.style.color=a.options[r].style.color,e(o).zcombo("refresh")},nt=function(e){var t=30;return e.length>t&&(e=e.slice(0,t-e.length),e+="..."),e},it=function(e){if(void 0!=t)for(var a=0;a<t.length;a++)if(t[a]==e)return showAlertDialog(jsMsg["FormatCells.CustomFormat.AlreadyExist"]),!0},lt=function(e){if(void 0!=t)for(var a=0;a<t.length;a++)t[a]==e&&t.splice(a,1)},mt=function(){if(""!=E){var e=E.id.split("_")[1];getObj("customFormatSPAN_"+e).style.display="",getObj("customFormatEditTD_"+e).style.display="",getObj("customFormatDeleteTD_"+e).style.display="",getObj("customFormatINPUT_"+e).style.display="none",getObj("customFormatUpdateTD_"+e).style.display="none",getObj("customFormatCancelTD_"+e).style.display="none"}},ct=function(e){getObj("language_format_numbers").value=e,getObj("language_format_currency").value=e,getObj("language_format_datetime").value=e,getObj("language_format_percentage").value=e,getObj("language_format_scientific").value=e},ut=function(){for(var e=getObj("customFormatTBody"),t=e.getElementsByTagName("TR"),a=0,o=0;t.length>a;){var r=t[a];if(-1!=r.id.indexOf("customFormatTR_")){r.id="customFormatTR_"+o,r.setAttribute("index",o);for(var s=r,n=s.getElementsByTagName("TD"),i=0;i<n.length;i++){var l=n[i];-1!=l.id.indexOf("customFormatTD_")&&(l.id="customFormatTD_"+o)}for(var m=s.getElementsByTagName("SPAN"),c=0;c<m.length;c++){var u=m[c];-1!=u.id.indexOf("customFormatSPAN_")&&(u.id="customFormatSPAN_"+o)}for(var d=s.getElementsByTagName("TEXTAREA"),g=0;g<d.length;g++){var f=d[g];-1!=f.id.indexOf("customFormatINPUT_")&&(f.id="customFormatINPUT_"+o)}for(var v=s.getElementsByTagName("A"),p=0;p<v.length;p++){var _=v[p];-1!=_.id.indexOf("customFormatEditTD_")&&(_.id="customFormatEditTD_"+o,browser_ie?_.onclick=function(){FormatCells.customFormatActions(o,this)}:_.setAttribute("onclick","FormatCells.customFormatActions("+o+", this);")),-1!=_.id.indexOf("customFormatUpdateTD_")&&(_.id="customFormatUpdateTD_"+o,browser_ie?_.onclick=function(){FormatCells.customFormatActions(o,this)}:_.setAttribute("onclick","FormatCells.customFormatActions("+o+", this);")),-1!=_.id.indexOf("customFormatCancelTD_")&&(_.id="customFormatCancelTD_"+o,browser_ie?_.onclick=function(){FormatCells.customFormatActions(o,this)}:_.setAttribute("onclick","FormatCells.customFormatActions("+o+", this);")),-1!=_.id.indexOf("customFormatDeleteTD_")&&(_.id="customFormatDeleteTD_"+o,browser_ie?_.onclick=function(){FormatCells.customFormatActions(o,this)}:_.setAttribute("onclick","FormatCells.customFormatActions("+o+", this);"))}o++}a++}},dt=function(){var t,a=e("[id^=__negative_format_]");e.each(a,function(o){"__negative_format_currencyMenu"==e(a[o]).attr("id")&&(t=e(a[o]).attr("id","__negative_format_currencyMenu"),t.remove()),"__negative_format_numbersMenu"==e(a[o]).attr("id")&&(t=e(a[o]).attr("id","__negative_format_numbersMenu"),t.remove())})},gt=function(t){var a=getObj("customFormats");t.title==t.value&&(t.value="",e("#quickApplyCusFrmt").removeClass("frmttext-label"),a&&e("#customFormats").find("option").removeAttr("selected"))},ft=function(t){""==t.value&&(t.value=t.title,e("#quickApplyCusFrmt").addClass("frmttext-label"))},vt=function(e,t,a,o,r){var s=msg.FORMATTYPE,n=msg.DECIMALS,i=msg.LEADINGZEROES,l=msg.THOUSANDSEP,m=msg.LANGUAGE,c=msg.FORMATSTRING,u=msg.NEGATIVEFORMAT,d=G(e,t,a,o,r);if("AUTOMATIC"==s)d+=W();else if("NUMBER"==s)d+=Y(void 0,u,l,n,i,m);else if("CURRENCY"==s){var g=msg.SYMBOL;d+=J(void 0,g,u,l,n,i,m)}else if("DATETIME"==s||"DATE"==s||"TIME"==s){var f=msg.FORMAT;d+=Q(void 0,s,f,m)}else if("PERCENTAGE"==s){var v=msg.AUTOPERCENT,p=msg.MULTIPLY;d+=$(void 0,n,v,p,m)}else if("FRACTION"==s){var _=msg.FRACTIONTYPE,F=msg.ACCEPT;d+=Z(void 0,_,F,m)}else if("SCIENTIFIC"==s)d+=K(void 0,n,m);else if("TEXT"==s)d+=et();else if("REGIONAL"==s){var C=msg.TYPE,b=msg.SUBREGFORMAT;d+=tt(void 0,C,m,b)}else if("SPECIAL"==s)d+=appendNVPforSpecial(void 0,c);else if("CUSTOM"==s){var O=msg.CUSFORMAT;d+=at(O,"",e)}ot(d,void 0,e)};return{showFormatCellsDialog:M,showCustomFormatDialog:I,toggleFormatType:U,toggleformatPreviewTab:P,customFormatActions:k,updateCustomFormatEnter:z,submitCustomFormatData:H,responseHandler:vt,focusOperforCustFrmt:gt,blurOperforCustFrmt:ft}}(jQuery);appEvent.on("showFormatCellsDialog",function(e,t){isUndefined(e)?FormatCells.showFormatCellsDialog():FormatCells.showFormatCellsDialog(e,t)}),appEvent.on("responseHandler",function(e,t,a,o,r){FormatCells.responseHandler(e,t,a,o,r)});function showSearchBar(){if(FIND.dialogOpen)return getObj("searchText").focus(),!1;FIND.dialogOpen=!0;var e=jsMsg["Find.Dialog.Title"];READ_WRITE||(e=jsMsg["Find.Title"]);var t={width:420,title:e,close:function(){sheetdialog.allowToClose=!0,closeFindDialog()}};return sheetdialog.open("findandreplacedialog",t,{init:function(){sheetdialog.allowToClose=!1,READ_WRITE||($("#replaceBtn").hide(),$("#replaceAllBtn").hide(),$("#replaceText").parent().parent().hide()),$("#searchArea").zcombo("setSelectedIndex",1),setTimeout(function(){findCallBack()},200)},set:function(e){var t=e.action;"changeSearchRange"===t&&findResetVariables()}}),!1}function findCallBack(){return FIND.dialogOpen&&(findResetVariables(),getObj("searchText").focus(),getObj("radDown").checked=!0,FIND.isNext||(getObj("radUp").checked=!0),clearSearch(),FindAndReplaceToggle("Disable")),positionDialog(),!1}function searchWord(e){return FIND.isNext=$("#radUp").is(":checked")?!1:!0,FIND.isNext?searchNext(e):searchPrevious(e),!1}function replaceWord(e){return jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE||isReadOnlyViewMode?!1:(submitSearch(e,"REPLACE"),clearSearch(),!1)}function searchNext(e){return FIND.isNext=!0,submitSearch(e,"FIND"),clearSearch(),!1}function searchPrevious(e){return FIND.isNext=!1,submitSearch(e,"FIND"),clearSearch(),!1}function replaceAllWord(e){return jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE||isReadOnlyViewMode?!1:(submitSearch(e,"REPLACEALL"),clearSearch(),!1)}function FindAndReplaceToggle(e){"Enable"===e?($("#findBtn").enable(),ProtectedRanges.getObject().hasProtectedSheet(CURRSHEETNAME)||($("#replaceBtn").enable(),$("#replaceAllBtn").enable())):($("#findBtn").disable(),$("#replaceBtn").disable(),$("#replaceAllBtn").disable())}function searchBarKeyUp(){var e=getObj("searchText");FindAndReplaceToggle(e?"Enable":"Disable")}function searchBarKeyDown(e,t){var r=e.keyCode;switch(r){case 114:e.shiftKey?searchPrevious(t):searchNext(t),stopEvt(e);break;case 70:e.ctrlKey&&(browser_ie&&disableKeys(e),stopEvt(e));break;case 13:"searchText"==t.id?searchWord(t):"replaceText"==t.id?replaceWord(t):"searchArea"==t.id&&searchNext(t)}return!1}function submitSearch(e,t,r){if(currSearchBarEl=e,t||(t=FIND.action),FIND.action=t,(jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE||isReadOnlyViewMode)&&"FIND"!=t&&!r)return!1;var s=$("#searchArea").zcombo("getValue"),a=ActionConstants.FIND_IN_SHEET;"workbook"===s?a=ActionConstants.FIND_IN_WORKBOOK:"column"===s?a=ActionConstants.FIND_IN_COL:"row"===s&&(a=ActionConstants.FIND_IN_ROW);var n=ActionConstants.FIND;"REPLACE"===t?n=ActionConstants.REPLACE:"REPLACEALL"===t&&(n=ActionConstants.REPLACE_ALL);var o=new RequestParameters(n);if(!r){var i=getObj("searchText").value,c=getObj("replaceText").value;if(""===i)return!1;c||(c="");var l=ActiveCellInfo,d=l.getStartRow(),h=l.getStartCol();"FIND"!=t?o.setParameters(WorkSheets.getAssociatedActiveSheetName(),d,h,encodeURIComponent(i),encodeURIComponent(c),FIND.isNext,getObj("matchCase").checked.toString(),getObj("exactMatch").checked.toString(),a):o.setParameters(WorkSheets.getAssociatedActiveSheetName(),d,h,encodeURIComponent(i),FIND.isNext,getObj("matchCase").checked.toString(),getObj("exactMatch").checked.toString(),a)}if("REPLACEALL"==t){var g=getObj("loading");null!=g&&$("#loading").addClass("updatingmsg"),showProgressMessage(jsMsg.Updating)}if("FIND"!=t){var u=new AjaxRequest;return u.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(u),!1}var u=new AjaxRequest;return u.init("POST",o.getURL(),!0,o.getParametersAsString()),u.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);searchCallBack(t)}),u.sendRequest(),!1}function searchCallBack(e){if(hideProgressMessage(),e&&-1!=e.row){if("FIND"==FIND.action){var t=parseInt(e.row),r=parseInt(e.col),s=e.sheet,a=getSheetIndex(s),n=$("#searchArea").zcombo("getValue");if("row"===n)FIND.isNext&&(currCol>r||t==currRow&&r==currCol)?(getObj("searchEndMsg").innerHTML=jsMsg["Find.EndOfRow"],showSearchResult("END_OF_AREA")):!FIND.isNext&&(r>currCol||t===currRow&&r===currCol)&&(getObj("searchEndMsg").innerHTML=jsMsg["Find.StartOfRow"],showSearchResult("END_OF_AREA"));else if("column"===n)FIND.isNext&&(currRow>t||t===currRow&&r===currCol)?(getObj("searchEndMsg").innerHTML=jsMsg["Find.EndOfColumn"],showSearchResult("END_OF_AREA")):!FIND.isNext&&(t>currRow||t===currRow&&r===currCol)&&(getObj("searchEndMsg").innerHTML=jsMsg["Find.StartOfColumn"],showSearchResult("END_OF_AREA"));else if("sheet"===n)FIND.isNext?(currRow>t||t==currRow&&currCol>=r)&&(getObj("searchEndMsg").innerHTML=jsMsg["Find.EndOfSheet"],showSearchResult("END_OF_AREA")):(t>currRow||t==currRow&&r>=currCol)&&(getObj("searchEndMsg").innerHTML=jsMsg["Find.StartOfSheet"],showSearchResult("END_OF_AREA"));else if("workbook"===n){var o=getSheetIndex();FIND.isNext?(o>a||a==o&&(currRow>t||t==currRow&&currCol>=r))&&(getObj("searchEndMsg").innerHTML=jsMsg["Find.EndOfWorkbook"],showSearchResult("END_OF_AREA")):(a>o||a==o&&(t>currRow||t==currRow&&r>=currCol))&&(getObj("searchEndMsg").innerHTML=jsMsg["Find.StartOfWorkbook"],showSearchResult("END_OF_AREA"))}}else if("REPLACEALL"==FIND.action&&FIND.dialogOpen){if(!e)return;e>1?(getObj("statusMsg").innerHTML=replaceParams(jsMsg["Find.replaceMsg"],new Array(escapeSpecialCharacters(e))),showSearchResult("REPLACE_NOTIFY")):1==e?(getObj("statusMsg").innerHTML=jsMsg["Find.replaceMsgForOne"],showSearchResult("REPLACE_NOTIFY")):showSearchResult("NO_DATA_FOUND")}if("REPLACEALL"!=FIND.action){var i=getCellLabel(t,r),c=s+"."+i;FIND.isFromFind=!0,"REPLACE"==FIND.action&&isValueChanged?setTimeout("Goto.gotoCellInit('"+c+"')",300):Goto.gotoCellInit(c),moveDialogBox(t,r),FIND.isFirstFind&&(FIND.startCol=r,FIND.startRow=t,FIND.startSheet=e.sheet,FIND.isFirstFind=!1)}}else showSearchResult("NO_DATA_FOUND")}function showSearchResult(e){"NO_DATA_FOUND"==e?getObj("searchNoDataMsg").style.display="":"END_OF_AREA"==e?getObj("searchEndOfAreaMsg").style.display="":"REPLACE_NOTIFY"==e&&(getObj("searchStatusMsg").style.display="")}function findResetVariables(){FIND.startCol=0,FIND.startRow=0,FIND.startSheet="",FIND.isFirstFind=!0,FIND.isFromFind=!1,FIND.isNext=$("#radUp").is(":checked")?!1:!0}function closeFindDialog(){return FIND.dialogOpen=!1,sheetdialog.close(),!1}function clearSearch(){var e=getObj("searchNoDataMsg");""==e.style.display&&(e.style.display="none");var t=getObj("searchEndOfAreaMsg");""==t.style.display&&(t.style.display="none");var r=getObj("searchStatusMsg");return""==r.style.display&&(r.style.display="none"),!1}function focusSearchBarEl(){return currSearchBarEl.focus(),!1}function moveDialogBox(e,t){var r;r=sheetdialog.getOpenedDialog();var s=clientDim.width,a=getCellPosInPage(e,t),n=getCell(e,t),o=0;n&&(o=getCellWidth(n));var i=r.offset().left+r.width(),c=r.offset().top+r.height(),l=a.left+o;r.offset().left<=l&&i>=l&&r.offset().top<=a.top&&a.top<=c&&(l+r.width()>s?r.css("left",a.left-r.width()+"px"):r.css("left",l+"px"))}function hideSearchBar(){var e=getObj("searchBar");(""==e.style.display||"block"==e.style.display)&&(e.style.display="none",getObj("searchText").blur(),resetEditorDim(),setFocusInCellField()),findResetVariables()}function getSheetIndex(e){e||(e=CURRSHEETNAME);for(var t=getObj("sheetsTab").getElementsByTagName("TD"),r=0;r<t.length-1;r++){var s=t[r].getAttribute("sheetname");if(s==e)return r}}var FIND={action:"FIND",startRow:0,startCol:0,startSheet:"",isFirstFind:!0,isFromFind:!1,isNext:!0,dialogOpen:!1};appEvent.on("onGotoDone",function(){FIND.isFromFind&&(focusSearchBarEl(),FIND.isFromFind=!1)});var ConditionalFormatOperator={THIS_WEEK:21,ISBLANK:29,ISERROR:31,YESTERDAY:15,THIS_YEAR:27,BETWEEN:7,LAST_MONTH:23,THIS_MONTH:24,GREATER_EQUAL:3,TEXT_BEGINNINGWITH:11,TOMORROW:17,GREATER_THAN:1,NEXT_MONTH:25,LESS_EQUAL:4,LAST_YEAR:26,TEXT_NOTCONTAINING:10,LAST_WEEK:20,NOT_BETWEEN:8,NEXT_YEAR:28,TODAY:16,EQUAL:5,TEXT_ISVALIDURL:14,TEXT_ISVALIDEMAIL:13,NEXT_WEEK:22,LAST_7_DAYS:18,TEXT_CONTAINING:9,LESS_THAN:2,NEXT_7_DAYS:19,ISNOTERROR:32,ISNOTBLANK:30,NOT_EQUAL:6,TEXT_ENDINGWITH:12};function convertHex(e){e=e.replace("#","");var t=parseInt(e.substring(0,2),16),o=parseInt(e.substring(2,4),16),a=parseInt(e.substring(4,6),16);return"rgb("+t+","+o+","+a+")"}function showMoreLink(e){var t=$(e).find(".mL");$(t).stop(0).animate({opacity:"1"},10)}function hideMoreLink(e){var t=$(e).find(".mL");$(t).stop(0).animate({opacity:"0"},10)}function showRuleOptions(e,t){hideRuleOptions($("#conditionalDialogContent"),"hide",t);var o=$(e).parent().find(".rM");if($(o).stop(0).animate({"z-index":"0",right:"-1px",opacity:"1"},10),!t)var t=window.event;t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}function hideRuleOptions(e,t){if("show"!=t){var o=$(e).find(".rM");$(o).stop(0).animate({"z-index":"0",right:"-108px",opacity:"0"},10)}}var numOfCond=1,check,ruleId=1,vfRuleMap={},table1,div1,mdiaglog={},formatWithConditions=function(e){var t=null,o="",a=null,n=null,i={},r="",s=null,l=function(e){Q(e)},d=function(o,a){var n={width:600,allowSheetSwitch:!0,close:function(){sheetdialog.allowToClose=!0,"ADD"!==classicDialodState&&(colorScalesBag.isDialogEdited?(e.dialogutil.close("cformatmanagedialog"),setTimeout(function(){formatWithConditions.showManageRulesAfterEdit("manageLIElement")},400)):setTimeout(function(){sheetdialog.recallDialog()},200),classicDialodState="ADD"),e(e(e(createruledialogtheme).find(".dCp")[10]).children()[1]).css("background-color","transparent"),e(e(e(createruledialogtheme).find(".dCp")[10]).children()[1]).css("color","rgb(17, 17, 17)"),colorScalesBag.isDialogEdited=!1,u(),at={},s=null,ruleId=1}};t=o,n.title=jsMsg["CFormat.Classic"]+" - "+jsMsg[a],sheetdialog.open("cformatdialog",n,m)},c=function(t){e(t).bind("colorpalettecolorselected",function(t,o){if(e(this).addClass("pressed"),"bg"==o.colorpicker.attr("ftype"))if(e(o.colorpicker).children("span:first").css({"border-bottom":"3px solid "+o.color}),e(this).parent().parent().parent().parent().find(".previewBg").css("background",o.color),"transparent"===o.color)e(this).parent().parent().parent().parent().find(".previewBg").css("background","");else{var a=colorScalesBag.brightness(o.color)<127.5;a?e(e(this).parent().parent().parent().parent().find(".previewBg").children()[0]).addClass("arwLight"):e(e(this).parent().parent().parent().parent().find(".previewBg").children()[0]).removeClass("arwLight")}else e(o.colorpicker).children("span:first").css({"border-bottom":"3px solid "+o.color}),e(this).parent().parent().parent().parent().find(".previewBg").css("color",o.color),"default"===o.color&&(e(o.colorpicker).children("span:first").css({"border-bottom":"transparent"}),e(this).parent().parent().parent().parent().find(".previewBg").css("color",""))})},m={showtab:"",set:function(t,o){var a=t.action;switch(a){case"filterInCF":if(e("#condFormat").empty(),"cellRange"!==o){var n=e("#condFilterHolder");n.is(":visible")&&(n.hide(),RangeSelector.off(),hideCellRangeFillDIV())}else setTimeout(function(){e("#conditionFilter").focus()},300);colorScalesBag.viewRules=null,w(o);break;case"filterInCFRule":"cellRange"!==o&&rt(o)}},init:function(){if(e("#cformatdialogzdialog").parent().css("opacity",0),e.ui.utils.initComponents(e("#addRules")),e.ZContextMenu.registerColorpalette(),e(e("#rule1").find("[ftype=bg]")).children("span:first").css({"border-bottom":"3px solid rgb(155, 222, 180)"}),e(e("#rule1").find("[ftype=tg]")).children("span:first").css({"border-bottom":"3px solid rgb(37, 150, 80)"}),getObj("aR")&&(getObj("aR").style.display=""),setTimeout(function(){"insidesingle"!==a&&"manageLIElement"!==t&&setTimeout(function(){e("#appliestofield").focus()},100),this.showtab=this.showtab?this.showtab:jsSHARE_VIEW&&!ALLOW_TO_WRITE?"managerule":"createrule",jsSHARE_VIEW&&!ALLOW_TO_WRITE?f():"manageLIElement"===t?(this.showtab="managerule",g()):(T(),formatWithConditions.editRulesopen&&(document.getElementById("appliestofield").value=CellUtils.addApostrophe(o))),a=null,this.showtab=""},20),"ADD"===classicDialodState&&getObj("selComp")){for(var n=CellUtils.getRequiredSheetNames().sheetNames,i=document.getElementById("selComp"),r=0,s=0;s<n.length;s++)e("<option/>",{value:ActionConstants.CONDITIONAL_FORMAT_READ_SHEET,text:n[s]}).appendTo(e("#selComp")),n[s]===CURRSHEETNAME&&(r=s+2);e(i).zcombo("refresh"),e(i).zcombo("setSelectedIndex",r)}"EDIT"===classicDialodState&&setTimeout(function(){formatWithConditions.loadExistingRules(loadRuleObj)},100),e("#appliestofield").focus(function(){var e=this;RangeSelector.on({el:e,allowSheetSwitch:!0,appendSheetName:!0,multiRangeSelection:!0,callback:function(){colorScalesBag.isDialogEdited=!0}})}),e("#conditionFilter").bind("focus",function(){var t=this;RangeSelector.on({el:t,isAbsoluteRef:!1,allowSheetSwitch:!0,appendSheetName:!0,callback:function(o){p(o),e(t).val(o),e(t).focus()}})}),e(".dropme").sortable({connectWith:".dropme",axis:"y",scroll:!0,stop:function(e,t){t.item.index()},cursor:"pointer"}).droppable({accept:".button",activeClass:"highlight"}),e("#rulesContainer").sortable("option","cancel","#rule1"),e("#rule1").find(".drag_cue").css("display","none"),e("#rule1").find("table").hover(function(){e(this).css({"background-color":"transparent"})}),setTimeout(function(){e("#cformatdialogzdialog").parent().css("opacity",1)},200)},destroy:function(){var e=RangeSelector.returnsourceSheet();e!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open"),gridFormulaEditController.off()}},u=function(){e("#tempDivId").hide(),formatWithConditions.editRulesopen=!1,formatWithConditions.isCfManageRules=!1,formatWithConditions.managecfData=null,resetCellRangeFill("conditionalDialogContent"),clearCellRangeFill(),numOfCond=1,formatWithConditions.clickedElem=null},p=function(t){e("#condFormat").children().remove(),e("#noconditions").hide();var o=x(t),a=o.startRow,n=o.startCol,i=o.endRow,r=o.endCol,s=o.sheetName;s===CURRSHEETNAME&&(e("#conditionFilter").val(t),focusCellRangeFill(a,n,i,r));var l=WorkSheets.getSheetCodeFromName(CURRSHEETNAME),d=DataValidation_UI.getDateFormat(!0),c="HH:mm",m=new RequestParameters(ActionConstants.CONDITIONAL_FORMAT_READ_RANGE);m.setParameters(l,d,c,a,n,i,r);var u=new AjaxRequest;u.init("POST",m.getURL(),!0,m.getParametersAsString()),e(e("#manageRulesContent").find(".generate")).css("display","block"),u.addEventListener("onComplete",function(t){var o=parseJSON(t.responseText);if("undefined"==typeof o.CONDITIONALFORMAT||0===o.CONDITIONALFORMAT.length)K();else{e("#noconditions").hide();var a=o.CONDITIONALFORMAT;e("#condFormat").children().not("#noconditions").remove(),formatWithConditions.managecfData=a,W(a)}}),u.sendRequest()},C=function(){var e=getCellRange();e=getServerRange(e.startRow,e.startCol,e.endRow,e.endCol);var t=WorkSheets.getSheetCodeFromName(CURRSHEETNAME),o=new RequestParameters(ActionConstants.CONDITIONAL_FORMAT_READ_DATATYPE);o.setParameters(t,e.startRow,e.startCol,e.endRow,e.endCol);var a=new AjaxRequest;a.init("POST",o.getURL(),!0,o.getParametersAsString()),a.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);s=t,formatWithConditions.validateAndShow("createLIElement")}),a.sendRequest()},f=function(){getObj("createRuleContent").style.display="none",getObj("createRuleTab").style.display="none",getObj("manageRulesContent").style.display="",w(ActionConstants.CONDITIONAL_FORMAT_READ_SHEET),positionDialog()},g=function(){if("manageLIElement"===t)getObj("createRuleContent")&&(getObj("createRuleContent").style.display="none"),getObj("manageRulesContent")&&(getObj("manageRulesContent").style.display=""),w(ActionConstants.CONDITIONAL_FORMAT_READ_SHEET),positionDialog();else{reinitManageRuleTabUI();var e=getObj("manageRulesContent");e.style.display="";var o=e.getElementsByTagName("select");o[0].selectedIndex=1,w(ActionConstants.CONDITIONAL_FORMAT_READ_SHEET)}},h=function(t){e(t).toggleClass("dvtreeExpand dvtreeCollapse"),e(t).next("table").is(":visible")?e(t).next("table").hide():e(t).next("table").show()},b=function(t,o){var a=e("#"+o);"expand"===t?(e(a).find("table").show(),e(a).find("div.dvtreeCollapse").toggleClass("dvtreeExpand dvtreeCollapse")):(e(a).find("div.dvtreeExpand").toggleClass("dvtreeExpand dvtreeCollapse"),e(a).find("table").hide())},v=function(t){e(t).focus(function(){var e=this;enableFormulaControl({el:e,isAbsoluteRef:!0,multiRangeSelection:!0})})},E=function(t){var o=e("#"+t).parents("td"),a=e("#"+t).parents('div[id*="rule"]')[0],n=e(o).find("select"),i=e(a).find("div#singleInput"),r=e(a).find("div#doubleInput"),s=e(n[0]).zcombo("getSelectedIndex"),l=e(a).find(":input");e(l).datepicker("destroy"),e(l).val(""),e(l).removeClass("dvdatePickerIcon"),RangeSelector.off();var d=e(i).find(":input:first");if(e(d).siblings("span").css("display","none"),0==s){e(n[1]).parent().show(),e(n[1]).zcombo("setSelectedIndex",0),e(n).filter(":gt(1)").parent().hide(),e(i).hide(),e(r).show();var c=e(r).find(":input[type=text]");e(r).find(":input").css("width","172px"),e(c[0]).attr("placeholder",jsMsg["StatusBar.Minimum"]),e(c[1]).attr("placeholder",jsMsg["StatusBar.Maximum"]),e(d).css("width","354px")}else if(1==s)e(n[2]).parent().show(),e(n[2]).zcombo("setSelectedIndex",0),e(n).filter(":eq(1),:eq(3),:eq(4)").parent().hide(),e(i).show(),e(r).hide(),e(d).css("width","354px"),e(d).toggleClass("cR",!1),e(d).attr("placeholder",jsMsg["Solver.UI.Value"]);else if(2==s){var c=e(r).find(":input");e(n[3]).zcombo("setSelectedIndex",0),e(c).addClass("dvdatePickerIcon"),e(d).css("width","354px"),e(n).filter(":eq(1),:eq(2),:eq(4)").parent().hide(),e(n[3]).parent().show(),e(i).hide(),e(r).show(),e(c).datepicker({showAnim:"fadeIn",changeMonth:!0,changeYear:!0,constrainInput:!1});var m=DataValidation_UI.getDateFormat();e(c).datepicker({dateFormat:m}),e(c).datepicker("option","dateFormat",m),e(c[0]).attr("placeholder",jsMsg["DataVal.StartDate"]),e(c[1]).attr("placeholder",jsMsg["DataVal.EndDate"])}else 3==s?(e(n[4]).zcombo("setSelectedIndex",0),e(n).filter(":gt(0):lt(4)").parent().hide(),e(n[4]).parent().show(),e(i).hide(),e(r).hide()):(e(n).filter(":gt(0)").parent().hide(),e(i).show(),e(r).hide(),e(d).css("width","330px"),e(d).val("="),e(d).siblings("span").show(),v(d),setTimeout(function(){e("#cfinput").focus()},400))},R=function(t){var o=e("#"+t).parents("td"),a=e("#"+t).parents('div[id*="rule"]')[0],n=e(o).find("select"),i=e(a).find("div#singleInput"),r=e(a).find("div#doubleInput"),s=e(n[0]).zcombo("getValue"),l=e(i).find(":input"),d=parseInt(e("#"+t).zcombo("getValue"));if("DATE"==s&&d<=ConditionalFormatOperator.NOT_EQUAL){e(i).show(),e(r).hide(),e(l).addClass("dvdatePickerIcon"),e(l).removeClass("cR"),e(l).datepicker({showAnim:"fadeIn",changeMonth:!0,changeYear:!0,constrainInput:!1}),e(l).attr("placeholder",jsMsg["Filter.date"]);var c=DataValidation_UI.getDateFormat();e(l).datepicker({dateFormat:c}),e(l).datepicker("option","dateFormat",c)}else if("DATE"!=s||d!=ConditionalFormatOperator.BETWEEN&&d!=ConditionalFormatOperator.NOT_BETWEEN)if(d<=ConditionalFormatOperator.NOT_EQUAL)e(l).removeClass("dvdatePickerIcon cR"),e(r).hide(),e(i).show(),e(l).attr("placeholder",jsMsg["Solver.UI.Value"]);else if(d==ConditionalFormatOperator.BETWEEN||d==ConditionalFormatOperator.NOT_BETWEEN){var m=e(r).find(":input");e(r).show(),e(i).hide(),e(m).removeClass("dvdatePickerIcon")}else d>=ConditionalFormatOperator.TEXT_CONTAINING&&d<=ConditionalFormatOperator.TEXT_ENDINGWITH?(e(r).hide(),e(i).show(),e(l).removeClass("dvdatePickerIcon cR"),e(l).attr("placeholder",jsMsg["Solver.UI.Value"])):(e(r).hide(),e(i).hide());else{var m=e(r).find(":input");e(m).addClass("dvdatePickerIcon"),e(r).show(),e(i).hide()}e(n[0]).zcombo("setValue",s)},T=function(){if($(),"managerule"==showtab)g();else{var t=_(),o=(t.startRow,t.startCol,t.endRow,t.endCol,t.label);if(o.length>35&&e("#appliestofield").css("text-align","left"),e("#appliestofield").val(CellUtils.constructCellName(t.startRow,t.startCol,t.endRow,t.endCol,!1,CURRSHEETNAME)),s){var a=s.CONDITIONALFORMAT,n=s.DATATYPE;""!==n&&"number"!==n&&H(n),A(a)}}q(r),positionDialog()},A=function(t){if(void 0!=t){for(var o=t.datarange.split(";"),a="",n=0;n<o.length;n++){var i=getDataFrom2DRangeText(o[n]);a+=CellUtils.constructCellName(i.sR,i.sC,i.eR,i.eC,!1,i.sheetName)+";"}a=a.substring(0,a.length-1),e("#appliestofield").val(a);for(var r=1;numOfCond>=r;r++)if(t["cond"+r]){var s=document.getElementById("rule"+r);if(null!=s){{var l=(s.getElementsByTagName("select"),s.getElementsByTagName("input"));s.getElementsByTagName("div")}null!=document.getElementById("chk_rule"+r)&&(document.getElementById("chk_rule"+r).checked=!0);var d=e(s).css("opacity");d>=.4&&.5>d&&(e(s).css("opacity",""),mask.toolbar(!1,e("#rule"+r),"rule"+r+"mask"));var c=(D(t["cstyle"+r]),t["cstyle"+r].split("~"));"none"!==c[0]?e(e("#rule1").find("[ftype=bg]")).children("span:first").css({"border-bottom":"3px solid "+c[0]}):(e(e("#rule1").find("[ftype=bg]")).children("span:first").css({"border-bottom":"3px solid transparent"}),e(e("#rule1").find("[ftype=bg]")).removeClass("pressed")),"none"!==c[1]?e(e("#rule1").find("[ftype=tg]")).children("span:first").css({"border-bottom":"3px solid "+c[1]}):(e(e("#rule1").find("[ftype=tg]")).children("span:first").css({"border-bottom":"3px solid transparent"}),e(e("#rule1").find("[ftype=tg]")).removeClass("pressed"));var m=D(t["cstyle"+r],s),u=e(s).find("div.previewBg");e(u).attr("style",m);var p=t["cond"+r],C=t["cval"+r],f=C[0],g=C[1],h=t[JSONConstants.CRITERIA_TYPE+r];if(r>1){s.checked=!0;for(var n=0;n<l.length;n++)l[n].disabled=!1}e("#rulesCombo"+r).zcombo("setValue",h),E("rulesCombo"+r),e("#rulesCombo"+r).zcombo("setValue",h),"ANY_VALUE"==h&&p<=ConditionalFormatOperator.NOT_EQUAL?(e("#anyvalueCombo"+r).zcombo("setValue",""+p),R("anyvalueCombo"+r),e("#anyvalueCombo"+r).zcombo("setValue",""+p),l[0].value=""+f.replace(/\"/g,"")):"ANY_VALUE"!=h||p!=ConditionalFormatOperator.BETWEEN&&p!=ConditionalFormatOperator.NOT_BETWEEN?"TEXT"==h&&p>=ConditionalFormatOperator.TEXT_CONTAINING&&p<=ConditionalFormatOperator.TEXT_ENDINGWITH?(e("#textCombo"+r).zcombo("setValue",""+p),R("textCombo"+r),e("#textCombo"+r).zcombo("setValue",""+p),f=f.replace(/\\\\/g,"\\"),l[0].value=f):"DATE"==h&&p<=ConditionalFormatOperator.NOT_EQUAL?(e("#dateCombo"+r).zcombo("setValue",""+p),R("dateCombo"+r),e("#dateCombo"+r).zcombo("setValue",""+p),l[0].value=""+f.replace(/\"/g,"")):"DATE"!=h||p!=ConditionalFormatOperator.BETWEEN&&p!=ConditionalFormatOperator.NOT_BETWEEN?"DATE"==h&&(p>=ConditionalFormatOperator.YESTERDAY||p<=ConditionalFormatOperator.NEXT_YEAR)?(e("#dateCombo"+r).zcombo("setValue",""+p),e(s).find("div#doubleInput").hide(),e(s).find("div#singleInput").hide()):"CELL"==h?e("#cellCombo"+r).zcombo("setValue",""+p):"FORMULA"==h&&(f=f.replace(/\\\\/g,"\\"),e(l[0]).css("width","330px"),e(l[0]).val("="+f)):(e("#dateCombo"+r).zcombo("setValue",""+p),R("dateCombo"+r),e("#dateCombo"+r).zcombo("setValue",""+p),l[1].value=f,l[2].value=g):(e("#anyvalueCombo"+r).zcombo("setValue",""+p),R("anyvalueCombo"+r),e("#anyvalueCombo"+r).zcombo("setValue",""+p),l[1].value=f,l[2].value=g)}}else e("#rulesCombo"+r).zcombo("setValue","ANY_VALUE"),E("rulesCombo"+r),R("anyvalueCombo"+r)}},O=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?"rgb( "+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":null},y=function(e){if("transparent"!=e&&-1==e.indexOf("#")){var t=e.substring(e.indexOf("(")+1,e.indexOf(")")),o=t.split(","),a=d2h(o[0].trim());return a+=d2h(o[1].trim()),a+=d2h(o[2].trim()),"#"+a}return null},F=function(e){var t=["none","none","false","false","none","false"];if(e.style.backgroundColor){var o=y(e.style.backgroundColor);null==o&&(o=e.style.backgroundColor),t[0]=o}if(e.style.color){var o=y(e.style.color);null==o&&(o=e.style.color),t[1]=o}var a=e.style.fontWeight;a&&-1==a.search("normal")&&(t[2]="true");var n=e.style.fontStyle;n&&-1!=n.search("italic")&&(t[3]="true");var i=e.style.textDecoration;return i&&-1!=i.search("underline")&&(t[4]="single"),i&&-1!=i.search("line-through")&&(t[5]="true"),t.join("~")},I=function(){var t=e("#appliestofield").val();if(DataValidation_UI.isEmptyField(t))return void showAlertDialog(jsMsg.Rangecannotbeempty);e("#CreateButton").disable();for(var o,a=!1,n=!1,i="{",r=0,s=1;numOfCond>=s;s++){r++;var l,d=e("#rulesContainer").find(".cRules")[s-1],c=d.getElementsByTagName("input"),m=d.getElementsByTagName("select"),u=e(m[0]).zcombo("getSelectedIndex"),p=e(m[0]).zcombo("getValue");if(0==u)l=parseInt(e(m[1]).zcombo("getValue")),n=!0;else if(3==u)l=parseInt(e(m[4]).zcombo("getValue")),n=!0;else if(2==u)l=parseInt(e(m[3]).zcombo("getValue")),n=!0;else if(1==u){if(n=!0,""==c[0].value){a=!0;break}o=c[0].value,l=parseInt(e(m[2]).zcombo("getValue"))}else if(4==u){if(""==c[0].value||"="==c[0].value){a=!0;break}o=c[0].value,l=-1,n=!0}if(n)if(l<=ConditionalFormatOperator.NOT_EQUAL){if(""==c[0].value){a=!0;break}o=c[0].value,o=o.replace(/\\/g,"\\\\"),o=o.replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")}else if(l==ConditionalFormatOperator.BETWEEN||l==ConditionalFormatOperator.NOT_BETWEEN){if(""==c[1].value||""==c[2].value){a=!0;break}o=c[1].value+";"+c[2].value}i+='"cond'+r+'":'+l+',"cval'+r+'":"'+encodeURIComponent(o)+'","'+JSONConstants.CRITERIA_TYPE+r+'":"'+p+'",'}if(n){var C=RangeSelector.returnsourceSheet();C!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(C),"open"),i+='"datarange" : "'+e("#appliestofield").val()+'", "noofrules":'+r+"}";var f=new RequestParameters(ActionConstants.VALIDATE_INPUT_CF);f.setParameters(WorkSheets.getAssociatedActiveSheetName(),"conditionalformat",i);var g=new AjaxRequest;g.init("POST",f.getURL(),!0,f.getParametersAsString()),g.addEventListener("onComplete",function(o){e("#CreateButton").enable();var a=parseJSON(o.responseText);if(0!=Boolean(a.valinp.isError)){var n=replaceParams(jsMsg[""+a.valinp.errorMsg],new Array(formatWithConditions.keypair[p]));return void showAlertDialog(n)}N(t)}),g.sendRequest()}else N(t)},N=function(){colorScalesBag.isDialogEdited=!0,(formatWithConditions.isCfManageRules||formatWithConditions.editRulesopen)&&hideCellRangeFillDIV();for(var t=0,o="{",a=1;numOfCond>=a;a++){t++;var n=0,i="",r="",s=e("#rulesContainer").find(".cRules")[a-1],l=s.getElementsByTagName("select"),d=s.getElementsByTagName("input"),c=(s.getElementsByTagName("div"),e(s).find(".previewBg")[0]),m=e(l[0]).zcombo("getSelectedIndex"),p=e(l[0]).zcombo("getValue");if(0==m?n=parseInt(e(l[1]).zcombo("getValue")):1==m?n=parseInt(e(l[2]).zcombo("getValue")):2==m?n=parseInt(e(l[3]).zcombo("getValue")):3==m?n=parseInt(e(l[4]).zcombo("getValue")):4==m&&(n=-1),n<=ConditionalFormatOperator.NOT_EQUAL||n>=ConditionalFormatOperator.TEXT_CONTAINING&&n<=ConditionalFormatOperator.TEXT_ENDINGWITH||"FORMULA"==p?(i=d[0].value,i=i.replace(/\\/g,"\\\\"),i=i.replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")):(n==ConditionalFormatOperator.BETWEEN||n==ConditionalFormatOperator.NOT_BETWEEN)&&(i=d[1].value+";"+d[2].value),r=F(c),"none~none~false~false~none~false"===r)return void showAlertDialog(jsMsg["CFormat.RuleMustContainFormat"]+a);o+='"cond'+a+'":'+n+',"cval'+t+'":"'+encodeURIComponent(i)+'","cstyle'+t+'":"'+r+'","'+JSONConstants.CRITERIA_TYPE+t+'":"'+p+'",'}if(o+='"noofrules":'+t+',"datarange":"'+e("#appliestofield").val()+'"',"EDIT"===classicDialodState){o+=',"csuid":'+manageEditId.split("_")[1],o+=',"asn":"'+manageEditId.split("_")[2]+'"';var C=manageEditedRules[manageEditId.split("_")[1]+"_"+manageEditId.split("_")[2]].cs_type;o+=',"cs_type":"'+C+'"'}o+="}";var f="EDIT"===classicDialodState?ActionConstants.CONDITIONAL_FORMAT_EDIT:ActionConstants.CONDITIONAL_FORMAT_APPLY,g=new RequestParameters(f);g.setParameters(WorkSheets.getAssociatedActiveSheetName(),o);var h=new AjaxRequest;if(h.init("POST",g.getURL(),!0,g.getParametersAsString()),actionManager.addRequest(h),formatWithConditions.editRulesopen||formatWithConditions.isCfManageRules){getObj("createRuleContent").style.display="none",e("#manageRulesContent").show();var b=e("#cformatdialogzdialog").prev().children()[0];e(b).text(jsMsg.CFormat+" - "+jsMsg["CFormat.ManageRules"]),e("#cformatdialogzdialog").parent().css("width","575px"),setTimeout(function(){w(e("#selComp").zcombo("getValue"))},500),formatWithConditions.editRulesopen=!1}else sheetdialog.close(),u();numOfCond=1,ruleId=1,manageEditId=void 0},_=function(){var e,t,o,a;if(isCellRange()){var n=getCellRange();e=n.startRow,t=n.startCol,o=n.endRow,a=n.endCol,isRowSelected()&&(t=0,a=getColMax()-1),isColSelected()&&(e=0,o=getRowMax()-1),isRowSelected()&&isColSelected()&&(a=a,o=o)}else e=o=ActiveCellInfo.getStartRow(),t=a=ActiveCellInfo.getStartCol(),ActiveCellInfo.isMerged()&&(o=ActiveCellInfo.getEndRow(),a=ActiveCellInfo.getEndCol());return{type:"RANGE",startRow:e,startCol:t,endRow:o,endCol:a,label:CURRSHEETNAME+"."+getCellLabel(e,t)+":"+getCellLabel(o,a)}},S=function(e,t,o){var a=parseInt(e),n="",i=escapeSpecialCharacters(t[0]),r=t[1]?escapeSpecialCharacters(t[1]):"";switch(a){case ConditionalFormatOperator.TEXT_CONTAINING:n=jsMsg["CFormat.Condition.Contains"]+" '"+i+"'";break;case ConditionalFormatOperator.TEXT_NOTCONTAINING:n=jsMsg["CFormat.Condition.NotContains"]+" '"+i+"'";break;case ConditionalFormatOperator.TEXT_BEGINNINGWITH:n=jsMsg["CFormat.Condition.BeginsWith"]+" '"+i+"'";break;case ConditionalFormatOperator.TEXT_ENDINGWITH:n=jsMsg["CFormat.Condition.EndsWith"]+" '"+i+"'";break;case ConditionalFormatOperator.ISBLANK:n=jsMsg["CFormat.Condition.Blanks"];break;case ConditionalFormatOperator.ISNOTBLANK:n=jsMsg["CFormat.Condition.NoBlanks"];break;case ConditionalFormatOperator.ISERROR:n=jsMsg["CFormat.Condition.Errors"];break;case ConditionalFormatOperator.ISNOTERROR:n=jsMsg["CFormat.Condition.NoErrors"];break;case ConditionalFormatOperator.YESTERDAY:n=jsMsg["CFormat.Condition.Yesterday"];break;case ConditionalFormatOperator.TODAY:n=jsMsg["CFormat.Condition.Today"];break;case ConditionalFormatOperator.TOMORROW:n=jsMsg["CFormat.Condition.Tomorrow"];break;case ConditionalFormatOperator.LAST_7_DAYS:n=jsMsg["CFormat.Condition.Last7Days"];break;case ConditionalFormatOperator.NEXT_7_DAYS:n=jsMsg["CFormat.Condition.Next7Days"];break;case ConditionalFormatOperator.LAST_WEEK:n=jsMsg["CFormat.Condition.LastWeek"];break;case ConditionalFormatOperator.THIS_WEEK:n=jsMsg["CFormat.Condition.ThisWeek"];break;case ConditionalFormatOperator.NEXT_WEEK:n=jsMsg["CFormat.Condition.NextWeek"];break;case ConditionalFormatOperator.LAST_MONTH:n=jsMsg["CFormat.Condition.LastMonth"];break;case ConditionalFormatOperator.THIS_MONTH:n=jsMsg["CFormat.Condition.ThisMonth"];break;case ConditionalFormatOperator.NEXT_MONTH:n=jsMsg["CFormat.Condition.NextMonth"];break;case ConditionalFormatOperator.LAST_YEAR:n=jsMsg["CFormat.Condition.LastYear"];break;case ConditionalFormatOperator.THIS_YEAR:n=jsMsg["CFormat.Condition.ThisYear"];break;case ConditionalFormatOperator.NEXT_YEAR:n=jsMsg["CFormat.Condition.NextYear"]}if(n)return n;if("WHOLENUMBER"==o||"DECIMAL"==o||"ANY_VALUE"==o||"TEXT_LENGTH"==o)switch(s=new Array(jsMsg["CFormat.AnyValue"],i,r),"WHOLENUMBER"==o?s=new Array(jsMsg["CFormat.WholeNumber"],i,r):"DECIMAL"==o?s=new Array(jsMsg["CFormat.Decimal"],i,r):"TEXT_LENGTH"==o&&(s=new Array(jsMsg["CFormat.TextLength"],i,r)),a){case ConditionalFormatOperator.LESS_THAN:n=replaceParams(jsMsg["CFormat.Condition.LessThan"],s);break;case ConditionalFormatOperator.GREATER_THAN:n=replaceParams(jsMsg["CFormat.Condition.GreaterThan"],s);break;case ConditionalFormatOperator.LESS_EQUAL:n=replaceParams(jsMsg["CFormat.Condition.LessThanOrEqual"],s);break;case ConditionalFormatOperator.GREATER_EQUAL:n=replaceParams(jsMsg["CFormat.Condition.GreaterThanOrEqual"],s);break;case ConditionalFormatOperator.EQUAL:n=replaceParams(jsMsg["CFormat.Condition.Equal"],s);break;case ConditionalFormatOperator.NOT_EQUAL:n=replaceParams(jsMsg["CFormat.Condition.NotEqual"],s);break;case ConditionalFormatOperator.BETWEEN:n=replaceParams(jsMsg["CFormat.Condition.Between"],s);break;case ConditionalFormatOperator.NOT_BETWEEN:n=replaceParams(jsMsg["CFormat.Condition.NotBetween"],s)}else if("DATE"==o){var s,l=-1;switch(a<=ConditionalFormatOperator.NOT_BETWEEN&&(i&&null!==i.match(/\s|:/g)&&(l=i.match(/\s|:/g).length),r&&null!==r.match(/\s|:/g)&&(l+=r.match(/\s|:/g).length)),a<=ConditionalFormatOperator.NOT_EQUAL?l>=2?s=new Array(jsMsg.DateTime,i):1==l?(i=replaceParams(jsMsg["CFormat.TimeHrs"],new Array(i)),s=new Array(jsMsg.Time,i)):s=new Array(jsMsg["Filter.date"],i):(a==ConditionalFormatOperator.BETWEEN||a==ConditionalFormatOperator.NOT_BETWEEN)&&(l>=4?s=new Array(jsMsg.DateTime,i,r):2==l?(i=replaceParams(jsMsg["CFormat.TimeHrs"],new Array(i)),r=replaceParams(jsMsg["CFormat.TimeHrs"],new Array(r)),s=new Array(jsMsg.Time,i,r)):s=new Array(jsMsg["Filter.date"],i,r)),a){case ConditionalFormatOperator.LESS_THAN:n=replaceParams(jsMsg["CFormat.Condition.DateBefore"],s);break;case ConditionalFormatOperator.LESS_EQUAL:n=replaceParams(jsMsg["CFormat.Condition.DateOnOrBefore"],s);break;case ConditionalFormatOperator.GREATER_THAN:n=replaceParams(jsMsg["CFormat.Condition.DateAfter"],s);break;case ConditionalFormatOperator.GREATER_EQUAL:n=replaceParams(jsMsg["CFormat.Condition.DateOnOrAfter"],s);break;case ConditionalFormatOperator.EQUAL:n=replaceParams(jsMsg["CFormat.Condition.DateOn"],s);break;case ConditionalFormatOperator.NOT_EQUAL:n=replaceParams(jsMsg["CFormat.Condition.DateNotOn"],s);break;case ConditionalFormatOperator.BETWEEN:n=replaceParams(jsMsg["CFormat.Condition.DateBetween"],s);break;case ConditionalFormatOperator.NOT_BETWEEN:n=replaceParams(jsMsg["CFormat.Condition.DateNotBetween"],s)}}else"LIST"===o?n=i.indexOf("&quot;")>-1?replaceParams(jsMsg["CFormat.Condition.List"],new Array(i)):replaceParams(jsMsg["CFormat.Condition.Range"],new Array(i)):"FORMULA"===o&&(n=jsMsg["CFormat.Condition.Formula"]+" ="+i);return n},w=function(t){(colorScalesBag.viewRules||0===colorScalesBag.viewRules)&&(e("#selComp").zcombo("setSelectedIndex",colorScalesBag.viewRules),0===colorScalesBag.viewRules&&e("#conditionFilter").val(colorScalesBag.rulesRange),t=colorScalesBag.viewRules>1?242:1===colorScalesBag.viewRules?243:"cellRange");var o=e("#selComp").find("option:selected").text(),a=o,n=!1,i=-1,r=-1,s=-1,l=-1;if(t=t?t:e("#selComp").zcombo("getValue"),"cellRange"===t){e("#condFilterHolder").show();{getCellRange()}if(n=!0,e("#conditionFilter").val(e("#conditionFilter").val()?e("#conditionFilter").val():formatWithConditions.cfRange().label),e("#conditionFilter").val()){var d=e("#conditionFilter").val(),c=x(d);i=c.startRow,r=c.startCol,s=c.endRow,l=c.endCol;var m=c.sheetName;m===CURRSHEETNAME?(e("#conditionFilter").val(d),focusCellRangeFill(i,r,s,l)):e("#condFilterHolder").hide()}else conditionalFormattingFilter.cellRangeOnDialogOpen(t)}else{var u=e("#condFilterHolder");u.is(":visible")&&(u.hide(),hideCellRangeFillDIV())}if(WorkSheets.isNameExists(a))a=WorkSheets.getSheetCodeFromName(a);else if("cellRange"===t){a=WorkSheets.getSheetCodeFromName(CURRSHEETNAME),t=ActionConstants.CONDITIONAL_FORMAT_READ_RANGE;{e("#conditionFilter").val()}}else a=WorkSheets.getSheetCodeFromName(CURRSHEETNAME);var p=ActionConstants.CONDITIONAL_FORMAT_READ_SHEET;t==ActionConstants.CONDITIONAL_FORMAT_READ_WORKBOOK&&(p=ActionConstants.CONDITIONAL_FORMAT_READ_WORKBOOK),t==ActionConstants.CONDITIONAL_FORMAT_READ_RANGE&&(p=ActionConstants.CONDITIONAL_FORMAT_READ_RANGE);var C=DataValidation_UI.getDateFormat(!0),f="HH:mm";e(e("#manageRulesContent").find(".generate")).css("display","block");var g=new RequestParameters(p);g.setParameters(a,C,f,i,r,s,l);var h=new AjaxRequest;h.init("POST",g.getURL(),!0,g.getParametersAsString()),h.addEventListener("onComplete",function(o){var a=parseJSON(o.responseText);if("undefined"==typeof a.CONDITIONALFORMAT||0===a.CONDITIONALFORMAT.length)K();else{e("#noconditions").hide();var i=a.CONDITIONALFORMAT;t==ActionConstants.CONDITIONAL_FORMAT_READ_SHEET?(e("#condFormat").children().not("#noconditions").remove(),formatWithConditions.managecfData=i,W(i,colorScalesBag.viewRules,colorScalesBag.filterRule)):t==ActionConstants.CONDITIONAL_FORMAT_READ_WORKBOOK?(e("#condFormat").children().not("#noconditions").remove(),formatWithConditions.managecfData=i,W(i,void 0,colorScalesBag.filterRule),n&&conditionalFormattingFilter.searchARange()):t==ActionConstants.CONDITIONAL_FORMAT_READ_RANGE&&(e("#condFormat").children().not("#noconditions").remove(),formatWithConditions.managecfData=i,W(i),setTimeout(function(){e("#conditionFilter").focus()},100)),colorScalesBag.viewRules=void 0,colorScalesBag.filterRule=void 0}}),h.sendRequest()},M=function(e){if("undefined"!=typeof e){for(var t=6===Object.keys(e).length?colorScalesBag.getGradientColor(O(e.cs_c1),O(e.cs_c2),7):colorScalesBag.getGradientColor(O(e.cs_c1),O(e.cs_c2),7,O(e.cs_c3)),o="linear-gradient(to right, ",a=7,n=100/a,i=0;7>i;i++)o+=t[i]+" "+Math.round(n*i)+"% ,"+t[i]+" "+Math.round(n*(i+1))+"%, ";o=o.substring(0,o.lastIndexOf(","))+")";var r="background-image:"+o;return r}},D=function(t,o){if("undefined"!=typeof t){var a=t.split("~");0==a.length&&(a=t.split("$"));var n="";return"[1]"!=a[0]&&"none"!=a[0]&&(n+="background-color:"+a[0]+";",o&&e(o).find(".formatBox").find("li:eq(4)").addClass("pressed")),"[2]"!=a[1]&&"none"!=a[1]&&(n+="color:"+a[1]+";",o&&e(o).find(".formatBox").find("li:eq(5)").addClass("pressed")),"[3]"!=a[2]&&"false"!=a[2]&&(n+="font-weight:bold;",o&&e(o).find(".formatBox").find("li:eq(0)").addClass("pressed")),"[4]"!=a[3]&&"false"!=a[3]&&(n+="font-style:italic;",o&&e(o).find(".formatBox").find("li:eq(1)").addClass("pressed")),"[5]"!=a[4]&&"none"!=a[4]&&("single"==a[4]&&"true"==a[5]?n=n:n+="text-decoration:underline;",o&&e(o).find(".formatBox").find("li:eq(2)").addClass("pressed")),"[6]"!=a[5]&&"false"!=a[5]&&("single"==a[4]&&"true"==a[5]?n=n:n+="text-decoration:line-through;",o&&e(o).find(".formatBox").find("li:eq(3)").addClass("pressed")),"single"==a[4]&&"true"==a[5]&&(n+="text-decoration:line-through underline;",o&&e(o).find(".formatBox").find("li:eq(2), li:eq(3)").addClass("pressed")),n}},k=function(t){var o=e(t).parents('div[id*="rule"]')[0];if("undefined"!=o){var a=e(o).find("div.previewBg");if("cfbold"==t.id){var n=e(a).css("fontWeight");!n||"bold"!=n&&"700"!=n?e(a).css("fontWeight","bold"):e(a).css("fontWeight","normal")}else if("cfitalic"==t.id){var i=e(a).css("fontStyle");i&&"normal"==i?e(a).css("fontStyle","italic"):e(a).css("fontStyle","normal")}else if("cfuline"==t.id){var r=e(a).css("text-decoration");""!=r&&"underline"==r.trim()?e(a).css("text-decoration",""):"line-through"==r.trim()?e(a).css("text-decoration","line-through underline"):"line-through underline"==r||"underline line-through"==r?e(a).css("text-decoration","line-through"):e(a).css("text-decoration","underline")}else if("cfstrik"==t.id){var r=e(a).css("text-decoration");""!=r.trim()&&"line-through"==r?e(a).css("text-decoration",""):"underline"==r.trim()?e(a).css("text-decoration","line-through underline"):"line-through underline"==r||"underline line-through"==r?e(a).css("text-decoration","underline"):e(a).css("text-decoration","line-through")}}},x=function(e){var t=DataValidation_UI.validateDvRange(e);if(t){t.indexOf(";")>-1&&(t=t.substring(0,t.indexof(";")-1));var o=(t.substring(0,t.indexOf(".")),t.substring(t.indexOf(".")+1)),a=(o.split(":"),getDataFrom2DRangeText(e));return{type:"RANGE",startRow:a.sR,startCol:a.sC,endRow:a.eR,endCol:a.eC,sheetName:a.sheetName}}},L=function(o){"manageLIElement"==o?t="manageLIElement":(m.showtab="managerule",formatWithConditions.editRulesopen=!1);var a={width:545,allowSheetSwitch:!0,title:jsMsg.CFormat+" - "+jsMsg["CFormat.ManageRules"],close:function(){u(),e("div#colorScaleTip").hide(),e("div#iconSetTip").hide()}};sheetdialog.open("cformatmanagedialog",a,m)},W=function(t,o,a){if(e(e("#manageRulesContent").find(".generate")).css("display","none"),t.length>0){manageEditedRules={};for(var n=0;n<t.length;n++){var i=t[n];if("undefined"!=typeof i.datarange){var r=i.datarange,s=i.cval1,l=document.createElement("div"),d=i.csuid,c=n;l.id=c+"_cfrule",manageEditedRules[d+"_"+i.asn]=i,l.setAttribute("type",i.cs_type),l.setAttribute("csuid",d),l.setAttribute("priority",i.asn+"_"+i.priority);var m=document.createElement("div");e(m).addClass("dTc");var u=document.createElement("div");e(u).addClass("drag_cue");var p=document.createElement("div");e(u).append(e(p)),e(m).append(e(u));var C=document.createElement("div");e(l).addClass("dTr"),e(C).addClass("dTc aR");var f=document.createElement("div");e(f).addClass("elipsis fTalign"),e(C).append(e(f));var g=document.createElement("div");g.id=c+"_info",e(g).addClass("iI");var h="c_f"===i.cs_type?S(i.cond1,s,i[JSONConstants.CRITERIA_TYPE+1]):"i_s"===i.cs_type?jsMsg["CFormat.Iconset"]:jsMsg["CFormat.ColorScale"];e(f).text(replaceSplChrs(h)),h.length>27&&e(C).attr("title","c_f"===i.cs_type?replaceSplChrs(h):"");var b=document.createElement("div");if(e(b).addClass("dTc pD"),"i_s"!==i.cs_type){var v="c_f"===i.cs_type?D(i.cstyle1):M(i.cstyle1),E=document.createElement("dt");e(E).attr("style","text-align:center;"+v),e(E).text("c_f"===i.cs_type?jsMsg["CFormat.Preview"]:""),e(E).addClass("previewBg"),e(b).append(e(E))}else{var R=P(i);e(b).append(e(R))}var T=document.createElement("div");e(T).addClass("dTc pLaT elipsis"),e(T).text(r),r.length>25&&e(T).attr("title",r);var A=document.createElement("div");e(A).addClass("dTc");var O=document.createElement("div");e(O).attr("style","position:relative;");var y=document.createElement("div");e(y).addClass("mL");var F=document.createElement("div");e(F).text("..."),e(F).addClass("dTl"),e(y).append(e(F));var I=document.createElement("div");e(I).addClass("rM"),e(I).attr("style","right:-108px;opacity:0;z-index:0");var N=document.createElement("ul");N.setAttribute("type",i.cs_type);var _=c+"_editManage";N.id=_;var w=document.createElement("li");e(w).attr("title","Copy");var k=document.createElement("a");e(k).addClass("rC"),e(w).append(e(k));var L=document.createElement("li"),W=document.createElement("a");e(W).addClass("rE"),e(L).append(e(W)),e(L).attr("title","Edit");var B=document.createElement("li"),z=document.createElement("a");e(z).addClass("rD"),e(B).append(e(z)),e(B).attr("title","Delete"),e(N).append(e(w)),e(N).append(e(L)),e(N).append(e(B)),e(O).append(e(y)),e(I).append(e(N)),e(O).append(e(I)),e(A).append(e(O)),e(l).append(e(m),e(C),e(b),e(T),e(A)),e(C).append(e(f)),("c_s"===i.cs_type||"i_s"===i.cs_type)&&e(C).append(e(g));var V=document.createElement("div");e(V).addClass("dT"),e(V).append(e(l)),e("#condFormat").append(e(V)),j(c+"_cfrule",_,i.cs_type,e(y),e(I),e(g)),colorScalesBag.filterRule&&e("#selRule").zcombo("setValue",a);var U=e("#selRule").zcombo("getValue");if("all"!==U&&("classic"===U&&"c_f"!=i.cs_type&&e(V).css("display","none"),"colorscale"===U&&"c_s"!=i.cs_type&&e(V).css("display","none")),colorScalesBag.viewRules&&colorScalesBag.viewRules>1){var H=WorkSheets.getSheetCodeFromName(e("#selComp").find("option:selected").text());x(r.split(";")[0]).asn!==H&&e(V).css("display","none")}}}rt(U),t.length>1?(e(".dropme1").sortable({connectWith:".dropme1",axis:"y",start:function(e,t){t.item.startPos=t.item.index()},stop:function(e,t){var o=t.item.index();dt(t.item.startPos,o)},cursor:"pointer"}).droppable({accept:".button",activeClass:"highlight"}),e("#condFormat").children().find(".drag_cue").css("display","block")):e("#condFormat").children().find(".drag_cue").css("display","none")}colorScalesBag.viewRules=null,colorScalesBag.rulesRange=null},j=function(t,o,a,n,i,r){var s=getObj(t).getAttribute("priority").split("_"),l=s[0],d=s[1],c=getObj(t).getAttribute("csuid");e("#"+t).bind("dblclick",function(){colorScalesBag.editRulesInManage(a,d,this,l,c)}),e("#"+t).bind("click",function(){hideRuleOptions(this)}),e("#"+o).delegate("li","click",function(){colorScalesBag.editConditionalFormat(e(this),a,d,l,c,t)}),n.bind("click",function(e){showRuleOptions(this,e)}),i.bind("click",function(e){hideRuleOptions(this,"show",e)}),r.bind("mouseover",function(){var e=this.parentElement.parentElement.getAttribute("priority").split("_"),t=this.parentElement.parentElement.getAttribute("csuid"),o=z(this,t,e[0],a);"c_s"==a?st(this,o):"i_s"===a&&B(this,o)}),r.bind("mouseleave",function(){lt()})},B=function(t,o){t=e(t);var a=e("div#iconSetTip");a.show(),a.css({top:t.offset().top+"px",left:t.offset().left-55+"px"});var n=a.find(".divTableRow");e("#iconSetTip").find(".divTableRow").css("display","none");for(var i=1,r=0;i<=o.noOfCond;i++,r++)n[r].style.display="block",e(n[r]).find("span")[0].className=o["icon_id"+i]+" mR5",e(n[r]).children()[1].innerText=o["is_c"+i]},P=function(t){var o=t.cstyle1,a=t.noofcond,n=document.createElement("div");if(t.rio)for(var i=a;i>=1;i--){var r=document.createElement("span");e(r).append(e(document.createElement("span"))),e(r).addClass(iconsets.getIconClassName(o["icon_name"+i],o["icon_id"+i])),e(r).addClass(" mR5"),e(n).append(e(r))}else for(var i=1;a>=i;i++){var r=document.createElement("span");e(r).append(e(document.createElement("span"))),e(r).addClass(iconsets.getIconClassName(o["icon_name"+i],o["icon_id"+i])),e(r).addClass(" mR5"),e(n).append(e(r))}return n},z=function(e,t,o,a){var n=manageEditedRules[t+"_"+o],i=n.cstyle1,r={};if("c_s"==a)r.min="MINIMUM"===i.cr_ty1?jsMsg["CFormat.CS.Automatic"]:"PERCENT"===i.cr_ty1?i.cval1+"%":"PERCENTILE"===i.cr_ty1?i.cval1+" "+jsMsg["CFormat.CS.Percentile"]:i.cval1,9===Object.keys(i).length?(r.mid="MINIMUM"===i.cr_ty2?jsMsg["CFormat.CS.Automatic"]:"PERCENT"===i.cr_ty2?i.cval2+" %":"PERCENTILE"===i.cr_ty2?i.cval2+" "+jsMsg["CFormat.CS.Percentile"]:i.cval2,r.max="MAXIMUM"===i.cr_ty3?jsMsg["CFormat.CS.Automatic"]:"PERCENT"===i.cr_ty3?i.cval3+" %":"PERCENTILE"===i.cr_ty3?i.cval3+" "+jsMsg["CFormat.CS.Percentile"]:i.cval3):r.max="MAXIMUM"===i.cr_ty2?jsMsg["CFormat.CS.Automatic"]:"PERCENT"===i.cr_ty2?i.cval2+" %":"PERCENTILE"===i.cr_ty2?i.cval2+" "+jsMsg["CFormat.CS.Percentile"]:i.cval2;else if("i_s"==a)for(var s=n.noofcond,l=1;s>0;s--,l++){r.noOfCond=n.noofcond;var d=n.rio?l:s;r["icon_id"+d]=iconsets.getIconClassName(i["icon_name"+s],i["icon_id"+s]);var c=chartGlance.isNumber(i["cval"+s]);if(r["val"+s]="FORMULA"!==i["cr_ty"+s]&&c?"PERCENTILE"===i["cr_ty"+s]?i["cval"+s]+" "+jsMsg["CFormat.CS.Percentile"]:"PERCENT"===i["cr_ty"+s]?i["cval"+s]+"%":i["cval"+s]:"Formula",s==n.noofcond)r["is_c"+s]=("gteq"===i["is_c"+s]?" >= ":" > ")+r["val"+s];else{var m="gteq"==i["is_c"+(s+1)]?" < ":"<=",u=1!=s?("gteq"==i["is_c"+s]?" >= ":" > ")+r["val"+s]:"";u=u?u+=" and ":u,r["is_c"+s]=u+m+r["val"+(s+1)]}}return r},V=function(t){var o=e(t);setTimeout(function(){!e("#cfUL").is(":visible")||e(o).is(":hover")||e(".arw").is(":hover")||e("#cfUL").is(":hover")||(e("#cfUL").hide(),U("hide",t))},1e3)},U=function(t,o){if(!getObj("tempDivId")){var a=document.createElement("div");a.setAttribute("id","tempDivId"),a.setAttribute("class","arw"),document.body.appendChild(a)}var n=e("#tempDivId");if("show"===t){var i=e(o),r=i.offset().top,s=i.offset().left;n.css("top",r+21),n.css("left",s+5),n.show()}else n.hide()},H=function(t){var o=document.getElementById("rule"+ruleId);if(null!=o){var a=o.getElementsByTagName("select");"number"==t?(e(a[0]).zcombo("setSelectedIndex",0),formatWithConditions.setCombo("rulesCombo"+ruleId)):"date"==t?(e(a[0]).zcombo("setSelectedIndex",2),formatWithConditions.setCombo("rulesCombo"+ruleId),e(a[0]).zcombo("setSelectedIndex",2)):"text"==t&&(e(a[0]).zcombo("setSelectedIndex",1),formatWithConditions.setCombo("rulesCombo"+ruleId),e(a[0]).zcombo("setSelectedIndex",1))}},q=function(t){r&&setTimeout(function(){switch(t){case"gt":"DATE"===e("#rulesCombo1").zcombo("getValue")?(e("#dateCombo1").zcombo("setValue",1),R("dateCombo1"),e("#dateCombo1").zcombo("setValue",1)):(e("#rulesCombo1").zcombo("setValue","ANY_VALUE"),E("rulesCombo1"),e("#anyvalueCombo1").zcombo("setValue",1),R("anyvalueCombo1")),e("#cfinput").focus();break;case"lt":"DATE"===e("#rulesCombo1").zcombo("getValue")?(e("#dateCombo1").zcombo("setValue",2),R("dateCombo1"),e("#dateCombo1").zcombo("setValue",2)):(e("#rulesCombo1").zcombo("setValue","ANY_VALUE"),E("rulesCombo1"),e("#anyvalueCombo1").zcombo("setValue",2),R("anyvalueCombo1")),e("#cfinput").focus();break;case"btw":H("DATE"===e("#rulesCombo1").zcombo("getValue")?"date":"number"),setTimeout(function(){e(e("#doubleInput").find("input")[0]).focus()},0);break;case"eq":"DATE"===e("#rulesCombo1").zcombo("getValue")?(e("#dateCombo1").zcombo("setValue",5),R("dateCombo1"),e("#dateCombo1").zcombo("setValue",5)):(e("#rulesCombo1").zcombo("setValue","ANY_VALUE"),E("rulesCombo1"),e("#anyvalueCombo1").zcombo("setValue",5),R("anyvalueCombo1")),e("#cfinput").focus();break;case"tc":e("#rulesCombo1").zcombo("setValue","TEXT"),E("rulesCombo1"),e("#rulesCombo1").zcombo("setValue","TEXT"),e("#cfinput").focus();break;case"formula":e("#rulesCombo1").zcombo("setValue","FORMULA"),E("rulesCombo1"),e("#rulesCombo1").zcombo("setValue","FORMULA"),e("#cfinput").focus();break;case"dc":H("date")}},100),r=""},Y=function(e){r=e,C()},$=function(){var t=e("#rule1").find("table:first"),o=e("#rule1").find("div:first");table1=t.clone(!0),div1=o.clone(!0);var a=e.trim(e("#rule2").html()).length;if(e("#rule2").css({opacity:"0.4"}),0==a){var n=e(t).clone(),i=n.find("#singleInput input");i.attr("id",i.attr("id")+2)}mask.toolbar(!0,e("#rule2"),"rule2mask"),e("#rule3").css({opacity:"0.4"});var r=e.trim(e("#rule3").html()).length;if(0==r){var n=e(t).clone(),i=n.find("#singleInput input");i.attr("id",i.attr("id")+3)}mask.toolbar(!0,e("#rule3"),"rule3mask"),e("#rule1").find("select").removeAttr("disabled"),e("#rule1").find("input").removeAttr("disabled");try{var s=1,l=e("#rule"+s),d=l.find("select");e(d[0]).attr("id","rulesCombo"+s),e(d[0]).attr("ctype","zcombo"),e(d[0]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.setCombo', arg:'rulesCombo"+s+"'}}"),e(d[1]).attr("id","anyvalueCombo"+s),e(d[1]).attr("ctype","zcombo"),e(d[1]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'anyvalueCombo"+s+"'}}"),e(d[2]).attr("id","textCombo"+s),e(d[2]).attr("ctype","zcombo"),e(d[2]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'textCombo"+s+"'}}"),e(d[3]).attr("id","dateCombo"+s),e(d[3]).attr("ctype","zcombo"),e(d[3]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'dateCombo"+s+"'}}"),e(d[4]).attr("id","cellCombo"+s),e(d[4]).attr("ctype","zcombo"),e(d[4]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'cellCombo"+s+"'}}"),e.ui.utils.initComponents(e(d)),e(e("#rule1").find(".dR")).attr("id",1),e("#1").css("display","none"),e.ZToolbarHandler.init(["#rule"+s]),registerIconEvents(e(l).find("li"))}catch(e){}},G=function(){formatWithConditions.editRulesopen||formatWithConditions.isCfManageRules?setTimeout(function(){u();var t=e("#selComp").zcombo("getValue");w(t);var o=e("#cformatdialogzdialog").prev().children()[0];e(o).text(jsMsg.CFormat+" - "+jsMsg["CFormat.ManageRules"]),getObj("createRuleContent").style.display="none",e("#manageRulesContent").show(),e("#cformatdialogzdialog").parent().css("width","575px")},500):sheetdialog.close()},X=function(t){e("#rule"+t).remove(),numOfCond--,1===numOfCond&&e(e("#rulesContainer").find(".dR")).css("display","none"),10>numOfCond&&e("#aR").css("display","block"),1===numOfCond?(e("#rulesContainer").sortable("option","cancel","#"+e("#rulesContainer").children()[0].id),e("#rulesContainer").children().css("cursor","default"),e("#"+e("#rulesContainer").children()[0].id).find(".drag_cue").css("display","none"),e("#rulesContainer .cRules").find("table").hover(function(){e(this).css({"background-color":"transparent"})})):(e("#rulesContainer").sortable("option","cancel",".cfDisableTextfield"),e("#rulesContainer").children().css("cursor","move"),e("#rulesContainer").find(".drag_cue").css("display","block"),e("#rulesContainer .cRules").find("table").hover(function(){e(this).css({"background-color":"#f7f7f7"})}),e("#rulesContainer .cRules").find("table").mouseleave(function(){e(this).css({"background-color":""})}))},Q=function(e){var t=x(e),o=isUndefined(t)?!1:!0;o?t.label=e:t=_();var a=t.startRow,n=t.startCol,i=t.endRow,r=t.endCol;ProtectedRanges.isRangeLocked(a,n,i,r)||d(e,"CFormat.CreateRule")},K=function(){e("#condFormat").children().not("#noconditions").remove(),e(e("#manageRulesContent").find(".generate")).css("display","none"),e("#noconditions").show()},J=function(){if(!(numOfCond>=10)){var t="rule"+ ++ruleId;e("#rulesContainer").append('<div class = "cRules" id='+t+"></div>");var o=e(table1).clone(),a=o.find("#singleInput input");a.attr("id",a.attr("id")+ruleId),o.appendTo(e("#"+t)),e(e("#"+t).find(".dR")).attr("id",ruleId);var n=e("#rule"+ruleId),i=n.find("select");e(i[0]).attr("id","rulesCombo"+ruleId),e(i[0]).attr("ctype","zcombo"),e(i[0]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.setCombo', arg:'rulesCombo"+ruleId+"'}}"),e(i[1]).attr("id","anyvalueCombo"+ruleId),e(i[1]).attr("ctype","zcombo"),e(i[1]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'anyvalueCombo"+ruleId+"'}}"),e(i[2]).attr("id","textCombo"+ruleId),e(i[2]).attr("ctype","zcombo"),e(i[2]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'textCombo"+ruleId+"'}}"),e(i[3]).attr("id","dateCombo"+ruleId),e(i[3]).attr("ctype","zcombo"),e(i[3]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'dateCombo"+ruleId+"'}}"),e(i[4]).attr("id","cellCombo"+ruleId),e(i[4]).attr("ctype","zcombo"),e(i[4]).attr("data","{componentOptions:{type: 'text_only','editable': false}, appData:{callback: 'formatWithConditions.getListItems', arg:'cellCombo"+ruleId+"'}}"),e.ui.utils.initComponents(e(i)),e.ZToolbarHandler.init(["#rule"+ruleId]),registerIconEvents(e(n).find("li")),1===numOfCond&&e(e("#rulesContainer").find(".dR")).css("display","block"),numOfCond++,e("#"+ruleId).css("display","block"),e("#"+t).bind("mouseup",function(){e("#"+t).css("background","")}),e("#rulesContainer").scrollTop(e("#rulesContainer").scrollTop()+e("#"+t).position().top),10===numOfCond&&e("#aR").css("display","none"),e("#rulesContainer").sortable("option","cancel",".cfDisableTextfield"),e("#rulesContainer").children().css("cursor","move"),e("#rulesContainer").find(".drag_cue").css("display","block"),e("#rulesContainer .cRules").find("table").hover(function(){e(this).css({"background-color":"#f7f7f7"})}),e("#rulesContainer .cRules").find("table").mouseleave(function(){e(this).css({"background-color":""})}),s&&""!==s.DATATYPE&&"number"!==s.DATATYPE&&H(s.DATATYPE),"number"===s.DATATYPE?e(e("#"+t).find("#doubleInput").find("input")[0]).focus():"text"===s.DATATYPE&&e(e("#"+t).find("#singleInput").find("input")[0]).focus()}},Z=function(){var e,t,o,a;if(isCellRange()){var n=getCellRange();e=n.startRow,t=n.startCol,o=n.endRow,a=n.endCol}else{var i=ActiveCellInfo;e=i.getStartRow(),t=i.getStartCol(),o=i.getEndRow(),a=i.getEndCol()}var r=getServerRange(e,t,o,a),s=new AjaxRequest,l=new RequestParameters(ActionConstants.CONDITIONAL_FORMAT_CLEAR_RULE);l.setParameters(WorkSheets.getAssociatedActiveSheetName(),r.startRow,r.startCol,r.endRow,r.endCol),s.init("POST",l.getURL(),!0,l.getParametersAsString()),s.sendRequest()},et=function(t){formatWithConditions.clickedElem=e(e(t).parent().find(".previewBg")),tt("clearTheme")},tt=function(t,o){var a=e(formatWithConditions.clickedElem).parent().find("li"),n=[];if("custom"===t){var r=o.style;n.push(r.backgroundColor),n.push(r.color),n.push("bold"===r.fontWeight?!0:!1),n.push("italic"===r.fontStyle?!0:!1),n.push(-1!==r.textDecoration.indexOf("underline")?!0:!1),n.push(-1!==r.textDecoration.indexOf("line-through")?!0:!1)}else n=i[t];n[0]?(e(formatWithConditions.clickedElem).css("background-color",n[0]),e(a[4]).children().css("border-bottom-color",n[0]),e(a[4]).addClass("pressed")):(e(formatWithConditions.clickedElem).css("background-color",""),e(a[4]).children().css("border-bottom-color","transparent"),e(a[4]).removeClass("pressed")),n[1]?(e(formatWithConditions.clickedElem).css("color",n[1]),e(a[5]).children().css("border-bottom-color",n[1]),e(a[5]).addClass("pressed")):(e(formatWithConditions.clickedElem).css("color",""),e(a[5]).children().css("border-bottom-color","transparent"),e(a[5]).removeClass("pressed")),n[2]?(e(formatWithConditions.clickedElem).css("font-weight","bold"),e(a[0]).addClass("pressed")):(e(formatWithConditions.clickedElem).css("font-weight",""),e(a[0]).removeClass("pressed")),n[3]?(e(formatWithConditions.clickedElem).css("font-style","italic"),e(a[1]).addClass("pressed")):(e(formatWithConditions.clickedElem).css("font-style",""),e(a[1]).removeClass("pressed")),n[4]?(e(formatWithConditions.clickedElem).css("text-decoration","underline"),e(a[2]).addClass("pressed")):(e(formatWithConditions.clickedElem).css("text-decoration",""),e(a[2]).removeClass("pressed")),n[5]?(e(formatWithConditions.clickedElem).css("text-decoration","line-through"),n[4]&&e(formatWithConditions.clickedElem).css("text-decoration","line-through underline"),e(a[3]).addClass("pressed")):(e(formatWithConditions.clickedElem).css("text-decoration",""),n[4]&&e(formatWithConditions.clickedElem).css("text-decoration","underline"),e(a[3]).removeClass("pressed"));var s=colorScalesBag.brightness(e(formatWithConditions.clickedElem).css("background-color"))<127.5;s?e(formatWithConditions.clickedElem).children().addClass("arwLight"):e(formatWithConditions.clickedElem).children().removeClass("arwLight")},ot=function(e){formatWithConditions.clickedElem=e},at={},nt=function(){var t;if(formatWithConditions.clickedElem.parentNode?t=formatWithConditions.clickedElem.parentNode.parentNode.parentNode.parentNode.parentNode.id:formatWithConditions.clickedElem.parent()&&(t=e(formatWithConditions.clickedElem.parent().parent().parent().parent().parent())[0].id),"none"!==e(e(createruledialogtheme).find(".dCp")[10]).css("display")){at[t]={};var o=e(e(createruledialogtheme).find(".dCp")[10]).children()[1];at[t].fontWeight=o.style.fontWeight,at[t].backgroundColor=o.style.backgroundColor,at[t].fontStyle=o.style.fontStyle,at[t].color=o.style.color,at[t].textDecoration=o.style.textDecoration,e(o).css("background-color",""),e(o).css("color","rgb(17, 17, 17)"),e(o).css("font-style",""),e(o).css("font-weight",""),e(o).css("text-decoration","")}},it=function(){var t=formatWithConditions.clickedElem.parentNode.parentNode.parentNode.parentElement.parentNode.id;e("#createruledialogtheme .dCp .cstM").css("display","none");var o=!1,a=formatWithConditions.clickedElem.style,n=[];n.push(a.backgroundColor),n.push(a.color),n.push("bold"===a.fontWeight?!0:!1),n.push("italic"===a.fontStyle?!0:!1),n.push(-1!==a.textDecoration.indexOf("underline")?!0:!1),n.push(-1!==a.textDecoration.indexOf("line-through")?!0:!1);for(var r=1;10>=r;r++)if(JSON.stringify(i["theme"+r])==JSON.stringify(n)){if(e(e("#createruledialogtheme .dCp .cstM")[r-1]).css("display","block"),o=!0,at[t]){var s=e(e(createruledialogtheme).find(".dCp")[10]).children()[1];s.style.fontWeight=at[t].fontWeight,s.style.backgroundColor=at[t].backgroundColor,s.style.fontStyle=at[t].fontStyle,s.style.color=at[t].color,s.style.textDecoration=at[t].textDecoration,e(e(createruledialogtheme).find(".dCp")[10]).show()}else{var s=e(e(createruledialogtheme).find(".dCp")[10]).children()[1];s.style.fontWeight="",s.style.backgroundColor="",s.style.fontStyle="",s.style.color="",s.style.textDecoration="",e(e(createruledialogtheme).find(".dCp")[10]).hide()}break}if(!o){var l=formatWithConditions.clickedElem.style,d=e(e(e(createruledialogtheme).find(".dCp")[10]).children()[1]);if(!(l.backgroundColor||l.color||l.fontWeight||a.fontStyle||l.textDecoration))return void(at[t]?(e(e(createruledialogtheme).find(".dCp")[10]).show(),d.css("background-color",at[t].backgroundColor),d.css("color",at[t].color),d.css("font-weight",at[t].fontWeight),d.css("font-style",at[t].fontStyle),d.css("text-decoration",at[t].textDecoration)):e(e(createruledialogtheme).find(".dCp")[10]).hide());e(e(createruledialogtheme).find(".dCp")[10]).show(),e(e(e(createruledialogtheme).find(".dCp")[10]).children()[0]).css("display","block"),d.css("background-color",l.backgroundColor),d.css("color",l.color),d.css("font-weight",l.fontWeight),d.css("font-style",l.fontStyle),d.css("text-decoration",l.textDecoration)}},rt=function(t){var o=e(e("#condFormat").find(".dT")),a=o.size();if("classic"===t)for(var n=0;n<o.size();n++)"c_s"===e(e(o[n]).children()[0]).attr("type")||"i_s"===e(e(o[n]).children()[0]).attr("type")?(a--,e(e(e("#condFormat").find(".dT"))[n]).css("display","none")):"c_f"===e(e(o[n]).children()[0]).attr("type")&&e(e(e("#condFormat").find(".dT"))[n]).css("display","table");else if("colorscale"===t)for(var n=0;n<o.size();n++)"c_f"===e(e(o[n]).children()[0]).attr("type")||"i_s"===e(e(o[n]).children()[0]).attr("type")?(a--,e(e(e("#condFormat").find(".dT"))[n]).css("display","none")):e(e(e("#condFormat").find(".dT"))[n]).css("display","table");else if("iconset"===t)for(var n=0;n<o.size();n++)"c_f"===e(e(o[n]).children()[0]).attr("type")||"c_s"===e(e(o[n]).children()[0]).attr("type")?(a--,e(e(e("#condFormat").find(".dT"))[n]).css("display","none")):e(e(e("#condFormat").find(".dT"))[n]).css("display","table");else for(var n=0;n<o.size();n++)e(e(e("#condFormat").find(".dT"))[n]).css("display","table");0===a?e("#noconditions").show():e("#noconditions").hide()},st=function(t,o){t=e(t);var a=e("div#colorScaleTip");a.show(),a.css({top:t.offset().top+"px",left:t.offset().left-55+"px"}),e(a.find(".divTableCol")[1]).text(o.min),o.mid?(e(a.find(".divTableRow")[1]).css("display","table-row"),e(a.find(".divTableCol")[3]).text(o.mid)):e(a.find(".divTableRow")[1]).css("display","none"),e(a.find(".divTableCol")[5]).text(o.max),a.show(),a.animate({top:"-=8px"},200)},lt=function(){e("div#colorScaleTip").hide(),e("div#iconSetTip").hide()},dt=function(t,o){var a=t,n=o;if(a!==n){for(var i=e(e("#condFormat").children()[o]).children()[0].getAttribute("priority").split("_"),r=parseInt(e(e("#condFormat").children()[o]).children()[0].getAttribute("csuid")),s=i[0],l=(parseInt(i[0]),i[1],0),d=0,c=o-1;c>=0;c--){var m=e(e("#condFormat").children()[c]).children()[0].getAttribute("priority").split("_");if(m[0]==s){l=m[1],d=parseInt(e(e("#condFormat").children()[c]).children()[0].getAttribute("csuid"));break}}var u=0===l?"}":',"to":{"csuid":'+d+"}}",p='{"asn":"'+s+'","csuid":'+r+u,C=new AjaxRequest,f=new RequestParameters(ActionConstants.CONDITIONAL_STYLE_REORDER);f.setParameters(WorkSheets.getAssociatedActiveSheetName(),p),C.init("POST",f.getURL(),!0,f.getParametersAsString()),C.sendRequest()}};return i.theme1=["rgb(155, 222, 180)","rgb(37, 150, 80)",!1,!1,!1,!1],i.theme2=["rgb(248, 205, 207)","rgb(231, 72, 77)",!1,!1,!1,!1],i.theme3=["rgb(248, 245, 203)","rgb(140, 132, 28)",!1,!1,!1,!1],i.theme4=["rgb(209, 232, 251)","rgb(48, 123, 187)",!1,!1,!1,!1],i.theme5=["rgb(246, 217, 186)","",!1,!1,!1,!1],i.theme6=["rgb(194, 232, 230)","",!1,!1,!1,!1],i.theme7=["rgb(255, 255, 255)","rgb(0, 0, 0)",!0,!1,!1,!1],i.theme8=["rgb(255, 255, 255)","rgb(45, 133, 210)",!0,!1,!1,!1],i.theme9=["rgb(255, 255, 255)","rgb(0, 0, 0)",!1,!1,!1,!0],i.theme10=["rgb(255, 255, 255)","rgb(232, 80, 86)",!1,!1,!1,!0],i.clearTheme=["","",!1,!1,!1,!1],{editRulesopen:!1,isCfManageRules:!1,filterRulesByRange:[],managerulesFilter:!1,keypair:{DECIMAL:jsMsg["CFormat.Decimal"].toLowerCase(),WHOLENUMBER:jsMsg["CFormat.WholeNumber"].toLowerCase(),TEXT_LENGTH:jsMsg["CFormat.TextLength"].toLowerCase(),DATE:jsMsg["Filter.date"].toLowerCase(),ANY_VALUE:jsMsg.Number.toLowerCase(),TIME:jsMsg.Time.toLowerCase(),DATETIME:jsMsg.DateTime.toLowerCase()},validateAndShow:l,editObj:s,showConditionalDialog:d,initColorPalates:c,cfRange:_,setSelectForDatatype:H,loadExistingRules:A,cancelBtn:G,validateInpFields:I,showManageRulesAfterEdit:L,changeState:b,setCombo:E,getListItems:R,createClassicRule:C,setCFStyleValue:k,getRangeValues:x,changeMenuStyle:U,getManageRuleContent:w,addNewRuleInCreateDialog:J,clearRules:Z,mouseOutmenuHide:V,getFormula:S,noConditionsHTMLgeneration:K,createRulesList:W,toggleRuleList:h,deleteRuleInDialog:X,applyThemeInDialog:tt,setClickedElement:ot,clickedElem:n,selectThemeInMenu:it,storeCustomProperty:nt,clearFormat:et,setCondition:Y}}(jQuery);$(document).ready(function(){$("#cformatdialog").live("click",function(){$("#tempDivId").hide()}),$("#tempDivId").live("click",function(){formatWithConditions.changeMenuStyle("hide",this)})}),$(document).ready(function(){$("#manageRulesContent").scroll(function(){$("#cfUL").hide(),$("#tempDivId").hide()})});var conditionalFormattingFilter=function(){var e=function(){formatWithConditions.managerulesFilter=!0},t=function(){var e=$("#conditionFilter").val();if(e=CellUtils.removeApostrophe(e),formatWithConditions.managecfData&&0!==formatWithConditions.managecfData.length){var t=$("#condFormat");t.children().show();var a,n=0,i=formatWithConditions.getRangeValues(e);if(i)var r=new Range(i.startRow,i.startCol,i.endRow,i.endCol);for(a in formatWithConditions.managecfData)if("undefined"!=typeof formatWithConditions.managecfData[a].RANGENAME){var s=formatWithConditions.managecfData[a].RANGENAME,l=formatWithConditions.getRangeValues(s),d=i.sheetName?i.sheetName:CURRSHEETNAME;if(l.sheetName!==d){t.find("div.dvtreeExpand:eq("+a+"),div.dvtreeCollapse:eq("+a+"),table:eq("+a+")").hide(),n++;continue}DataValidation.util.isRangeIntersect(l,r)||(t.find("div.dvtreeExpand:eq("+a+"),div.dvtreeCollapse:eq("+a+"),table:eq("+a+")").hide(),n++)}var c=n===formatWithConditions.managecfData.length?!0:!1;setTimeout(o(c),100)}},o=function(e){$("#noconditions").hide(),e&&$("#noconditions").show()},a=function(e){{var t=$("#condFilterHolder");$("#conditionFilter")}"cellRange"===e?(t.show(),$("#conditionFilter").val(selectedRangeForDialog())):(t.hide(),hideCellRangeFillDIV())};return{onFilter:e,searchARange:t,cellRangeOnDialogOpen:a}}(),manageRulesButtonClicks=function(){var e=function(){sheetdialog.close(),formatWithConditions.validateAndShow("iconElement")},t=function(){sheetdialog.close(),$("#tempDivId").hide()};return{fireMeOnNewRule_open:e,manageRuleDialog_close:t}}();$("#ruleList li").bind("click",function(){$("#iS").text($(this).text()),$("#ruleList").hide()}),$("#rC").bind("click",function(){$("#ruleList").show()}),$("#ruleList").bind("mouseleave",function(){$("#ruleList").hide()});function EditAreaLoader(){this.version="0.7.0.1",date=new Date,this.start_time=date.getTime(),this.win="loading",this.error=!1,this.baseURL="",this.template="",this.lang=new Object,this.load_syntax=new Object,this.syntax=new Object,this.loadedFiles=new Array,this.waiting_loading=new Object,this.scripts_to_load=new Array,this.sub_scripts_to_load=new Array("edit_area","manage_area","edit_area_functions","keyboard","search_replace","highlight","regexp"),this.height=300,this.resize=new Array,this.hidden=new Object,this.default_settings={debug:!1,smooth_selection:!0,font_size:"10",font_family:"monospace",start_highlight:!1,toolbar:"search, go_to_line, fullscreen, |, undo, redo, |, select_font,|, change_smooth_selection, highlight, reset_highlight, |, help",begin_toolbar:"",end_toolbar:"",is_multi_files:!1,allow_resize:"both",min_width:400,min_height:125,replace_tab_by_spaces:!1,allow_toggle:!0,language:"en",syntax:"",syntax_selection_allow:"basic,brainfuck,c,cpp,css,html,js,pas,php,python,sql,vb,xml",display:"onload",max_undo:30,browsers:"known",plugins:"",gecko_spellcheck:!1,fullscreen:!1,load_callback:"",save_callback:"",change_callback:"",submit_callback:"",EA_init_callback:"",EA_delete_callback:"",EA_load_callback:"",EA_unload_callback:"",EA_toggle_on_callback:"",EA_toggle_off_callback:"",EA_file_switch_on_callback:"",EA_file_switch_off_callback:"",EA_file_close_callback:""},this.advanced_buttons=[["search","search.gif","show_search",!1],["go_to_line","go_to_line.gif","go_to_line",!1],["undo","undo.gif","undo",!0],["redo","redo.gif","redo",!0],["help","help.gif","show_help",!1]],ua=navigator.userAgent,this.nav=new Object,this.nav.isIE="Microsoft Internet Explorer"==navigator.appName,this.nav.isIE&&(this.nav.isIE=ua.replace(/^.*?MSIE ([0-9\.]*).*$/,"$1"),this.nav.isIE<6&&this.has_error()),(this.nav.isNS=-1!=ua.indexOf("Netscape/"))&&(this.nav.isNS=ua.substr(ua.indexOf("Netscape/")+9),(this.nav.isNS<8||!this.nav.isIE)&&this.has_error()),(this.nav.isOpera=-1!=ua.indexOf("Opera"))&&(this.nav.isOpera=ua.replace(/^.*?Opera.*?([0-9\.]+).*$/i,"$1"),this.nav.isOpera<9&&this.has_error(),this.nav.isIE=!1),this.nav.isGecko=-1!=ua.indexOf("Gecko"),(this.nav.isFirefox=-1!=ua.indexOf("Firefox"))&&(this.nav.isFirefox=ua.replace(/^.*?Firefox.*?([0-9\.]+).*$/i,"$1")),(this.nav.isIceweasel=-1!=ua.indexOf("Iceweasel"))&&(this.nav.isFirefox=this.nav.isIceweasel=ua.replace(/^.*?Iceweasel.*?([0-9\.]+).*$/i,"$1")),(this.nav.isCamino=-1!=ua.indexOf("Camino"))&&(this.nav.isCamino=ua.replace(/^.*?Camino.*?([0-9\.]+).*$/i,"$1")),(this.nav.isSafari=-1!=ua.indexOf("Safari"))&&(this.nav.isSafari=ua.replace(/^.*?Version\/([0-9]+\.[0-9]+).*$/i,"$1")),(this.nav.isChrome=-1!=ua.toLowerCase().indexOf("chrome"))&&(this.nav.isChrome=ua.replace(/^.*?Chrome.*?([0-9\.]+).*$/i,"$1")),this.nav.isValidBrowser=this.nav.isIE>=6||this.nav.isOpera>=9||this.nav.isFirefox||this.nav.isCamino||this.nav.isSafari>=3||this.nav.isChrome?!0:!1,this.set_base_url();for(var e=0;e<this.scripts_to_load.length;e++)setTimeout("editAreaLoader.load_script('"+this.baseURL+this.scripts_to_load[e]+".js');",1),this.waiting_loading[this.scripts_to_load[e]+".js"]=!1}EditAreaLoader.prototype.has_error=function(){this.error=!0;for(var e in EditAreaLoader.prototype)EditAreaLoader.prototype[e]=function(){}},EditAreaLoader.prototype.window_loaded=function(){if(editAreaLoader.win="loaded",document.forms)for(var e=0;e<document.forms.length;e++){var t=document.forms[e];t.edit_area_replaced_submit=null;try{t.edit_area_replaced_submit=t.onsubmit,t.onsubmit=""}catch(e){}editAreaLoader.add_event(t,"submit",EditAreaLoader.prototype.submit),editAreaLoader.add_event(t,"reset",EditAreaLoader.prototype.reset)}editAreaLoader.add_event(window,"unload",function(){for(var e in editAreas)editAreaLoader.delete_instance(e)})},EditAreaLoader.prototype.init_ie_textarea=function(e){textarea=document.getElementById(e),textarea&&"undefined"==typeof textarea.focused&&(textarea.focus(),textarea.focused=!0,textarea.selectionStart=textarea.selectionEnd=0,get_IE_selection(textarea),editAreaLoader.add_event(textarea,"focus",IE_textarea_focus),editAreaLoader.add_event(textarea,"blur",IE_textarea_blur))},EditAreaLoader.prototype.init=function(e){if(e.id||this.has_error(),!this.error){editAreas[e.id]&&editAreaLoader.delete_instance(e.id);for(var t in this.default_settings)"undefined"==typeof e[t]&&(e[t]=this.default_settings[t]);this.height=e.height,e.begin_toolbar.length>0&&(e.toolbar=e.begin_toolbar+","+e.toolbar),e.end_toolbar.length>0&&(e.toolbar=e.toolbar+","+e.end_toolbar),e.tab_toolbar=e.toolbar.replace(/ /g,"").split(","),e.plugins=e.plugins.replace(/ /g,"").split(",");for(var t=0;t<e.plugins.length;t++)0==e.plugins[t].length&&e.plugins.splice(t,1);this.get_template(),editAreaLoader.lang[e.language]||this.load_script(this.baseURL+e.language+".js?"+BUILD_VERSION),e.syntax.length>0&&(e.syntax=e.syntax.toLowerCase(),editAreaLoader.load_syntax[e.syntax]||this.load_script(this.baseURL+e.syntax+".js?"+BUILD_VERSION)),editAreas[e.id]={settings:e},editAreas[e.id].displayed=!1,editAreas[e.id].hidden=!1,editAreaLoader.start(e.id)}},EditAreaLoader.prototype.delete_instance=function(e){editAreaLoader.execCommand(e,"EA_delete"),window.frames["frame_"+e]&&window.frames["frame_"+e].editArea&&(editAreas[e].displayed&&editAreaLoader.toggle(e,"off"),window.frames["frame_"+e].editArea.execCommand("EA_unload"));var t=document.getElementById("EditAreaArroundInfos_"+e);t&&t.parentNode.removeChild(t);var a=document.getElementById("frame_"+e);if(a){a.parentNode.removeChild(a);try{delete window.frames["frame_"+e]}catch(e){}}delete editAreas[e]},EditAreaLoader.prototype.start=function(e){if("loaded"!=this.win)return void setTimeout("editAreaLoader.start('"+e+"');",50);for(var t in editAreaLoader.waiting_loading)if("loaded"!=editAreaLoader.waiting_loading[t])return void setTimeout("editAreaLoader.start('"+e+"');",50);if(!editAreaLoader.lang[editAreas[e].settings.language]||editAreas[e].settings.syntax.length>0&&!editAreaLoader.load_syntax[editAreas[e].settings.syntax])return void setTimeout("editAreaLoader.start('"+e+"');",50);if(editAreas[e].settings.syntax.length>0&&editAreaLoader.init_syntax_regexp(),!document.getElementById("EditAreaArroundInfos_"+e)&&(editAreas[e].settings.debug||editAreas[e].settings.allow_toggle)){var a=document.createElement("span");a.id="EditAreaArroundInfos_"+e;var r="";editAreas[e].settings.allow_toggle&&(checked="onload"==editAreas[e].settings.display?"checked":"",r+="<div id='edit_area_toggle_"+t+"'>",r+="<input id='edit_area_toggle_checkbox_"+e+"' class='toggle_"+e+"' type='checkbox' onclick='editAreaLoader.toggle(\""+e+"\");' accesskey='e' "+checked+" />",r+="<label for='edit_area_toggle_checkbox_"+e+"'>{$toggle}</label></div>"),editAreas[e].settings.debug&&(r+="<textarea id='edit_area_debug_"+e+"' style='z-index: 20; width: 100%; height: 120px;overflow: auto; border: solid black 1px;'></textarea><br />"),r=editAreaLoader.translate(r,editAreas[e].settings.language),a.innerHTML=r;var i=document.getElementById(e).parentNode,s=document.getElementById(e).nextSibling;null==s?i.appendChild(a):i.insertBefore(a,s)}if(!editAreas[e].initialized&&(this.execCommand(e,"EA_init"),"later"==editAreas[e].settings.display))return void(editAreas[e].initialized=!0);this.nav.isIE&&editAreaLoader.init_ie_textarea(e);if(area=editAreas[e],!this.iframe_script){this.iframe_script="",1==USE_COMPRESSION&&(sub_scripts_to_load=new Array("sub_edit_area_full"));for(var t=0;t<this.sub_scripts_to_load.length;t++)this.iframe_script+='<script language="javascript" type="text/javascript" src="'+this.baseURL+this.sub_scripts_to_load[t]+".js?"+BUILD_VERSION+'"></script>'}for(var t=0;t<area.settings.plugins.length;t++)editAreaLoader.all_plugins_loaded||(this.iframe_script+='<script language="javascript" type="text/javascript" src="'+this.baseURL+"plugins/"+area.settings.plugins[t]+"/"+area.settings.plugins[t]+'.js"></script>'),this.iframe_script+='<script language="javascript" type="text/javascript" src="'+this.baseURL+"plugins/"+area.settings.plugins[t]+"/langs/"+area.settings.language+'.js"></script>';if(!this.iframe_css){var o=".msgIconBig { background:url("+STYLE_PATH+"images/msgIconBig.png) no-repeat; height: 24px; width: 29px; cursor:default; vertical-align: middle;}";o+=".warningIconBig { background:url("+STYLE_PATH+"images/warningIconBig.png) no-repeat; height: 24px; width: 29px;cursor:default;vertical-align: middle;}",o+=".errorIconBig { background:url("+STYLE_PATH+"images/errorIconBig.png) no-repeat; height: 24px; width: 29px; cursor:default;vertical-align: middle;}",this.iframe_css="<link href='"+STYLE_PATH+"edit_area.css?"+BUILD_VERSION+"' rel='stylesheet' type='text/css' />",this.iframe_css+="<link href='"+STYLE_PATH+"style_sprite.css?"+BUILD_VERSION+"' rel='stylesheet' type='text/css' />",this.iframe_css+="<style>"+o+"</style>"}var n=this.template.replace(/\[__BASEURL__\]/g,this.baseURL),n=this.template.replace(/\[__IMAGE_PATH__\]/g,IMAGE_PATH);n=this.translate(n,area.settings.language,"template"),n=n.replace("[__CSSRULES__]",this.iframe_css),n=n.replace("[__JSCODE__]",this.iframe_script),area.textarea=document.getElementById(area.settings.id),editAreas[area.settings.id].textarea=area.textarea;var i=area.textarea.parentNode,d=document.createElement("iframe");d.name="frame_"+area.settings.id,d.id="frame_"+area.settings.id,d.style.borderWidth="0px",setAttribute(d,"frameBorder","0"),d.style.overflow="hidden",d.style.display="none";var s=area.textarea.nextSibling;null==s?i.appendChild(d):i.insertBefore(d,s);var l=window.frames["frame_"+area.settings.id];l.document.open(),l.editAreas=editAreas,l.area_id=area.settings.id,l.document.area_id=area.settings.id,l.document.write(n),l.document.close()},EditAreaLoader.prototype.toggle=function(e,t){return t||(t=1==editAreas[e].displayed?"off":"on"),1==editAreas[e].displayed&&"off"==t?this.toggle_off(e):0==editAreas[e].displayed&&"on"==t&&this.toggle_on(e),!1},EditAreaLoader.prototype.toggle_off=function(e){if(window.frames["frame_"+e]){var t=window.frames["frame_"+e];t.editArea.fullscreen.isFull&&t.editArea.toggle_full_screen(!1),editAreas[e].displayed=!1,editAreas[e].textarea.wrap="off",setAttribute(editAreas[e].textarea,"wrap","off");var a=editAreas[e].textarea.parentNode,r=editAreas[e].textarea.nextSibling;a.removeChild(editAreas[e].textarea),a.insertBefore(editAreas[e].textarea,r),editAreas[e].textarea.value=t.editArea.textarea.value;var i=t.editArea.last_selection.selectionStart,s=t.editArea.last_selection.selectionEnd,o=t.document.getElementById("result").scrollTop,n=t.document.getElementById("result").scrollLeft;document.getElementById("frame_"+e).style.display="none",editAreas[e].textarea.style.display="inline";try{editAreas[e].textarea.focus()}catch(e){}if(this.nav.isIE)editAreas[e].textarea.selectionStart=i,editAreas[e].textarea.selectionEnd=s,editAreas[e].textarea.focused=!0,set_IE_selection(editAreas[e].textarea);else{this.nav.isOpera&&editAreas[e].textarea.setSelectionRange(0,0);try{editAreas[e].textarea.setSelectionRange(i,s)}catch(e){}}editAreas[e].textarea.scrollTop=o,editAreas[e].textarea.scrollLeft=n,t.editArea.execCommand("toggle_off")}},EditAreaLoader.prototype.toggle_on=function(e){if(window.frames["frame_"+e]){{window.frames["frame_"+e]}area=window.frames["frame_"+e].editArea,area.textarea.value=editAreas[e].textarea.value;var t=0,a=0,r=0,i=0;if(1==editAreas[e].textarea.use_last){var t=editAreas[e].textarea.last_selectionStart,a=editAreas[e].textarea.last_selectionEnd,r=editAreas[e].textarea.last_scrollTop,i=editAreas[e].textarea.last_scrollLeft;editAreas[e].textarea.use_last=!1}else try{var t=editAreas[e].textarea.selectionStart,a=editAreas[e].textarea.selectionEnd,r=editAreas[e].textarea.scrollTop,i=editAreas[e].textarea.scrollLeft}catch(e){}this.set_editarea_size_from_textarea(e,document.getElementById("frame_"+e)),editAreas[e].textarea.style.display="none",document.getElementById("frame_"+e).style.display="inline";try{area.execCommand("focus")}catch(e){}editAreas[e].displayed=!0,area.execCommand("update_size"),window.frames["frame_"+e].document.getElementById("result").scrollTop=r,window.frames["frame_"+e].document.getElementById("result").scrollLeft=i,area.area_select(t,a-t),area.execCommand("toggle_on")}else{var s=document.getElementById(e);s.last_selectionStart=s.selectionStart,s.last_selectionEnd=s.selectionEnd,s.last_scrollTop=s.scrollTop,s.last_scrollLeft=s.scrollLeft,s.use_last=!0,editAreaLoader.start(e)}},EditAreaLoader.prototype.set_editarea_size_from_textarea=function(e,t){var a=document.getElementById(e),r=Math.max(editAreas[e].settings.min_width,a.offsetWidth)+"px",i=Math.max(editAreas[e].settings.min_height,a.offsetHeight)+"px";-1!=a.style.width.indexOf("%")&&(r=a.style.width),-1!=a.style.height.indexOf("%")&&(i=a.style.height),t.style.width=r,t.style.height=i},EditAreaLoader.prototype.set_base_url=function(){this.baseURL=jsPath+"../js/edit_area/"},EditAreaLoader.prototype.get_button_html=function(e,t,a,r,i){i||(i=this.baseURL);var s="editArea.execCommand('"+a+"')";return html='<a id="a_'+e+'" href="javascript:'+s+'" onclick="'+s+';return false;" onmousedown="return false;" target="_self" fileSpecific="'+(r?"yes":"no")+'">',html+='<img id="'+e+'" src="'+IMAGE_PATH+t+'" title="{$'+e+'}" width="20" height="20" class="editAreaButtonNormal" onmouseover="editArea.switchClass(this,\'editAreaButtonOver\');" onmouseout="editArea.restoreClass(this);" onmousedown="editArea.restoreAndSwitchClass(this,\'editAreaButtonDown\');" /></a>'},EditAreaLoader.prototype.get_control_html=function(e){for(var t=0;t<this.advanced_buttons.length;t++){var a=this.advanced_buttons[t];if(a[0]==e)return this.get_button_html(a[0],a[1],a[2],a[3])}switch(e){case"*":case"return":return"<br />";case"|":case"separator":return'<img src="'+this.baseURL+'images/spacer.gif" width="1" height="15" class="editAreaSeparatorLine">';case"select_font":return r="<select id='area_font_size' onchange='javascript:editArea.execCommand(\"change_font_size\")' fileSpecific='yes'>			<option value='-1'>{$font_size}</option>			<option value='8'>8 pt</option>			<option value='9'>9 pt</option>			<option value='10'>10 pt</option>			<option value='11'>11 pt</option>			<option value='12'>12 pt</option>			<option value='14'>14 pt</option>		</select>";case"syntax_selection":var r="<select id='syntax_selection' onchange='javascript:editArea.execCommand(\"change_syntax\", this.value)' fileSpecific='yes'>";return r+="<option value='-1'>{$syntax_selection}</option>",r+="</select>"}return"<span id='tmp_tool_"+e+"'>["+e+"]</span>"},EditAreaLoader.prototype.get_template=function(){if(""==this.template){var xhr_object=null;if(window.XMLHttpRequest)xhr_object=new XMLHttpRequest;else{if(!window.ActiveXObject)return void alert("XMLHTTPRequest not supported. EditArea not loaded");xhr_object=new ActiveXObject("Microsoft.XMLHTTP")}xhr_object.open("GET",ctxpath+"js/edit_area/template.html?"+BUILD_VERSION,!1),xhr_object.send(null),4==xhr_object.readyState?eval(xhr_object.responseText):this.has_error()}},EditAreaLoader.prototype.translate=function(e,t,a){return"word"==a?e=editAreaLoader.get_word_translation(e,t):(a="template")&&(editAreaLoader.current_language=t,e=e.replace(/\{\$([^\}]+)\}/gm,editAreaLoader.translate_template)),e},EditAreaLoader.prototype.translate_template=function(){return editAreaLoader.get_word_translation(EditAreaLoader.prototype.translate_template.arguments[1],1)},EditAreaLoader.prototype.get_word_translation=function(e,t,a){return"undefined"!=typeof a?replaceParams(jsMsg[e],a):jsMsg[e]},EditAreaLoader.prototype.load_script=function(e){if(!this.loadedFiles[e]){try{var t=document.createElement("script");t.type="text/javascript",t.src=e;var a=document.getElementsByTagName("head");a[0].appendChild(t)}catch(t){document.write('<script language="javascript" type="text/javascript" src="'+e+'"></script>')}this.loadedFiles[e]=!0}},EditAreaLoader.prototype.add_event=function(e,t,a){try{e.attachEvent?e.attachEvent("on"+t,a):e.addEventListener(t,a,!1)}catch(e){}},EditAreaLoader.prototype.remove_event=function(e,t,a){e.detachEvent?e.detachEvent("on"+t,a):e.removeEventListener(t,a,!1)},EditAreaLoader.prototype.reset=function(e){var t=editAreaLoader.nav.isIE?window.event.srcElement:e.target;for(var a in editAreas){for(var r=!1,i=0;i<t.elements.length;i++)t.elements[i].id==a&&(r=!0);if(window.frames["frame_"+a]&&r&&1==editAreas[a].displayed){var s='window.frames["frame_'+a+'"].editArea.textarea.value= document.getElementById("'+a+'").value;';s+='window.frames["frame_'+a+'"].editArea.execCommand("focus");',s+='window.frames["frame_'+a+'"].editArea.check_line_selection();',s+='window.frames["frame_'+a+'"].editArea.execCommand("reset");',window.setTimeout(s,10)}}},EditAreaLoader.prototype.submit=function(e){var t=editAreaLoader.nav.isIE?window.event.srcElement:e.target;for(var a in editAreas){for(var r=!1,i=0;i<t.elements.length;i++)t.elements[i].id==a&&(r=!0);r&&(window.frames["frame_"+a]&&1==editAreas[a].displayed&&(document.getElementById(a).value=window.frames["frame_"+a].editArea.textarea.value),editAreaLoader.execCommand(a,"EA_submit"))}if("function"==typeof t.edit_area_replaced_submit&&(res=t.edit_area_replaced_submit(),0==res)){if(editAreaLoader.nav.isIE)return!1;e.preventDefault()}},EditAreaLoader.prototype.getValue=function(e){return window.frames["frame_"+e]&&1==editAreas[e].displayed?window.frames["frame_"+e].editArea.textarea.value:(elem=document.getElementById(e))?elem.value:!1},EditAreaLoader.prototype.setValue=function(e,t){window.frames["frame_"+e]&&1==editAreas[e].displayed?(window.frames["frame_"+e].editArea.textarea.value=t,window.frames["frame_"+e].editArea.execCommand("focus"),window.frames["frame_"+e].editArea.check_line_selection(!1),window.frames["frame_"+e].editArea.execCommand("onchange")):(elem=document.getElementById(e))&&(elem.value=t)},EditAreaLoader.prototype.getSelectionRange=function(e){var t={start:0,end:0};if(window.frames["frame_"+e]&&1==editAreas[e].displayed){var a=window.frames["frame_"+e].editArea;t.start=a.textarea.selectionStart,t.end=a.textarea.selectionEnd}else(elem=document.getElementById(e))&&(t=getSelectionRange(elem));return t},EditAreaLoader.prototype.setSelectionRange=function(e,t,a){window.frames["frame_"+e]&&1==editAreas[e].displayed?(window.frames["frame_"+e].editArea.area_select(t,a-t),this.nav.isIE||(window.frames["frame_"+e].editArea.check_line_selection(!1),window.frames["frame_"+e].editArea.scroll_to_view())):(elem=document.getElementById(e))&&setSelectionRangeElement(elem,t,a)},EditAreaLoader.prototype.getSelectedText=function(e){var t=this.getSelectionRange(e);return this.getValue(e).substring(t.start,t.end)},EditAreaLoader.prototype.setSelectedText=function(e,t){t=t.replace(/\r/g,"");var a=this.getSelectionRange(e),r=this.getValue(e);if(window.frames["frame_"+e]&&1==editAreas[e].displayed)var i=window.frames["frame_"+e].document.getElementById("result").scrollTop,s=window.frames["frame_"+e].document.getElementById("result").scrollLeft;else var i=document.getElementById(e).scrollTop,s=document.getElementById(e).scrollLeft;r=r.substring(0,a.start)+t+r.substring(a.end),this.setValue(e,r);var o=a.start+t.length;this.setSelectionRange(e,a.start,o),t!=this.getSelectedText(e).replace(/\r/g,"")&&this.setSelectionRange(e,a.start,o+t.split("\n").length-1),window.frames["frame_"+e]&&1==editAreas[e].displayed?(window.frames["frame_"+e].document.getElementById("result").scrollTop=i,window.frames["frame_"+e].document.getElementById("result").scrollLeft=s,window.frames["frame_"+e].editArea.execCommand("onchange")):(document.getElementById(e).scrollTop=i,document.getElementById(e).scrollLeft=s)},EditAreaLoader.prototype.insertTags=function(e,t,a){var r=this.getSelectionRange(e);text=t+this.getSelectedText(e)+a,editAreaLoader.setSelectedText(e,text);var i=this.getSelectionRange(e);r.end>r.start?this.setSelectionRange(e,i.end,i.end):this.setSelectionRange(e,r.start+t.length,r.start+t.length)},EditAreaLoader.prototype.hide=function(e){if(document.getElementById(e)&&!this.hidden[e]){if(this.hidden[e]=new Object,this.hidden[e].selectionRange=this.getSelectionRange(e),"none"!=document.getElementById(e).style.display&&(this.hidden[e].scrollTop=document.getElementById(e).scrollTop,this.hidden[e].scrollLeft=document.getElementById(e).scrollLeft),window.frames["frame_"+e]){if(this.hidden[e].toggle=editAreas[e].displayed,window.frames["frame_"+e]&&1==editAreas[e].displayed)var t=window.frames["frame_"+e].document.getElementById("result").scrollTop,a=window.frames["frame_"+e].document.getElementById("result").scrollLeft;else var t=document.getElementById(e).scrollTop,a=document.getElementById(e).scrollLeft;this.hidden[e].scrollTop=t,this.hidden[e].scrollLeft=a,1==editAreas[e].displayed&&editAreaLoader.toggle_off(e)}var r=document.getElementById("EditAreaArroundInfos_"+e);r&&(r.style.display="none"),document.getElementById(e).style.display="none"}},EditAreaLoader.prototype.show=function(e){if((elem=document.getElementById(e))&&this.hidden[e]){elem.style.display="inline",elem.scrollTop=this.hidden[e].scrollTop,elem.scrollLeft=this.hidden[e].scrollLeft;var t=document.getElementById("EditAreaArroundInfos_"+e);t&&(t.style.display="inline"),window.frames["frame_"+e]&&(elem.style.display="inline",1==this.hidden[e].toggle&&editAreaLoader.toggle_on(e),scrollTop=this.hidden[e].scrollTop,scrollLeft=this.hidden[e].scrollLeft,window.frames["frame_"+e]&&1==editAreas[e].displayed?(window.frames["frame_"+e].document.getElementById("result").scrollTop=scrollTop,window.frames["frame_"+e].document.getElementById("result").scrollLeft=scrollLeft):(elem.scrollTop=scrollTop,elem.scrollLeft=scrollLeft)),sel=this.hidden[e].selectionRange,this.setSelectionRange(e,sel.start,sel.end),delete this.hidden[e]}},EditAreaLoader.prototype.getCurrentFile=function(e){return this.execCommand(e,"get_file",this.execCommand(e,"curr_file"))},EditAreaLoader.prototype.getFile=function(e,t){return this.execCommand(e,"get_file",t)},EditAreaLoader.prototype.getAllFiles=function(e){return this.execCommand(e,"get_all_files()")},EditAreaLoader.prototype.openFile=function(e,t){return this.execCommand(e,"open_file",t)},EditAreaLoader.prototype.closeFile=function(e,t){return this.execCommand(e,"close_file",t)},EditAreaLoader.prototype.setFileEditedMode=function(e,t,a){var r=new RegExp("\\\\","g"),i=new RegExp('"',"g");return this.execCommand(e,'set_file_edited_mode("'+t.replace(r,"\\\\").replace(i,'\\"')+'", '+a+")")},EditAreaLoader.prototype.execCommand=function(id,cmd,fct_param){switch(cmd){case"EA_init":editAreas[id].settings.EA_init_callback.length>0&&eval(editAreas[id].settings.EA_init_callback+"('"+id+"');");break;case"EA_delete":editAreas[id].settings.EA_delete_callback.length>0&&eval(editAreas[id].settings.EA_delete_callback+"('"+id+"');");break;case"EA_submit":editAreas[id].settings.submit_callback.length>0&&eval(editAreas[id].settings.submit_callback+"('"+id+"');")}return window.frames["frame_"+id]&&window.frames["frame_"+id].editArea?eval(void 0!=fct_param?'window.frames["frame_'+id+'"].editArea.'+cmd+"(fct_param);":'window.frames["frame_'+id+'"].editArea.'+cmd+";"):!1};var editAreaLoader=new EditAreaLoader;editAreaLoader.window_loaded();var editAreas=new Object;function getAttribute(e,t){try{var n=e.getAttribute(t)}catch(e){}if(!n)for(var r=0;r<e.attributes.length;r++){var o=e.attributes[r].name.toLowerCase();if(o==t)return n=e.attributes[r].value}return n}function setAttribute(e,t,n){"class"==t?(e.setAttribute("className",n),e.setAttribute("class",n)):e.setAttribute(t,n)}function getChildren(e,t,n,r,o,l){if(!o)var o="single";if(!l)var l=-1;if(e){for(var u=e.childNodes,a=null,c=new Array,i=0;i<u.length;i++)if(strTagName=new String(u[i].tagName),children_class="?","undefined"!=strTagName){if(child_attribute=getAttribute(u[i],n),!(strTagName.toLowerCase()!=t.toLowerCase()&&""!=t||""!=n&&child_attribute!=r)){if("all"!=o)return u[i];c.push(u[i])}if(0!=l)if(a=getChildren(u[i],t,n,r,o,l-1),"all"==o)a.length>0&&(c=c.concat(a));else if(null!=a)return a}if("all"==o)return c}return null}function isChildOf(e,t){if(e){if(e==t)return!0;for(;"undefined"!=e.parentNode;)return isChildOf(e.parentNode,t)}return!1}function getMouseX(e){return null!=e&&"undefined"!=typeof e.pageX?e.pageX:(null!=e?e.x:event.x)+document.documentElement.scrollLeft}function getMouseY(e){return null!=e&&"undefined"!=typeof e.pageY?e.pageY:(null!=e?e.y:event.y)+document.documentElement.scrollTop}function calculeOffsetLeft(e){return calculeOffset(e,"offsetLeft")}function calculeOffsetTop(e){return calculeOffset(e,"offsetTop")}function calculeOffset(e,t){for(var n=0;e;)n+=e[t],e=e.offsetParent;return n}function get_css_property(e,t){if(document.defaultView)return document.defaultView.getComputedStyle(e,null).getPropertyValue(t);if(e.currentStyle){var t=t.replace(/-\D/gi,function(e){return e.charAt(e.length-1).toUpperCase()});return e.currentStyle[t]}return null}function start_move_element(e,t,n){var r=(e.target||e.srcElement).id;return t&&(r=t),n||(n=window),n.event&&(e=n.event),move_current_element=n.document.getElementById(r),move_current_element.frame=n,n.document.onmousemove=move_element,n.document.onmouseup=end_move_element,mouse_x=getMouseX(e),mouse_y=getMouseY(e),move_current_element.start_pos_x=mouse_x-(move_current_element.style.left.replace("px","")||calculeOffsetLeft(move_current_element)),move_current_element.start_pos_y=mouse_y-(move_current_element.style.top.replace("px","")||calculeOffsetTop(move_current_element)),!1}function end_move_element(){move_current_element.frame.document.onmousemove="",move_current_element.frame.document.onmouseup="",move_current_element=null}function move_element(e){move_current_element.frame&&move_current_element.frame.event&&(e=move_current_element.frame.event);var t=getMouseX(e),n=getMouseY(e),r=n-move_current_element.start_pos_y,o=t-move_current_element.start_pos_x,l=move_current_element.frame.document.body.offsetWidth-move_current_element.offsetWidth;return max_top=move_current_element.frame.document.body.offsetHeight-move_current_element.offsetHeight,r=Math.min(Math.max(0,r),max_top),o=Math.min(Math.max(0,o),l),move_current_element.style.top=r+"px",move_current_element.style.left=o+"px",!1}function getSelectionRange(e){return{start:e.selectionStart,end:e.selectionEnd}}function setSelectionRangeElement(e,t,n){e.focus(),t=Math.max(0,Math.min(e.value.length,t)),n=Math.max(t,Math.min(e.value.length,n)),nav.isOpera&&(e.selectionEnd=1,e.selectionStart=0,e.selectionEnd=1,e.selectionStart=0),e.selectionStart=t,e.selectionEnd=n,nav.isIE&&set_IE_selection(e)}function get_IE_selection(e){if(e&&e.focused){if(!e.ea_line_height){var t=document.createElement("div");t.style.fontFamily=get_css_property(e,"font-family"),t.style.fontSize=get_css_property(e,"font-size"),t.style.visibility="hidden",t.innerHTML="0",document.body.appendChild(t),e.ea_line_height=t.offsetHeight,document.body.removeChild(t)}var n=document.selection.createRange(),r=n.duplicate();try{r.moveToElementText(e)}catch(e){}if(r.setEndPoint("EndToEnd",n),r.parentElement()==e){for(var o=e,l=0;o.parentNode;)l+=o.scrollTop,o=o.parentNode;var u=n.offsetTop-calculeOffsetTop(e)+l,a=Math.round(u/e.ea_line_height+1),c=Math.round(n.boundingHeight/e.ea_line_height),i=r.text.length-n.text.length,s=e.value.substr(0,i).split("\n");i+=2*(a-s.length),e.selectionStart=i;var m=e.selectionStart+n.text.length;s=e.value.substr(0,i+n.text.length).split("\n"),m+=2*(a+c-1-s.length),e.selectionEnd=m}}e&&setTimeout("get_IE_selection(document.getElementById('"+e.id+"'));",50)}function IE_textarea_focus(){event.srcElement.focused=!0}function IE_textarea_blur(){event.srcElement.focused=!1}function set_IE_selection(e){var t=e.value.substr(0,e.selectionStart).split("\n").length-1,n=e.value.substr(0,e.selectionEnd).split("\n").length-1,r=document.selection.createRange();r.moveToElementText(e),r.setEndPoint("EndToStart",r),r.moveStart("character",e.selectionStart-t),r.moveEnd("character",e.selectionEnd-n-(e.selectionStart-t)),r.select()}var move_current_element,nav=editAreaLoader.nav;editAreaLoader.waiting_loading["elements_functions.js"]="loaded";EditAreaLoader.prototype.start_resize_area=function(){document.onmouseup=editAreaLoader.end_resize_area,document.onmousemove=editAreaLoader.resize_area,editAreaLoader.toggle(editAreaLoader.resize.id);var e=editAreas[editAreaLoader.resize.id].textarea,t=document.getElementById("edit_area_resize");t||(t=document.createElement("div"),t.id="edit_area_resize",t.style.border="dashed #888888 1px");var r=e.offsetWidth-2,a=e.offsetHeight-2;t.style.display="block",t.style.width=r+"px",t.style.height=a+"px";var i=e.parentNode;i.insertBefore(t,e),e.style.display="none",editAreaLoader.resize.start_top=calculeOffsetTop(t),editAreaLoader.resize.start_left=calculeOffsetLeft(t)},EditAreaLoader.prototype.end_resize_area=function(){document.onmouseup="",document.onmousemove="";var e=document.getElementById("edit_area_resize"),t=editAreas[editAreaLoader.resize.id].textarea,r=Math.max(editAreas[editAreaLoader.resize.id].settings.min_width,e.offsetWidth-4),a=Math.max(editAreas[editAreaLoader.resize.id].settings.min_height,e.offsetHeight-4);return 6==editAreaLoader.nav.isIE&&(r+=2,a+=2),t.style.width=r+"px",t.style.height=a+"px",e.style.display="none",t.style.display="inline",t.selectionStart=editAreaLoader.resize.selectionStart,t.selectionEnd=editAreaLoader.resize.selectionEnd,editAreaLoader.toggle(editAreaLoader.resize.id),!1},EditAreaLoader.prototype.resize_area=function(e){var t=editAreas[editAreaLoader.resize.id].settings.allow_resize;if("both"==t||"y"==t){new_y=getMouseY(e);var r=Math.max(20,new_y-editAreaLoader.resize.start_top);document.getElementById("edit_area_resize").style.height=r+"px"}if("both"==t||"x"==t){new_x=getMouseX(e);var a=Math.max(20,new_x-editAreaLoader.resize.start_left);document.getElementById("edit_area_resize").style.width=a+"px"}return!1},editAreaLoader.waiting_loading["resize_area.js"]="loaded";EditAreaLoader.prototype.get_regexp=function(t){for(res="(\\b)(",i=0;i<t.length;i++)i>0&&(res+="|"),res+=this.get_escaped_regexp(t[i]);return res+=")(\\b)",reg=new RegExp(res),res},EditAreaLoader.prototype.get_el_regexp=function(t){for(res="(\\b)(",i=0;i<t.length;i++){i>0&&(res+="|");var e=t[i].split(" ");for(j=0;j<e.length;j++)j>0&&(res+="( )+"),res+=e[j]}return res+=")(\\b)",reg=new RegExp(res),res},EditAreaLoader.prototype.get_escaped_regexp=function(t){return t.replace(/(\.|\?|\*|\+|\\|\(|\)|\[|\]|\}|\{|\$|\^|\|)/g,"\\$1")},EditAreaLoader.prototype.init_syntax_regexp=function(){var t=new Object;for(var e in this.load_syntax)if(!this.syntax[e]){if(this.syntax[e]=new Object,this.syntax[e].keywords_reg_exp=new Object,this.keywords_reg_exp_nb=0,this.load_syntax[e].KEYWORDS){param="g",this.load_syntax[e].KEYWORD_CASE_SENSITIVE===!1&&(param+="i");for(var s in this.load_syntax[e].KEYWORDS)"function"!=typeof this.load_syntax[e].KEYWORDS[s]&&(this.syntax[e].keywords_reg_exp[s]="endline"==s?new RegExp(this.get_el_regexp(this.load_syntax[e].KEYWORDS[s]),param):new RegExp(this.get_regexp(this.load_syntax[e].KEYWORDS[s]),param),this.keywords_reg_exp_nb++)}if(this.load_syntax[e].OPERATORS){var a="",n=0;for(var s in this.load_syntax[e].OPERATORS)"function"!=typeof this.load_syntax[e].OPERATORS[s]&&(n>0&&(a+="|"),a+=this.get_escaped_regexp(this.load_syntax[e].OPERATORS[s]),n++);a.length>0&&(this.syntax[e].operators_reg_exp=new RegExp("("+a+")","g"))}if(this.load_syntax[e].DELIMITERS){var a="",n=0;for(var s in this.load_syntax[e].DELIMITERS)"function"!=typeof this.load_syntax[e].DELIMITERS[s]&&(n>0&&(a+="|"),a+=this.get_escaped_regexp(this.load_syntax[e].DELIMITERS[s]),n++);a.length>0&&(this.syntax[e].delimiters_reg_exp=new RegExp("("+a+")","g"))}var i=new Array;this.syntax[e].quotes=new Object;var r=new Array;if(this.load_syntax[e].QUOTEMARKS)for(var s in this.load_syntax[e].QUOTEMARKS)if("function"!=typeof this.load_syntax[e].QUOTEMARKS[s]){var o=this.get_escaped_regexp(this.load_syntax[e].QUOTEMARKS[s]);this.syntax[e].quotes[o]=o,r[r.length]="("+o+"(?:[^"+o+"\\\\]*(\\\\\\\\)*(\\\\"+o+"?)?)*("+o+"|$))",i.push(o)}if(this.syntax[e].macrocomments=new Object,this.load_syntax[e].COMMENT_SINGLE)for(var s in this.load_syntax[e].COMMENT_SINGLE)if("function"!=typeof this.load_syntax[e].COMMENT_SINGLE[s]){var o=this.get_escaped_regexp(this.load_syntax[e].COMMENT_SINGLE[s]);r[r.length]="("+o+"(.|\\r|\\t)*(\\n|$))",i.push(o),this.syntax[e].macrocomments[o]="\n"}if(this.load_syntax[e].COMMENT_MULTI)for(var s in this.load_syntax[e].COMMENT_MULTI)if("function"!=typeof this.load_syntax[e].COMMENT_MULTI[s]){var _=this.get_escaped_regexp(s),x=this.get_escaped_regexp(this.load_syntax[e].COMMENT_MULTI[s]);r[r.length]="("+_+"(.|\\n|\\r)*?("+x+"|$))",i.push(_),i.push(x),this.syntax[e].macrocomments[s]=this.load_syntax[e].COMMENT_MULTI[s]}if(r.length>0&&(this.syntax[e].comment_or_quote_reg_exp=new RegExp("("+r.join("|")+")","gi")),i.length>0&&(this.syntax[e].syntax_trace_regexp=new RegExp("((.|\n)*?)(\\\\*("+i.join("|")+"|$))","gmi")),this.load_syntax[e].SCRIPT_DELIMITERS){this.syntax[e].script_delimiters=new Object;for(var s in this.load_syntax[e].SCRIPT_DELIMITERS)"function"!=typeof this.load_syntax[e].SCRIPT_DELIMITERS[s]&&(this.syntax[e].script_delimiters[s]=this.load_syntax[e].SCRIPT_DELIMITERS)}if(this.syntax[e].custom_regexp=new Object,this.load_syntax[e].REGEXPS)for(var s in this.load_syntax[e].REGEXPS)if("function"!=typeof this.load_syntax[e].REGEXPS[s]){var h=this.load_syntax[e].REGEXPS[s];this.syntax[e].custom_regexp[h.execute]||(this.syntax[e].custom_regexp[h.execute]=new Object),this.syntax[e].custom_regexp[h.execute][s]={regexp:new RegExp(h.search,h.modifiers),class:h.class}}if(this.load_syntax[e].STYLES){t[e]=new Object;for(var s in this.load_syntax[e].STYLES)if("function"!=typeof this.load_syntax[e].STYLES[s])if("string"!=typeof this.load_syntax[e].STYLES[s])for(var y in this.load_syntax[e].STYLES[s])t[e][y]=this.load_syntax[e].STYLES[s][y];else t[e][s]=this.load_syntax[e].STYLES[s]}var p="";for(var s in t[e])t[e][s].length>0&&(p+="."+e+" ."+s.toLowerCase()+" span{"+t[e][s]+"}\n",p+="."+e+" ."+s.toLowerCase()+"{"+t[e][s]+"}\n");this.syntax[e].styles=p}},editAreaLoader.waiting_loading["reg_syntax.js"]="loaded";var Logger={isConsoleEnabled:!1,isEnabled:!1,toggleConsole:function(){this.isConsoleEnabled=!this.isConsoleEnabled},enable:function(){this.isEnabled||(this.isEnabled=!0,Logger.init())},disable:function(){this.isEnabled&&(this.isEnabled=!1,Logger.destroy())},destroy:function(){var e=getObj("1");e&&e.parentNode.parentNode.removeChild(e.parentNode)},init:function(){var e=document.createElement("DIV");e.style.position="absolute",e.style.top="7px",e.style.left="300px",e.style.height="30px",e.style.width="900px",e.style.background="white",e.style.color="red";var t=document.createDocumentFragment(),n=0,o=5,i=this._getMarkUp();do{var s=i.cloneNode(!0),a=80;s.style.left=o+"px",s.style.width=a+"px",o+=a,this._updateLabel(s,n);var r=i.cloneNode(!0),l=50;r.style.left=o+"px",r.style.width=a+"px",o+=l,n++,r.id=n,t.appendChild(s),t.appendChild(r)}while(4>n);var r=i.cloneNode(!0);r.style.width="110px",r.style.height="30px",r.style.background="yellow",r.style.left=o+"px",r.id=n+1,t.appendChild(r),o+=110;var d=i.cloneNode(!0);d.id="snapdiv",d.style.width="110px",d.style.height="25px",d.style.left=o+"px";var p=document.createElement("INPUT");p.type="BUTTON",p.value="Get Log",p.id="snapdiv",p.style.width="110px",p.style.height="25px",p.style.left=o+"px",p.onclick=Logger.takeSnapshot,d.appendChild(p);var c=document.createElement("INPUT");c.type="BUTTON",c.value="Get collab details",c.style.width="110px",c.style.height="25px",c.style.left=o+"px",c.onclick=function(){var e=new RequestParameters(ActionConstants.COLLAB_USERS_STATUS);url=e.getURL()+"?"+e.getParametersAsString(),window.open(url)},d.appendChild(c);var g=document.createElement("DIV");g.id="copysnap",g.style.position="absolute",g.style.top="130px",g.style.left="30px",document.body.appendChild(g),t.appendChild(r);var u=document.createElement("FORM");u.id="downlog",u.action="/getLog.do",u.method="POST";var h=document.createElement("INPUT");h.type="hidden",h.name="jsonlog",h.id="downlogtext",h.value=sessionStorage.text,u.appendChild(h),u.appendChild(d),t.appendChild(u);var y=this._getMarkUp(),x=y.cloneNode(!0);x.style.left="750px";var f=document.createElement("INPUT");f.type="BUTTON",f.value="Get Action Detail",f.id="actionDiv",f.style.width="110px",f.style.height="25px",f.style.left=o+"px",f.onclick=function(){var e=new RequestParameters(ActionConstants.AUDIT_TRAIL);url=e.getURL()+"?"+e.getParametersAsString(),window.open(url)},x.appendChild(f),e.appendChild(t),e.appendChild(x),document.body.appendChild(e)},_getMarkUp:function(){var e=document.createElement("DIV");return e.style.position="absolute",e.style.top="2.5px",e.style.height="25px",e},_updateLabel:function(e,t){switch(t){case 0:e.innerHTML="Req Q:";break;case 1:e.innerHTML="Ur Qid:";break;case 2:e.innerHTML="Last Qid";break;case 3:e.innerHTML="Last Xid"}},updateRequestIndicator:function(e){getObj("1").innerHTML=e},updateResponseQueIndicator:function(e){getObj("2").innerHTML=e},updateQueIdIndicator:function(e){getObj("3").innerHTML=e},updateExecIdIndicator:function(e){getObj("4").innerHTML=e},updateRefreshTileIndicator:function(e,t,n){""!=e?"WAITING_TIMER"===t?getObj("6").style.background="orange":"UN_ORDERED_TIMER"===t?getObj("6").style.background="green":"DELAY_TIMER"===t?getObj("6").style.background="red":"SYNC_CHECK_TIMER"===t&&(getObj("6").style.background="blue"):getObj("6").style.background="yellow",getObj("6").innerHTML=""!=e&&n?"refrsh for --"+n:""},takeSnapshot:function(){document.getElementById("downlogtext").value=sessionStorage.text,document.getElementById("downlog").target="hid_imp_doc",document.getElementById("downlog").submit(),delete sessionStorage.text},storeRequest:function(e){var t=" xmlHttp.respTxt= ";t+=JSON.stringify(e),sessionStorage.text+=t+"  [ "+new Date+" ]"},storeRequestAjax:function(e){var t=" \n\nRQ :  ",n=e.parameters;str=n.split("&");var o={};o.method=e.method,o.URL=e.URL,o.asynchronous=e.asynchronous;for(var i=0;i<str.length;i++){var s=str[i].split("=");o[s[0]]=s[1]}t+=JSON.stringify(o);var a="Unknown OS";-1!=navigator.appVersion.indexOf("Win")&&(a="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(a="MacOS"),null==sessionStorage.text&&(sessionStorage.text=a),sessionStorage.text+=t},storeResponse:function(e){var t=" \n\nRSP : ";t+=JSON.stringify(e);var n="Unknown OS";-1!=navigator.appVersion.indexOf("Win")&&(n="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(n="MacOS"),null==sessionStorage.text&&(sessionStorage.text=n),sessionStorage.text+=t+"  [ "+new Date+" ]"},storeRefreshTileInfo:function(e,t){var n=" \n\nTile Refr : ";n+=" For ::"+e,n+="  By ::"+t,n+="  @ ::",sessionStorage.text+=n+"  [ "+new Date+" ]"},storeSomething:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),sessionStorage.text+="\n\n"+e+"  : "+t+":  %%%% :  [ "+new Date+" ]"}};function addDottedProgress(e){var t=document.createElement("SPAN");return t.id=""!=e.id?e.id+"_dottedProgress":"_dottedProgress",t.innerHTML='<span style="visibility:hidden;">.</span><span style="visibility:hidden;">.</span><span style="visibility:hidden;">.</span>',e.appendChild(t),t.id}function showDottedProgress(e){dottedProgressEl=getObj(e),null!=dottedProgressIntvl&&clearTimeout(dottedProgressIntvl),animateProgressDots()}function stopDottedProgress(e){null!=dottedProgressIntvl&&clearTimeout(dottedProgressIntvl);var t=getObj(e),d=t.getElementsByTagName("SPAN");d[0].style.visibility="visible",d[1].style.visibility="visible",d[2].style.visibility="visible"}function animateProgressDots(){4==dottedProgressIdx&&(dottedProgressIdx=0);var e,t=dottedProgressEl.getElementsByTagName("SPAN");0==dottedProgressIdx?e="hidden;hidden;hidden":1==dottedProgressIdx?e="visible;hidden;hidden":2==dottedProgressIdx?e="visible;visible;hidden":3==dottedProgressIdx&&(e="visible;visible;visible");var d=e.split(";");t[0].style.visibility=d[0],t[1].style.visibility=d[1],t[2].style.visibility=d[2],dottedProgressIdx++,dottedProgressIntvl=setTimeout(function(){animateProgressDots()},dottedProgressTimer)}var dottedProgressEl,dottedProgressIdx=0,dottedProgressTimer=250,dottedProgressIntvl,FadeCell={};FadeCell.ie_waiting=!1,FadeCell.recalculateTimeoutId,FadeCell.elemsarr={},FadeCell.elemsarrIndex=0,FadeCell.fadeElement=function(e,t){var d=UTIL.DOM;if(null!=e&&""!=e){t=e.style.backgroundColor,"rgb(255,255,255)"!=t&&0!=t.length?d.addClass(e,"divFadeIn"):(d.addClass(e,"divFadeInBlank"),t="");var s=t?zoho.color.rgbToHex(t).substring(0,5)+"99":"#ffff99";e.style.backgroundColor=s;var i=1;browser_ie&&(i=500),browser_ie&&(FadeCell.ie_waiting=!0),setTimeout(function(){d.addClass(e,"divFadeOut"),e.style.backgroundColor=t,browser_ie&&(FadeCell.ie_waiting=!1)},i),setTimeout(function(){d.removeClass(e,"divFadeIn"),d.removeClass(e,"divFadeInBlank"),d.removeClass(e,"divFadeOut"),e.style.backgroundColor=t},1600)}},FadeCell.fadeCells=function(e,t){FadeCell.ie_waiting||("undefined"!=FadeCell.recalculateTimeoutId&&clearTimeout(FadeCell.recalculateTimeoutId),FadeCell.recalculateTimeoutId=setTimeout(function(){var e=FadeCell.elemsarr[t];if("undefined"!=typeof e)for(i=0;i<e.length;i++)FadeCell.fadeElement(e[i]);FadeCell.elemsarr[t]=null,FadeCell.elemsarrIndex>t&&(FadeCell.elemsarrIndex=t)},1))};function setOlePosForDrag(e,t,o,l,r){var i=ole.currObj;if(!o||"bottom"!=o&&"top"!=o)var s=r?r:getColLeft(t);else var s=r?r:preOleLeftVal?preOleLeftVal:getColLeft(t);var g=l?l:getRowTop(e),c=0,a=0;c+=getColWidth(t)+1,a+=getRowHeight(e)+1;var h=s,n=g;if(n+i.height>getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)&&(n=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)-i.height),!l){var p=findRowInYPos(n);n=getRowTop(p)}OLEDragProps.scrollTop=o&&"top"==o||!o&&preOleTopVal>n?g&&e>=0?getSheetScrollTop()+(parseFloat(n)-i.top)+32:getRowTop(e):e>=0?e<getRowMax()?getSheetScrollTop()+(parseFloat(n)-i.top)+getSheetHeight():getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1):getRowTop(e),OLEDragProps.scrollLeft=o&&"left"==o||!o&&preOleLeftVal>h?s&&t>=0?getNormalizedScrollLeft()+(parseInt(s)-i[isRTL?"right":"left"])+80:getColLeft(t):t>=0?getNormalizedScrollLeft()+(parseInt(s)-i[isRTL?"right":"left"])+getSheetWidth():getColLeft(t),OLE[i.id].setLeft(h),oleDIV.style[isRTL?"right":"left"]=h+"px",OLEDragProps.rowTop=n,OLE[i.id].setTop(n),oleDIV.style.top=n-20+"px",OLEDragProps.rowVal=e,OLEDragProps.colVal=t,i._setSelectLayer(!0,void 0,void 0,!0),oleDIV.style.display="",n&&(preOleTopVal=n),h&&(preOleLeftVal=h),OLEDragProps.scrollLeft>getColLeft(totCols)&&(OLEDragProps.scrollLeft=getColLeft(totCols)),OLEDragProps.scrollTop>getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)&&(OLEDragProps.scrollTop=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1))}function setOleDimforResize(e,t,o,l,r){var i=ole.currObj,s=i.width,g=i.height,c=0,a=0,h=l?l:getRowTop(e)-1;if(!o||"bottom"!=o&&"top"!=o)var n=r?r:getColLeft(t);else var n=r?r:preOleLeftVal?preOleLeftVal:getColLeft(t);var p=h-findThirdPaneYPos(),O=n,f=i.top-p,d=i[isRTL?"right":"left"]-O,S=ole.objects[i.type].minWidth||100,L=ole.objects[i.type].minHeight||100;i[isRTL?"right":"left"]+i.width>=getColLeft(totCols-1)+getColWidth(totCols-1)||(c+=getColWidth(t)+1),a+=e<getRowMax()?getRowHeight(e)+1:getRowHeight(getRowMax()-1)+1,"N"==ole.resizeType||"S"==ole.resizeType?(o&&"top"==o?"S"==ole.resizeType?(g-=a,L>g&&(g=L)):(OLE[i.id].setTop(p),g+=f):"S"==ole.resizeType?ole.currObj.top+g+a<=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)?g+=a:ole.currObj.top+g<=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)&&ole.currObj.top+g+a>getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)&&(g=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)-ole.currObj.top):(o&&"bottom"==o?g+=f:g-=a,prevOleHeight!=L&&L>g&&(p-=L-g,OLE[i.id].setTop(p)),L>g&&(g=L),o&&g!=L&&OLE[i.id].setTop(p)),o&&("S"==ole.resizeType&&i.top+g>getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)&&(g=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)-i.top),OLE[i.id].setHeight(g))):"E"==ole.resizeType||"W"==ole.resizeType?(o&&"left"==o||O<i[isRTL?"right":"left"]?"E"==ole.resizeType?(s-=c,S>s&&(s=S)):(OLE[i.id].setLeft(O),s+=d):"E"==ole.resizeType?s+=c:(o&&"right"==o?s+=d:s-=d,prevOleWidth!=S&&S>s&&(O-=S-s,OLE[i.id].setLeft(O)),S>s&&(s=S),o&&s!=S&&OLE[i.id].setLeft(O)),OLE[i.id].setWidth(s)):(g+=a,OLE[i.id].setHeight(g),s+=c,OLE[i.id].setWidth(s)),i.setSelectLayer(),OLEDragProps.rowVal=e,OLEDragProps.colVal=t,OLEDragProps.rowTop=p,("N"==ole.resizeType&&g>prevOleHeight||"S"==ole.resizeType&&prevOleHeight>=g)&&(!o||o&&"top"==o)?OLEDragProps.scrollTop=e>=0?g>prevOleHeight?"N"==ole.resizeType?p+32:getSheetScrollTop()+(prevOleHeight-g)+32:getSheetScrollTop()+(g-prevOleHeight)+32:getRowTop(e):(OLEDragProps.scrollTop=g>prevOleHeight?getSheetScrollTop()+(g-prevOleHeight)+getSheetHeight():getSheetScrollTop()+(prevOleHeight-g)+getSheetHeight(),OLEDragProps.scrollTop>getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1)&&(OLEDragProps.scrollTop=getRowTop(getRowMax()-1)+getRowHeight(getRowMax()-1))),(s!=S||prevOleWidth!=S)&&(OLEDragProps.scrollLeft=("W"==ole.resizeType&&s>prevOleWidth||"E"==ole.resizeType&&prevOleWidth>s)&&(!o||o&&"left"==o)?t>=0?s>prevOleWidth?"W"==ole.resizeType?O+80:getNormalizedScrollLeft()+(prevOleWidth-s)+80:getNormalizedScrollLeft()+(s-prevOleWidth)+80:getColLeft(t):prevOleWidth>s?getNormalizedScrollLeft()+(prevOleWidth-s)+getSheetWidth():getNormalizedScrollLeft()+(s-prevOleWidth)+getSheetWidth()),p&&(preOleTopVal=p),O&&(preOleLeftVal=O),prevOleHeight=g,prevOleWidth=s,OLEDragProps.scrollLeft>getColLeft(totCols)&&(OLEDragProps.scrollLeft=getColLeft(totCols))}function setOleYDiff(e){OLEDragProps.diffY=e-getRowTop(findRowInYPos(e))}function setOleDimentiononOutsideViewportForResize(e,t,o,l,r){setOleDimforResize(e,t,o,l,r),setOleYDiff(l)}function setOleDimentiononOutsideViewportForDrag(e,t,o,l,r){setOlePosForDrag(e,t,o,l,r),setOleYDiff(l)}ole.extentProperty("sCol",0),ole.extentProperty("sRow",0),ole.extentProperty("sColDiff",0),ole.extentProperty("sRowDiff",0),ole.conf={enableKeyBoardShortcuts:!0,focusElement:"OLETextarea",onPositionChange:function(e,t,o,l,r,i){for(var s=[],g=[],c=0;c<e.length;c++)s[c]=e[c].type;g=unique(s);for(var a=(g.length,[]),h=[],n=[],p="",O="",f="",c=0;c<g.length;c++)"img"==g[c]?a=ole.getObjects("img",e):"button"==g[c]?n=ole.getObjects("button",e):"chart"==g[c]&&(h=ole.getObjects("chart",e));if(g.contains("img")&&!i){for(var t=[],o=[],d=[],S=[],L=[],u=[],b=[],T=[],w=getObj("loadtype"),c=0;c<a.length;c++)T[c]=parseInt(a[c].id.substring(4,a[c].id.length)),b[c]=parseInt(a[c].el.getAttribute("imgid").substring(0,a[c].el.getAttribute("imgid").length)),t[c]=a[c].left,o[c]=a[c].top,d[c]=a[c].sCol,S[c]=a[c].sColDiff,L[c]=a[c].sRow,u[c]=a[c].sRowDiff;var R={imgid:b,left:t,top:o,seqnum:T,loadtype:w,sCol:d,sRow:L,sColDiff:S,sRowDiff:u};p=JSON.stringify(R)}if(g.contains("button")){for(var t=[],o=[],b=[],c=0;c<n.length;c++)b[c]=n[c].id,t[c]=n[c].left,o[c]=n[c].top;var R={name:b,left:t,top:o};f=JSON.stringify(R)}if(g.contains("chart")&&!i){for(var t=[],o=[],d=[],S=[],L=[],u=[],b=[],j=[],m=[],c=0;c<h.length;c++)b[c]=h[c].id,d[c]=h[c].sCol,S[c]=h[c].sColDiff,L[c]=h[c].sRow,u[c]=h[c].sRowDiff,t[c]=parseInt(h[c].left),o[c]=parseInt(h[c].top),j[c]=ExcelGraph.getInstance(b[c]);var R={name:b,left:t,top:o,dbid:m,sCol:d,sRow:L,sColDiff:S,sRowDiff:u};O=JSON.stringify(R)}if(l||(l=!1),""!=p&&a.length>=1)var D=p,v=!0;if(""!=f&&n.length>=1)var E=f,C=!0;if(""!=O&&h.length>=1)var P=O,y=!0;if(v||y||C){var H=new RequestParameters(ActionConstants.UPDATE_OLE);H.setParameters(D,v,E,C,P,y,WorkSheets.getAssociatedActiveSheetName(),jsREMOTE_VIEW);var W=new AjaxRequest;W.init("POST",H.getURL(),!0,H.getParametersAsString()),W.addEventListener("onComplete",function(){hasOleMoved=!1,r&&r.method(r.param1,r.param2,r.param3)})}else hasOleMoved=!1,r&&r.method(r.param1,r.param2,r.param3)},onblur:function(){if(getObj("fD").style.visibility="",ISFREEZED&&(getObj("fD1")&&(getObj("fD1").style.visibility=""),getObj("fD2")&&(getObj("fD2").style.visibility=""),getObj("fD3")&&(getObj("fD3").style.visibility="")),setFocusInCellField(),isCellRange()){var e=getCellRange();selectRowHead(e.startRow,e.endRow),selectColHead(e.startCol,e.endCol)}else selectRowHead(currRow,currRow),selectColHead(currCol,currCol)},onfocus:function(e){if(getObj("fD").style.visibility="hidden",ISFREEZED&&(getObj("fD1")&&(getObj("fD1").style.visibility="hidden"),getObj("fD2")&&(getObj("fD2").style.visibility="hidden"),getObj("fD3")&&(getObj("fD3").style.visibility="hidden")),isCellRange()){var t=getCellRange();blurRowHead(t.startRow,t.endRow),blurColHead(t.startCol,t.endCol)}else blurRowHead(currRow,currRow),e||blurColHead(currCol,currCol);ole.focus()},onKeyDown:function(e){var t=!os_mac&&e.ctrlKey&&!e.metaKey||os_mac&&(e.metaKey||e.ctrlKey),o=e.shiftKey,l=!1,r=!1,i=ole.getCurrObj(),s=i.getLeft(),g=i.getTop(),c=i.id,a=i.type,h=browser_ie?e.srcElement:e.target;isFirstTimeTabPressed||9==e.keyCode||(isFirstTimeTabPressed=!0);var n=e.keyCode;switch(isRTL&&(37==n?n=39:39==n&&(n=37)),t&&ole.onCtrlKeyDown(e,h),n){case 9:if(!t){var p=ole.getObjectsSortedByPos(),O=p.length;if("undefined"==typeof ole.pointer)for(var f=0;O>f;f++)if(p[f][0]===c){ole.pointer=f;break}var d=!1;if(isFirstTimeTabPressed&&(sheetScrollLeftVal=getSheetScrollLeft(),isFirstTimeTabPressed=!1),o){0===ole.pointer?ole.pointer=O-1:ole.pointer--,ole(p[ole.pointer][0])===ole.currFocusObj&&ole.currFocusObj.displayAssociativeElements("","none");var S=ole(p[ole.pointer][0]).getTop(),L=ole(p[ole.pointer][0]).getLeft();S+ole(p[ole.pointer][0]).getHeight()>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(ole(p[ole.pointer][0]).getLeft()>sheetScrollLeftVal&&ole(p[ole.pointer][0]).getLeft()+ole(p[ole.pointer][0]).getWidth()<sheetScrollLeftVal+getSheetWidth()&&(d=!0),S<=getSheetScrollTop()?scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"TOP",d):(S>getSheetScrollTop()+getSheetHeight()||S+ole(p[ole.pointer][0]).getHeight()>getSheetScrollTop()+getSheetHeight())&&scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"BOTTOM",d)):(L+ole(p[ole.pointer][0]).getWidth()>getSheetScrollLeft()+getSheetWidth()&&L+ole(p[ole.pointer][0]).getWidth()<getColLeft(totCols)||L>getSheetScrollLeft()+getSheetWidth()||L<getSheetScrollLeft())&&(L<getSheetScrollLeft()?scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"LEFT"):L>getSheetScrollLeft()+getSheetWidth()&&scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"RIGHT"),sheetScrollLeftVal=getSheetScrollLeft()),ole(p[ole.pointer][0])._setSelectLayer(!0).positionActionBar(!1)}else{ole.pointer===O-1?ole.pointer=0:ole.pointer++,ole(p[ole.pointer][0])===ole.currFocusObj&&ole.currFocusObj.displayAssociativeElements("","none");var S=ole(p[ole.pointer][0]).getTop(),L=ole(p[ole.pointer][0]).getLeft();S+ole(p[ole.pointer][0]).getHeight()>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(ole(p[ole.pointer][0]).getLeft()>sheetScrollLeftVal&&ole(p[ole.pointer][0]).getLeft()+ole(p[ole.pointer][0]).getWidth()<sheetScrollLeftVal+getSheetWidth()&&(d=!0),S<getSheetScrollTop()&&scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"TOP",d),S+ole(p[ole.pointer][0]).getHeight()>getSheetScrollTop()+getSheetHeight()&&scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"BOTTOM",d),d||(sheetScrollLeftVal=getSheetScrollLeft())):(L+ole(p[ole.pointer][0]).getWidth()>getSheetScrollLeft()+getSheetWidth()&&L+ole(p[ole.pointer][0]).getWidth()<getColLeft(totCols)||L>getSheetScrollLeft()+getSheetWidth()||L<getSheetScrollLeft())&&(L<getSheetScrollLeft()&&scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"LEFT"),L>getSheetScrollLeft()&&scrollAnimator.scroll(!1,ole(p[ole.pointer][0]).getTop(),ole(p[ole.pointer][0]).getLeft(),ole(p[ole.pointer][0]).getHeight(),ole(p[ole.pointer][0]).getWidth(),"RIGHT"),sheetScrollLeftVal=getSheetScrollLeft()),ole(p[ole.pointer][0])._setSelectLayer(!0).positionActionBar(!1)}r=!0}break;case 27:if(ole.onDrag){if(ole.onDrag=!1,ole.isDragged){var u=ole.currObj.getActionBar();if(u.style.visibility="visible",ole.isActionBarLocked=!1,i.positionActionBar(!0),ole.isDragged=!1,ole.isCalledOnce=!1,ole.lastClonedSelectLayer){var b=getObj(ole.lastClonedSelectLayer),T=b.parentNode;T&&T.removeChild(b)}}}else i.deSelect(),ole.conf.onblur(),l=!0;chartPreview.hideContextualToolbar();break;case 89:t&&(redo(),r=!0);break;case 90:t&&(o?(redo(),r=!0):undo());break;case 8:var w=!1,S=ole.currObj.top,L=ole.currObj.left,R=ole.currObj.getSelectLayer().id,d=!1;S>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(ole.currObj.left>sheetScrollLeftVal&&ole.currObj.left+ole.currObj.width<sheetScrollLeftVal+getSheetWidth()&&(d=!0),S<getSheetScrollTop()?(w=!0,scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"TOP",d)):(S>getSheetScrollTop()+getSheetHeight()||S+ole.currObj.height>getSheetScrollTop()+getSheetHeight())&&(w=!0,scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"BOTTOM",d))):(L+ole.currObj.width>getSheetScrollLeft()+getSheetWidth()&&L+ole.currObj.width<getColLeft(totCols)||L>getSheetScrollLeft()+getSheetWidth()||L<getSheetScrollLeft())&&(L<getSheetScrollLeft()&&(w=!0,scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"LEFT")),L>getSheetScrollLeft()+getSheetWidth()&&(w=!0,scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"RIGHT"))),w?(setTimeout(function(){document.getElementById(ole.currObj.id).classList.add(["zoomOut"],["animated"]),ole.currObj.getSelectLayer().classList.add(["zoomOut"],["animated"])},300),setTimeout(function(){ole.remove(ole.currObj.id,!0),ole.conf.onblur(),document.getElementById(R).classList.remove(["zoomOut"],["animated"])},600)):(setTimeout(function(){document.getElementById(ole.currObj.id).classList.add(["zoomOut"],["animated"]),ole.currObj.getSelectLayer().classList.add(["zoomOut"],["animated"])},200),setTimeout(function(){ole.remove(ole.currObj.id,!0),ole.conf.onblur(),document.getElementById(R).classList.remove(["zoomOut"],["animated"])},400));break;case 37:var S=ole.currObj.top,L=ole.currObj.left;S>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(S<getSheetScrollTop()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"TOP"),S+ole.currObj.height>getSheetScrollTop()+getSheetHeight()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"BOTTOM")):(L+ole.currObj.width>getSheetScrollLeft()+getSheetWidth()&&L+ole.currObj.width<getColLeft(totCols)||L>getSheetScrollLeft()+getSheetWidth()||L<getSheetScrollLeft())&&(L<getSheetScrollLeft()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"LEFT"),L>getSheetScrollLeft()+getSheetWidth()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"RIGHT"));var j=0;if(ole.currObj.left+ole.currObj.width>getSheetScrollLeft()&&(j=ole.currObj.left+ole.currObj.width-getSheetScrollLeft()),o&&t)ole.isFocusOnResizeCorners||i.setRearX(getColLeft(findColInXPos(i.getRearX())))._setSelectLayer().positionActionBar(!1);else if(t)ole.isFocusOnResizeCorners||i.setLeft(getColLeft(findColInXPos(parseInt(s)+1))-1)._setSelectLayer().positionActionBar(!1);else if(ole.isFocusOnResizeCorners){if(s>0){var m=i.width;i.setLeft(s-1).setWidth(m+1)._setSelectLayer().positionActionBar(!1)}}else s>0&&i.setLeft(parseInt(s)-1)._setSelectLayer().positionActionBar(!1);if(ole.currObj.left<getSheetScrollLeft()&&getSheetScrollLeft()>=0){var D=0;ole.currObj.left+ole.currObj.width>getSheetScrollLeft()&&(D=ole.currObj.left+ole.currObj.width-getSheetScrollLeft());var v=j-D;setScrollLeft(getSheetScrollLeft()-v)}l=!0;break;case 38:var S=ole.currObj.top,L=ole.currObj.left,d=!1;S>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(ole.currObj.left>sheetScrollLeftVal&&ole.currObj.left+ole.currObj.width<sheetScrollLeftVal+getSheetWidth()&&(d=!0),S<getSheetScrollTop()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"TOP",d),S+ole.currObj.height>getSheetScrollTop()+getSheetHeight()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"BOTTOM",d)):(L+ole.currObj.width>getSheetScrollLeft()+getSheetWidth()&&L+ole.currObj.width<getColLeft(totCols)||L>getSheetScrollLeft()+getSheetWidth()||L<getSheetScrollLeft())&&(L<getSheetScrollLeft()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"LEFT"),L>getSheetScrollLeft()+getSheetWidth()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"RIGHT"));var E=0;if(ole.currObj.top+ole.currObj.height>getSheetScrollTop()&&(E=ole.currObj.top+ole.currObj.height-getSheetScrollTop()),o&&t?i.setRearY(getRowTop(findRowInYPos(i.getRearY())))._setSelectLayer().positionActionBar(!1):t?i.setTop(getRowTop(findRowInYPos(parseInt(g)-1))-1)._setSelectLayer().positionActionBar(!1):g>0&&i.setTop(parseInt(g)-1)._setSelectLayer().positionActionBar(!1),ole.currObj.top<getSheetScrollTop()&&getSheetScrollTop()>0){var C=0;ole.currObj.top+ole.currObj.height>getSheetScrollTop()&&(C=ole.currObj.top+ole.currObj.height-getSheetScrollTop());var P=E-C;setScrollTop(getSheetScrollTop()-P),getSheetScrollTop()>ole.currObj.top&&setScrollTop(ole.currObj.top-100)}l=!0;break;case 39:var S=ole.currObj.top,L=ole.currObj[isRTL?"right":"left"];S>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(S<getSheetScrollTop()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"TOP"),S+ole.currObj.height>getSheetScrollTop()+getSheetHeight()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"BOTTOM")):(L+ole.currObj.width>getNormalizedScrollLeft()+getSheetWidth()&&L+ole.currObj.width<getColLeft(totCols)||L>getNormalizedScrollLeft()+getSheetWidth()||L<getNormalizedScrollLeft())&&(L<getNormalizedScrollLeft()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"LEFT"),L>getNormalizedScrollLeft()+getSheetWidth()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"RIGHT"));var j=0;if(ole.currObj[isRTL?"right":"left"]>getNormalizedScrollLeft()&&(j=ole.currObj[isRTL?"right":"left"]-getNormalizedScrollLeft()),o&&t?getColLeft(findColInXPos(i.getRearX()+1)+1)<getSheetTableWidth()&&i.setRearX(getColLeft(findColInXPos(i.getRearX()+1)+1))._setSelectLayer().positionActionBar(!1):t?getColLeft(findColInXPos(parseInt(s)+2)+1)-1+ole.currObj.width<getSheetTableWidth()&&i.setLeft(getColLeft(findColInXPos(parseInt(s)+2)+1)-1)._setSelectLayer().positionActionBar(!1):s+ole.currObj.width<getSheetTableWidth()&&i.setLeft(parseInt(s)+1)._setSelectLayer().positionActionBar(!1),ole.currObj[isRTL?"right":"left"]+ole.currObj.width>getNormalizedScrollLeft()+getSheetWidth()&&ole.currObj[isRTL?"right":"left"]+ole.currObj.width<getSheetTableWidth()){var D=0;ole.currObj[isRTL?"right":"left"]>getNormalizedScrollLeft()&&(D=ole.currObj[isRTL?"right":"left"]-getNormalizedScrollLeft());var v=D-j;setScrollLeft(getSheetScrollLeft()+v)}l=!0;break;case 40:var S=ole.currObj.top,L=ole.currObj.left,d=!1;if(S>getSheetScrollTop()+getSheetHeight()||S<getSheetScrollTop()?(ole.currObj.left>sheetScrollLeftVal&&ole.currObj.left+ole.currObj.width<sheetScrollLeftVal+getSheetWidth()&&(d=!0),S<getSheetScrollTop()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"TOP"),S+ole.currObj.height>getSheetScrollTop()+getSheetHeight()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"BOTTOM")):(L+ole.currObj.width>getSheetScrollLeft()+getSheetWidth()&&L+ole.currObj.width<getColLeft(totCols)||L>getSheetScrollLeft()+getSheetWidth()||L<getSheetScrollLeft())&&(L<getSheetScrollLeft()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"LEFT"),L>getSheetScrollLeft()+getSheetWidth()&&scrollAnimator.scroll(!1,S,L,ole.currObj.height,ole.currObj.width,"RIGHT")),ole.currObj.top>getSheetScrollTop()&&(E=ole.currObj.top-getSheetScrollTop()),o&&t?getRowTop(findRowInYPos(i.getRearY()+1)+1)<getSheetTableHeight()&&i.setRearY(getRowTop(findRowInYPos(i.getRearY()+1)+1))._setSelectLayer().positionActionBar(!1):t?getRowTop(findRowInYPos(parseInt(g)+2)+1)-1+ole.currObj.height<getSheetTableHeight()&&i.setTop(getRowTop(findRowInYPos(parseInt(g)+2)+1)-1)._setSelectLayer().positionActionBar(!1):g+ole.currObj.height<getSheetTableHeight()&&i.setTop(parseInt(g)+1)._setSelectLayer().positionActionBar(!1),ole.currObj.top+ole.currObj.height>getSheetScrollTop()+getSheetHeight()){var C=0;ole.currObj.top>getSheetScrollTop()&&(C=ole.currObj.top-getSheetScrollTop());var P=C-E;setScrollTop(getSheetScrollTop()+P)}l=!0;break;case 46:var w=!1,R=ole.currObj.getSelectLayer().id;(ole.currObj.left+ole.currObj.width<getSheetScrollLeft()-getSheetWidth()||ole.currObj.left>getSheetScrollLeft()+getSheetWidth())&&(setScrollLeft(ole.currObj.left-findSecondPaneXPos()-10),w=!0),(ole.currObj.top+ole.currObj.height<getSheetScrollTop()||ole.currObj.top>getSheetScrollTop()+getSheetHeight())&&(setScrollTop(ole.currObj.top-findThirdPaneYPos()-10),w=!0),w?(setTimeout(function(){document.getElementById(ole.currObj.id).classList.add(["zoomOut"],["animated"]),ole.currObj.getSelectLayer().classList.add(["zoomOut"],["animated"])},500),setTimeout(function(){ole.remove(ole.currObj.id,!0),ole.conf.onblur(),document.getElementById(R).classList.remove(["zoomOut"],["animated"])},1e3)):(setTimeout(function(){document.getElementById(ole.currObj.id).classList.add(["zoomOut"],["animated"]),ole.currObj.getSelectLayer().classList.add(["zoomOut"],["animated"])},200),setTimeout(function(){ole.remove(ole.currObj.id,!0),ole.conf.onblur(),document.getElementById(R).classList.remove(["zoomOut"],["animated"])},400));break;case 78:jsDOCS_VIEW||(ole.onOpenNewDoc(),TEMPLATE_FLAG="false",loadDocument("ajaxnew.do")),ole.objects[a].onDocOpen&&ole.objects[a].onDocOpen(c),r=!0;break;case 82:ole.isFocusOnResizeCorners=ole.isFocusOnResizeCorners?!1:!0;break;case 113:ole.objects[a].onedit&&ole.objects[a].onedit(c);break;case 67:browser_firefox||e.stopPropagation(),ole.objects[a].onCopy&&ole.objects[a].onCopy(c);break;case 88:ole.objects[a].onCut&&ole.objects[a].onCut(c)}return l&&(ole.objects[a].onMove&&ole.objects[a].onMove(c,i.getLeft(),i.getTop()),ole.objects[a].onMoveEnd&&(ole.addToEventBuffer([c,a,"onMoveEnd",i.getLeft(),i.getTop()]),ole.eventDispatchTimeout&&clearTimeout(ole.eventDispatchTimeout),ole.eventDispatchTimeout=setTimeout(function(){ole.dispatchEvents()},1e3)),r=!0),r?!1:void 0}},ole.shiftObjects=function(e,t,o,l){var r=o-t+1;switch(e){case"INSERT":for(var i=[],s=ole.getObjects(),g=0;g<s.length;g++){t<=OLE[s[g].id].sRow&&(OLE[s[g].id].sRow=parseInt(OLE[s[g].id].sRow)+parseInt(r));var c=parseInt(OLE[s[g].id].sRowDiff),a=parseInt(OLE[s[g].id].sRow),h=parseInt(getRowHeight(a)),n=parseInt(getRowTop(a));i[g]=c>h?n+h:n+c,OLE[s[g].id].setTop(i[g]),ole.getCurrObj()&&ole.getCurrObj()._setSelectLayer().positionActionBar()}break;case"DeleteRow":var i=[],p=[],p=ole.getObjectsByPositionY(getRowTop(t),getRowTop(o+1)),O=ole.getObjectsByPositionY(getRowTop(o+1));if(0!=p.length)for(var g=0;g<=p.length-1;g++)OLE[p[g].id].sRowDiff=0,OLE[p[g].id].sRow=t,OLE[p[g].id].setTop(getRowTop(t));for(var g=0;g<O.length;g++){OLE[O[g].id].sRow=OLE[O[g].id].sRow-r;var c=parseInt(OLE[O[g].id].sRowDiff),a=parseInt(OLE[O[g].id].sRow),h=parseInt(getRowHeight(a)),n=parseInt(getRowTop(a));i[g]=c>h?n+h:n+c,OLE[O[g].id].setTop(i[g]),ole.getCurrObj()&&ole.getCurrObj()._setSelectLayer().positionActionBar()}var s=ole.getObjects();setFocusInCellField();break;case"HEIGHT":var p=ole.getObjectsByPositionY(getRowTop(t)),i=[];if(p.length>0){for(var g=0;g<p.length;g++){var c=parseInt(OLE[p[g].id].sRowDiff),a=parseInt(OLE[p[g].id].sRow),h=parseInt(getRowHeight(a)),n=parseInt(getRowTop(a));i[g]=c>h?n+h:n+c,OLE[p[g].id].setTop(i[g]),ole.getCurrObj()&&ole.getCurrObj()._setSelectLayer().positionActionBar()}hasOleMoved=!0}break;case"WIDTH":var p=ole.getObjectsByPositionX(getColLeft(l)),f=[];if(p.length>0){for(var g=0;g<p.length;g++){var c=parseInt(OLE[p[g].id].sColDiff),d=parseInt(OLE[p[g].id].sCol),S=parseInt(getColWidth(d)),L=parseInt(getColLeft(d));f[g]=c>S?L+S:L+c,OLE[p[g].id].setLeft(f[g]),ole.getCurrObj()&&ole.getCurrObj()._setSelectLayer().positionActionBar()}hasOleMoved=!0}}},ole.setOLEDragRange=function(e,t){var o,l,r,i,s,g=0;"top"===t&&getSheetScrollTop()>0||"bottom"===t&&getSheetScrollHeight()>getSheetScrollTop()+getSheetHeight()?(o=OLEDragProps.rowVal,l=OLEDragProps.colVal,i=OLEDragProps.scrollTop,s=OLEDragProps.scrollLeft,"top"===t?(o>0&&(r=o,o-=e,g=getRowTop(r)-getRowTop(o)),0>=o&&(o=0),ole.onDrag&&setOlePosForDrag(o,l,t,OLEDragProps.rowTop-g-OLEDragProps.diffY),ole.onResize&&setOleDimforResize(o,l,t,OLEDragProps.rowTop-g-OLEDragProps.diffY),i=OLEDragProps.scrollTop):"bottom"===t&&(totRows>o&&(r=o,o+=e,g=getRowTop(o)-getRowTop(r)),appendBlankRows(),ole.onDrag&&setOlePosForDrag(o,l,t,OLEDragProps.rowTop+g+OLEDragProps.diffY),ole.onResize&&setOleDimforResize(o,l,t,OLEDragProps.rowTop+g+OLEDragProps.diffY),i=OLEDragProps.scrollTop),("top"===t||"bottom"===t)&&(OLEDragProps.rowVal=o,OLEDragProps.colVal=l),"top"===t?setSheetScrollDimentions(i,s,void 0,void 0,"TOP"):"bottom"===t&&setSheetScrollDimentions(i,s,void 0,void 0,"BOTTOM")):"top"===t?(o=OLEDragProps.rowVal,l=OLEDragProps.colVal,0>=o&&(o=0,OLEDragProps.rowVal=o,OLEDragProps.colVal=l)):"bottom"===t&&appendBlankRows(),"right"===t&&getSheetScrollWidth()+findSecondPaneXPos()>getSheetScrollLeft()+getSheetWidth()||"left"===t&&getSheetScrollLeft()>0?(o=OLEDragProps.rowVal,l=OLEDragProps.colVal,i=OLEDragProps.scrollTop,s=OLEDragProps.scrollLeft,"right"===t?(totCols>l&&(l+=e,getColLeft(l)+ole.currObj.width>=getColLeft(totCols-1)+getColWidth(totCols-1)&&(l=findColInXPos(getColLeft(totCols)+getColWidth(totCols-1)-ole.currObj.width)),ole.onDrag&&setOlePosForDrag(o,l,t),ole.onResize&&setOleDimforResize(o,l,t),OLE[ole.currObj.id].getLeft()+OLE[ole.currObj.id].getWidth()>=getColLeft(totCols-1)+getColWidth(totCols-1)||setSheetTableWidth(getColLeft(totCols)),s=OLEDragProps.scrollLeft),l>=totCols&&(l=totCols-1,ole.onDrag&&setOlePosForDrag(o,l,t),ole.onResize&&setOleDimforResize(o,l,t),s=OLEDragProps.scrollLeft),setSheetScrollDimentions(i,s,void 0,void 0,"RIGHT")):"left"===t&&(l-=e,0>=l&&(l=0),ole.onDrag&&setOlePosForDrag(o,l,t),ole.onResize&&setOleDimforResize(o,l,t),s=OLEDragProps.scrollLeft,OLEDragProps.rowVal=o,setSheetScrollDimentions(i,s,void 0,void 0,"LEFT")),OLEDragProps.colVal=l,"right"===t?setSheetScrollDimentions(i,s,void 0,void 0,"RIGHT"):"left"===t&&setSheetScrollDimentions(i,s,void 0,void 0,"LEFT")):("right"===t||"left"===t)&&(o=OLEDragProps.rowVal,l=OLEDragProps.colVal,"right"===t?(0>=o&&(o=0),s=OLEDragProps.scrollLeft):"left"===t&&(l-=e,0>=l&&(l=0),OLEDragProps.rowVal=o,OLEDragProps.colVal=l),ole.onDrag&&setOlePosForDrag(o,l,t),ole.onResize&&setOleDimforResize(o,l,t),s=OLEDragProps.scrollLeft)},ole.hanldeDragAndResizeOle=function(e,t,o){var l=findRowInYPos(e),r=findColInXPos(t);scrollHelper.pointerOffsetPosCalculator(o,!0,!0);var i={ole:!0},s={rowNo:l,colNo:r,direction:void 0,top:e,left:t};ole.onDrag?(i.onScrollCallback=ole.setOLEDragRange,i.defaultCallBack=setOlePosForDrag,i.immediateCallBack=setOlePosForDrag,i.callbackParams=s,i.immediateCallBackParams=[l,r,void 0,e,t]):ole.onResize&&(i.onScrollCallback=ole.setOLEDragRange,i.defaultCallBack=setOleDimforResize,i.immediateCallBack=setOleDimforResize,i.callbackParams=s,i.immediateCallBackParams=[l,r,void 0,e,t]),scrollHelper.handleCursorPos(i)},appEvent.on("ole.onDrag",function(e,t,o){ole.hanldeDragAndResizeOle(e,t,o)}),appEvent.on("ole.onResize",function(e,t,o){ole.hanldeDragAndResizeOle(e,t,o)}),appEvent.on("grid.shift",function(e,t){e&&ole.conf.onPositionChange(ole.getObjects(),t)});function sort1(e,t){var o=!1;o=getObj("toptobottom").checked?!1:!0;var a=!1;getObj("containsheader").checked&&(a=!0);var r=!1;if(o?""==getObj("DD_row_0").value&&(r=!0):a?""==getObj("DD_column_header_0").value&&(r=!0):""==getObj("DD_column_0").value&&(r=!0),r)return void showAlertDialog(jsMsg.SortByBoxShouldNotBlank);var s="DD_column";a&&(s="DD_column_header");var l="asc_col";o&&(s="DD_row",l="asc_row");var n=getCellRange(),i=n.startRow,d=n.startCol,c=n.endRow,g=n.endCol,h="startColumn="+d+"&endColumn="+g+"&startRow="+i+"&endRow="+c;h+="&currentTime="+CURRENTTIME+"&currentSheet="+encodeURIComponent(CURRSHEETNAME)+"&documentId="+DOCUMENT_ID;var p="FALSE";a&&!o&&(p="TRUE");var u="FALSE";getObj("sensitive").checked&&(u="TRUE"),o=o?"TRUE":"FALSE";for(var v=new Array,b=0;e>b&&!(b>2);b++){var f={},w=-1,y=getObj(s+"_"+b).value;""==y?f.f=w:(w=getIndex(t,y),f.f=w);var D="FALSE";getObj(l+"_"+b).checked&&(D="TRUE"),f.s=D,v.push(f)}sortvalues(v,e,o,p,u),sheetdialog.close()}function sortvalues(e,t,o,a,r,s,l){if(l){var n=Filter.getInstance();if(!n)return;var i=n.range,d=i.sr,c=i.sc,g=i.er,h=i.ec}else var p=getCellRange(),u=getServerRange(p.startRow,p.startCol,p.endRow,p.endCol),d=u.startRow,c=u.startCol,g=u.endRow,h=u.endCol;if(!ProtectedRanges.isRangeLocked(d,c,g,h)){if(containsAnyArray(d,c,g,h))return void showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray);if(!isPivotOrArrayRange(d,c,g,h)){var v=new RequestParameters(ActionConstants.SORT);v.setParameters(WorkSheets.getAssociatedActiveSheetName(),d,c,g,h,JSON.stringify(e),t,o,a,r);var b=new AjaxRequest;b.init("POST",v.getURL(),!0,v.getParametersAsString()),actionManager.addRequest(b),sheetdialog.close()}}}function sortheader(e){if(isCellRange()){var t=getCellRange(),o=t.startRow,a=t.startCol,r=t.endRow,s=t.endCol,l=!1;if(l=checkSort(o,r,a,s))return showAlertDialog(jsMsg.SortingNotPossibleInMergedCellrange),void sheetdialog.close();var n=0,i=!1,d=a,c=s;if(isColSelected()){var g=new RequestParameters(ActionConstants.SORT_DETAILS);g.setParameters(WorkSheets.getAssociatedActiveSheetName(),o,a,getRowMax()-1,s);var h=new AjaxRequest;h.init("POST",g.getURL(),!0,g.getParametersAsString()),h.addEventListener("onComplete",function(t){var l=parseJSON(t.responseText),g=l.response_array,h=g[0],p=g[1];d=h.ESC,c=h.EEC,"true"==h.ES&&(i=!0,p=g[0],focusCellRange(o,d,usedCursRow,c,void 0,!0),n=a-d,a=d,s=c,r=usedCursRow);var u="true"==p.ch,v="FALSE";u&&(v="TRUE");var b="FALSE";"asc"==e&&(b="TRUE");var f=new Array,w={};w.f=n,w.s=b,f.push(w),sortvalues(f,s-a+1,!1,v,!1)}),h.sendRequest()}else{var p="FALSE";"asc"==e&&(p="TRUE");var u=new Array,v={};v.f=n,v.s=p,u.push(v),sortvalues(u,s-a+1,!1,!1,!1)}}}function changeDDOptions(e,t,o){if("toptobottom"==e.id){if(e.checked){getObj("lefttorightBtn").style.display="none",getObj("toptobtmBtn").style.display="",getObj("lefttorightRow").style.display="none",getObj("toptotbmRow").style.display="",getObj("containsheader").disabled=!1,getObj("containsheader").checked=o;for(var a=0;t>a;a++)getObj("containsheader").checked?(getObj("columnheaderDD_"+a).style.display="",getObj("columnDD_"+a).style.display="none"):(getObj("columnheaderDD_"+a).style.display="none",getObj("columnDD_"+a).style.display="")}}else if("lefttoright"==e.id)e.checked&&(getObj("lefttorightBtn").style.display="",getObj("toptobtmBtn").style.display="none",getObj("lefttorightRow").style.display="",getObj("toptotbmRow").style.display="none",getObj("containsheader").checked=!1,getObj("containsheader").disabled=!0);else if("containsheader"==e.id)for(var a=0;t>a;a++)e.checked?(getObj("columnheaderDD_"+a).style.display="",getObj("columnDD_"+a).style.display="none"):(getObj("columnheaderDD_"+a).style.display="none",getObj("columnDD_"+a).style.display="")}function DDcolvalidate(e,t){var o=e.value;if(""!=o){var a=e.id,r=!1;-1!=a.indexOf("DD_column_header_")&&(r=!0),a=r?"DD_column_header_":"DD_column_";for(var s=0;t>s&&!(s>2);s++){var l=a+s,n=getObj(l).value;if(e.id!=l&&o==n){showAlertDialog(jsMsg.SelectDifferentColumn),e.selectedIndex=0;break}}}}function DDrowvalidate(e,t){var o=e.value;if(""!=o)for(var a=0;t>a&&!(a>2);a++){var r="DD_row_"+a,s=getObj(r).value;if(e.id!=r&&o==s){showAlertDialog(jsMsg.SelectDifferentRow),e.selectedIndex=0;break}}}function getIndex(e,t){for(var o=e.split(":"),a=-1,r=0;r<o.length;r++)if(t.trim()==o[r].trim()){a=r;break}return a}function checkSort(e,t,o,a){var r=new Range(e,o,t,a),s=r.getIterator();return s.initData(!1),s.setDataProcessor(function(e){return e}),s.iterate(function(e,t){var o=Merge.getCellInfo(e,t);o&&(this.processData(!0),this.interrupt())}),s.getData()}function constructSortDialog(){var e=getCellRange(),t=e.startRow,o=e.startCol,a=e.endRow,r=e.endCol,s=checkSort(t,a,o,r);if(s)return showAlertDialog(jsMsg.SortingNotPossibleInMergedCellrange),void sheetdialog.close();var l=getServerRange(t,o,a,r),n=new RequestParameters(ActionConstants.SORT_DETAILS);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),t,o,l.endRow,l.endCol);var i=new AjaxRequest;i.init("POST",n.getURL(),!0,n.getParametersAsString()),i.addEventListener("onComplete",function(e){var a=parseJSON(e.responseText);sortDialog(a.response_array,t,o,l.endRow,l.endCol)}),i.sendRequest()}function sortDialog(e,t,o,a,r){var s=e[0],l=e[1],n=s.ESC,i=s.EEC;isColSelected()&&"true"==s.ES&&(l=e[0],focusCellRange(t,n,usedCursRow,i,void 0,!0),o=n,r=i,a=usedCursRow),a>usedCursRow&&(a=usedCursRow),a>usedCursRow&&(a=usedCursRow),v="true"==l.ch;var d="FALSE";v&&(d="TRUE");for(var c=r-o+1,g=a-t+1,h=c>3?3:c,p="",u=new Array,v="true"==l.ch,b=0,f=o;r>=f;f++)u[b]="undefined"==typeof l["c_"+f]?getCellContent(getCell(t,f),"cV"):l["c_"+f],p+=getColHeadLabel(f+1)+":",b++;p=p.substring(0,p.length-1);for(var w="",f=t;a>=f;f++)w+=f+1+":";w=w.substring(0,w.length-1);var y="",D=IMAGE_PATH+"/spacer.gif",_=p.split(":"),R=w.split(":"),m="";m+="<table style='table-layout:fixed;' width='100%' border='0' cellspacing='0' cellpadding='0'><tr><td>",m+="<table width='100%' border='0' cellspacing='0' cellpadding='0'>",m+="<tr id='toptotbmRow'><td>",m+="<table width='100%' border='0' cellspacing='0' cellpadding='0'>";for(var f=0;3>f;f++){y=jsMsg.Thenby,0==f&&(y=jsMsg.SortBy),m+="<tr> <td colspan='2'><div style='float:left;clear:both;width:20%;white-space:nowrap;'>"+y+"</div>",m+="<div class='hsep' style='float:right;width:80%;height:20px;'><img src='"+D+"' width='1' height='1'></div></td></tr>",m+="<tr>";var j="";v||(j="style='display:none'");var C="";f>c-1&&(C="disabled"),m+="<td id='columnheaderDD_"+f+"' "+j+"> <div style='width:130px;'><select style='width:130px;' id='DD_column_header_"+f+"' onchange='DDcolvalidate(this, "+c+");' "+C+">";var S="";0!=f&&(S="selected"),m+="<option value='' "+S+"></option>";for(var O=0;O<_.length;O++){var A=u[O],k="";0==f&&0==O&&(k="selected"),m+="<option value='"+_[O]+"' "+k+">"+A+"</option>"}m+="</select> </div></td>",j="",v&&(j="style='display:none'"),m+="<td id='columnDD_"+f+"' "+j+"> <div style='width:130px;'><select style='width:130px;' id='DD_column_"+f+"' onchange='DDcolvalidate(this, "+c+");' "+C+">",S="",0!=f&&(S="selected"),m+="<option value='' "+S+"></option>";for(var O=0;O<_.length;O++){var A=replaceParams(jsMsg["Sort.Orientation.Column"],new Array(_[O])),k="";0==f&&0==O&&(k="selected"),m+="<option value='"+_[O]+"' "+k+">"+A+"</option>"}m+="</select> </div></td>",m+="<td><table border='0' cellspacing='0' cellpadding='0'><tr>",m+="<td><input type='radio' id='asc_col_"+f+"' name='order_col_"+f+"' value='Ascending' checked "+C+"></td>",m+="<td><label for='asc_col_"+f+"'>"+jsMsg.Ascending+"</label></td></tr>",m+="<tr><td><input type='radio' id='desc_col_"+f+"' name='order_col_"+f+"' value='Descending' "+C+"></td>",m+="<td><label for='desc_col_"+f+"'>"+jsMsg.Descending+"</label></td></tr>",m+="</table></td>",m+="</tr>"}m+="</table>",m+="</td></tr>",m+="<tr id='lefttorightRow' style='display:none'><td>",m+="<table width='100%' border='0' cellspacing='0' cellpadding='0'>";for(var f=0;3>f&&!(f>2);f++){y=jsMsg.Thenby,0==f&&(y=jsMsg.SortBy);var C="";f>g-1&&(C="disabled"),m+="<tr> <td colspan='2' ><div style='float:left;clear:both;width:20%;white-space:nowrap;'>"+y+"</div>",m+="<div class='hsep' style='float:right;width:80%;height:20px;'><img src='"+D+"' width='1' height='1'></div></td></tr>",m+="<tr><td> <div style='width:130px;'><select style='width:130px;' id='DD_row_"+f+"' onchange='DDrowvalidate(this, "+g+");' "+C+">";var S="";0!=f&&(S="selected"),m+="<option value='' "+S+"></option>";for(var O=0;O<R.length;O++){var E=replaceParams(jsMsg["Sort.Orientation.Row"],new Array(R[O])),k="";0==f&&0==O&&(k="selected"),m+="<option value='"+R[O]+"' "+k+">"+E+"</option>"}m+="</select> </div></td>",m+="<td><table border='0' cellspacing='0' cellpadding='0'><tr>",m+="<td><input type='radio' id='asc_row_"+f+"' name='order_row_"+f+"' value='Ascending' checked "+C+"></td>",m+="<td><label for='asc_row_"+f+"'>"+jsMsg.Ascending+"</label></td></tr>",m+="<tr><td><input type='radio' id='desc_row_"+f+"' name='order_row_"+f+"' value='Descending' "+C+"></td>",m+="<td><label for='desc_row_"+f+"'>"+jsMsg.Descending+"</label></td></tr>",m+="</table></td>",m+="</tr>"}m+="</table>",m+="</td></tr>";var M="";v&&(M="checked"),m+="<tr> <td colspan='2' ><div style='float:left;clear:both;width:30%;white-space:nowrap;'>"+jsMsg.ListOptions+"</div>",m+="<div class='hsep' style='float:right;width:70%;height:20px;'><img src='"+D+"' width='1' height='1'></div></td></tr>",m+="<tr><td colspan='2' height='30'><table border='0' cellspacing='0' cellpadding='2'><tr>",m+="<td><input id='containsheader' name='checkbox' value='checkbox' type='checkbox' "+M+" onclick='changeDDOptions(this, "+h+", "+v+");'></td>",m+="<td nowrap><label for='containsheader'>"+jsMsg.ContainsHeader+"</label></td>",m+="<td style='padding-left:10px;'><input id='sensitive' name='checkbox' value='checkbox' type='checkbox' checked></td>",m+="<td nowrap><label for='sensitive'>"+jsMsg.CaseSensitive+"</label></td></tr>",m+="</table></td></tr>",m+="<tr> <td colspan='2' ><div style='float:left;clear:both;width:30%;white-space:nowrap;'>"+jsMsg.Orientation+"</div>",m+="<div class='hsep' style='float:right;width:70%;height:20px;'><img src='"+D+"' width='1' height='1'></div></td></tr>",m+="<tr><td colspan='2' height='30'><table border='0' cellspacing='0' cellpadding='2'><tr>",m+="<td><input id='toptobottom' name='orientation' type='radio' checked onclick='changeDDOptions(this, "+h+", "+v+");'></td>",m+="<td nowrap><label for='toptobottom'>"+jsMsg.SortTopToBottom+"</label></td>",m+="<td style='padding-left:10px;'><input id='lefttoright' name='orientation' type='radio' onclick='changeDDOptions(this, "+h+");'></td>",m+="<td nowrap><label for='lefttoright'>"+jsMsg.SortLeftToRight+"</label></td></tr>",m+="</table></td></tr>",m+="<tr> <td colspan='2' align='right' style='padding-top:10px'><button ctype='zbutton' class='ui-zbutton-primary' id='toptobtmBtn' onclick='sort1("+c+', "'+p+"\");'>"+jsMsg.OK+"</button><button ctype='zbutton' id='lefttorightBtn' class='ui-zbutton-primary' style='display:none' onclick='sort1("+g+', "'+w+"\");'>"+jsMsg.OK+"</button>",m+="<button ctype='zbutton' onClick='isSortDialogOpened=false;sheetdialog.close();'>"+jsMsg.Cancel+"</button></td>",m+="</tr></table></td></tr></table>";var x={width:410,modal:!0,title:jsMsg.Sort};sheetdialog.open(m,x),c>1&&1===g&&setTimeout(function(){setSortLabelsOption()},200)}function setSortLabelsOption(){$("#lefttoright").click(),$("#lefttoright").trigger("onclick")}function makepublicdialog(e){var o=user.permissions.unRegisteredUserEmail;if(o)return void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail]));if(sheetdialog.close(),0==DOCUMENT_NAME.toLowerCase().indexOf(jsMsg.Untitled.toLowerCase())){var t=showPromptDialog(jsMsg.RenameWhilePublish,$("#fileName").text());null!=t&&""!=t&&(renameDocument(t,e),isNewDocument=!1),makepublicconfirm(e)}else makepublicconfirm(e)}function makepublicconfirm(e){sheetdialog.close();var o="";if("org"==e){var t="";t=null==orgDisplayName||""==orgDisplayName||"Organization"==orgDisplayName?jsMsg.MakePublicwithinOrganization:replaceParams(jsMsg.MakePublicwithinDomain,new Array(orgDisplayName)),o=t}else o="external"==e?jsMsg["Share.MakePublic"]:jsMsg["Share.MakePublic"];var i=showFormulas,l=allowExportPublic;if(("org"==e||-1!=zoid)&&(i=showFormulasOrg,l=allowExportOrg),isNewDocument){var a=new RequestParameters(ActionConstants.CHANGE_DOC_STATUS);a.setParameters();var s=new AjaxRequest;s.init("POST",a.getURL(),!0,a.getParametersAsString()),s.addEventListener("onComplete",function(){isNewDocument=!1,makePublicRequestToServer(e,l,i,o)}),s.sendRequest()}else makePublicRequestToServer(e,l,i,o)}function makePublicRequestToServer(e,o,t,i){var l=new RequestParameters(ActionConstants.JSP_MAKE_PUBLIC);l.setParameters(RESOURCE_ID,showPublic,orgDisplayName,e,o,t,allowOrgEdit,"document");var a={width:520,modal:!0,title:i},s=l.getURL()+"?"+l.getParametersAsString();sheetdialog.open("makepublicdialog",a,void 0,void 0,s)}function makepublicsubmit(e,o){var t,i=!1,l=getObj("semipublic_confirmoption");if(null!=l&&(i=l.checked?!1:!0),"org"==e){showFormulasOrg=!0;var a=getObj("public_formulaoption");null!=a&&(showFormulasOrg=a.checked?!1:!0),allowExportOrg=!0;var s=getObj("public_exportoption");null!=s&&(allowExportOrg=s.checked?!0:!1);var r=getObj("public_allowOrgEditoption");null!=r&&(allowOrgEdit=r.checked?!0:!1)}else{showFormulas=!0;var a=getObj("public_formulaoption");null!=a&&(showFormulas=a.checked?!1:!0),allowExportPublic=!0;var s=getObj("public_exportoption");null!=s&&(allowExportPublic=s.checked?!0:!1),allowExportOrg=allowExportPublic,showFormulasOrg=showFormulas}if(showPublic=!0,"org"==e)showPublic="false";else if("external"==e)showPublic="true",null==l&&(i="false");else{var n=getObj("showPublicOption");null!=n&&(showPublic=n.checked?!0:!1)}var u=document.getElementById("isDocTemplate").value;t="true"==u?"template":"false"===u?"document":"document";var c;"doc_id"==DOCUMENT_ID&&"null"!=o?c=o:"null"==o&&"doc_id"!=DOCUMENT_ID&&""!=DOCUMENT_ID?c=DOCUMENT_ID:""==o&&""!=DOCUMENT_ID?c=DOCUMENT_ID:"null"!=o&&"doc_id"!=DOCUMENT_ID&&""!=DOCUMENT_ID&&(c=o);var m=new RequestParameters(ActionConstants.MAKE_PUBLIC);"org"==e?m.setParameters(c,"Make Public",i,encodeURIComponent(DOCUMENT_NAME),showFormulasOrg,allowExportOrg,showPublic,e,t,allowOrgEdit):m.setParameters(c,"Make Public",i,encodeURIComponent(DOCUMENT_NAME),showFormulasOrg,allowExportOrg,showPublic,e,t);var d=new AjaxRequest;d.init("POST",m.getURL(),!0,m.getParametersAsString()),d.addEventListener("onComplete",function(o){sheetdialog.close(),"external"==e?($("#orgpub").hide(),$("#extpub").show()):$("#orgpub").show(),callpublic("Made Public",o.responseText),"org"==e?public_view(i,"Public",!0):public_view(i,"Public",!1),m=void 0;var l=showFormulas,a=allowExportPublic;("org"==e||-1!=zoid)&&(l=showFormulasOrg,a=allowExportOrg),"template"==t?(m=new RequestParameters(ActionConstants.JSP_CONFIRM_PUBLIC_TEMPLATE),m.setParameters(showPublic,orgDisplayName,e,a,l,t,doit(publicURL),i)):(m=new RequestParameters(ActionConstants.JSP_MAKE_PUBLIC),m.setParameters(RESOURCE_ID,showPublic,orgDisplayName,e,a,l,allowOrgEdit,t,i,!0));var s={width:543,modal:!0,title:jsMsg["Share.MakePublic"]},r=m.getURL()+"?"+m.getParametersAsString();sheetdialog.open("makepublicdialog",s,void 0,void 0,r)}),d.sendRequest()}function togglePublicURLTab(e){var o=document.getElementById("publicurltext");if(""!=currPublicURLTab){var t=getObj(currPublicURLTab).className,i=t.replace("selected","");getObj(currPublicURLTab).className=i}var l=publicURL;"htmlViewTab"==e?(l+="&mode=html",o.href=publicURL+"&mode=html"):"readOnlyView"==e?(l+="&mode=readonly",o.href=publicURL+"&mode=readonly"):"printableVersion"==e?(l+="&mode=print",o.href=publicURL+"&mode=print"):""!=e&&(o.href=publicURL),o.innerHTML=l,getObj(e).className+=" selected",currPublicURLTab=e}function cancelpublicsubmit(e){e||(e=isDocumentSemiPublic&&!isDocumentPublic?"org":"external"),"external"===e?$("#extpub").hide():$("#orgpub").hide();var o,t=document.getElementById("isDocTemplate").value;"true"==t?o="template":(o="document",isDocumentPublic=!1);var i=new RequestParameters(ActionConstants.MAKE_PUBLIC);i.setParameters(DOCUMENT_ID,"Remove Public","",encodeURIComponent(DOCUMENT_NAME),"","","",e,o,"");var l=new AjaxRequest;l.init("POST",i.getURL(),!0,i.getParametersAsString()),l.addEventListener("onComplete",function(e){return"Not Authorized"==e.responseText?void showAlertDialog(jsMsg.YouAreNotAuthorizedUserToMakeDocPublic):void public_view(!1,"Cancel")}),l.sendRequest()}function showPublicURL(){var e=isDocumentSemiPublic&&!isDocumentPublic?"org":"external",o=new RequestParameters(ActionConstants.JSP_MAKE_PUBLIC),t=showFormulas,i=allowExportPublic;("org"==e||-1!=zoid)&&(t=showFormulasOrg,i=allowExportOrg),o.setParameters(RESOURCE_ID,showPublic,orgDisplayName,e,i,t,allowOrgEdit,"document",isDocumentSemiPublic,!0);var l={width:543,modal:!0,title:jsMsg["Share.ViewPublicURL"]},a=o.getURL()+"?"+o.getParametersAsString();sheetdialog.open("showpublicurldialog",l,void 0,void 0,a)}function showRangePublishURL(e,o,t,i,l,a){"undefined"!=typeof e&&"rangepublish"!=o&&"makepublish"!=o&&(publicURL=e),"undefined"==typeof e||"rangepublish"!=o&&"makepublish"!=o||(tempPublishURL=e);if("rangepublish"==o){"undefined"==typeof t&&(t=""),"undefined"==typeof i&&(i=""),"undefined"==typeof l&&(l=""),"undefined"==typeof a&&(a="");var s=new RequestParameters(ActionConstants.JSP_RANGE_SNIPPET);s.setParameters(l,"","",tempPublishURL,a,t,i);var r={width:550,modal:!0,title:jsMsg.PublishRange},n=s.getURL()+"?"+s.getParametersAsString();sheetdialog.open("showrangepublishurldialog",r,void 0,void 0,n)}}function cancelpublicdialog(e){sheetdialog.close(),publiccallBck="frompublic"==e?"set":null;var o={width:450,modal:!0,title:jsMsg.RemovePublic};sheetdialog.open("cancelpublic",o)}function cancelcheck(){"set"!=publiccallBck?sheetdialog.close():(publiccallBck=null,showPublicURL())}function public_view(e,o,t){"Public"==o?((e||"undefined"!=typeof t&&t)&&(isDocumentSemiPublic=!0),"undefined"!=typeof t&&t||(isDocumentPublic=!0)):(isDocumentPublic=!1,isDocumentSemiPublic=!1,allowExportOrg=showFormulasOrg=allowExportPublic=showFormulas=!0,"Cancel"==o&&sheetdialog.close(),allowOrgEdit=!1)}function openShareDialog(){if(isCellEdited()&&submitCell(),isNewDocument){var e=new RequestParameters(ActionConstants.CHANGE_DOC_STATUS);e.setParameters();var o=new AjaxRequest;o.init("POST",e.getURL(),!0,e.getParametersAsString()),o.addEventListener("onComplete",function(){isNewDocument=!1,FILEDIALOG.showShareForm("zohosheet",RESOURCE_ID,isCoOwnerSharedDoc)}),o.sendRequest()}else FILEDIALOG.showShareForm("zohosheet",RESOURCE_ID,isCoOwnerSharedDoc)}function notifySharedUsers(){RESOURCE_ID&&NotifyCollaborator.open(RESOURCE_ID)}var tempPublishURL="";Share={htmlData:void 0,showDialog:function(e,o,t){var i={width:"450px",modal:!0,title:jsMsg["Service.ZohoOffice"],closeOnEscape:!1,close:function(){return!1},buttons:[{text:e,class:"ui-zbutton-primary",click:function(){o?(documentBakeStatus.setCollabBake(!1),document.location.href=ctxpath+"ropen.do?rid="+RESOURCE_ID):Share.coOwnerChanges(t)}}]},l="";this.htmlData?l=this.htmlData:(l=$("#notifyDlgContainer").html(),$("#notifyDlgContainer").html(""),this.htmlData=l),sheetdialog.close(),sheetdialog.open(l,i,Share.notifyCallBack)},setValues:function(e,o,t,i){if(o&&t&&e){var l="info"==e?"infoIcon":"errorIcon";$("#notifyDlgIcon").addClass(l),$("#notifyDlgHeading").html(o),$("#notifyDlgMsg").html(t),i&&($("#notifyDlgReloadMsg").html(i),$("#notifyDlgReloadMsg").show())}},coOwnerChanges:function(e){1==e?(isCoOwnerSharedDoc=!1,$("#share").hide()):2==e&&(isCoOwnerSharedDoc=!0,$("#share").show()),(isDialogShow||$("#sharedialogdiv").length>0)&&($("#sharedialogdiv").length>0?$("#sharedialogdiv").dialog("close"):sheetdialog.close())},notifyCallBack:function(){$(".ui-dialog-titlebar-close").hide()}},Trash={htmlData:void 0,showDialog:function(e){var o={width:"450px",modal:!0,title:jsMsg["Service.ZohoOffice"],closeOnEscape:!1,close:function(){return!1},buttons:[{text:e,class:"ui-zbutton-primary",click:function(){documentBakeStatus.setCollabBake(!1),window.location.reload()}}]},t="";this.htmlData?t=this.htmlData:(t=$("#notifyDlgContainer").html(),$("#notifyDlgContainer").html(""),this.htmlData=t),sheetdialog.open(t,o,Share.notifyCallBack)},setValues:function(e,o,t){if(o&&t&&e){var i="info"==e?"infoIcon":"errorIcon";$("#notifyDlgIcon").addClass(i),$("#notifyDlgHeading").html(o),$("#notifyDlgMsg").html(t)}},notifyCallBack:function(){$(".ui-dialog-titlebar-close").hide()}};function showDialog(e,o,l,t){if("undefined"==typeof o)var o="position=absmiddle";o=o.split(",");for(var i,n=0;n<dialogProperties.length;n++){i=!1;for(var a=0;a<o.length;a++)if(o[a].indexOf(dialogProperties[n])>=0){i=!0;break}self["dialog_"+dialogProperties[n]]=i?o[a].substr(o[a].indexOf("=")+1,o[a].length).trim():"undefined"}null!=document.getElementById("_DIALOG_LAYER")&&closeDialog(),oDialog=document.createElement("DIV"),oDialog.id="_DIALOG_LAYER",document.body.appendChild(oDialog),dialogEl=oDialog,"undefined"!=typeof t&&null!=t&&(onCloseCallBack=t);var d="string"!=typeof e,r=e;e='<div id="_DIALOG_CONTENT">'+(d?"":e)+"</div>";var s='<table class="DialogBox" border="0" cellspacing="0" cellpadding="0"><tr><td class="boxTL">&nbsp;</td>';s+="undefined"!=dialog_draggable&&"no"==dialog_draggable?'<td class="boxHeader">':'<td class="boxHeader drag" onMouseDown="captureDialog(event)">',"undefined"!=dialog_title?("'"==dialog_title.charAt(0)&&"'"==dialog_title.charAt(dialog_title.length-1)&&(dialog_title=dialog_title.substr(1,dialog_title.length-2)),0==dialog_title.trim().length&&(dialog_title="&nbsp;")):dialog_title="&nbsp;",s+=dialog_title+'</td><td class="boxCtrlButtonPane">',s+="undefined"!=dialog_closeButton&&"no"==dialog_closeButton?"&nbsp;</td>":'<input type="button" class="closeButton" onClick="closeDialog();"></td>',s+='<td class="boxTR">&nbsp;</td></tr><tr><td colspan="4" class="boxContent">'+e+"</td></tr>",s+='<tr><td class="boxBL"></td><td class="boxBC" colspan="2"></td><td class="boxBR"></td></tr></table>',oDialog.style.display="block";var g=!0;"undefined"!=dialog_closeButton&&"&nbsp;"==dialog_title&&"no"==dialog_closeButton&&(g=!1),oDialog.innerHTML=g?"<table cellpadding='0' cellspacing='0'><tr><td height='100%' style='display:;'>"+s+"</td></tr></table>":"<table cellpadding='0' cellspacing='0'><tr><td height='100%' style='display:;'>"+e+"</td></tr></table>",oDialog.style.position="absolute",oDialog.style.left="-1000px",oDialog.style.top="-1000px",oDialog.style.zIndex="100000";for(var c=oDialog.getElementsByTagName("SCRIPT"),n=0;n<c.length;n++){var f=document.createElement("SCRIPT");f.type="text/javascript",f.language="javascript",""!=c[n].src&&(f.src=c[n].src),f.text=c[n].text,"undefined"==typeof document.getElementsByTagName("HEAD")[0]?document.createElement("HEAD").appendChild(f):document.getElementsByTagName("HEAD")[0].appendChild(f)}if(browser_opera)for(var p=e,y=oDialog.getElementsByTagName("STYLE"),n=0;n<y.length;n++)y[n].innerHTML=p.substring(p.indexOf("<style>")+7,p.indexOf("</style>")-1),p=p.substring(p.indexOf("</style>")+8,p.length);"undefined"!=dialog_width&&(browser_ie?oDialog.childNodes[0].style.width=parseInt(dialog_width)+"px":(browser_nn4||browser_nn6)&&(oDialog.childNodes.item(0).style.width=parseInt(dialog_width)+"px")),"undefined"!=dialog_height&&(browser_ie?oDialog.childNodes[0].style.height=parseInt(dialog_height)+"px":(browser_nn4||browser_nn6)&&(oDialog.childNodes.item(0).style.height=parseInt(dialog_height)+"px")),oDialogContent=getObj("_DIALOG_CONTENT"),dialogContentEl=oDialogContent,d&&oDialogContent.appendChild(r);var u=0,m=0;browser_opera&&("undefined"!=dialog_width?oDialogContent.style.width=parseInt(dialog_width)+"px":(oDialogContent.style.width=oDialogContent.offsetWidth+"px",oDialog.style.width=oDialogContent.offsetWidth+"px")),(browser_nn4||browser_nn6)&&(oDialogContent.style.width="undefined"!=dialog_width?parseInt(dialog_width)+"px":oDialogContent.offsetWidth+20+"px"),"undefined"!=dialog_height&&(browser_ie&&parseInt(dialog_height)<oDialogContent.offsetHeight&&(u=-15),oDialogContent.style.height=parseInt(dialog_height)+"px"),oDialogContent.style.overflow="auto";var _=oDialog.offsetWidth,h=oDialog.offsetHeight;doc=findDocDim(),closeOnEscKey="undefined"!=dialog_closeOnEscKey&&"no"==dialog_closeOnEscKey?!1:!0,closeOnBodyClick="undefined"!=dialog_closeOnBodyClick&&"yes"==dialog_closeOnBodyClick?!0:!1,browser_opera||("undefined"!=dialog_modal&&"yes"==dialog_modal?("undefined"==dialog_freezeLayerBGColor&&(self.dialog_freezeLayerBGColor=""),"undefined"==dialog_freezeLayerOpacity&&(self.dialog_freezeLayerOpacity=""),isModalDialog=!0,freezeBackground({BGColor:dialog_freezeLayerBGColor,opacity:dialog_freezeLayerOpacity})):null!=document.getElementById("FreezeLayer")?(document.body.removeChild(document.getElementById("FreezeLayer")),isModalDialog=!1):isModalDialog=!1),"undefined"!=dialog_left&&(u+=parseInt(dialog_left)),"undefined"!=dialog_top&&(m+=parseInt(dialog_top));var D=document.body.scrollLeft>0?15:0,b=document.body.scrollTop>0?15:0;if("undefined"!=dialog_position&&"relative"==dialog_position){"undefined"!=dialog_srcElement?srcEl=getObj(dialog_srcElement):null==srcEl&&(srcEl=document.body);var E=srcEl.offsetWidth?srcEl.offsetWidth:0,w=srcEl.offsetHeight?srcEl.offsetHeight:0;u+=findPosX(srcEl)+_>doc.width-D?findPosX(srcEl)+E-_:findPosX(srcEl),m+=findPosY(srcEl)+w+h>doc.height-b?findPosY(srcEl)-h:findPosY(srcEl)+w+2}else"undefined"!=dialog_position&&"current"==dialog_position?(null!=dialog_cursor_left&&null!=dialog_cursor_top?(u=dialog_cursor_left,m=dialog_cursor_top):u=m=0,u=null!=dialog_cursor_left?dialog_cursor_left:0,m=null!=dialog_cursor_top?dialog_cursor_top:0,u+_>doc.width-D&&(u-=_),m+h>doc.height-b&&(m-=h)):"undefined"!=dialog_position&&"absolute"==dialog_position?(("undefined"==dialog_left||"absmiddle"==dialog_left)&&(u=doc.width/2-_/2+document.body.scrollLeft),("undefined"==dialog_top||"absmiddle"==dialog_top)&&(m=doc.height/2-h/2+document.body.scrollTop),u+=document.body.scrollLeft,m+=document.body.scrollTop):(u=doc.width/2-_/2+document.body.scrollLeft+u,m=doc.height/2-h/2+document.body.scrollTop+m);if(u=u>0?u:0,m=m>0?m:0,"undefined"!=dialog_transitionType?("undefined"==dialog_transitionInterval&&(dialog_transitionInterval=10),Effect.init({type:dialog_transitionType,speed:dialog_transitionInterval,layerId:"_DIALOG_LAYER",layerTop:m,layerLeft:u}),Effect.display()):(oDialog.style.left=parseInt(u)+"px",oDialog.style.top=parseInt(m)+"px"),browser_ie&&!browser_opera&&(iframeIEHack=document.createElement("IFRAME"),iframeIEHack.scrolling="no",iframeIEHack.frameBorder=0,null!=window.CONTEXT_PATH&&(iframeIEHack.src=CONTEXT_PATH+"/framework/html/blank.html"),iframeIEHack.style.position="absolute",iframeIEHack.style.zIndex="99998",iframeIEHack.style.filter="progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)","undefined"!=dialog_modal&&"yes"==dialog_modal?(iframeIEHack.style.width=document.getElementById("FreezeLayer").style.width,iframeIEHack.style.top="0px",iframeIEHack.style.left="0px"):(iframeIEHack.style.width=oDialog.offsetWidth+"px",iframeIEHack.style.height=oDialog.offsetHeight+"px",iframeIEHack.style.top=parseInt(m)+"px",iframeIEHack.style.left=parseInt(u)+"px"),document.body.appendChild(iframeIEHack)),!browser_opera&&"undefined"!=dialog_modal&&"yes"==dialog_modal){var I=0;I=setFreezeLayerHeight(),browser_ie&&(iframeIEHack.style.height=I)}return dialogHidden=!1,dialogOpened=!0,"undefined"!=typeof l&&null!=l&&""!=l&&l(),"function"==typeof onDialogOpen&&onDialogOpen(),oDialog}function freezeBackground(e){var o=document.createElement("DIV");if(o.id="FreezeLayer",o.className="freezeLayer",o.style.width="100%",o.style.zIndex="99999",""!=e.BGColor&&(o.style.backgroundColor=e.BGColor),""!=e.opacity){var l=e.opacity.indexOf("%")<0?e.opacity:e.opacity.substr(0,e.opacity.length-1);browser_ie?o.style.filter="alpha(opacity="+l+")":o.style.opacity=l/1e3}document.body.appendChild(o)}function captureDialog(e){oDialog.style.cursor="move",browser_ie?(diffLeft=window.event.clientX+document.body.scrollLeft-parseInt(findPosX(oDialog)),diffTop=window.event.clientY+document.body.scrollTop-parseInt(findPosY(oDialog))):(browser_nn4||browser_nn6)&&(diffLeft=e.pageX-parseInt(findPosX(oDialog)),diffTop=e.pageY-parseInt(findPosY(oDialog))),document.onmousemove=moveDialog,document.onmouseup=releaseDialog}function moveDialog(e){if(clearTextSelection(),browser_ie){var o=window.event.clientX+document.body.scrollLeft-diffLeft,l=window.event.clientY+document.body.scrollTop-diffTop;o=o>=0?o:0,l=l>=0?l:0,null!=document.getElementById("FreezeLayer")||browser_opera?(oDialog.style.left=o+"px",oDialog.style.top=l+"px"):(oDialog.style.left=iframeIEHack.style.left=o+"px",oDialog.style.top=iframeIEHack.style.top=l+"px")}else(browser_nn4||browser_nn6)&&(oDialog.style.left=(e.pageX-diffLeft>0?e.pageX-diffLeft:0)+"px",oDialog.style.top=(e.pageY-diffTop>0?e.pageY-diffTop:0)+"px")}function releaseDialog(){oDialog.style.cursor="default",document.onmousemove=null,document.onmouseup=null}function closeDialog(e){null==oDialog||"none"==oDialog.style.display&&!dialogHidden||(oDialog.style.display="none",null!=document.getElementById("FreezeLayer")&&document.body.removeChild(document.getElementById("FreezeLayer")),browser_ie&&!browser_opera&&(document.body.removeChild(iframeIEHack),iframeIEHack=null),closeOnBodyClick=!1,"undefined"!=typeof e&&"undefined"==e.srcElement&&e(),"undefined"!=typeof onCloseCallBack&&null!=onCloseCallBack&&onCloseCallBack(),dialogHidden=!1,dialogOpened=!1,onCloseCallBack=null,document.body.removeChild(oDialog),oDialog=null,dialogEl=null,"function"==typeof onDialogClose&&onDialogClose())}function hideDialog(){if(null!=oDialog&&"none"!=oDialog.style.display){oDialog.style.display="none";var e=document.getElementById("FreezeLayer");null!=e&&(e.style.display="none"),browser_ie&&!browser_opera&&(iframeIEHack.style.display="none"),dialogHidden=!0}}function recallDialog(){if(null!=oDialog&&"none"==oDialog.style.display){browser_ie&&!browser_opera&&(iframeIEHack.style.display="");var e=document.getElementById("FreezeLayer");null!=e&&(e.style.display=""),oDialog.style.display="",dialogHidden=!1}}function scrollPage(){scrollEnd>=cnt?(document.body.scrollTop+=10,cnt+=10):(scrollEnd=cnt=0,clearInterval(scrollInterval))}function showURLInDialog(e,o,l,t,i){callBack=function(e){var n=showDialog(e.responseText,o,l,i);t&&n.setAttribute("opener",t)},AjaxAPI.sendRequest({METHOD:"GET",URL:e,ONSUCCESSFUNC:callBack})}function closeParentDialog(e,o){if(closeDialog(),o){var l=DOMUtils.getParentWithAttr(e,"opener");AjaxAPI.refreshOpener({OPENER:l.getAttribute("opener")})}}function dialogWinResizeListener(){dialogOpened&&isModalDialog&&setFreezeLayerHeight()}function setFreezeLayerHeight(){var e=0;return e=browser_ie?document.documentElement.scrollHeight<document.documentElement.offsetHeight?document.documentElement.offsetHeight:document.documentElement.scrollHeight:document.body.scrollHeight,document.getElementById("FreezeLayer").style.height=e,e}var oDialog,doc,srcEl,closeOnEscKey=!0,closeOnBodyClick=!1,iframeIEHack,onCloseCallBack,dialogHidden,dialogOpened,dialogProperties=new Array("position","top","left","height","width","srcElement","modal","draggable","title","closeButton","closeOnEscKey","transitionType","transitionInterval","closeOnBodyClick","freezeLayerBGColor","freezeLayerOpacity"),dialogEl,dialogContentEl,onDialogOpen,onDialogClose,isModalDialog,diffLeft=0,diffTop=0;document.onkeydown=function(e){if(browser_ie)var o=window.event.keyCode;else if(browser_nn4||browser_nn6)var o=e.which;27==o&&1==closeOnEscKey&&null!=oDialog&&"none"!=oDialog.style.display&&closeDialog()};var dialog_cursor_left,dialog_cursor_top;document.onmousedown=function(e){browser_ie?srcEl=window.event.srcElement:(browser_nn4||browser_nn6)&&(srcEl=e.target);var o=getCursorPos(e),l=o.x,t=o.y;dialog_cursor_left=l,dialog_cursor_top=t,"undefined"!=typeof closeOnBodyClick&&1==closeOnBodyClick&&null!=oDialog&&"hidden"!=oDialog.style.visibility&&(l<findPosX(oDialog)||l>=findPosX(oDialog)+oDialog.offsetWidth||t<findPosY(oDialog)||t>=findPosY(oDialog)+oDialog.offsetHeight)&&closeDialog()};var scrollEnd=0,cnt=0;window.addEventListener("resize",dialogWinResizeListener,!1);function showFuncList(){if(READ_WRITE&&!ProtectedRanges.isRangeLocked(currRow,currCol,currRow,currCol)){isCellEdited()?(focusCellField("="),funcFocusFld=currFocusFld):(browser_safari||browser_opera||exprField.focus(),(exprField.value&&"="!=exprField.value.charAt(0)||!exprField.value)&&(exprField.value="="),currCell&&setCellContent(currCell,"="),isEditingInExprField&&setCellContent(cellField,"="),(browser_safari||browser_opera)&&setCaretPos(exprField,1),funcFocusFld=exprField);var e=currRow,t=currCol,l={width:350,title:jsMsg.InsertFunction,close:function(){RangeSelector.goNormal(),setTimeout(function(){RangeSelector.off();var l=currRow===e&&currCol===t;closeFunctionDialog(l)},100)}};sheetdialog.open("functionsdialog",l,{init:function(){fetchFunctions(),setTimeout(function(){setCaretPos(exprField,exprField.value.length),$("#Tv").focus(),appEvent.trigger("formula.insertFunction",["Tv",!0])},200)}}),isFuncDlgOpen=!0}}function hoverFunc(e){"undefined"==typeof prevFuncRow?prevFuncRow=e:prevFuncRow.className="",e.className="hover",prevFuncRow=e}function houtFunc(e){e.className=""}function deSelectFunc(){getObj("funcSyntax").innerHTML=""}function selectFunc(e){getObj("funcSyntax").innerHTML=e.getAttribute("funcSyntax");e.innerHTML}function insertFunc(e){var t;if(isCellEdited()&&0==cellField.value.indexOf("=")){var l=e.getAttribute("funcName")+"()",r=insertText(cellField,l);t=cellField;var n=r+(l.length-1);tempPos=n,exprField.value=cellField.value;var a="setCaretPos(cellField, "+n+")";setTimeout(a,1),setCellFieldWidth()}else{funcFocusFld==cellField&&isCellFieldSPANHided()&&(funcFocusFld=exprField);var l=e.getAttribute("funcName")+"()",r=insertText(exprField,l);t=exprField,exprFieldKeyPressed=!0,isEditingInExprField=!0;var n=r+(l.length-1);tempPos=n,currCell&&setCellContent(currCell,exprField.value),isCellFieldSPANHided()||setCellContent(cellField,exprField.value),setTimeout(function(){setCaretPos(exprField,n),cellField.value=exprField.value},1)}appEvent.trigger("formula.insertFunction",[t.id,!0]),resetFillRanges()}function submitComputeSum(){if(isCellRange()){var e=!1,t=(getAvailableStartRow(),getAvailableEndRow(),getCellRange()),l=ActionConstants.COMPUTE_SUM;if(t.startRow==t.endRow&&t.startCol!=t.endCol){e=!0;var r=t.endCol,n=t.endRow;for(col=r+1;totCols>=col;col++){if(col>totCols-1&&(insertCol("append",totCols,1,!1,!0,!1),col>=getColMax()))return;var a=getCell(n,col);if("null"==getCellContentWOF(a)||"NULL"==getCellContentWOF(a)||(""==a.getAttribute("fn")||null==a.getAttribute("fn"))&&""==a.getAttribute("cv")){r=col;break}}l=ActionConstants.COMPUTE_SUM_C}var o=getServerRange(t.startRow,t.startCol,t.endRow,t.endCol),u=new RequestParameters(l);u.setParameters(WorkSheets.getAssociatedActiveSheetName(),n,r,t.startRow,t.startCol,o.endRow,o.endCol,"SUM");var i=new AjaxRequest;i.init("POST",u.getURL(),!0,u.getParametersAsString()),actionManager.addRequest(i)}else initAutoSum()}function submitCellValueChangeFormat(e,t,l,r){var n=getCellRange();if(!ProtectedRanges.isRangeLocked(n.startRow,n.startCol,n.endRow,n.endCol)){var a=decodeURIComponent(t),o=new RequestParameters(1*e),u=getServerRange(n.startRow,n.startCol,n.endRow,n.endCol);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),n.startRow,n.startCol,u.endRow,u.endCol,r,a);var i=new AjaxRequest;i.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(i),sheetdialog.close()}}function submit_Inc_Dec_Decimal_And_Comma(e){var t=getCellRange();if(ProtectedRanges.isRangeLocked(t.startRow,t.startCol,t.endRow,t.endCol))return void(1*e===170&&ProtectedRanges.resetMenuItem("#comma"));var l=new RequestParameters(1*e),r=getServerRange(t.startRow,t.startCol,t.endRow,t.endCol);l.setParameters(WorkSheets.getAssociatedActiveSheetName(),t.startRow,t.startCol,r.endRow,r.endCol);var n=new AjaxRequest;n.init("POST",l.getURL(),!0,l.getParametersAsString()),actionManager.addRequest(n)}function fetchFunctions(){var e=new RequestParameters(ActionConstants.JSP_FUNCTIONSLIST);e.setParameters(getViewType(),docLocale);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){getObj("tmpFunctionsList").innerHTML=e.responseText,fetchFunFlag=1;var t=getObj("funcType");null!=t&&null!=getObj(t.value)&&(getObj("funcList").innerHTML=getObj(t.value).innerHTML)}),t.sendRequest()}function submitCellValueFormat(e,t,l,r,n,a){var o=new RequestParameters(e);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),l,r,n,a,t);var u=new AjaxRequest;u.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(u)}function closeFunctionDialog(e){e&&(""!=exprField.value&&"="!=exprField.value?(focusCellField(exprField.value),submitCell(),resetCellRangeFill("functions")):(setCellContent(currCell,currCellValue),exprField.value=currCellValue,cellField.value=currCellValue,currCellFormula&&currCellValue!=currCellFormula&&(currCell.setAttribute("fn",currCellFormula),exprField.value=currCellFormula),resetCellRangeFill("escapefromfunc"),exprField.blur(),formulaCell=!1,isExprFunc=!1)),isFuncDlgOpen=!1,focusActiveElement()}function initAutoSum(){if(currRow<getAvailableStartRow()&&currRow<getAvailableEndRow())return calcAutoSumCellRange("",currRow,currCol,currRow,currCol),!1;if(currRow>getAvailableStartRow()&&currRow>getAvailableEndRow())return calcAutoSumCellRange("",currRow,currCol,currRow,currCol),!1;var e=ActiveCellInfo,t=e.getStartRow(),l=e.getStartCol();if(0==t&&0==l)return autoSumRes(),!1;if(0==t&&0!=l)return autoSumCalc("colWise",t,l),!1;if(0!=t&&0==l)return autoSumCalc("rowWise",t,l),!1;var r=!1,n=!1,a=getCell(t,l-1,void 0,!0),o=getCell(t-1,l,void 0,!0),u="",i="";if(null!=a&&(u=getCellContentWOF(a)),null!=o&&(i=getCellContentWOF(o)),(null==u||""==u||isNaN(u))&&(null==i||""==i||isNaN(i))){for(var s=t-1;s>=0;s--){var c=getCell(s,l,void 0,!0);if(null!=c){var d=getCellContentWOF(c);if(!isNaN(d)&&null!=d&&""!=d){n=!0;break}}}if(!n)for(var s=l-1;s>=0;s--){var c=getCell(t,s,void 0,!0);if(null!=c){var d=getCellContentWOF(c);if(!isNaN(d)&&null!=d&&""!=d){r=!0;break}}}return n?(autoSumCalc("rowWise",t,l),!1):r?(autoSumCalc("colWise",t,l),!1):(autoSumRes(),!1)}if(null!=a&&null!=u&&""!=u){var C=getCellContentWOF(a);null==C||""==C||isNaN(C)||(r=!0)}if(null!=o&&null!=i&&""!=i){var g=getCellContentWOF(o);null==g||""==g||isNaN(g)||(n=!0)}else r=!0;return r&&!n?(autoSumCalc("colWise",t,l),!1):(autoSumCalc("rowWise",t,l),!1)}function autoSumCalc(e,t,l){var r=null,n=null,a=!1,o="",u="",i="",s="",c="",d="";if("rowWise"==e)var C=t;if("colWise"==e)var C=l;for(var g=C-1;g>=0;g--){if("rowWise"==e){var R=getCell(g,l,void 0,!0);if(null==R)continue;var v=getCellContentWOF(R);c=Merge.getCellInfo(g,l),c&&(a&&!isNaN(v)&&""!=v||!a)&&(""==o&&(o=c.startCol),""==u&&(u=c.endCol),c.startCol<o&&(o=c.startCol),c.endCol>u&&(u=c.endCol))}if("colWise"==e){var R=getCell(t,g,void 0,!0);if(null==R)continue;var v=getCellContentWOF(R);c=Merge.getCellInfo(t,g),c&&(a&&!isNaN(v)&&""!=v||!a)&&(""==i&&(i=c.startRow),""==s&&(s=c.endRow),c.startRow<i&&(i=c.startRow),c.endRow>s&&(s=c.endRow))}if(a){if(isNaN(v)||null==v||""==v)break;if("rowWise"==e&&g==getAvailableStartRow()&&0!=g)return calcAutoSumCellRange("",currRow,currCol,currRow,currCol),!1;n=R,d=g}else isNaN(v)||null==v||""==v||(r=R,a=!0,d=g)}return null==r?(autoSumRes(),!1):(""==o&&""==u&&(o=l,u=l),""==i&&""==s&&(i=t,s=t),"rowWise"==e?autoSumRes(e,d,o,t-1,u):"colWise"==e&&autoSumRes(e,t,d,t,l-1),!1)}function autoSumRes(e,t,l,r,n){{var a="="+localizedFunctionName.SUM,o=docLocale.split("_");o[1]}"de"==userLangCode&&(jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW)&&(a="=SUMME("),Filter.hasFilteredCols()&&Row.hasHiddenRows()&&(a="=SUBTOTAL(109, ");var u=a;enableRangeSelector(cellField),u+=")",RangeSelector.setText(u,a.length,u.length-1),"undefined"!=typeof e&&setTimeout(function(){focusCellRangeFill(t,l,r,n)},50)}function calcAutoSumCellRange(e,t,l,r,n){var a=getServerRange(t,l,r,n),o=new RequestParameters(ActionConstants.ALT_EQUAL_RANGE);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),t,l,a.endRow,a.endCol);var u=new AjaxRequest;u.init("POST",o.getURL(),!0,o.getParametersAsString()),u.addEventListener("onComplete",function(t){var l=parseJSON(t.responseText),r=l.sr,n=l.sc,a=l.er,o=l.ec;a==currRow-1&&o==currCol||a==currRow&&o==currCol-1?autoSumRes(e,r,n,a,o):autoSumRes()}),u.sendRequest()}function recalculate(){if(READ_WRITE){var e=new RequestParameters(ActionConstants.RECALCULATE);e.setParameters(WorkSheets.getAssociatedActiveSheetName()),showProgressMessage(jsMsg.Recalculating);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t)}}var funcFocusFld="",currFocusFld="",isFuncDlgOpen=!1,currFunValue,prevFuncRow,fetchFunFlag=0;var Template=function(e){function t(){e("#templatesListId").empty()}function a(){var e=new RequestParameters(ActionConstants.GET_TEMPLATES);e.setParameters("modifydes","all");var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){n(parseJSON(e.responseText))}),t.sendRequest()}function n(a){var n=getObj("noTemplateDiv"),s=getObj("templateExistDiv");l=a.templateInfo,l?(n.style.display="none",s.style.display="",t(),e("#templatesListId").on("change",function(t){var a=t.target;e("#filenameFieldId2").val(e(a.options[a.selectedIndex]).text()).select()}),a.templateInfo.forEach(function(t){var a=e("<option>");a.attr("id",t.rid),a.text(t.dn).val(t.di).appendTo(getObj("templatesListId"))})):(n.style.display="",s.style.display="none"),positionDialog()}function s(){var e=getObj("filenameFieldId2"),t=getObj("templatesListId");if(""==e.value||-1==t.options.selectedIndex)return showAlertDialog(jsMsg.SelectTemplateToCreateDocument),!1;var a=t.options[t.options.selectedIndex].id,n=e.value.trim();if(n){n=encodeURIComponent(n);var s=new RequestParameters(ActionConstants.NEW_SPREADSHEET_FROM_TEMPLATE);s.setParameters(n);var i=new AjaxRequest;return i.init("POST",ctxpath+docCtxPath+a,!0,s.getParametersAsString()),i.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);loadDocument(t.di)}),i.sendRequest(),!1}}function i(){var t=getObj("saveAsTemplateMenuFileName"),a=t.value;if(a=a.trim(),""===a)return showAlertDialog(jsMsg["InvalidMsg.TemplateName"]),void t.focus();var n=getObj("loading");null!==n&&(e("#loading").addClass("updatingmsg"),showPrevMessage&&(PREVIOUS_MESSAGE=n.innerHTML)),sheetdialog.close(),showProgressMessage();var s=new RequestParameters(ActionConstants.SAVEAS_NEW_TEMPLATE);s.setParameters(encodeURIComponent(a));var i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);loadDocument(t.di)}),i.sendRequest()}function o(){var e={modal:!0,width:285,title:jsMsg.SystemTemplatesTitle};sheetdialog.open("templatedialog",e,{init:function(){a()}})}function r(){l?s():createNewDocument("template",getObj("filenameFieldId1").value),sheetdialog.close()}var l;return{saveAsTemplate:i,saveAsSpreadsheet:o,UIHandler:r}}(jQuery);function showSheetComments(){var e=new RequestParameters(ActionConstants.DOC_COMMENT),t=(e.getURL()+"?"+e.getParametersAsString(),new AjaxRequest);t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){e.responseText&&$("#commentContainer").html(e.responseText)}),t.sendRequest()}function handleDocCommentActions(e){var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(){showSheetComments()}),t.sendRequest()}function doc_comment_call(e,t){var n=opener||parent,s=new n.RequestParameters(n.ActionConstants.DOC_COMMENT_SAVE);s.setParameters(e,null,t),handleDocCommentActions(s,t)}commentCnt=0;var ImageDialog=function(e){var t=!1,o=!1,n=function(){t=(jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW)&&-1==zuid?!0:!1;var n=(jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW)&&-1==zuid||disableGadgets?!1:!0,i={insertFrom:"Upload",isRemoteMode:t,fcGadgetsUrl:gadgetUrl,enableGadgets:n};if(i.noOfImagesToBeSelected=o?50:1,t){var r=new RequestParameters(ActionConstants.IMAGE_UPLOAD);i.uploadURL=r.getURL()+"?"+r.getParametersAsString()}var s={contextPath:"/sheet/fcomponents/",service:"ST",csrfParamName:"zsreqcsr",csrfCookieName:"zscookcsr"};-1==zuid&&FComponents.init(s),FComponents.option("contextPath","/sheet/fcomponents/"),FCImageLibrary.open(i),e("#imagelibrary").on("imageinsert",function(e,t){a(t)})},a=function(e){var o=!1,n="",a="",s=!1,c=!1,g="",I="",l=ActiveCellInfo,d=l.getStartRow(),E=l.getStartCol();if("undefined"==typeof h&&null==h)var h=getColLeft(E);if("undefined"==typeof M&&null==M)var M=getRowTop(d);var u=findColInXPos(h+1),f=findRowInYPos(M+1);if(n=M-getRowTop(f),a=h-getColLeft(u),e){var m=e.info[0],A=["IMAGE_EXTENSION","IMAGE_NAME","IMAGE_HEIGHT","IMAGE_WIDTH","AUTHOR_ID","RESOURCE_ID","IMAGE_URL","IMAGE_ID"],C={};A.forEach(function(e){m[e]&&(C[e]=encodeURIComponent(m[e]))}),e.isInsertFromWeb&&(o=!0),c="Library"===e.insertFrom?!0:!1,s=c||t?!0:!1;var T=Math.round(sheetWidth/1.3),v=Math.round(sheetHeight/1.3),R=250,_=400,G=!1;g=m.IMAGE_WIDTH,I=m.IMAGE_HEIGHT,m.IMAGE_WIDTH&&(G=m.IMAGE_WIDTH>T?!0:!1,G||(G=m.IMAGE_HEIGHT>v?!0:!1)),G&&(g=Math.round(i(m.IMAGE_WIDTH,m.IMAGE_HEIGHT,T,v).width),I=Math.round(i(m.IMAGE_WIDTH,m.IMAGE_HEIGHT,T,v).height),(_>g||R>I)&&(g=Math.round(r(g,I,_,R).width),I=Math.round(r(g,I,_,R).height)));var S=getColLeft(totCols-1)+getColWidth(totCols-1),p=h+parseInt(g);if(p>S){var H=p-S,w=h-H,D=findColInXPos(w)-1;h=getColLeft(D)+getColWidth(D),u=D,a=h-getColLeft(u)}isCellinView(currRow,currCol)||(M=Math.round(sheetHeight/2-I/2+getSheetScrollTop()),h=Math.round(sheetWidth/2-g/2+getSheetScrollLeft()),u=findColInXPos(h),f=findRowInYPos(M),n=M-getRowTop(f),a=h-getColLeft(u));var L={row:f,column:u,sRowDiff:n,sColDiff:a,resId:C.RESOURCE_ID,imgId:C.IMAGE_ID,imgNm:C.IMAGE_NAME,isRemoteMode:t,insertFromLib:c};C.IMAGE_URL&&o&&(L.imgurl=C.IMAGE_URL),""!=g&&(L.imgWd=g),""!=I&&(L.imgHt=I);var W=[L],P=new RequestParameters(ActionConstants.IMAGE_NEW);P.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(W));var y=new AjaxRequest;y.init("POST",P.getURL(),!0,P.getParametersAsString()),y.addEventListener("onComplete",function(){FCImageLibrary.close()}),y.sendRequest()}},i=function(e,t,o,n){var a=Math.min(o/e,n/t);return{width:e*a,height:t*a}},r=function(e,t,o,n){var a=Math.max(o/e,n/t);return{width:e*a,height:t*a}},s=function(){e("#SaveToMyAccountforImageandChartDlgMsg").html(jsMsg["Publish.SaveToMyAccount"]);var t={width:"450px",modal:!0,title:jsMsg.SaveToMyAccount,closeOnEscape:!1,close:function(){return!1},buttons:[{text:jsMsg.SaveToMyAccount,click:function(){sheetdialog.close(),saveToMyAccount.getDetails()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]},o="";o=e("#SaveToMyAccforImageandChartContainer").html(),sheetdialog.open(o,t)};return{showImageDialog:n,InsertImageSaveToMyAccountDialog:s}}(jQuery);function _getDate(e){var t=$("#"+e),i=t.val().split(userDateSeparator),a=null;return"MDY"===userDateFormatType&&(a=i[0]+"/"+i[1]+"/"+i[2]),"DMY"===userDateFormatType&&(a=i[1]+"/"+i[0]+"/"+i[2]),"YMD"===userDateFormatType&&(a=i[1]+"/"+i[2]+"/"+i[0]),a}var AuditTrail=function(e,t){function i(e){for(var t=new Array,i=e.split("#L"),a=0;a<i.length;a++){var n=i[a];if(-1!=n.indexOf("#CL")){var r=n.split("#CL");isUndefined(r[1])||""==r[1]||t.push(r[1])}else t.push(n)}return t}function a(){"0"!=DOCUMENT_VERSION&&""!=DOCUMENT_VERSION?(t("#revertButton").is(":disabled")&&t("#revertButton").enable(!0),t("#deleteButton").is(":disabled")&&t("#deleteButton").enable(!0),t("#markVersion").is(":disabled")&&t("#markVersion").enable(!0),t(AuditTrail.clickedElement).find(".versionDetails").show()):(t("#revertButton").disable(),t("#deleteButton").disable(),t("#markVersion").disable())}function n(){t("#versionToolbarDiv").css("width",clientDim.width),t("#userStatusDiv").hide(),resetHScrollDim("DOCPANEL_OPEN"),getObj("docPanel").style.display="",getObj("docPanelFrame").style.display="",docPanel.setDocPanelDim(),resetWorkSheetDim(),resetSheetsTabDim(),appEvent.trigger("postVersionView"),t("#commentContainer").hide(),t("#chatContainer").hide(),t("#notifier").is(":visible")&&t("#notifier").hide(),lt=dt=0,t("#versionPanel").attr("style","width:330px;"),getObj("versionPanel").innerHTML="",t("#fCROD").removeAttr("style");var e=document.createDocumentFragment(),i=t("<div/>",{class:"versionHistory"}),a=t("<div/>",{class:"versionsHead"}),n=t("<div/>",{style:"float:left;font-weight:bold;"}).text(jsMsg["AT.VersionHistory"]),s=t("<div/>",{id:"filterVersionHistory",class:"atSettingBG"});s.click(function(){AuditTrail.showMarkMenu()});var o=t("<div/>",{class:"atSetting"});t(o).appendTo(s),n.appendTo(a),s.appendTo(a);var l=t("<div/>",{class:"versionHighlightChanges"});disableAuditTrailOption&&l.attr("style","display:none");var d=t("<input/>",{id:"highlightChanges",type:"checkbox",name:"highlightChanges",checked:!0,value:!0});d.change(function(){r()});var c=t("<label/>",{for:"highlightChanges"}).text(jsMsg["AT.Hightlights"]);d.appendTo(l),c.appendTo(l),a.appendTo(i),l.appendTo(i),e.appendChild(i[0]);var g=t("<div/>",{id:"headahead",style:"height: 306px; float: left; width: 100%; overflow-y: auto;overflow-x: hidden;"}),u=t("<div/>",{id:"loadingDiv",class:"loadingDiv",style:"display: none;"}).text(jsMsg.Loading+"..."),h=t("<div/>",{id:"versionItemsContainer",style:"position:relative;"});h.appendTo(g),e.appendChild(u[0]),e.appendChild(g[0]),getObj("versionPanel").appendChild(e),getObj("versionPanel").style.display=""}function r(){if(appEvent.trigger("PostVersionPaneLoad"),!disableAuditTrailOption)if(t("#highlightChanges").attr("checked"))if(t(".atD").length>0)t(".atD").each(function(){t(this).show()});else{var e=new RequestParameters(ActionConstants.HIGHLIGHT_VERSION_CHANGES);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var i=new AjaxRequest;i.init("POST",e.getURL(),!0,e.getParametersAsString()),i.addEventListener("onComplete",function(e){var t=e.responseText;t&&(AuditTrail.addToCellsJson(t),AuditTrail.showViewPortVersionChanges())}),i.sendRequest()}else t(".atD").each(function(){t(this).hide()})}function s(e,t,i,a,n,r){ole.removeAll(),appEvent.trigger("version.load"),AuditTrail.isCloseVersionHistory&&(jsVERSION_VIEW=!1,docPanel.close(),message(jsMsg.Loading,"none","...")),AuditTrail.highlightChanges=void 0,updateSheetObjects(e,t,i);var s=void 0;a&&(s=[a,n,r]),hideBannerMessage(),sheetTabBgColor.getSheetTabColors(),postSheetLoader(ActionConstants.POST_DOC_LOAD,s,AuditTrail.isCloseVersionHistory),appEvent.on("Audit.dismantleQueue",function(){ot&&ot.dismantle()}),appEvent.off("window.error",Tt),AuditTrail.isCloseVersionHistory=void 0,insertImage.loadSheetImages()}function o(){AuditTrail.scrollObject._$element.empty();var e=t("#highlightChanges").attr("checked")?!0:!1;AuditTrail.scrollObject=void 0,AuditTrail.showVersionHistory(),t("#highlightChanges").attr("checked",e),auditTrail.removeAll()}function l(e,i){stopEvt(i);var a=e.parentNode,n=t(a).find(".contn"),r=t(n).children();t(r).each(function(){t(this).toggleClass("hide")});var s=t(a).find(".versionAuthorsList"),o=t(s).find(".hide"),l=o.length;0==o.length?(o=t(s).find(".show"),t(o).each(function(){this.setAttribute("class","hide")})):t(o).each(function(){this.setAttribute("class","show")});var d=l?l:-1;AuditTrail.scrollObject._refreshTileForMoreIcon(20*d,t(e.parentElement.parentElement))}function d(){var e=t("[name=actionBy]:checked").attr("id"),i="";t("#actionListcontainer").html("");var a=document.getElementById("actionListcontainer");if(a.scrollTop=0,ct=gt=0,"byName"==e){if(0!=parseJSON(AuditTrail.filteredByName).length)return void m(AuditTrail.filteredByName);i=jsMsg["AT.Filter.Name"]}if("byDate"==e){if(0!=parseJSON(AuditTrail.filteredByDate).length)return void m(AuditTrail.filteredByDate);i=jsMsg["AT.NoEdits.Date"]}if("byRange"==e){if("undefined"!=typeof AuditTrail.filteredByRange&&0!=parseJSON(AuditTrail.filteredByRange).length)return void m(AuditTrail.filteredByRange);i=jsMsg["AT.Filter.Range"]}if("bySheet"==e){if(0!=parseJSON(AuditTrail.filteredBySheet).length)return void m(AuditTrail.filteredBySheet);i=jsMsg["AT.NoEdits.Sheet"]}AuditTrail.constructActionDetails("[]",i)}function c(e,i,a){if(!disableAuditTrailOption){a&&stopEvt(a);var n;i||(DOCUMENT_VERSION=e,n=jsVERSION_VIEW&&""==DOCUMENT_VERSION?!0:void 0);var r=new AjaxRequest,s=new RequestParameters(ActionConstants.JSP_VIEW_ACTIONLIST);s.setParameters(i,n),r.init("POST",s.getURL(),!0,s.getParametersAsString()),r.addEventListener("onComplete",function(e){if(sheetdialog.close(),i){jsVERSION_VIEW&&AuditTrail.isNamedVersionsOnly&&(AuditTrail.isNamedVersionsOnly=!1,AuditTrail.changeVariable(t("#versionMenu").zmenu().children()[0].id));var a={width:560,minHeight:100,title:jsMsg.AT,close:function(){ct=0,gt=0,AuditTrail.closeDialog(),g(),RangeSelector.off(),sheetdialog.allowToClose=!0}};sheetdialog.open(e.responseText,a),t("#filterVersionHistory").disable(!0),t("#filterVersionHistory").unbind("click")}else{var a={width:560,minHeight:100,modal:!1,title:""!=DOCUMENT_VERSION?jsMsg["AT.ChangeLog"]+" - "+jsMsg.version+" #"+parseFloat(DOCUMENT_VERSION):jsMsg["AT.ChangeLog"],close:function(){AuditTrail.closeDialog(),AuditTrail.isChangeLogDialogOpened=!1,RangeSelector.off()}};if(AuditTrail.isChangeLogDialogOpened)t("#ui-dialog-title-sheetdialog").text(""!=DOCUMENT_VERSION?jsMsg["AT.ChangeLog"]+" - "+jsMsg.version+" #"+parseFloat(DOCUMENT_VERSION):jsMsg["AT.ChangeLog"]),t("#actionListcontainer").html("");else{AuditTrail.isChangeLogDialogOpened=!0;var n=document.createDocumentFragment(),r=t("<div/>",{class:"usrActTbl",id:"actionListcontainer",style:"min-height:0px;"});n.appendChild(r[0]),sheetdialog.open("<div></div>",a);var s=sheetdialog.getDialogName();t("#"+s).append(n)}AuditTrail.constructActionDetails(e.responseText)}AuditTrail.isActionDetailOpen=!0,sheetdialog.allowToClose=!1,positionDialog()}),r.sendRequest()}}function g(){var e=new RequestParameters(ActionConstants.CLEAR_AUDITTRAIL_ACTIONLIST);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()}function u(){t("#filterVersionHistory").enable(!0),t("#filterVersionHistory").bind("click",AuditTrail.showMarkMenu),AuditTrail.focusVariable=0,delete AuditTrail.filteredByName,delete AuditTrail.filteredByDate,delete AuditTrail.filteredByRange,delete AuditTrail.filteredBySheet,delete AuditTrail.allActions,clearCellRangeFill(),t("#"+sheetdialog.getDialogName()).empty(),AuditTrail.isActionDetailOpen=!1}function h(e,t){0!=e.length&&(AuditTrail.hightlightVersion(e[0]),AuditTrail.viewVersion([e[0].getAttribute("ver"),e[0],t]))}function A(e,i,a,n){var r=[];if(r.push(i),r.push(a),r.push(n),!jsVERSION_VIEW)return void AuditTrail.showVersionHistory(e,r);if(DOCUMENT_VERSION!=e){var s=AuditTrail.scrollObject._binarySearchForVersion(parseFloat(e),0,AuditTrail.scrollObject._getScrollInfoArray().length);AuditTrail.scrollObject._appendSuitableTiles(s),AuditTrail.scrollObject._setScrollTop(AuditTrail.scrollObject._getScrollInfoArray()[s].h),AuditTrail.scrollObject._getScrollInfoArray()[s].v!==e&&(e=AuditTrail.scrollObject._getScrollInfoArray()[s].v),h(t(".versionItem[ver='"+e+"']"),r)}else AuditTrail.goToCellRef(i,a,n)}function T(e,t,i){if("undefined"!=typeof e){var a=CellUtils.getLabelsSplitFromRange(e),n=a[0],r=a[1];CellUtils.isCellLabel(n)||-1===e.indexOf(".")||(isNaN(parseInt(n))?(n+="1",r+="65536"):(n="A"+n,r="IV"+r),t=CellUtils.getCellPosByLabel(n).row,i=CellUtils.getCellPosByLabel(n).col,e=CellUtils.getSheetNameFromCelLbl(e)+"!"+n+":"+r),Goto.gotoCellInit(e),CellUtils.isDefinedSheet(CellUtils.getSheetNameFromCelLbl(e))&&moveDialogBox(t,i)}}function m(e,i){if(AuditTrail.currentViewingChangeLog=parseJSON(e),AuditTrail.currentViewingChangeLog.fnf){var a=document.createDocumentFragment();i=jsMsg["AT.ChangeLogNotSupport"];var n=t("<div/>",{class:"noAction"}).text(i);a.appendChild(n[0]),t("#actionListcontainer").append(a)}else if(AuditTrail.currentViewingChangeLog.length>0){var r=AuditTrail.currentViewingChangeLog.length>100?100:AuditTrail.currentViewingChangeLog.length-1;100==r&&(ct=0,gt=r),f(0,r)}else{var a=document.createDocumentFragment();i=i?i:jsMsg["AT.NoEdits.Version"];var n=t("<div/>",{class:"noAction"}).text(i);a.appendChild(n[0]),t("#actionListcontainer").append(a)}}function p(){var e=document.getElementById("actionListcontainer");if(!(e.scrollTop<e.scrollHeight-450)){if(AuditTrail.currentViewingChangeLog.length<=100||ct>=AuditTrail.currentViewingChangeLog.length){var t=document.getElementById("loadingMsg");return void(t.style.display="none")}var t=document.getElementById("loadingMsg");""!=t.style.display&&(t.style.display="",gt=ct+100,gt>=AuditTrail.currentViewingChangeLog.length&&(gt=AuditTrail.currentViewingChangeLog.length-1),v(e,ct,gt))}}function v(e,t,i){var a=e.scrollHeight;setTimeout(function(){f(t,i)},100),e.scrollTop=a}function f(e,a,n){for(var r=document.createDocumentFragment(),s=t("<div/>",{class:"chngLogVer"}),o=t("<span/>",{class:"userLegend"}),l=t("<span/>",{}),d=t("<span/>",{class:"actTime"}),c=t("<div/>",{class:"changeLog"}),g=t("<span/>",{class:"failedAction"}),u=e;a>=u;u++){var h=AuditTrail.currentViewingChangeLog[u][JSONConstants.USER_NAME],A=AuditTrail.currentViewingChangeLog[u][JSONConstants.COLOR_CODE],T=AuditTrail.currentViewingChangeLog[u][JSONConstants.TIME_STAMP],m=jsMsg[AuditTrail.currentViewingChangeLog[u][JSONConstants.MESSAGE]],p=AuditTrail.currentViewingChangeLog[u][JSONConstants.LINK_PARAM],v=AuditTrail.currentViewingChangeLog[u][JSONConstants.NO_LINK_PARAM],f=AuditTrail.currentViewingChangeLog[u][JSONConstants.VERSION],E=AuditTrail.currentViewingChangeLog[u][JSONConstants.IS_ROLL_BACK],C=AuditTrail.currentViewingChangeLog[u].undid,O=AuditTrail.currentViewingChangeLog[u].redid;(C||O)&&(m=C?jsMsg[C[JSONConstants.MESSAGE]]:jsMsg[O[JSONConstants.MESSAGE]],p=C?C[JSONConstants.LINK_PARAM]:O[JSONConstants.LINK_PARAM],v=C?C[JSONConstants.NO_LINK_PARAM]:O[JSONConstants.NO_LINK_PARAM]);var b=AuditTrail.currentViewingChangeLog[u][JSONConstants.DYNAMIC_MSG];b&&(m+=b);var D=i(m),S=s.clone(!0);u!=AuditTrail.currentViewingChangeLog.length-1||n||S.attr("style","border-bottom:none");var w=o.clone(!0).attr("style","background-color:#"+A);w.appendTo(S);var R=l.clone(!0).attr("title",h).text(h);R.appendTo(S);var N=d.clone(!0).text(" - "+T);if(N.appendTo(S),E){var V=g.clone(!0).text(" "+jsMsg["AT.Failed"]);V.appendTo(S)}for(var L=c.clone(!0),y=AuditTrail.currentViewingChangeLog[u][JSONConstants.SRC_DOC_PARAMS],M=0,I=D.length;I>M;M++){if(v)for(var _ in v)D[M]=D[M].replace("{"+_+"}",v[_]);var k=document.createTextNode(D[M]);if(t(k).appendTo(L),D[M].length>100&&(L.addClass("elipsis"),L.attr("title",D[M])),0!=p.length&&p.length>M){null==p[M]&&(p[M]=p[M]+"");var j=CellUtils.getLabelsSplitFromRange(p[M]),P=CellUtils.getCellPosByLabel(j[0]),B=CellUtils.getCellPosByLabel(j[1]?j[1]:j[0]);-1==p[M].indexOf(".")&&(P=void 0,B=void 0);var x=P&&-1!=P.row?P.row:0,F=B&&-1!=B.col?B.col:0,U="";AuditTrail.isChangeLogDialogOpened||(U=""===f?jsMsg["AT.GotoCellCurrentVersion"].replace("{0}",p[M]):jsMsg["AT.GotoCell"].replace("{0}",p[M]).replace("{1}",parseFloat(f)));var H=t("<a/>",{class:"link",title:U,onclick:"AuditTrail.goToChange('"+f+"','"+p[M]+"','"+x+"','"+F+"')"}).text(p[M]);if(cdview&&(H=t("<span/>",{text:p[M]})),v[JSONConstants.SOURCE_RID]&&0==M&&-1!==p[M].indexOf(":")){var W=window.location.origin+window.location.pathname+"?rid="+v[JSONConstants.SOURCE_RID];H=t("<a/>",{class:"link",href:W,target:"_blank"}).text(p[M])}H.appendTo(L)}}if(!isUndefined(y)){var W=window.location.origin+"/sheet/open/"+y[JSONConstants.SOURCE_RID],H=t("<a/>",{class:"link",href:W,target:"_blank"}).text(y[JSONConstants.SOURCE_DOCNAME]);H.appendTo(L)}if(C||O){var q=document.createTextNode(jsMsg[AuditTrail.currentViewingChangeLog[u][JSONConstants.MESSAGE]]+" - ");t(q).prependTo(L)}L.appendTo(S),r.appendChild(S[0])}if(n?t("#actionStreamContiner").append(r):t("#actionListcontainer").append(r),!AuditTrail.isChangeLogDialogOpened){ct=gt+1;var J=document.getElementById("loadingMsg");J&&(J.style.display="none")}}function E(e){if(!disableAuditTrailOption){var i=JSON.parse(e);auditTrail.rangeJson=i.vc,AuditTrail.sheetCallOuts=i.sco,Object.keys(AuditTrail.sheetCallOuts).forEach(function(e){var i=WorkSheets.getSheetObjByName(e);if(void 0!=i){var a=i.children();0!=a.find(".versionSheetCallOut").length&&a[0].removeChild(a.find(".versionSheetCallOut")[0]);var n=AuditTrail.sheetCallOuts[e]>1?jsMsg.edits:jsMsg.edit,r=replaceParams(jsMsg["AT.sheetTabCallOutMsg"],new Array(AuditTrail.sheetCallOuts[e],n)),s=t("<span/>",{title:r,class:"versionSheetCallOut"}).text(AuditTrail.sheetCallOuts[e]);s.appendTo(a)}})}}function C(){function e(e,t){var i={vcID:o.sn+"_"+e+"_"+t,dname:o.un,sheetName:o.sn,row:e,col:t,colorCode:o.cc};auditTrail.show(i,!0)}if(!disableAuditTrailOption&&t("#highlightChanges").attr("checked")){auditTrail.removeAll();for(var i=getAvailableStartRow(),a=getAvailableStartCol(),n=getAvailableEndRow(),r=getAvailableEndCol(),s=0;s<auditTrail.rangeJson.length;s++){var o=auditTrail.rangeJson[s],l=Merge.getCellInfo(o.sr,o.sc);if(l){var d=Merge.getIterator(o.sr,o.sc,o.er,o.ec);d.iterate(e)}else for(var c=o.sr<i?i:o.sr,g=o.sc<a?a:o.sc,u=o.er>n?n:o.er,h=o.ec>r?r:o.ec,A=c;u>=A;A++)for(var T=g;h>=T;T++)e(A,T)}}}function O(){AuditTrail.isActionDetailOpen||sheetdialog.close(),initVersionToolbar(),t("#versionToolbarDiv").show(),t("#versionview").show(),t("#mainOuterDiv").hide(),t("#fSC").css("cursor","default"),t("#auditTrailIcon").enable("true"),t(".add_sheet").hide(),removeSheetContextMenu(),ole.removeAll(),READ_WRITE=!1,ALLOW_TO_WRITE=!1,jsVERSION_VIEW=!0,userPresence.removeAll(),appEvent.trigger("initVersionView")}function b(e,i){if(t("#fileName").zfilefield("disable"),ALL_SHEET_SHARED){if(RTLlang){var a=document.getElementById("revisionDetails").style;a.right="",a.left="0px",a.float="left"}0==documentBakeStatus.objectBaked&&(errorMsgShown=restrictScroll=!1),isCellEdited()&&submitCell(),focusRemembering.setWorkbookData(),workbookData.ascSheetName=WorkSheets.getAssociatedActiveSheetName(),message(jsMsg.Loading,"block","..."),At||initVersionToolbar(),O(),t("#revertButton").disable(),t("#deleteButton").disable(),t("#markVersion").disable(),n(),DOCUMENT_VERSION="",insertImage.loadSheetImages();var s=t("#headahead").lazyLoadOnScroll({},function(){AuditTrail.scrollObject=t.data(s,"lazyLoadOnScroll"),message(jsMsg.Loading,"none","..."),responseManager.clearSyncCheckTimer(),D(!1),chartPreview.setChartCustomizationPermission(!1);var a=AuditTrail.scrollObject._getVersionInfoArray();if(a.length){if(AuditTrail.clickedElement=AuditTrail.scrollObject._$element.children().first().children()[0],DOCUMENT_VERSION=AuditTrail.clickedElement.getAttribute("ver"),AuditTrail.setViewingVersionDetails(AuditTrail.clickedElement),AuditTrail.setVersionDialogHeight(),r(),0==documentBakeStatus.objectBaked&&(t("#auditTrailIcon").disable("true"),AuditTrail.viewVersion([AuditTrail.clickedElement.getAttribute("ver"),AuditTrail.clickedElement]),setTimeout(function(){hideBannerMessage()},100)),e)if(DOCUMENT_VERSION!=e){var n=AuditTrail.scrollObject._binarySearchForVersion(parseFloat(e),0,AuditTrail.scrollObject._getScrollInfoArray().length);AuditTrail.scrollObject._appendSuitableTiles(n),AuditTrail.scrollObject._setScrollTop(AuditTrail.scrollObject._getScrollInfoArray()[n].h);var o=t(".versionItem[ver='"+e+"']");h(o,i)}else AuditTrail.goToCellRef(i[0],i[1],i[2])}else AuditTrail.showNoVersionMessage()})}appEvent.trigger("menutabListener",["versionview"])}function D(e){ole&&(ole.setObjectProperties("button",{permissions:{isDraggable:e,isResizable:e,isEditable:e}}),ole.setObjectProperties("chart",{permissions:{isDraggable:e,isResizable:e,isEditable:e}}),ole.setObjectProperties("img",{permissions:{isDraggable:e,isResizable:e,isEditable:e}}))}function S(e){var i="";if(e){var n=0!=e.getAttribute("ver")?jsMsg.version+": #"+parseFloat(e.getAttribute("ver")):"",r=""!=n?" - "+e.firstElementChild.firstChild.textContent:e.firstElementChild.firstChild.textContent;i=document.createTextNode(r),a(),t(e).css("background-color","#F0F0F0"),t(e).unbind("mouseover"),t(e).unbind("mouseout"),t(e).find(".versionDetails").show()}else if(""!=DOCUMENT_VERSION){n=jsMsg.version+": #"+parseFloat(DOCUMENT_VERSION);var s=AuditTrail.scrollObject._binarySearchForVersion(DOCUMENT_VERSION,0,AuditTrail.scrollObject._getScrollInfoArray().length),o=" - "+AuditTrail.scrollObject._getVersionInfoArray()[s].ts;i=document.createTextNode(o)}t("#versionTime").html("");var l=t("<span/>",{id:"version",style:"font-weight:bold"}).text(n);t(l).appendTo(t("#versionTime")),t(i).appendTo(t("#versionTime"))}function w(e){var i=t("<p/>",{class:"descriptionStamp"}),a=t("<label/>",{style:"float:left;"});a.html(jsMsg["AT.Description"]+": &nbsp;");var n=t("<span/>",{class:"overflowEllipsis",style:"display: block; width:67%;",title:e}).text(e);return a.appendTo(i),n.appendTo(i),i[0]}function R(){var e=findClientDim().height-(t(".versionHistory").offset().top+t(".versionHistory").outerHeight()+t("#wmstoolbar").outerHeight()+ssBottomPanel.offsetHeight+t(".bottomBand").height());t("#headahead").height(e+"px")}function N(e){e&&(""!=AuditTrail.clickedElement&&(t(AuditTrail.clickedElement).find(".versionDetails").hide(),t(AuditTrail.clickedElement).removeAttr("style")),t(e).css("background-color","#F0F0F0"),AuditTrail.clickedElement=e,t(AuditTrail.clickedElement).unbind("mouseover"),t(AuditTrail.clickedElement).unbind("mouseout"),t(AuditTrail.clickedElement).find(".versionDetails").show())}function V(e){if(appEvent.on("window.error",Tt),"object"==typeof e[0])var i=e[0][0],n=e[0][1],r=e[0][2];else var i=e[0],n=e[1],r=e[2];if(DOCUMENT_VERSION===i&&""!==DOCUMENT_VERSION)return void(r&&AuditTrail.goToCellRef(r[0],r[1],r[2]));!AuditTrail.isActionDetailOpen||AuditTrail.isChangeLogDialogOpened||r||(AuditTrail.closeDialog(),sheetdialog.close()),AuditTrail.isChangeLogDialogOpened&&AuditTrail.showActionDetails(i,!1),AuditTrail.sheetCallOuts={},a(),this.highlightChanges=t("#highlightChanges").attr("checked")?!0:!1,DOCUMENT_VERSION=i;var s={};if(s.onAfterComplete={},s.isExecuteActionIdNeeded=!0,s.isXaidToBeAppended=!0,r&&(s.onAfterComplete.params=r),s.onAfterComplete.method=this.postVersionLoader,r)var o=r[1];insertImage.loadSheetImages(),reloadPage(null,!0,s,o,!0);var l={ctx:AuditTrail,nameSpace:"viewVersion",dismantleTimeout:5e3,iterateKeys:!1};ot=TransientImpostor(l,[i,n,r]),AuditTrail.setViewingVersionDetails(n),appEvent.trigger("PostVersionLoad")}function L(){t("#fileName").zfilefield("enable"),message(jsMsg.Loading,"block","..."),auditTrail.removeAll(),D(!0),chartPreview.setChartCustomizationPermission(!0),ht="",delete AuditTrail.clickedElement,AuditTrail.sheetCallOuts={},AuditTrail.closeDialog(),sheetdialog.close(),AuditTrail.isNamedVersionsOnly=!1,getObj("versionPanel").innerHTML="",DOCUMENT_VERSION="",t("#mainOuterDiv").show(),t("#versionToolbarDiv").hide(),t(".add_sheet").show(),t("#topBand").is(":visible")||t("#topBand").show(),t(".versionHighlightChanges").enable("true"),t("#fSC").css("cursor","crosshair"),responseManager.reInvokeSyncCheckTimer(),WMSResponseProcessor.handleServerUp(),READ_WRITE=!0,ALLOW_TO_WRITE=!0,this.isCloseVersionHistory=!0;var e={};e.onAfterComplete={},e.isExecuteActionIdNeeded=!0,e.isXaidToBeAppended=!0,e.onAfterComplete.method=this.postVersionLoader,e.onFailure={method:function(){jsVERSION_VIEW=!1,docPanel.close(),message(jsMsg.Loading,"none","...")}},CURRSHEETNAME=workbookData.preSheetName,sheetTabBgColor.clearTabColors(),isRespondedInScroll=!1,setScrollTop(getRowTop(workbookData.posBtm)),setScrollLeft(getColLeft(workbookData.posLft)),isRespondedInScroll=!0;var i=getRowTop(workbookData.posBtm),a=findRowInYPos(i-extraViewPorts*sheetHeight,!0,!0),n=findRowInYPos(i+(extraViewPorts+1)*sheetHeight,!0,!0);submitScrollForm(getNonHiddenRowsInPage(a,n-1),"SCROLLDOWN","true",!0,e),focusCellRange(workbookData.preActiveRow,workbookData.preActiveCol,workbookData.endRow,workbookData.endCol,null,!0);var r=t("#docPanel").find("tr")[0];t(r).removeAttr("style"),AuditTrail.versionDetailsList=void 0,AuditTrail.markedVersions=void 0,AuditTrail.scrollObject._removeTopDiv(),AuditTrail.scrollObject._$element.empty(),AuditTrail.scrollObject=void 0,"ON"==COLLABORATIVE_EDITING&&t("#userStatusDiv").show(),Discussion.toggle(),Annot.setNoteView()}function y(){t("#"+sheetdialog.getDialogName()).parent().animate({width:"570px"});var e=t("[name=actionBy]")[0];t(e).attr("checked",!0),d(),t(".actDtl").children()[0].setAttribute("class","show"),t(".actDtl").children()[1].removeAttribute("style"),t(".actDtl").children()[1].setAttribute("class","divTableRow hide"),t(".actDtl").children()[2].setAttribute("class","divTableRow hide"),t(".actDtl").children()[3].setAttribute("class","divTableRow hide"),AuditTrail.focusVariable=0,G(),RangeSelector.off()}function M(){t("#"+sheetdialog.getDialogName()).parent().animate(I(t("#date").val())?{width:"620px"}:{width:"570px"});var e=t("[name=actionBy]")[1];t(e).attr("checked",!0),d(),t(".actDtl").children()[0].setAttribute("class","hide"),t(".actDtl").children()[1].removeAttribute("style"),t(".actDtl").children()[1].setAttribute("class","divTableRow show"),t(".actDtl").children()[2].setAttribute("class","divTableRow hide"),t(".actDtl").children()[3].setAttribute("class","divTableRow hide"),AuditTrail.focusVariable=0,G(),RangeSelector.off()}function I(e){return e==ConditionalFormatOperator.EQUAL||e==ConditionalFormatOperator.LESS_THAN||e==ConditionalFormatOperator.GREATER_THAN||e==ConditionalFormatOperator.BETWEEN||e==ConditionalFormatOperator.NOT_BETWEEN}function _(){t("#"+sheetdialog.getDialogName()).parent().animate({width:"570px"});var e=t("[name=actionBy]")[2];t(e).attr("checked",!0),d(),t(".actDtl").children()[0].setAttribute("class","hide"),t(".actDtl").children()[2].removeAttribute("style"),t(".actDtl").children()[1].setAttribute("class","divTableRow hide"),t(".actDtl").children()[2].setAttribute("class","divTableRow show"),t(".actDtl").children()[3].setAttribute("class","divTableRow hide"),AuditTrail.focusVariable=0,G(),RangeSelector.off()}function k(){t("#"+sheetdialog.getDialogName()).parent().animate({width:"570px"});var e=t("[name=actionBy]")[3];t(e).attr("checked",!0),d(),t(".actDtl").children()[0].setAttribute("class","hide"),t(".actDtl").children()[1].removeAttribute("style"),t(".actDtl").children()[1].setAttribute("class","divTableRow hide"),t(".actDtl").children()[2].setAttribute("class","divTableRow hide"),t(".actDtl").children()[3].setAttribute("class","divTableRow show"),t("#auditRangeSelection").focus(function(){var e=this;RangeSelector.on({el:e,appendSheetName:!0,isAbsoluteRef:!0,callback:function(e){AuditTrail.filterByRange(e)}})}),t("#auditRangeSelection").focus()}function j(){AuditTrail.openmessage=t("#openmessage"),AuditTrail.openmessage.addClass("openmessage"),AuditTrail.openmessage.removeAttr("id"),t("#actionListcontainer").is(":visible")&&AuditTrail.openmessage[0]&&(AuditTrail.openmessage.css("top",t("#"+sheetdialog.getDialogName()).offset().top+170),AuditTrail.openmessage.css("left",t("#"+sheetdialog.getDialogName()).offset().left+235),AuditTrail.openmessage[0].style.display="block")}function P(){AuditTrail.openmessage=t(".openmessage"),AuditTrail.openmessage[0]&&(AuditTrail.openmessage[0].style.display="none"),AuditTrail.openmessage.attr("id","openmessage"),AuditTrail.openmessage.removeAttr("class")}function B(){var e=t("#user").zcombo("getSelectedOption");if("selectAll"==t(e).val())return AuditTrail.filteredByName=AuditTrail.capturedActionList,t("#actionListcontainer").html(""),void m(AuditTrail.capturedActionList);t("#actionListcontainer").slideUp(),j();var i=new RequestParameters(ActionConstants.AUDIT_FILTER_BY_NAME);i.setParameters(t(e).val());var a=new AjaxRequest;a.init("POST",i.getURL(),!0,i.getParametersAsString()),a.addEventListener("onComplete",function(i){P(),t("#actionListcontainer").html("");var a=t(e).attr("un")+" "+jsMsg["AT.NoEdits.User"];AuditTrail.constructActionDetails(i.responseText,a),AuditTrail.filteredByName=i.responseText,t("#actionListcontainer").slideDown()}),a.addEventListener("onError",function(){P(),t("#actionListcontainer").slideDown(),showAlertDialog(jsMsg.ErrorOccurred)}),a.sendRequest()}function x(){var e=t("#date").val();if("all"==e)return AuditTrail.filteredByDate=AuditTrail.capturedActionList,t("#actionListcontainer").html(""),void m(AuditTrail.capturedActionList);t("#actionListcontainer").slideUp(),j();var i=new RequestParameters(ActionConstants.AUDIT_FILTER_BY_DATE);if(e==ConditionalFormatOperator.LESS_THAN||e==ConditionalFormatOperator.GREATER_THAN||e==ConditionalFormatOperator.EQUAL){if(""==t("#dateText1").val())return showAlertDialog(jsMsg["AT.Alert.Date"]),P(),void t("#actionListcontainer").slideDown();i.setParameters(e,_getDate("dateText1"))}else if(e==ConditionalFormatOperator.BETWEEN||e==ConditionalFormatOperator.NOT_BETWEEN){if(""==t("#dateText2").val()||""==t("#dateText3").val())return showAlertDialog(jsMsg["AT.Alert.Date"]),P(),void t("#actionListcontainer").slideDown();i.setParameters(e,_getDate("dateText2"),_getDate("dateText3"))}else i.setParameters(e);var a=new AjaxRequest;a.init("POST",i.getURL(),!0,i.getParametersAsString()),a.addEventListener("onComplete",function(e){P(),t("#actionListcontainer").html("");var i=jsMsg["AT.NoEdits.Date"];AuditTrail.constructActionDetails(e.responseText,i),AuditTrail.filteredByDate=e.responseText,t("#actionListcontainer").slideDown()}),a.addEventListener("onError",function(){P(),t("#actionListcontainer").slideDown(),showAlertDialog(jsMsg.ErrorOccurred)}),a.sendRequest()}function F(){if("workbook"==t("#sheetFilter").val())AuditTrail.filteredBySheet=AuditTrail.capturedActionList,t("#actionListcontainer").html(""),m(AuditTrail.filteredBySheet);else{t("#actionListcontainer").slideUp(),j();var e=new RequestParameters(ActionConstants.AUDIT_FILTER_BY_SHEET);e.setParameters(t("#sheetFilter").val());var i=new AjaxRequest;i.init("POST",e.getURL(),!0,e.getParametersAsString()),i.addEventListener("onComplete",function(e){P(),t("#actionListcontainer").html(""),AuditTrail.constructActionDetails(e.responseText,jsMsg["AT.NoEdits.Sheet"]),AuditTrail.filteredBySheet=e.responseText,t("#actionListcontainer").slideDown()}),i.addEventListener("onError",function(){P(),t("#actionListcontainer").slideDown(),showAlertDialog(jsMsg.ErrorOccurred)}),i.sendRequest()}}function U(e){t("#actionListcontainer").slideUp(),j(),e&&(e=CellUtils.removeApostrophe(e));var i=new RequestParameters(ActionConstants.AUDIT_FILTER_BY_RANGE);i.setParameters(e);var a=new AjaxRequest;a.init("POST",i.getURL(),!0,i.getParametersAsString()),a.addEventListener("onComplete",function(e){P(),t("#actionListcontainer").html(""),AuditTrail.constructActionDetails(e.responseText,jsMsg["AT.NoEdits.Range"]),AuditTrail.filteredByRange=e.responseText,t("#actionListcontainer").slideDown()}),a.addEventListener("onError",function(){P(),t("#actionListcontainer").slideDown(),showAlertDialog(jsMsg.ErrorOccurred)}),a.sendRequest()}function H(){AuditTrail.closeVersionHistory()}function W(e){var i=t(e).val(),a=DataValidation_UI.getDateFormat();if(i==ConditionalFormatOperator.LESS_THAN||i==ConditionalFormatOperator.GREATER_THAN||i==ConditionalFormatOperator.EQUAL){t("#"+sheetdialog.getDialogName()).parent().animate({width:"620px"}),t("#dateInput1").css("display",""),t("#dateInput2").css("display","none"),t("#showDetails").css("display","");var n=t("#dateText1");n.datepicker({showOn:"both",buttonImage:"/sheet/styles/"+CURR_THEME+"/images/datetime.png",buttonImageOnly:!0,changeMonth:!0,changeYear:!0,buttonText:jsMsg["Filter.date"]}),n.datepicker({dateFormat:a}),n.datepicker("option","dateFormat",a),t(".ui-datepicker-trigger").attr("class","datePickerIcon")}else if(i==ConditionalFormatOperator.BETWEEN||i==ConditionalFormatOperator.NOT_BETWEEN){t("#"+sheetdialog.getDialogName()).parent().animate({width:"620px"}),t("#showDetails").css("display",""),t("#dateInput1").css("display","none"),t("#dateInput2").css("display","");var r=t("#dateText2");r.datepicker({showOn:"both",buttonImage:"/sheet/styles/"+CURR_THEME+"/images/datetime.png",buttonImageOnly:!0,changeMonth:!0,changeYear:!0,buttonText:jsMsg["Filter.date"]}),r.datepicker({dateFormat:a}),r.datepicker("option","dateFormat",a);var s=t("#dateText3");s.datepicker({showOn:"both",buttonImage:"/sheet/styles/"+CURR_THEME+"/images/datetime.png",buttonImageOnly:!0,changeMonth:!0,changeYear:!0,buttonText:jsMsg["Filter.date"]}),s.datepicker({dateFormat:a}),s.datepicker("option","dateFormat",a),t(".ui-datepicker-trigger").attr("class","datePickerIcon")}else t("#"+sheetdialog.getDialogName()).parent().animate({width:"570px"}),t("#showDetails").css("display","none"),t("#dateInput1").css("display","none"),t("#dateInput2").css("display","none"),AuditTrail.filterByDate()}function q(e){var i;return i=window.event?window.event.keyCode:e.which,13!=i?!1:AuditTrail.filterByRange(t("#auditRangeSelection").val())}function J(){var e=t("<span>");e.css({left:15,top:15,position:"relative"}).text("There is no version History for this spreadsheet"),AuditTrail.scrollObject._$element.get(0).appendChild(e[0]),a();var i=function(){t(".versionHighlightChanges").disable(),t("#revisionDetails").disable(),t("#auditTrailIcon").disable()};menutabListener.doAction(TOOLBAR.VERSIONVIEW,{id:"revisionDetails",action:"disable",callback:i})}function z(){var e=t("#fCROD"),i=e.css("top"),a=e.css("left"),n=e.css("height"),r=e.css("width"),s={top:i,left:a,height:n,width:r};return s}function G(){var e=z();t("#fCROD").css({top:e.top,left:e.left,height:e.height,width:e.width,display:"none"})}function Y(){var e=[];e.push({id:"allVersions",data:"{label:jsMsg['AT.ShowAllVersions'], appData:{dynamic:true, callback: 'AuditTrail.changeVariable', arg:'allVersions'}}"}),e.push({id:"markedVersions",data:"{label:jsMsg['AT.ShowNamedVersions'], appData:{dynamic:true, callback: 'AuditTrail.changeVariable', arg:'markedVersions'}}"});var i={target:t("#filterVersionHistory"),clearcache:!0};sheetMenu.showMenu("versionMenu",e,i),t(".atSetting").css("opacity","1"),Q()}function K(e){e!==ht&&(ht=e,t(".atSetting").removeAttr("style"),AuditTrail.scrollObject._clearAllTiles(),"allVersions"===e?(AuditTrail.isNamedVersionsOnly=!1,AuditTrail.scrollObject._resetLoadState(ut),AuditTrail.marking()):"markedVersions"===e&&(AuditTrail.isNamedVersionsOnly=!0,ut=AuditTrail.scrollObject._backUpLoadState(),AuditTrail.scrollObject._sendRequest(0,0,AuditTrail.marking,!0)),Q())}function $(){if(AuditTrail.scrollObject._getVersionInfoArray().length>0){var e=AuditTrail.scrollObject._$element.children().first().children()[0];AuditTrail.viewVersion([e.getAttribute("ver"),e])}else AuditTrail.showNoVersionMessage()}function Q(){var e=t("#versionMenu");AuditTrail.isNamedVersionsOnly?(e.zmenu("changeIcon","markedVersions","ui-individual-icon ui-icon-ztick"),e.zmenu("changeIcon","allVersions","ui-zmenu-no-icon")):(e.zmenu("changeIcon","allVersions","ui-individual-icon ui-icon-ztick"),e.zmenu("changeIcon","markedVersions","ui-zmenu-no-icon"))}function X(){if(!ALL_SHEET_SHARED)return void showAlertDialog(jsMsg.permissionToVersionDocumentMsg);var e=jsVERSION_VIEW?jsMsg["AT.Version.Mark"]:jsMsg["VersionDialog.CreateVersion"],t=jsVERSION_VIEW?jsMsg.OK:jsMsg["VersionDialog.Create"],i={autoOpen:!1,width:348,modal:!0,resizable:!1,title:e,buttons:[{text:t,class:"ui-zbutton-primary",click:function(){Z(),sheetdialog.close()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};sheetdialog.open("versiondialog",i,{init:function(){setTimeout(function(){tt()},200)}})}function Z(){var e=getObj("versionLabel").value;if(!e||e&&!e.trim())return void showAlertDialog(jsMsg.Namecannotbeempty);sheetdialog.close();var i,a=new AjaxRequest;if(jsVERSION_VIEW){i=new RequestParameters(ActionConstants.RENAME_VERSION);var n,r;0!=AuditTrail.clickedElement.getElementsByClassName("revertedVersion").length&&(n=AuditTrail.clickedElement.firstElementChild.childNodes[1].getAttribute("revert"),r=AuditTrail.clickedElement.firstElementChild.childNodes[1].getAttribute("ts")),i.setParameters(encodeURIComponent(e),r,n)}else i=new RequestParameters(ActionConstants.CREATE_VERSION),i.setParameters(encodeURIComponent(e));a.init("POST",i.getURL(),!0,i.getParametersAsString()),a.addEventListener("onComplete",function(){if(versionLabelName=encodeURIComponent(e),jsVERSION_VIEW){var i=AuditTrail.scrollObject._updateNamedVersion(DOCUMENT_VERSION,e);if(null===AuditTrail.clickedElement.getAttribute("vl")&&AuditTrail.scrollObject._refreshHightForRename(i),t(AuditTrail.clickedElement).is(":visible")){AuditTrail.clickedElement.setAttribute("vl",e),0!=AuditTrail.clickedElement.getElementsByClassName("descriptionStamp").length&&AuditTrail.clickedElement.removeChild(AuditTrail.clickedElement.childNodes[1]);var a=AuditTrail.getDescriptiveDom(e);AuditTrail.clickedElement.insertBefore(a,AuditTrail.clickedElement.childNodes[1]),AuditTrail.setViewingVersionDetails(AuditTrail.clickedElement)}}else InfoBanner.showBanner(jsMsg["Version.infoMessage"],!0,"info")}),a.sendRequest()}function et(e){window.event&&(e=window.event),13==e.keyCode&&(Z(),sheetdialog.close())}function tt(){getObj("versionLabel")&&(getObj("versionLabel").value=AuditTrail.clickedElement&&null!=AuditTrail.clickedElement.getAttribute("vl")?AuditTrail.clickedElement.getAttribute("vl"):"",getObj("versionLabel").focus(),getObj("versionLabel").select()),positionDialog()}function it(e){if(sheetdialog.isDialogOpen&&sheetdialog.close(),WebForm.isFormAvailable&&e<WebForm.formVersionId){if(CURR_DOC_OWNERNAME!==LOGINNAME)return void showAlertDialog(jsMsg["Form.DeleteMessage.SharedUser.WhileDeletingTheVersion"]);var t=showConfirmDialog(jsMsg["Form.DeleteMessage.WhileDeletingTheVersion"]);if(!t)return;WebForm.deleteForm()}else{var i={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){at(e),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};sheetdialog.showConfirmDialog(replaceParams(jsMsg["AT.DeleteVersion.Alert"],new Array("#"+parseFloat(DOCUMENT_VERSION))),i)}}function at(e){var i=new RequestParameters(ActionConstants.DELETE_VERSION);i.setParameters(e);var a=new AjaxRequest;a.init("POST",i.getURL(),!0,i.getParametersAsString()),a.addEventListener("onComplete",function(i){var a=i.responseText;if(a){var n=JSON.parse(a);if(n.a==ActionConstants.SHOW_ERROR_MESSAGE)return void ErrorMsg.show(n)}var r=AuditTrail.scrollObject._refreshTileForDelete(parseFloat(e));if(t(AuditTrail.clickedElement).is(":visible")){var s=AuditTrail.clickedElement.previousElementSibling;AuditTrail.clickedElement.parentElement.removeChild(AuditTrail.clickedElement),AuditTrail.clickedElement=null==s?AuditTrail.scrollObject._$element.children().first().children()[0]:s,"undefined"==typeof AuditTrail.clickedElement?AuditTrail.showNoVersionMessage():AuditTrail.viewVersion([AuditTrail.clickedElement.getAttribute("ver"),AuditTrail.clickedElement])}else AuditTrail.viewVersion([r])}),a.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),a.sendRequest()}function nt(e,t){if(sheetdialog.isDialogOpen&&sheetdialog.close(),0==documentBakeStatus.objectBaked)return void AuditTrail.revertVersionOnError(e);if(WebForm.isFormAvailable&&e<WebForm.formVersionId){if(CURR_DOC_OWNERNAME!==LOGINNAME)return void showAlertDialog(jsMsg["Form.DeleteMessage.SharedUser.WhileRevertingTheDoc"]);var i=showConfirmDialog(jsMsg["Form.DeleteMessage.WhileRevertingTheDoc"]);if(!i)return;WebForm.deleteForm()}else if(!t){var a={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){jsVERSION_VIEW=!1,maskSheet(),rt(e),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};sheetdialog.showConfirmDialog(replaceParams(jsMsg["AT.RevertVersion.Alert"],new Array("#"+parseFloat(DOCUMENT_VERSION))),a)}}function rt(e){var t=new RequestParameters(ActionConstants.REVERT_VERSION);t.setParameters(e);var i=new AjaxRequest;i.init("POST",t.getURL(),!0,t.getParametersAsString()),i.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);return t.a&&t.a==ActionConstants.SHOW_ERROR_MESSAGE?void ErrorMsg.show(t):void 0}),i.sendRequest(),sheetdialog.close(),showProgressMessage(jsMsg["Version.RevertingMessage"])}function st(e){var t=new RequestParameters(ActionConstants.REVERT_VERSION_ON_ERROR);e&&t.setParameters(e);var i=new AjaxRequest;i.init("POST",t.getURL(),!0,t.getParametersAsString()),i.addEventListener("onComplete",function(){loadDocument(DOCUMENT_ID,DOCUMENT_NAME)}),i.sendRequest()}var ot,lt=0,dt=0,ct=(Math.round(findClientDim().height/40),0),gt=0,ut={},ht="allVersions",At=!1,Tt=function(){ot&&ot.dismantle()};return{highlightChanges:!1,isActionDetailOpen:!1,isNamedVersionsOnly:!1,isChangeLogDialogOpened:!1,clickedElement:"",sheetCallOuts:{},currentViewingChangeLog:[],focusVariable:0,showVersionDialog:X,markVersion_enter:et,fillVersionLabel:tt,deleteVersion:it,revertVersion:nt,revertVersionOnError:st,showActionDetails:c,closeDialog:u,goToChange:A,goToCellRef:T,constructActionDetails:m,addToCellsJson:E,showViewPortVersionChanges:C,showVersionHistory:b,setViewingVersionDetails:S,getDescriptiveDom:w,setVersionDialogHeight:R,hightlightVersion:N,viewVersion:V,closeVersionHistory:L,showByName:y,showByDate:M,showByRange:k,showBySheet:_,filterByName:B,filterByDate:x,filterByRange:U,filterBySheet:F,refreshAfterRevert:H,getDateListItems:W,submitOnEnter:q,showNoVersionMessage:J,postVersionLoader:s,appendChangeLogOnScroll:p,appendChangeLogToDom:f,refreshVersionHistory:o,toggleAuthorsListHeight:l,showMarkMenu:Y,changeVariable:K,marking:$}}(this,jQuery);!function(t,e){e.lazyLoadOnScroll=function(t,i,o){this._$versionDiv=e("<div/>"),this._$versionI=e("<div/>",{class:"versionItem"}),this._$versionT=e("<p/>",{class:"timeStamp"}),this._$verNoSpan=e("<span/>",{class:"versionNumber"}),this._$authorListUL=e("<ul/>",{class:"versionAuthorsList"}),this._$authorListLI=e("<li/>",{}),this._$authorListSpan=e("<span/>",{class:"userLegend"}),this._$authorName=e("<span/>",{class:"versionUserName overflowEllipsis"}),this._$toggleDiv=e("<div/>",{class:"contn"}),this._$moreIcon=e("<span/>",{style:"background: none repeat scroll 0 0 #D7D7D7;padding: 0 2px;"}).text(jsMsg["AT.User.More"]),this._$lessIcon=e("<span/>",{style:"background: none repeat scroll 0 0 #D7D7D7;padding: 0 2px;",class:"hide"}).text(jsMsg["AT.User.Less"]),this._$verDetail=e("<a/>",{class:"versionDetails link"}),this._$loading=e("<div/>",{class:"vload"}).text(jsMsg.Loading+"..."),this._$topNav=e("<div/>",{class:"auditTopNav"}).text("Top"),this._$head=o,this._$element=e(o.children().get(0)),this.$chatPanel=e("#chatcmtPanel"),this._init(t,i)},e.lazyLoadOnScroll.defaults={versionPanelSettings:{DOM_SIZE_PER_TILE:25,MAX_TILE_SIZE:3,FETCH_PER_SCROLL:1e3},loadState:{currScrollTop:0,isReqCompleted:!0,isMarkUpCompleted:!0,isTopDivAppended:!1,availableStartIndex:0,availableEndIndex:0,loadedStartIndex:0,loadedEndIndex:0,scrollEvtIntvl:void 0,scrollInfo:[]},versionInfoArray:[],totalHeight:0,countOfCurrRecord:0,divDimensions:{}},e.lazyLoadOnScroll.prototype={_init:function(t,i){this.options=e.extend(!0,{},e.lazyLoadOnScroll.defaults,t),this._appendDummyDiv(),this._initialLoad(i),this._bindEvents()},_initialLoad:function(t){this._sendRequest(0,0,t)},_bindEvents:function(){var t=this;this._$head.unbind("scroll").bind("scroll",function(){t._observe()})},_appendDummyDiv:function(){var t=[{dummy:"#000"},{dummy:"#000"},{dummy:"#000"},{dummy:"#000"},{dummy:"#000"}],i={al:t,ts:"dummy",ver:"1.0",vl:"dummyLabel"},o=this._markUpVersionItem(i).css("visibility","hidden");this._$element.get(0).appendChild(o[0]);var n=e(".versionItem").outerHeight(),s=e(e(".versionAuthorsList").children()[0]).outerHeight(),a=e(".versionAuthorsList").outerHeight(),r=e(".descriptionStamp").outerHeight(),l=e(".contn").outerHeight(),d=n-a-r-l;this.options.divDimensions={defH:parseInt(d),desH:parseInt(r),moreH:parseInt(l),unH:parseInt(s)},this._$element.empty()},_backUpLoadState:function(){var t={lsi:this.options.loadState.loadedStartIndex,lei:this.options.loadState.loadedEndIndex,via:this.options.versionInfoArray,si:this.options.loadState.scrollInfo,th:this.options.totalHeight,ccr:this.options.countOfCurrRecord};return this.options.loadState.availableStartIndex=0,this.options.loadState.availableEndIndex=0,this.options.loadState.loadedStartIndex=0,this.options.loadState.loadedEndIndex=0,this.options.loadState.scrollInfo=[],this.options.versionInfoArray=[],this.options.totalHeight=0,t},_resetLoadState:function(t){this.options.loadState.availableStartIndex=0,this.options.loadState.availableEndIndex=0,this.options.loadState.loadedStartIndex=t.lsi,this.options.loadState.loadedEndIndex=t.lei,this.options.loadState.scrollInfo=t.si,this.options.versionInfoArray=t.via,this.options.totalHeight=t.th,this.options.countOfCurrRecord=t.ccr,this._setScrollTop(0),this._updateContainerHeight(),this._appendSuitableTiles(0)},_isScrollDownwards:function(){return this.options.loadState.currScrollTop<=this._getScrollTop()?!0:!1},_getScrollTop:function(){return this._$head.scrollTop()},_getLoadedEndIndex:function(){return this.options.loadState.loadedEndIndex},_getLoadedStartIndex:function(){return this.options.loadState.loadedStartIndex},_getLoadedEndVersion:function(){return this.options.versionInfoArray[this.options.versionInfoArray.length-1].ver},_getLoadedStartVersion:function(){return this.options.versionInfoArray[0].ver},_getAvailableStartIndex:function(){return this.options.loadState.availableStartIndex},_getAvailableEndIndex:function(){return this.options.loadState.availableEndIndex},_getLastTileSize:function(){return e(this._$element.children().get(2)).children().length},_getFirstTileSize:function(){return e(this._$element.children().get(0)).children().length},_getVersionInfoArray:function(){return this.options.versionInfoArray},_getScrollInfoArray:function(){return this.options.loadState.scrollInfo},_isNextTileRequired:function(t){var e=this._binarySearch(t,0,this.options.loadState.scrollInfo.length),i=this._getAvailableStartIndex()+2*this.options.versionPanelSettings.DOM_SIZE_PER_TILE;if(e>this._getAvailableEndIndex()&&e<this._getLoadedEndIndex()){var o=e?e-e%this.options.versionPanelSettings.DOM_SIZE_PER_TILE:e;return this._appendSuitableTiles(o),!1}return e>=i?!0:void 0},_isPrevTileRequired:function(t){var e=this._binarySearch(t,0,this.options.loadState.scrollInfo.length),i=this._getAvailableEndIndex()-2*this.options.versionPanelSettings.DOM_SIZE_PER_TILE;if(e<=this._getAvailableStartIndex()&&e>=this._getLoadedStartIndex()){var o=e-e%this.options.versionPanelSettings.DOM_SIZE_PER_TILE;return this._appendSuitableTiles(o),!1}return i>=e?!0:void 0},_appendSuitableTiles:function(t){this.options.loadState.availableStartIndex=t,this.options.loadState.availableEndIndex=t-1,this._clearAllTiles(),this._appendFloorTile(),t?this._appendCeilTile():this._appendFloorTile(),this._appendFloorTile()},_appendFloorTile:function(t){var e=this._getAvailableEndIndex();this._markUpTile(e+1,e+this.options.versionPanelSettings.DOM_SIZE_PER_TILE,"APPEND",t)},_appendCeilTile:function(){var t=this._getAvailableStartIndex();this._markUpTile(t-this.options.versionPanelSettings.DOM_SIZE_PER_TILE,t-1,"PREPEND")},_observe:function(){var t=this,e=t._getScrollTop(),i=t._$element.prop("scrollHeight");e>=0&&i>=e&&(e>.02*i?t.options.loadState.isTopDivAppended||t._showTopDiv():t._removeTopDiv(),t._isScrollDownwards()?t._isNextTileRequired(e)&&(t.options.loadState.isMarkUpCompleted=!1,t._appendFloorTile()):t._isPrevTileRequired(e)&&(t.options.loadState.isMarkUpCompleted=!1,t._appendCeilTile()),t.options.loadState.currScrollTop=e)},_clearAllTiles:function(){this._$element.empty()},_checkAndRemoveCeilDom:function(){this._getTileSize()>this.options.versionPanelSettings.MAX_TILE_SIZE&&(e(this._$element.children().get(0)).remove(),this.options.loadState.availableStartIndex+=this.options.versionPanelSettings.DOM_SIZE_PER_TILE)},_checkAndRemoveFloorDom:function(){this._getTileSize()>this.options.versionPanelSettings.MAX_TILE_SIZE&&(e(this._$element.children().get(this._$element.children().length-1)).remove(),this.options.loadState.availableEndIndex-=this.options.versionPanelSettings.DOM_SIZE_PER_TILE)},_getTileSize:function(){return this._$element.children().length},_sendRequest:function(t,e,i,o){var n=this,s=new AjaxRequest,a=new RequestParameters(ActionConstants.JSP_VERSION_VIEW_DIALOG);n.options.loadState.isReqCompleted=!1,a.setParameters(IS_REVERT_ALLOWED,!documentBakeStatus.objectBaked,t,e,n.options.totalHeight,o,JSON.stringify(n.options.divDimensions)),s.init("POST",a.getURL(),!0,a.getParametersAsString()),s.addEventListener("onComplete",function(t){o&&n._setScrollTop(0);var e=parseJSON(t.responseText),s=e.result;if(s){var a=s.vview;if(a){var r=a.vi?a.vi:[];0!==r.length&&(n.options.countOfCurrRecord=r.length,n.options.versionInfoArray=n.options.versionInfoArray.concat(r),n.options.loadState.loadedEndIndex=n.options.versionInfoArray.length-1,a.si&&(n.options.totalHeight=a.si.ht?a.si.ht:0,n.options.loadState.scrollInfo=n.options.loadState.scrollInfo.concat(a.si.ti),n._updateContainerHeight()),n._appendSuitableTiles(n.options.loadState.availableEndIndex))}}if(n.options.loadState.isReqCompleted=!0,i){var l=[n];i.apply(void 0,l)}}),s.sendRequest()},_binarySearch:function(t,e,i){var o=~~(e+(i-e)/2),n=this.options.loadState.scrollInfo[o].h;return e===o?o:n>t?this._binarySearch(t,e,o):t>n?this._binarySearch(t,o,i):o},_binarySearchForVersion:function(t,e,i){var o=~~(e+(i-e)/2),n=parseFloat(this.options.loadState.scrollInfo[o].v);return e===o?o:t>n?this._binarySearchForVersion(t,e,o):n>t?this._binarySearchForVersion(t,o,i):o},_refreshTile:function(){for(var t=0;t<this._$element.children().length;t++){var i=e(this._$element.children().get(t)).children().first(),o=i.attr("ver"),n=this._binarySearchForVersion(parseFloat(o),0,this._getScrollInfoArray().length),s=this._getScrollInfoArray()[n].h;e(this._$element.children().get(t)).attr("style","top: "+s+"px")}},_updateNamedVersion:function(t,e){var i=this._binarySearchForVersion(parseFloat(t),0,this._getScrollInfoArray().length);return this.options.versionInfoArray[i].vl=e,i},_refreshHightForRename:function(t){for(var e=t+1;e<this.options.loadState.scrollInfo.length;e++)this.options.loadState.scrollInfo[e].h+=22;var i=parseInt(this._$element.get(0).style.height)+22;this._$element.get(0).style.height=i+"px",this.options.totalHeight=i,this._refreshTile()},_refreshTileForMoreIcon:function(t,e){var i=e.next();if(i.length){var o=i.get(0).style.height;i.get(0).style.height=o+t}var n=i.next();if(n.length){var o=n.get(0).style.height;n.get(0).style.height=o+t}},_refreshTileForDelete:function(t){var e=this._binarySearchForVersion(t,0,this._getScrollInfoArray().length),i=this.options.loadState.scrollInfo.splice(e,1),o=this._getScrollInfoArray()[e];if(o){var n=o.h-i[0].h;return this.options.loadState.loadedEndIndex-=1,this.options.loadState.availableEndIndex-=1,this.options.versionInfoArray.splice(e,1),this._reduceHeight(e,n),o.v}},_reduceHeight:function(t,e){for(var i=t;i<this.options.loadState.scrollInfo.length;i++){var o=this.options.loadState.scrollInfo[i].h;this.options.loadState.scrollInfo[i].h=o-e}var n=parseInt(this._$element.get(0).style.height)-e;this._$element.get(0).style.height=n+"px",this.options.totalHeight=n,this._refreshTile()},_removeMoreTag:function(){this.$chatPanel.children().length&&this.$chatPanel.children().first().get(0).remove(this.$chatPanel)},_updateContainerHeight:function(){this._$element.get(0).style.height=this.options.totalHeight+"px"},_setScrollTop:function(t){this._$head.scrollTop(t)},_markUpTile:function(t,e,i){var o=this;if(o.options.versionInfoArray){if(0>=t&&0>=e)return;if(t>=o.options.versionInfoArray.length&&e>=o.options.versionInfoArray.length)return;e>=o.options.versionInfoArray.length&&(e=o.options.versionInfoArray.length-1),0>t&&(t=0);var n=o._$versionDiv.clone(!0).attr("style","top:"+o.options.loadState.scrollInfo[t].h+"px;");n.addClass("versionTile");for(var s=document.createDocumentFragment(),a=t;e>=a;a++){var r=o._markUpVersionItem(o.options.versionInfoArray[a]);r.appendTo(n)}s.appendChild(n.get(0))}"APPEND"===i?(o.options.loadState.availableEndIndex=e,o._$element.get(0).appendChild(s),e===o._getLoadedEndIndex()&&(o.options.countOfCurrRecord%o.options.versionPanelSettings.FETCH_PER_SCROLL?o._$element.get(0).style.height=o.options.totalHeight+"px":o._showMoreTag()),o._checkAndRemoveCeilDom()):(o.options.loadState.availableStartIndex=t,o._$element.prepend(s),o._checkAndRemoveFloorDom()),o.options.loadState.isMarkUpCompleted=!0},_markUpVersionItem:function(t){var i,o=this,n=t.ver,s=o._$versionI.clone(!0).attr("ver",n),a=o._$versionT.clone(!0).text(t.ts);""!==n&&(i=o._$verNoSpan.clone(!0).text("#"+parseFloat(n)));var r;if(t.vl){if(t[JSONConstants.REVERTED_VERSION_OF_NO]){var l=jsMsg["AT.Reverted"]+" #"+parseFloat(t[JSONConstants.REVERTED_VERSION_OF_NO]),d=e("<span/>",{class:"revertedVersion",ts:t[JSONConstants.REVERTED_VERSION_OF_TIMESTAMP],revert:t[JSONConstants.REVERTED_VERSION_OF_NO],title:l});d.appendTo(a)}t.vl!==jsMsg["AT.Reverted"]&&(r=AuditTrail.getDescriptiveDom(decodeURIComponent(t.vl)),s.attr("vl",t.vl))}if(""!==n&&i.appendTo(a),t.al)for(var h=o._$authorListUL.clone(!0),p=0;p<t.al.length;p++){var c=t.al[p];for(var _ in c)if(c.hasOwnProperty(_)){var v=o._$authorListLI.clone(!0);p>=4&&v.addClass("hide");var u=o._$authorListSpan.clone(!0).attr("style","background-color:"+c[_]),g=o._$authorName.clone(!0).attr("title",_).text(_);u.appendTo(v),g.appendTo(v),v.appendTo(h)}}if(a.appendTo(s),t.vl&&t.vl!==jsMsg["AT.Reverted"]&&s.append(r),t.al&&h.appendTo(s),s.click(""!==n?o._callVersionItem:o._callCurrVersionItem),t.al&&t.al.length>4){var S=o._$toggleDiv.clone(!0),I=o._$moreIcon.clone(!0),f=o._$lessIcon.clone(!0);I.appendTo(S),f.appendTo(S),S.click(o._callToggle),S.appendTo(s)}if(!disableAuditTrailOption)var m=o._$verDetail.clone(!0).attr("ver",n).text(jsMsg["AT.ChangeLog"]);return(n===DOCUMENT_VERSION||0===n)&&(disableAuditTrailOption||(m.get(0).style.display="block"),s.css("background-color","#F0F0F0"),s.unbind("mouseover"),s.unbind("mouseout"),AuditTrail.clickedElement=s.get(0)),disableAuditTrailOption||(m.click(o._callActionDetail),m.appendTo(s)),s},_callActionDetail:function(t){AuditTrail.showActionDetails(this.getAttribute("ver"),!1,t)},_callCurrVersionItem:function(){setTimeout(function(){AuditTrail.refreshVersionHistory()},100),AuditTrail.viewVersion([""])},_callVersionItem:function(){AuditTrail.hightlightVersion(this),e("#openmessage").is(":visible")||message(jsMsg.Loading,"block","..."),AuditTrail.viewVersion([this.getAttribute("ver"),this]),AuditTrail.setViewingVersionDetails(this)},_callToggle:function(t){AuditTrail.toggleAuthorsListHeight(this,t)},_showMoreTag:function(){var t=this,e=document.createDocumentFragment();e.appendChild(this._$loading.get(0)),t.$chatPanel.prepend(e),t._sendRequest(t._getLoadedEndVersion(),t._getLoadedEndIndex()+1,function(){t._removeMoreTag()})},_showTopDiv:function(){var t=this,e=document.createDocumentFragment(),i=t._$topNav.clone(!0);i.click(function(){t._setScrollTop(0)}),e.appendChild(i.get(0)),t.$chatPanel.get(0).appendChild(e),t.options.loadState.isTopDivAppended=!0},_removeTopDiv:function(){this.$chatPanel.children().length&&this.$chatPanel.children().last().get(0).remove(this.$chatPanel),this.options.loadState.isTopDivAppended=!1},_getContainerHeight:function(){return this._$head.height()}},e.fn.lazyLoadOnScroll=function(t,i){return e.data(this,"lazyLoadOnScroll",new e.lazyLoadOnScroll(t,i,this)),this}}(window,jQuery);var CheckINCheckOUT=function(){var e=function(){$("#tooltipToggle").attr("disabled","disabled"),$("#CheckINCheckOUTtoggle").disable();var e,t=new RequestParameters(ActionConstants.CHECKIN_CHECKOUT_FROM_SHEET);e=$("#collab input").prop("checked")?"CheckIN":"CheckOUT",t.setParameters(e);var n=new AjaxRequest;n.init("POST",t.getURL(),!0,t.getParametersAsString()),n.addEventListener("onComplete",function(e){var t=JSON.parse(e.response);1==t.CheckIN||0==t.CheckIN?1==t.CheckIN?$("#collab label").text("On"):(InfoBanner.showBanner(jsMsg["Checkin.CheckinErrorBanner"],!0,"info"),$("#collab input").prop("checked","")):(1==t.CheckOUT||0==t.CheckOUT)&&(1==t.CheckOUT?$("#collab label").text("Paused"):(InfoBanner.showBanner(jsMsg["Checkin.CheckOutErrorBanner"],!0,"info"),$("#collab input").prop("checked","true"))),$("#CheckINCheckOUTtoggle").enable(),$("#tooltipToggle").removeAttr("disabled")}),n.sendRequest(),sheetdialog.close()},t=function(){$("#collab input").prop("checked")?$("#collab label").attr("title",jsMsg["Checkin.Checkout.titleMsg"]):$("#collab label").attr("title",jsMsg["Checkin.Checkin.titleMsg"])};return{sendRequest:e,showHint:t}}();var SheetNotifier=function(t){var e,o={},n="",i=0,a={},p=void 0,r=0,s=function(t){var e=t.type;switch("PopUp"!==e&&"PopUpTimer"!==e&&(l(t),u()),e){case"Alert":__showAlertDialog();break;case"Confirm":__showConfirmDialog();break;case"Timer":g();break;case"Info":__showInfoDialog();break;case"Warning":__showWarningDialog();break;case"Error":__showErrorDialog();break;case"PopUpTimer":case"PopUp":h(t)}},c=function(){y()},l=function(t){var e={icon:"info",countFrom:10,width:300,title:jsMsg["Service.ZohoOffice"],buttons:[{text:jsMsg.OK,click:function(){sheetdialog.close()}}]};Object.keys(t).forEach(function(o){e[o]=t[o]}),o=e},u=function(){n||(n=t("#notifyDlgContainer").html(),t("#notifyDlgContainer").html(""))},f=function(){t("#cntDwn").text(i),0==i&&(sheetdialog.close(),document.location.href=location.href),i--,setTimeout(function(){SheetNotifier.startCountDown()},1e3)},d=function(){var t={autoOpen:!1,width:o.width,modal:!0,resizable:!1,title:o.title,buttons:o.buttons};sheetdialog.open("HTML",n,t)},g=function(){var e=o.icon,n=o.header,a=o.content,p=o.timerMsg;i=o.countFrom,d(),t("#notifyDlgIcon").addClass(e+"Icon"),t("#notifyDlgHeading").text(n),t("#notifyDlgMsg").text(a),t("#notifyDlgReloadMsg").text(p),t("<b/>",{text:i,id:"cntDwn"}).appendTo(t("#notifyDlgReloadMsg")),t("#notifyDlgReloadMsg").show(),setTimeout(function(){SheetNotifier.startCountDown()},200)},h=function(t){if(x()){if(p)return y(),void setTimeout(function(){h(t)},800);m(t),T(),v()}},m=function(t){var e={content:"Sample notify",href:"",closeBtn:!0,autoHide:!0,timeOut:"8000",posiiton:"bottomright",popupType:"info",count:10,timerMsg:jsMsg["CopyToClipboard.TimerMsg"]};Object.keys(t).forEach(function(o){e[o]=t[o]}),a=e},x=function(){return jsVERSION_VIEW||jsPUBLIC_VIEW||REMOTE.ISRMVIEW&&!REMOTE.ISCOLLABEDITVIEW&&!REMOTE.ISCOLLABVIEW?!1:!0},T=function(){p=t("<div/>",{class:"ui-znotifier ui-state-info",style:"position:absolute; bottom:-125px; right:5px; font-weight:normal; overflow:hidden; width:300px; border:1px solid #AFACAC; z-index:11370"});var e=t("<span/>",{class:"ui-icon ui-icon-close",style:"cursor:pointer; float:right; right:2px; top:2px;"}).appendTo(p);if(e.on("click",function(){y()}),"chat"===a.popupType){var o=t("<span/>",{class:"ui-znotifier-message",style:"padding:0px 5px 10px 10px; width:270px"}).appendTo(p);t("<b/>",{text:a.dname+": "}).appendTo(o),t("<span/>",{text:a.chatContent}).appendTo(o)}else if("PopUpTimer"==a.type){var n=t("<span/>",{class:"ui-znotifier-message",style:"padding:0px 5px 10px 10px; width:270px"});n.html(a.content).appendTo(p),t("<hr/>",{size:"1",color:"#CCC",style:"margin-top:10px;"}).appendTo(p);var i=t("<span/>",{id:"timer"}),r=t("<span/>",{style:"padding:0px 5px 10px 10px; width:270px",id:"timermain"});r.html(a.timerMsg),i.html(" "+a.count+" secs."),i.appendTo(r),r.appendTo(p)}else t("<span/>",{class:"ui-znotifier-message",text:a.content,style:"padding:0px 5px 10px 10px; width:270px"}).appendTo(p);if(a.href){var s=a.href,c=s.action,l=s.args,u=s.text;if(u&&c){t("<hr/>",{size:"1",color:"#CCC",style:"margin-top:10px;"}).appendTo(p);var f=t("<div/>",{style:"text-align:right; padding-top:5px"}).appendTo(p);t("<a/>",{text:u,href:"#"}).appendTo(f),f.on("click",function(){y();var e=c.split("."),o=window,n="";if(t(e).each(function(t,i){o=o[i],t===e.length-2&&(n=o)}),isUndefined(l))o.call();else{var i=l.split(",");o.apply(n,i)}})}}p.appendTo("body")},v=function(){p&&(p.animate({bottom:"25px"},{queue:!0,duration:600,easing:"easeInOutSine"}),a.timeOut>0&&(r=setTimeout(function(){y()},a.timeOut)))},y=function(){clearTimeout(r),clearInterval(e),p&&p.animate({bottom:"-125px"},{queue:!0,duration:600,easing:"easeInOutSine",complete:function(){p.remove(),p=void 0,t(".ui-effects-wrapper").length&&t(".ui-effects-wrapper").remove()}})},w=function(){e=setInterval(b,1e3)},b=function(){return a.count=a.count-1,a.count<=0?void y():void t("div.ui-znotifier").find("#timer").html(" "+a.count+" secs.")};return{open:s,close:c,startCountDown:f,startTimer:w}}(jQuery);!function(e,t){function n(){l?i[0]&&setTimeout(function(){i.focus()},300):(l=!0,exprField.readOnly=!0,g(),t.setTargetElement(i[0]))}function o(){if(l){l=!1,exprField.readOnly=!1,r=!1;var e=i.val();d(e),t.revokeTargetElement(e)}}var i,a,l=!1,r=!1,c=function(){var e={},t=sheetdialog.getOpenedDialog();return e.title=sheetdialog.getTitle(),e.pos=t.offset(),sheetdialog.hideDialog(),e},g=function(){var n=c(),o=n.pos,l=e("#rangeSelectorDialog");if(!l.length){e("<div/>",{id:"rangeSelectorDialog",title:n.title,class:"ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable"}).appendTo("body").draggable({containment:e("body")});var l=e("#rangeSelectorDialog");e(l).css({width:360,height:50,top:o?o.top:22,left:o?o.left:"calc( 100% / 2 - 360px /2)",cursor:"move",padding:"10px","z-index":"11370",position:"absolute"}),e("<span/>",{style:"font-size:14px",text:n.title}).appendTo(l),e("<input/>",{type:"text",style:"width:86%;margin-top:9px;padding-right:22px;",class:"textField",id:"sRange"}).appendTo(l),e("<span/>",{class:"rangeInput",onclick:"RangeSelector.goNormal()"}).appendTo(l)}i=e("#sRange"),setTimeout(function(){i.focus(),i[0].onkeydown=function(e){var n=e.keyCode;13===n?t.goNormal():27===n&&t.goNormal(),t.arrowKeyDownCheck(e)},i[0].onkeypress=function(e){var n=e.keyCode?e.keyCode:e.which;t.setMultiRange(n)},i[0].onkeyup=function(){a.directInput&&t.inputValidate()}},300)},d=function(){var t=e("#rangeSelectorDialog");setTimeout(function(){e(t).remove(),sheetdialog.recallDialog()},100)};appEvent.on("grid.onrangeselect",function(){!t.isActive()||a.directInput||t.isRangeSelectionSupported()||n()}),appEvent.on("grid.rangeselect.end",function(){!t.isActive()||a.directInput||r||t.goNormal()}),appEvent.on("rangeselector.on",function(e){a=e}),t.goZen=function(){r=!0,n()},t.goNormal=function(){r=!1,o(),t.functionCallback()},t.showRangeSelection=function(n){e("#"+n).focus(),t.goZen()}}(jQuery,RangeSelector);var repeat={LASTACTIONJSON:void 0,doAction:function(t,e,n){t&&READ_WRITE&&this.sendActionRequest(t,e,n)},sendActionRequest:function(t){fillCellRange();var e=parseJSON(t);switch(e.a){case ActionConstants.FILLSERIES:var n="TO_TOP"!=e.fd?startR:endR-(e.er-e.sr),a="TO_BOTTOM"!=e.fd?endR:startR+(e.er-e.sr),s="TO_LEFT"!=e.fd?startC:endC-(e.ec-e.sc),r="TO_RIGHT"!=e.fd?endC:startC+(e.ec-e.sc);if(containsAnyArray(n,s,a,r))return void showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray);if(isPivotOrArrayRange(n,s,a,r))return;var o,C,i,R,c;if(isCellRange()){var g=getCellRange();o=g.startRow,C=g.startCol,i=g.endRow,R=g.endCol}else{var l=ActiveCellInfo;o=l.getStartRow(),C=l.getStartCol(),i=l.getEndRow(),R=l.getEndCol()}switch(e.fd){case"TO_BOTTOM":c=i-o+1;break;case"TO_TOP":c=o-i+1;break;case"TO_RIGHT":c=R-C+1;break;case"TO_LEFT":c=C-R+1}if(e.vc=c,e.sr=n,e.sc=s,e.er=a,e.ec=r,ProtectedRanges.isRangeLocked(n,s,a,r))return;break;case ActionConstants.CLEARCONTENTS:case ActionConstants.DELETE_ROW:case ActionConstants.DELETE_COL:if(ProtectedRanges.isRangeLocked(startR,startC,endR,endC))return;if(isPivotOrArrayRange(startR,startC,endR,endC))return;break;case ActionConstants.INSERT_ROW:if(isPartOfArray(startR,startC,endR,endC)){if(n="above"==e.pos?startR-1:startR+1,a="above"==e.pos?endR-1:endR+1,ProtectedRanges.isRangeLocked(n,startC,a,endC))return;if(isPivotOrArrayRange(n,startC,a,endC))return}break;case ActionConstants.INSERT_COL:if(isPartOfArray(startR,startC,endR,endC)){if(s="before"==e.pos?startC-1:startC+1,r="before"==e.pos?endC-1:endC+1,ProtectedRanges.isRangeLocked(startR,s,endR,r))return;if(isPivotOrArrayRange(startR,s,endR,r))return}break;case ActionConstants.INSERT_CELL_LEFT:case ActionConstants.INSERT_CELL_TOP:case ActionConstants.DELETE_CELL_RIGHT:case ActionConstants.DELETE_CELL_BOTTOM:var d=e.sr,E=e.sc,T=e.er,A=e.ec;void 0!==Merge.getCellInfo(d,E)&&(d=Merge.getCellInfo(d,E).startRow,E=Merge.getCellInfo(d,E).startCol,T=Merge.getCellInfo(d,E).endRow,A=Merge.getCellInfo(d,E).endCol);var L=(A-E+1)*(T-d+1);if(e.a===ActionConstants.INSERT_CELL_TOP?cellRangeContainsMergeCells(d+L,E,getRowMax()-1,A):e.a===ActionConstants.INSERT_CELL_LEFT?cellRangeContainsMergeCells(d,E+L,T,getColMax()-1):e.a===ActionConstants.DELETE_CELL_BOTTOM?cellRangeContainsMergeCells(d,E,getRowMax()-1,A):cellRangeContainsMergeCells(d,E,T,getColMax()-1))return void showAlertDialog(jsMsg["Insert.CannotInsertOnMergedCells"]);if(e.a===ActionConstants.INSERT_CELL_LEFT||e.a===ActionConstants.DELETE_CELL_RIGHT?isPartOfArray(d,E,T,getColMax()-1):isPartOfArray(d,E,getRowMax()-1,A))return void showAlertDialog(jsMsg.YouCannotChangeOnlyPartOfAnArray);if(e.a===ActionConstants.INSERT_CELL_TOP?L+usedCursRow>getRowMax()-1:e.a===ActionConstants.INSERT_CELL_LEFT?L+usedCursCol>getColMax()-1:!1)return void showAlertDialog(jsMsg["Insert.CannotInsert"])}if(e.a!=ActionConstants.FILLSERIES){var O=startR,f=startC,_=endR,I=endC;if(startR==endR&&startC==endC){var l=ActiveCellInfo,S=l.getStartRow(),v=l.getStartCol(),u=l.getEndRow(),M=l.getEndCol();S==startR&&v==startC&&(O=S,f=v,_=u,I=M)}if(e.sr=O,e.sc=f,e.er=_,e.ec=I,ProtectedRanges.isRangeLocked(O,f,_,I))return}var P=new RequestParameters(ActionConstants.REPEAT_ACTION);P.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(e));var w=new AjaxRequest;w.init("POST",P.getURL(),!0,P.getParametersAsString()),actionManager.addRequest(w)},setLastAction:function(t){this.LASTACTIONJSON=JSON.stringify(t)}};function showWebDataDialog(){var e={title:jsMsg["Data.LinkExternalData"],width:560};sheetdialog.open("externaldatadialog",e,{init:function(){setTimeout(function(){getObj("webdatacell").value=getCellLabel(currRow,currCol),currSchedulePeriod="periodic",fillsheetNames()},200)},destroy:function(){RangeSelector.off()}}),tempwebDataUrl="",webdataUrlType="csv",extDatamode="configure"}function externalDataUrlWizard(){RangeSelector.off(),getObj("schDiv").style.display="none",getObj("htmldataDiv").style.display="none",getObj("locDiv").style.display="none",getObj("urlDiv").style.display="",setclassForTabs("urlTab")}function externalDataLocationWizard(){if(!validateURL())return!1;var e=getObj("webdatacell");RangeSelector.on({el:e,single:!0,callback:function(e){var t=e.indexOf(".");if(t>0){var a=e.substring(0,t);a=a.replace(/'/gi,""),$("#webdatasheet").val(a)}else $("#webdatasheet").val(CURRSHEETNAME)}}),getObj("urlDiv").style.display="none",getObj("schDiv").style.display="none",getObj("htmldataDiv").style.display="none",getObj("locDiv").style.display="",setclassForTabs("locTab"),setBackVal()}function setBackVal(){$("#locBack").click("csv"===webdataUrlType||"rss"===webdataUrlType?function(){externalDataUrlWizard()}:function(){externalDataSelectionWizard()})}function validateURL(){var e="";e="edit"!==extDatamode?getObj("webdataurl").value:getObj("webdataurl_edit").value;var t=e.toLowerCase(),a=t.length;return 0===t.indexOf("http://")&&a>7||0===t.indexOf("https://")&&a>8||0===t.indexOf("ftp://")&&a>6||0===t.indexOf("telnet://")&&a>9||0===t.indexOf("gopher://")&&a>9||0===t.indexOf("rlogin://")&&a>9||0===t.indexOf("nntp://")&&a>7||0===t.indexOf("url://")&&a>6||0===t.indexOf("www.")&&a>4||0===t.indexOf("#")?e:(showAlertDialog(jsMsg["Error.Hyperlink.Invalid.Url"]),!1)}function externalDataSelectionWizard(){var e=validateURL();if(!e)return!1;if(tempwebDataUrl!==e){tempwebDataUrl=e;var t=new RequestParameters(ActionConstants.GET_HTML_WEBDATA);t.setParameters("parseHtml",CURRSHEETNAME,encodeURIComponent(e),CURRSHEETNAME);var a=new AjaxRequest;a.init("POST",t.getURL(),!0,t.getParametersAsString()),a.addEventListener("onComplete",function(e){var t,a=parseJSON(e.responseText),l=a.webdataXML;if(window.ActiveXObject)t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(l);else{var s=new DOMParser;t=s.parseFromString(l,"text/xml")}showDataSelectionWizard(t)}),a.sendRequest()}else showDataSelectionWizard(null)}function showDataSelectionWizard(e){if(null!==e)for(var t=e.firstChild.childNodes,a=0;a<t.length;a++)if(node=t.item(a),"sheet"===node.nodeName){var l=(node.attributes,node.childNodes[0].nodeValue);"NoTableAvailable"===l||""===l?(getObj("selectalltable").style.display="none",getObj("htmltables").innerHTML=getObj("nodatawarningdiv").innerHTML):"UrlNotReachable"===l?(getObj("selectalltable").style.display="none",getObj("htmltables").innerHTML=getObj("noreachwarningdiv").innerHTML):(getObj("selectalltable").style.display="",getObj("htmltables").innerHTML=node.childNodes[0].nodeValue)}"edit"===extDatamode&&"null"!==edithtml?selectHtmlEditTables():(getObj("urlDiv").style.display="none",getObj("locDiv").style.display="none",getObj("schDiv").style.display="none",getObj("htmldataDiv").style.display="",setclassForTabs("dataTab")),message("","none")}function externalDataScheduleWizard(){RangeSelector.off(),getObj("urlDiv").style.display="none",getObj("locDiv").style.display="none",getObj("htmldataDiv").style.display="none",getObj("schDiv").style.display="",setclassForTabs("schTab")}function toggleURLType(e){var t=getObj("csv_hint"),a=getObj("rss_hint"),l=getObj("others_hint");"csv"===e||"rss"===e?(webdataUrlType=e,"csv"===e&&(a.style.display="none",t.style.display=""),"rss"===e&&(t.style.display="none",a.style.display=""),l.style.display="none",getObj("dataTab").style.display="none",$("#urlNext").click(function(){externalDataLocationWizard()})):(webdataUrlType="html",getObj("dataTab").style.display="",t.style.display="none",a.style.display="none",l.style.display="",$("#urlNext").click(function(){externalDataSelectionWizard()}))}function toggleExtDataTables(e){for(var t=0;getObj("scraptbl_"+t);)"none"!==getObj("scraptbl_"+t).parentNode.parentNode.parentNode.parentNode.style.display&&(toggleExtDataTable(t,e),toggleExtDataFields(t,"all"===e)),t++}function toggleExtDataTable(e,t){getObj("scraptbl_"+e).checked="all"===t}function toggleExtDataFields(e,t){for(var a=0;getObj("scraptbl_"+e+"_"+a);)getObj("scraptbl_"+e+"_"+a).checked=t,a++}function deSelectExtDataTables(e){for(var t=e.id,a=(e.checked,parseInt(t.substring(t.indexOf("_")+1,t.lastIndexOf("_")))),l=(parseInt(t.substring(t.lastIndexOf("_")+1,t.length)),!1),s=0;getObj("scraptbl_"+a+"_"+s);){if(getObj("scraptbl_"+a+"_"+s).checked){l=!0;break}s++}l?toggleExtDataTable(a,"all"):toggleExtDataTable(a,"")}function toggleScheduleType(e){getObj("periodicinterval").value="csv"===webdataUrlType?"30min-webData":"1hr-webData",getObj("schedule").style.display="once"===e||"everyopen"===e?"none":""}function toggleSchedulePeriod(e){currSchedulePeriod!==e&&(getObj("schedule_"+currSchedulePeriod).style.display="none",getObj("schedule_"+e).style.display="",getObj("schedule_"+currSchedulePeriod+"_timer")&&(getObj("schedule_"+currSchedulePeriod+"_timer").style.display="none"),("weekly"===e||"monthly"===e)&&getObj("schedule_"+currSchedulePeriod+"_timer")&&(getObj("schedule_"+e+"_timer").style.display=""),currSchedulePeriod=e)}function fillsheetNames(){var e=getObj("sheetsTab").getElementsByTagName("TD");sheetCount=0;for(var t=0;t<e.length-1;t++)null!==e[t].getAttribute("sheetname")&&(sheetName=e[t].getAttribute("sheetname"),opt=document.createElement("option"),opt.value=sheetName,sheetName===CURRSHEETNAME&&(opt.selected=!0),opt.appendChild(document.createTextNode(sheetName)),"edit"===extDatamode?(document.getElementById("webdatasheet_edit").appendChild(opt),getObj("webdataurl_edit").focus()):(document.getElementById("webdatasheet").appendChild(opt),getObj("webdataurl").focus()));positionDialog()}function setclassForTabs(e){var t=getObj("urlTab");"notCrossed"!==t.className&&(t.className="crossed",$(t).click(function(){externalDataUrlWizard()}));var a=getObj("dataTab");"notCrossed"!==a.className&&(a.className="crossed",$(a).click(function(){externalDataSelectionWizard()}));var l=getObj("locTab");"notCrossed"!==l.className&&(l.className="crossed",$(l).click(function(){externalDataLocationWizard()}));var s=getObj("schTab");"notCrossed"!==s.className&&(s.className="crossed",$(s).click(function(){externalDataScheduleWizard()}));var n=getObj(e);n.className="current",n.onclick=""}function savewebData(){var e=getObj("webdataurl").value;if(!isValidURL(e))return void showAlertDialog(jsMsg.PleaseProvideValidDataurl);var t=getObj("webdatacell").value;if(""===t)return void showAlertDialog(jsMsg.StartCellCannotBeEmpty);var a="";if("html"===webdataUrlType&&(a=getSelectTables(),"{}"===a))return void showAlertDialog(jsMsg.PleaseSelectAtleastOneTable);var l=getObj("webdatasheet").value,s=webdataUrlType+"save",n="",i=getObj("task_type_schedule");null!==i&&i.checked&&(n=getScheduleName());getAvailableStartRow(),getAvailableEndRow();l!==CURRSHEETNAME&&showsheet(getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(l)),"open"),e=encodeURIComponent(e),l=WorkSheets.getSheetCodeFromName(l);var r=new RequestParameters(ActionConstants.WEB_DATA);r.setParameters(s,WorkSheets.getAssociatedActiveSheetName(),e,l,t,n,a);var o=new AjaxRequest;o.init("POST",r.getURL(),!0,r.getParametersAsString()),actionManager.addRequest(o),sheetdialog.close(),showProgressMessage(jsMsg.UpdatingWebdata,!0)}function savewebData_enter(e){submitFuction(e,function(){"html"===webdataUrlType?externalDataSelectionWizard():externalDataLocationWizard()})}function getSelectTables(){var e="",t="{",a="",l=0;count=0;var s=[],n=$("input").filter(function(){return this.id.match(/scraptbl_[0-9]*\b/)}).length;for(l=0;n>l;l++){var r=document.getElementById("scraptbl_"+l);if(r&&r.checked){s[count]=l,count++;var o=[],d=0;for(colCount=0,tempcolNo=0;document.getElementById("scraptbl_"+l+"_"+d);){var c=0;if(document.getElementById("scraptbl_"+l+"_"+d+"_colspan").colSpan&&(c=document.getElementById("scraptbl_"+l+"_"+d+"_colspan").colSpan),document.getElementById("scraptbl_"+l+"_"+d).checked)for(o[colCount]=tempcolNo,colCount++,i=1;c>i;i++)o[colCount]=tempcolNo+1,colCount++,tempcolNo++;else for(i=1;c>i;i++)tempcolNo++;tempcolNo++,d++}e=e+"&selectcols_"+l+"="+o,a+=""+l+':"'+o+'",'}}return""!==a&&(t+=a+"tblcnt:"+l),t+="}"}function setWebData(e,t,a){return t>=300?void showAlertDialog(jsMsg.ProblemInConfiguringWebData):(gridListener.listen(10),void(null!==e&&updateCell(e,t,a,"webData")))}function refreshWebData(e,t,a){sheetdialog.close(),t=WorkSheets.getSheetCodeFromName(t);var l=new RequestParameters(ActionConstants.UPDATE_WEB_DATA);l.setParameters("refresh",WorkSheets.getAssociatedActiveSheetName(),null,t,null,null,null,e,a);var s=new AjaxRequest;s.init("POST",l.getURL(),!0,l.getParametersAsString()),s.addEventListener("onComplete",function(e){if(""!==e.responseText){var t=parseJSON(e.responseText),a=t.clientUpdateJson;updateJson(a)}}),s.sendRequest(),showProgressMessage(jsMsg.UpdatingWebdata,!0)}function enableWebData(e,t){sheetdialog.close(),t=WorkSheets.getSheetCodeFromName(t);var a=new RequestParameters(ActionConstants.UPDATE_WEB_DATA);a.setParameters("enable",WorkSheets.getAssociatedActiveSheetName(),null,t,null,null,null,e,!1);var l=new AjaxRequest;l.init("POST",a.getURL(),!0,a.getParametersAsString()),l.addEventListener("onComplete",function(){}),l.sendRequest(),showProgressMessage(jsMsg.UpdatingWebdata,!0)}function showWebDataDetails(){if(sheetdialog.close(),ALL_SHEET_SHARED){versionDetailsNo++;var e=new RequestParameters(ActionConstants.JSP_REMOTEDATA_LIST);e.setParameters(DOCUMENT_ID,versionDetailsNo);var t={title:jsMsg["Data.ManageExternalData"],width:700},a=e.getURL()+"?"+e.getParametersAsString();sheetdialog.open("webDataDialog",t,void 0,void 0,a)}}function deleteWebData(e,t){var a=new RequestParameters(ActionConstants.UPDATE_WEB_DATA);a.setParameters("delete",WorkSheets.getAssociatedActiveSheetName(),null,e,t,null,null,null,!1);var l=new AjaxRequest;l.init("POST",a.getURL(),!0,a.getParametersAsString()),l.addEventListener("onComplete",function(){showWebDataDetails()}),l.sendRequest()}function editWebData(e,t,a,l,s,n){sheetdialog.close(),tempwebDataUrl="",extDatamode="edit",ewcellid=e,editurl=t,editsheet=a,editcell=l,edithtml=s,editsch=n;var i={title:jsMsg.EditExternalData,width:560};sheetdialog.open("externaldataeditdialog",i,{init:function(){setTimeout(function(){currSchedulePeriod="periodic",fillEditDetails()},200),RangeSelector.on({el:getObj("webdatacell_edit"),single:!0,callback:function(e){var t=e.indexOf(".");if(t>0){var a=e.substring(0,t);a=a.replace(/'/gi,""),$("#webdatasheet_edit").val(a)}else $("#webdatasheet_edit").val(CURRSHEETNAME)}})},destroy:function(){RangeSelector.off()}})}function fillEditDetails(){fillsheetNames(),webdataUrlType="csv","null"!==edithtml&&(webdataUrlType="html",getObj("edit_datatab").style.display=""),getObj("webdataurl_edit").value=editurl,getObj("webdatasheet_edit").value=editsheet,getObj("webdatacell_edit").value=editcell,"html"===webdataUrlType&&externalDataSelectionWizard(),selectEditSchedule()}function selectEditSchedule(){if("-"!==editsch)if(getObj("task_type_schedule").checked=!0,-1!==editsch.indexOf("daily")){toggleScheduleType("daily"),getObj("repeatinterval").value="daily",toggleSchedulePeriod("daily");var e=editsch.split("_");getObj("dailytime").value=getTimeHrs(e[1])}else if(-1!==editsch.indexOf("weekly")){toggleScheduleType("weekly"),getObj("repeatinterval").value="weekly",toggleSchedulePeriod("weekly");var t=editsch.split("_");getObj("weeklyinterval").value=t[1],getObj("weeklytime").value=getTimeHrs(t[2])}else if(-1!==editsch.indexOf("monthly")){toggleScheduleType("monthly"),getObj("repeatinterval").value="monthly",toggleSchedulePeriod("monthly");var a=editsch.split("_");getObj("monthlyinterval").value=a[1],getObj("monthlytime").value=getTimeHrs(a[2])}else toggleScheduleType("periodic"),getObj("periodicinterval").value=editsch}function selectHtmlEditTables(){message("","none");var e=edithtml.split("-");for(i=0;i<e.length;i++){var t=e[i].split(",");for(j=1;j<t.length;j++){var a=getObj("scraptbl_"+t[0]).parentNode.parentNode.parentNode.parentNode;a&&(a.style.display=""),getObj("scraptbl_"+t[0]+"_"+t[j])&&(getObj("scraptbl_"+t[0]+"_"+t[j]).checked=!0,deSelectExtDataTables(getObj("scraptbl_"+t[0]+"_"+t[j])))}}}function updateWebData(){message("","none"),wdCellId=ewcellid;var e=getObj("webdataurl_edit").value;if(""===e)return void showAlertDialog(jsMsg.PleaseProvideValidDataurl);var t=getObj("webdatasheet_edit").value,a=getObj("webdatacell_edit").value;if(""===a)return void showAlertDialog(jsMsg.StartCellCannotBeEmpty);var l="";getObj("task_type_schedule").checked&&(l=getScheduleName());count=0;var s="";if("html"===webdataUrlType&&(mode="htmlsave",s=getSelectTables(),"{}"===s))return void showAlertDialog(jsMsg.PleaseSelectAtleastOneTable);sheetdialog.close(),e=encodeURIComponent(e),t=WorkSheets.getSheetCodeFromName(t);var n=new RequestParameters(ActionConstants.UPDATE_WEB_DATA);n.setParameters("edit",WorkSheets.getAssociatedActiveSheetName(),e,t,a,l,s,wdCellId,!1),setProgressMessage(jsMsg.UpdatingWebdata);var i=new AjaxRequest;i.init("POST",n.getURL(),!0,n.getParametersAsString()),i.addEventListener("onComplete",function(e){if(""!==e.responseText){var t=parseJSON(e.responseText),a=t.clientUpdateJson;updateJson(a)}}),i.sendRequest()}function getScheduleName(){var e=getObj("repeatinterval").value;if("periodic"===e)return getObj("periodicinterval").value;if("daily"===e){var t=getObj("dailytime").value;return"daily_"+getTimeMinutes(t)}if("weekly"===e){var a=getObj("weeklytime").value,l=getObj("weeklyinterval").value;return"weekly_"+l+"_"+getTimeMinutes(a)}if("monthly"===e){var s=getObj("monthlytime").value,n=getObj("monthlyinterval").value;return"monthly_"+n+"_"+getTimeMinutes(s)}}function getTimeMinutes(e){var t=e.split(":"),a=parseInt(60*t[0])+parseInt(t[1]);return a}function getTimeHrs(e){var t=Math.floor(parseInt(e)/60),a=""+parseInt(e)%60;a=1===a.length?a+"0":a;var l=t+":"+a;return l}var webdataUrlType="csv",tempwebDataUrl="",extDatamode="",currSchedulePeriod="",ewcellid,editurl,editsheet,editcell,edithtml,editsch;function exportDoc(e,t,i){if(allowExport||"print"==t){if(isCellEdited()||exprFieldKeyPressed)return submitCallBack={action:"exportDoc",args:[e,t,i]},void submitCell();(jsNEW_DOC_VIEW||jsOPEN_DOC_VIEW||jsSHARE_VIEW)&&(FROMEXPORT=!1,EXPORTTYPE="",TEMPPRTVAR=""),isExportEvent=!0;var s="";if("publicHTML"==t||"publicHTML"==e||ALL_SHEET_SHARED||"print"==t){var r="";if(!jsGADGET_VIEW){if("publicHTML"==t||"publicHTML"==e)r=DOCUMENT_NAME;else if(jsGUEST_VIEW||jsPUBLIC_VIEW||jsREMOTE_VIEW||jsTHROWAWAY_VIEW||jsVERSION_VIEW||jsREMOTE_SAVE_VIEW){var o=getObj("sp_docName");r=o&&o.getAttribute("docname")?o.getAttribute("docname"):DOCUMENT_NAME,o=null}else r=DOCUMENT_NAME;r=encodeURIComponent(r);var E=encodeURIComponent(CURRSHEETNAME)}var a=getViewType();if("print"!=t){if(jsREMOTE_VIEW&&(a="REMOTE_SAVE_VIEW"),jsGADGET_VIEW)exurl=ctxpath+"export.do?fname="+jsMsg["Gadget.FileName"]+"&docid="+DOCUMENT_ID+"&curtime="+CURRENTTIME+"&viewType="+a+"&ftype="+e;else{var n=!1;if("publicHTML"!=t&&"publicHTML"!=e&&(jsNEW_DOC_VIEW||jsTHROWAWAY_VIEW||jsREMOTE_VIEW)&&(n=!0),isDocumentPublic||isDocumentSemiPublic);else;}exportFlag=!0;var l=new RequestParameters(ActionConstants.EXPORT_DOCUMENT);if(l.setParameters(CURRSHEETNAME,e,DOCUMENT_VERSION),exurl=l.getURL()+"?"+l.getParametersAsString(),jsPUBLIC_VIEW||jsREMOTE_SAVE_VIEW||jsREMOTE_VIEW||isGDriveView||DR_SERVER){var l=new RequestParameters(ActionConstants.EXPORT_DOCUMENT);l.setParameters(CURRSHEETNAME,e,DOCUMENT_VERSION),exurl=l.getURL()+"?"+l.getParametersAsString(),exurl+="&skipL7Check=true";var d=document.forms.utilFORM;d.method="post",d.action=exurl,d.zsreqcsr.value=readCookie(csrfCookieName),isPublished||(d.target="hid_imp_doc"),d.submit(),exportFlag=!1}else if(ALLOW_TO_WRITE||jsVERSION_VIEW&&""==DOCUMENT_VERSION){var l=new RequestParameters(ActionConstants.SAVE_DOCUMENT);l.setParameters(CURRSHEETNAME);var c=new AjaxRequest;c.init("POST",l.getURL(),!0,l.getParametersAsString()),c.addEventListener("onComplete",function(){if(e=e.substring(e.lastIndexOf(".")+1),"csv"==e||"tsv"==e||cdview){exurl+="&skipL7Check=true";var t=document.forms.utilFORM;t.method="post",t.action=exurl,t.zsreqcsr.value=readCookie(csrfCookieName),isPublished||(t.target="hid_imp_doc"),getObj("utilFORMContainer").innerHTML="",t.submit()}else exurl="https://"+DOCS_SERVER_URL+"/downloaddoc.do?docId="+RESOURCE_ID+"&docExtn="+e,document.getElementById("hid_imp_doc").src=exurl;exportFlag=!1,sheetdialog.close()}),c.sendRequest()}else e=e.substring(e.lastIndexOf(".")+1),exurl="https://"+DOCS_SERVER_URL+"/downloaddoc.do?docId="+RESOURCE_ID+"&docExtn="+e,jsVERSION_VIEW&&""!=DOCUMENT_VERSION&&(exurl+="&version="+DOCUMENT_VERSION),document.getElementById("hid_imp_doc").src=exurl,exportFlag=!1,sheetdialog.close()}else{if(image_urls="","publicHTML"!=e){if(isCellRange()){var R=getCellRange();s="&range="+R.startRow+":"+R.startCol+":"+R.endRow+":"+R.endCol}for(var u=sheet.getElementsByTagName("IMG"),_=0;_<u.length;_++)if("undefined"!=typeof u[_].id){var O=ExcelGraph.getInstance(u[_].id);if(null!=O){var I=O.CP_TOP,m=O.CP_LEFT,T=O.CP_WIDTH,p=O.CP_HEIGHT;IMGSrc=u[_].src,image_urls+=IMGSrc+"*"+I+"*"+m+"*"+T+"*"+p+"+"}else if(u[_].id){var I=u[_].style.top,m=u[_].style[isRTL?"right":"left"],T=u[_].width,p=u[_].height;IMGSrc=u[_].src,image_urls+=IMGSrc+"*"+I+"*"+m+"*"+T+"*"+p+"+"}}}var M=0,C=document.forms.utilFORM;if(ole){var g=ole.getObjects("button");for(x in g)M++}s+="&viewType="+a,sheetdialog.close();var v=ctxpath;REMOTE.ISRMVIEW?(v+="null"==RESOURCE_ID?"remoteprintpreview.do?":"printpreview.do?rid="+RESOURCE_ID+"&",v+="RMNAME="+RMUSER+"&doc="+DOCUMENT_INFO.DOCUMENT_POINTER):v+="printpreview.do?rid="+RESOURCE_ID,v+="&sheetName="+E+"&browser_ie="+browser_ie+s+"&feButtonCount="+M,jsPUBLIC_VIEW&&isInOOMode&&(v+="&tempPublicDocId="+tempPublicDocId),browser_safari?window.open(v,"_blank"):(getObj("utilFORMContainer").innerHTML="",C.action=v,C.target="_blank",C.submit())}}}}function exportDocs(e){if(allowExport){var t=0,i=!1;docids="";var s="";for("shrdocs"==SIDEBAR_VIEW?s="shrdocs":"mydocs"==SIDEBAR_VIEW?s="mydocs":"search"==SIDEBAR_VIEW?s="srchdocs":"mytemplates"==SIDEBAR_VIEW&&(s="mytempl");;){var r=document.getElementById(s+"_"+t);if(null==r)break;r.checked&&(i=!0,docids=""==docids?r.value:docids+","+r.value),t++}if(!i)return void showAlertDialog(jsMsg.SelectAtleastOneDocument);var o=docids.split(",");if(!MKIMODE&&o.length>10)return void showAlertDialog(jsMsg.ExportLimit);var E=document.forms.utilFORM;isPublished||(E.target="hid_imp_doc"),E.method="post",E.action=ctxpath+"zipexport.do?docids="+docids+"&type="+e,getObj("utilFORMContainer").innerHTML="<input type='hidden' name='"+csrfParamName+"' value='"+readCookie(csrfCookieName)+"'>",E.submit()}}var image_urls="",printOptions="",FROMEXPORT=!1,EXPORTTYPE="",TEMPPRTVAR="";var tableObj=void 0,ztable=function(t){var e,o,n={width:"500px",height:"200px",colselection:!1},l=[],a=[],s=0,d=0,p=0,u=0,f="",h=0,v=0,b=0,w=void 0,x=function(i){l=i,y();var n=t("<div/>",{class:"ui-ztable-container"}).appendTo(f);e=t("<div/>",{class:"ui-ztable-hcontainer",style:"width:"+(h-37)+"px"}).appendTo(n),o=t("<div/>",{class:"ui-ztable-bcontainer",style:"height:"+(v-21)+"px; width:"+(h-37)+"px"}).appendTo(n),m(e),C(o),j(),g()},T=function(){p=0,u=0,h=0,v=0,s=0,d=0,f="",a=[]},z=function(t){h=t.width,v=t.height,a=t.columnWidths,b=t.startRow,Object.keys(t).forEach(function(e){n[e]=t[e]})},g=function(){v-21>=u&&f.find(".ui-ztable-hcontainer").css("overflowY","hidden")},y=function(){if(d=l.length,s=a.length,0===a.length){var e=t("<span/>",{id:"tempSpan",style:"white-space:nowrap"}).appendTo("body");for(r=0;d>r;r++){for(c=0;s>c;c++){var o=l[r][c];if(o=o?decodeURIComponent(o.trim()):"",""!==o){e.text(o);var n=e[0].offsetWidth}var f=a[c];f||(f=a[c]=80),n>f&&(a[c]=n)}u+=21}e.remove()}else u=21*d;var h=0;for(i=0;s>i;i++)h+=a[i]+11;p=h},m=function(e){var o=t("<div/>",{style:"width:"+p+"px",class:"ui-ztable"}).appendTo(e),n=t("<div/>",{style:"width:"+p+"px",class:"ui-ztable-row"}).appendTo(o);for(i=0;s>i;i++)t("<div/>",{id:"h"+i,onclick:"TexttoColumns.selectCol(this)",style:"width:"+a[i]+"px",class:"ui-ztable-cell",text:jsMsg.General}).appendTo(n)},C=function(e){var i=t("<div/>",{style:"width:"+p+"px",class:"ui-ztable"}).appendTo(e);for(r=0;d>r;r++){var o=t("<div/>",{style:"width:"+p+"px",class:"ui-ztable-row",id:"r"+(r+1)}).appendTo(i);if(isRTL)for(c=s-1;c>=0;c--){var n=l[r][c];n=n?n.replace(/\+/g," "):"",n=decodeURIComponent(n.trim()),t("<div/>",{style:"width:"+a[c]+"px",class:"ui-ztable-cell",text:n,onclick:"TexttoColumns.selectRow(this)"}).appendTo(o)}else for(c=0;s>c;c++){var n=l[r][c];n=n?n.replace(/\+/g," "):"",n=decodeURIComponent(n.trim()),t("<div/>",{style:"width:"+a[c]+"px",class:"ui-ztable-cell",text:n,onclick:"TexttoColumns.selectRow(this)"}).appendTo(o)}}},k=function(e){void 0!=w&&R(w);var o=t(".ui-ztable-bcontainer").find(".ui-ztable-row"),n=o.length;for(n>25&&(n-=1),i=0;n>i;i++)t(o[i].children[e]).css("background-color","#f5f5f5");w=e},R=function(e){var o=t(".ui-ztable-bcontainer").find(".ui-ztable-row"),n=o.length;for(n>25&&(n-=1),i=0;n>i;i++)t(o[i].children[e]).css("background-color","")},j=function(){o.on("scroll",function(e){{var i=this.scrollLeft;this.scrollTop}return t(this).siblings(".ui-ztable-hcontainer").scrollLeft(i),e.stopPropagation(),e.preventDefault(),!1}),n.colselection&&e.find(".ui-ztable-cell").on("click",function(){t("#TTCDropdown").attr("disabled",!1);var e=t(this).index();k(e)})},I=function(t,e,i){T(),f=t,z(i),x(e)},L=function(){return w};return{createTable:I,getIndex:L}}(jQuery);var TexttoColumns={dialog:!1,separatorsList:"",enclosure:"",isMergeDelimitersChecked:!1,cellContent:"",isSubmitBtnClicked:!1,isTexttoColumnBtnClicked:!1,ttcLocale:"",startsFromRow:1,curStartRow:1,count:0,maxRowCnt:0,maxColCnt:0,maxPreviewRows:25,init:function(t){var e={autoOpen:!1,closeOnEscape:!0,minHeight:10,width:550,resizable:!1,sheetswitch:!1,title:jsMsg["TexttoColumns.Title"],close:function(){setFocusInCellField()}},o={set:function(t){var e=t.action;"ttcEnclosure"==e?TexttoColumns.getEnclosure():"setFormatToColumn"==e?TexttoColumns.setFormatToColumn():"selectStartRow"==e&&TexttoColumns.selectStartRow()},init:function(){TexttoColumns.separatorsList="	",TexttoColumns.enclosure='"',TexttoColumns.isMergeDelimitersChecked=!1,setTimeout(function(){$("#tab_ttc").bind("click",function(){TexttoColumns.getSeparator(this)}),$("#semicolon_ttc").bind("click",function(){TexttoColumns.getSeparator(this)}),$("#comma_ttc").bind("click",function(){TexttoColumns.getSeparator(this)}),$("#space_ttc").bind("click",function(){TexttoColumns.getSeparator(this)}),$("#otherdelimiter_ttc").bind("click",function(){TexttoColumns.otherDelimiters(this)}),$("#otherdelimitertext_ttc").bind("keyup",function(){TexttoColumns.others(),TexttoColumns.getSeparator(this)}),$("#mergedelimiters").bind("click",function(){TexttoColumns.mergeDelimiters(this)}),$("#texttoColumnsDiv input").on("keydown",function(t){13===t.which&&("otherdelimitertext_ttc"===document.activeElement.id&&(document.activeElement==$("#otherdelimiter_ttc"),$("#otherdelimiter_ttc").focus()),TexttoColumns.submit())}),$("#texttoColumnsDiv .ui-zcombo").on("keydown",function(t){13===t.which&&TexttoColumns.submit()}),TexttoColumns.setTargetCell(),TexttoColumns.getColumnData(TexttoColumns.separatorsList,TexttoColumns.enclosure,TexttoColumns.isMergeDelimitersChecked)},100),$("#destTTC").focus(function(){var t=this;RangeSelector.on({el:t,single:!0,appendSheetName:!0})})},destroy:function(){RangeSelector.off()},beforeFillValues:function(){TexttoColumns.isTexttoColumnBtnClicked||setTimeout(function(){$("#ttcLocale").zcombo("setValue",docLocale)},200)}},s=getCellRange(),l=s.startRow,n=s.startCol,i=s.endRow,r=s.endCol;if("TTCBtnClicked"==t&&(TexttoColumns.isTexttoColumnBtnClicked=!0),TexttoColumns.isTexttoColumnBtnClicked){var a=isCellRangeContainsValues(l,n,i,r);n==r?a?sheetdialog.open("texttocolumns",e,o):(TexttoColumns.isTexttoColumnBtnClicked=!1,showAlertDialog(jsMsg["TexttoColumns.NoDataWasSelectedToParse"])):(TexttoColumns.isTexttoColumnBtnClicked=!1,showAlertDialog(jsMsg["TexttoColumns.ConvertsOneColumnAtATime"]))}else sheetdialog.open("texttocolumns",e,o)},getColumnData:function(t,e,o){void 0==t&&(t=""),void 0==e&&(e=""),void 0==o&&(o=!1);var s=TexttoColumns.getTargetCell(),l="",n="";if(TexttoColumns.cellContent.length>0?$("#ttcImport").css("display","block"):$("#ttcImport").css("display","none"),TexttoColumns.isSubmitBtnClicked){n={};var i="",r="",a="",c="",u="";TexttoColumns.isTexttoColumnBtnClicked?TexttoColumns.ttcLocale=docLocale:(TexttoColumns.ttcLocale=getObj("ttcLocale").value,TexttoColumns.startsFromRow=getObj("ttcStartRow").value),l=new RequestParameters(ActionConstants.TEXTTOCOLUMNS_APPLY);for(var m=TexttoColumns.getColumnHeaders(),C=0;C<m.length;C++)"Text"==m[C]?(i+=C,i+=","):"Date (DMY)"==m[C]?(r+=C,r+=","):"Date (MDY)"==m[C]?(a+=C,a+=","):"Date (YMD)"==m[C]?(c+=C,c+=","):"Hide"==m[C]&&(u+=C,u+=",");i.length>0&&(i=i.substring(0,i.length-1),n.Text="["+i+"]"),r.length>0&&(r=r.substring(0,r.length-1),n.DMY="["+r+"]"),a.length>0&&(a=a.substring(0,a.length-1),n.MDY="["+a+"]"),c.length>0&&(c=c.substring(0,c.length-1),n.YMD="["+c+"]"),u.length>0&&(u=u.substring(0,u.length-1),n.Hide="["+u+"]"),n=JSON.stringify(n)}else l=new RequestParameters(ActionConstants.TEXTTOCOLUMNS_PREVIEW);var d=getCellRange(),T=d.startRow,g=d.startCol,x=d.endRow,h=d.endCol;TexttoColumns.isTexttoColumnBtnClicked?TexttoColumns.cellContent="":T=g=x=h=-1;var w=WorkSheets.getSheetCodeFromName(CURRSHEETNAME);if(TexttoColumns.count+=1,TexttoColumns.isSubmitBtnClicked){if(cellRangeContainsMergeCells(s.row,s.col,s.row,s.col))return TexttoColumns.isSubmitBtnClicked=!1,showAlertDialog(jsMsg.CannotPasteIntoMergedCell),hideProgressMessage(),!0;var d=getCellRange();cellRangeContainsMergeCells(d.startRow,d.startCol,d.endRow,d.endCol)||adjustColsAndRowsForTextArea(),l.setParameters(w,WorkSheets.getAssociatedActiveSheetName(),T,g,x,h,encodeURIComponent(t),e,o,s.row,s.col,n,encodeURIComponent(TexttoColumns.cellContent),TexttoColumns.ttcLocale,TexttoColumns.startsFromRow)}else{if(l.setParameters(w,WorkSheets.getAssociatedActiveSheetName(),T,g,x,h,encodeURIComponent(t),e,o,encodeURIComponent(TexttoColumns.cellContent),TexttoColumns.startsFromRow),TexttoColumns.count>1){var f=$("#TTCDropdown").zcombo("getValue");"1"!==f&&$("#TTCDropdown").zcombo("setValue",1)}message(jsMsg.Loading,"none"),TexttoColumns.showLoadingMessage()}var v=new AjaxRequest;v.init("POST",l.getURL(),!0,l.getParametersAsString()),v.addEventListener("onComplete",function(t){var e=t.responseText;if(void 0===TexttoColumns.isSubmitBtnClicked||TexttoColumns.isSubmitBtnClicked){var o=JSON.parse(e);if(o.a==ActionConstants.SHOW_ERROR_MESSAGE)return hideProgressMessage(),TexttoColumns.isSubmitBtnClicked=!1,void ErrorMsg.show(o);TexttoColumns.closeDialog(),TexttoColumns.destroy()}else{var s=JSON.parse(e).result1,l=JSON.parse(e).result2,n=JSON.parse(e).result3;if(TexttoColumns.isTexttoColumnBtnClicked&&(n=0),s.length<=0&&n>0)showAlertDialog(jsMsg["Error.Starts.From.Row.Limit.Exceed"]);else if(s.length>0){var i=$("<div/>",{id:"ttcPreviewWidthTable"}).appendTo("body");i.html(l);for(var r=getObj("ttcPreviewWidthTable").getElementsByTagName("tr"),a=r[0],c=[],u=a.children,m=0;m<u.length;m++){var C=u[m].offsetWidth;80>C&&(C=80),c[m]=C}if(i.remove(),TexttoColumns.maxRowCnt=s.length,TexttoColumns.maxColCnt=u.length,TexttoColumns.curStartRow=n,s.length){$("#ttcPreviewTable").html("");var d={width:537,height:146,colselection:!0,columnWidths:c,startRow:TexttoColumns.curStartRow};ztable.createTable($("#ttcPreviewTable"),s,d),$("#ttcPreviewTable").css("border","0px"),isRTL&&$("#ttcPreviewTable").css("direction","rtl"),$("#h0").click(),s.length>TexttoColumns.maxPreviewRows&&TexttoColumns.showFadeOutBox()}}else{var d={minHeight:10,width:340,resizable:!1,modal:!0,title:jsMsg["TexttoColumns.Title"]};sheetdialog.open("texttocolumns",d),$("#texttoColumnsDiv").hide(),$("#noData").show();var T=$(".ui-dialog").filter(":visible");T.css("top","40%"),T.css("width","350px");var g=T.find(".ui-dialog-titlebar-close");g.css("visibility","hidden"),$("#ui-dialog-title-texttocolumnszdialog").html(jsMsg["Service.ZohoOffice"])}TexttoColumns.hideLoadingMessage()}}),v.addEventListener("onError",function(){showAlertDialog(jsMsg.TheServerHasEncounteredProblem),TexttoColumns.closeDialog(),TexttoColumns.destroy(),TexttoColumns.hideLoadingMessage()}),TexttoColumns.isSubmitBtnClicked?actionManager.addRequest(v):setTimeout(function(){v.sendRequest()},30)},others:function(){var t=getObj("otherdelimiter_ttc");t.checked=!0},otherDelimiters:function(t){"checked"==$("#otherdelimiter_ttc").attr("checked")?($("#otherdelimitertext_ttc").focus(),$("#otherdelimitertext_ttc").val().length>0&&TexttoColumns.getSeparator(t)):TexttoColumns.getSeparator(t)},submit:function(){var t=$("#destTTC").val();t=CellUtils.removeApostrophe(t),t=t.replace(/\$/g,"").replace(".","!");var e=CURRSHEETNAME;-1!==t.indexOf("!")&&(e=t.split("!")[0]);var o=CellUtils.checkCellLbl(t,"TexttoCol");if(!o||e.toLowerCase()!==CURRSHEETNAME.toLowerCase())return showAlertDialog(jsMsg["CellReference.Msg.Invalid"]),void $("#destTTC").focus();var s=TexttoColumns.getTargetCell().row,l=TexttoColumns.getTargetCell().col,n=getCell(s,l);"hide"!=getCellContent(n,"fn")?(showProgressMessage(jsMsg["Notify.Pasting"]),TexttoColumns.isSubmitBtnClicked=!0,setTimeout(function(){TexttoColumns.getColumnData(TexttoColumns.separatorsList,TexttoColumns.enclosure,TexttoColumns.isMergeDelimitersChecked)},30)):showAlertDialog(jsMsg["PublicView.ProtectedCell"])},closeDialog:function(){$("#texttocolumnsdialog").is(":visible")&&sheetdialog&&sheetdialog.close()},destroy:function(){TexttoColumns.dialog=!1,clearCellRangeFill(),delete TexttoColumns.separatorsList,delete TexttoColumns.enclosure,delete TexttoColumns.isMergeDelimitersChecked,TexttoColumns.isSubmitBtnClicked=!1,TexttoColumns.isTexttoColumnBtnClicked=!1,TexttoColumns.cellContent="",TexttoColumns.ttcLocale="",TexttoColumns.count=0,TexttoColumns.maxRowCnt=0,TexttoColumns.maxColCnt=0,TexttoColumns.startsFromRow=1,TexttoColumns.curStartRow=1,isenterKeyPressed&&(isenterKeyPressed=!1)},setTargetCell:function(){TexttoColumns.dialog=!0;var t=$(".ui-dialog").filter(":visible").find(".ui-icon-closethick");$(t).bind("mousedown",TexttoColumns.destroy);var e=getCellRange(),o=ActiveCellInfo.getStartRow();e.startRow!==o&&(o=e.startRow),isColSelected()&&(o=0);var s=ActiveCellInfo.getStartCol();e.startCol!==s&&(s=e.startCol),$("#destTTC").val(CellUtils.addApostrophe(CURRSHEETNAME+"."+getColHeadLabel(s+1)+getRowHeadLabel(o))),$("#destTTC").focus()},getTargetCell:function(){var t=$("#destTTC").val();if(t){t=t.replace(".","!");var e=CURRSHEETNAME;-1!=t.indexOf("!")&&(e=t.substring(0,t.indexOf("!")),e=CellUtils.getRequiredSheetNames(e).sheetName,t=t.substring(t.indexOf("!")+1,t.length)),e==CURRSHEETNAME&&(pos=CellUtils.getCellPosByLabel(t))}return{row:pos.row,col:pos.col}},getEnclosure:function(){TexttoColumns.enclosure=$("#textDelimiter").zcombo("getValue"),TexttoColumns.getColumnData(TexttoColumns.separatorsList,TexttoColumns.enclosure,TexttoColumns.isMergeDelimitersChecked)},mergeDelimiters:function(t){TexttoColumns.isMergeDelimitersChecked=t.checked?!0:!1,TexttoColumns.getColumnData(TexttoColumns.separatorsList,TexttoColumns.enclosure,TexttoColumns.isMergeDelimitersChecked)},selectCol:function(t){$("#TTCDropdown").zcombo("enable"),TexttoColumns.resetDropDownMenu(t.innerHTML)},selectRow:function(t){if(!TexttoColumns.isTexttoColumnBtnClicked){var e=t.parentNode.id,o=parseInt(e.split("r")[1]);o==TexttoColumns.maxPreviewRows+1&&(o-=1),o=TexttoColumns.curStartRow+o-1;{$("#ttcStartRow").zspinner("setValue",o)}TexttoColumns.selectStartRow()}},setFormatToColumn:function(){var t=ztable.getIndex(),e=$("#TTCDropdown").zcombo("getSelectedOption").innerHTML;$("#h"+t).text(e)},selectStartRow:function(){TexttoColumns.startsFromRow=getObj("ttcStartRow").value;for(var t=TexttoColumns.startsFromRow-TexttoColumns.curStartRow,e=$(".ui-ztable-bcontainer").find(".ui-ztable-row"),o=0;t-1>=o;o++)e[o]&&(e[o].style.opacity="0.4");for(var s=t;s<=TexttoColumns.maxPreviewRows;s++)e[s]&&(e[s].style.opacity="1")},getColumnHeaders:function(){var t=[],e=$(".ui-ztable-hcontainer").find(".ui-ztable-row"),o=e[0].children.length;if(isRTL)for(j=o-1,i=0;j>=0;j--,i++)t[i]=e[0].children[j].textContent;else for(j=0;o>j;j++)t[j]=e[0].children[j].textContent;return t},showFadeOutBox:function(){var t=$(".ui-ztable-bcontainer").find(".ui-ztable-row"),e=t[TexttoColumns.maxPreviewRows];if(e){e.style.position="absolute",e.style.top="504px";for(var o=e.children.length,s=0;o>s;s++)e.children[s].textContent="",e.children[s].style.height="21px",e.className="fadeOutBox";for(var t=$(".ui-ztable-bcontainer").find(".fadeOutBox"),l=t[0].children.length,n=0;l>n;n++)t[0].children[n].style.borderBottom="0px",t[0].children[n].style.borderRight="0px"}},resetDropDownMenu:function(t){for(var e=$("#TTCDropdown")[0].options.length,o=0;e>o;o++){var s=$("#TTCDropdown")[0].options[o].text;if(t==s)break}$("#TTCDropdown").zcombo("setValue",o+1)},showLoadingMessage:function(){$("#ttcPreviewTable").addClass("lI")},hideLoadingMessage:function(){$("#ttcPreviewTable").removeClass("lI")},getSeparator:function(){var t="",e="",o="",s="",l="",n=getObj("tab_ttc");"tab"==n.name&&(t=n.checked?n.value+"TTC":""),n=getObj("comma_ttc"),"comma"==n.name&&(e=n.checked?n.value+"TTC":""),n=getObj("semicolon_ttc"),"semicolon"==n.name&&(o=n.checked?n.value+"TTC":""),n=getObj("space_ttc"),(n.name="space")&&(s=n.checked?n.value+"TTC":""),n=getObj("otherdelimiter_ttc"),"otherdelimiter"==n.name&&(n.checked?(n=getObj("otherdelimitertext_ttc"),l=n.value):l=""),TexttoColumns.separatorsList=t+e+o+s+l,TexttoColumns.getColumnData(TexttoColumns.separatorsList,TexttoColumns.enclosure,TexttoColumns.isMergeDelimitersChecked)}};!function(n){n.widget("ui.zannouncementbar",{widgetEventPrefix:"zannouncementbar",options:{autoOpen:!1,message:void 0,learnMoreLink:void 0,type:void 0,learnMoreText:void 0},_EVENTS:{ONBEFOREOPEN:"onbeforeopen",ONOPEN:"onopen",ONBEFORECLOSE:"onbeforeclose",ONCLOSE:"onclose"},_create:function(){this._defaultClass=this.element.attr("class"),this.element.attr("class",this._defaultClass+(this.options.autoOpen?" ":" ui-zannouncebar-collapse ")+" ui-zannouncebar ui-zannouncebar-transition");var t=this.options.message?this.options.message:this.element.text(),e=(this.options.type?this.options.type.toLowerCase():"whatsnew")+".label",i=this._getString(e);i==="[noi18n] "+e&&(i=this._getString("announcement.label"),this.options.type="announcement"),"announcement"===this.options.type&&(i+=":");var o=this.options.learnMoreText?this.options.learnMoreText:this._getString("more.label"),s=this.options.learnMoreLink?"<a href="+this.options.learnMoreLink+" target='_blank'>"+o+"</a>":"",a="<div class='ui-zannouncebar-content'><b>"+i+"</b> "+t+s+"</div>";a+="<div class='ui-zannouncebar-closebtn' title="+this._getString("close.label")+" ><a id='ui-zannouncebar-close'><span class='ui-zannouncebar-close'>close</span></a></div>",this.element.html(a),this._transitionSupport=void 0!==n("body").css("transition")?!0:!1,this.options.autoOpen&&this.open();var r=this;n("#ui-zannouncebar-close").click(function(n){r.close(n),n.preventDefault(),n.stopPropagation()})},_openEffectDuration:800,_closeEffectDuration:600,open:function(){var t=this;this.options.autoOpen&&"complete"!==document.readyState?n(window).on("load.zannouncebar",function(){t._open()}):setTimeout(function(){t._open()},1)},_open:function(){var n=this._triggerEvent(this._EVENTS.ONBEFOREOPEN);if(!1!==n){var t=this,e=this._defaultClass+" ui-zannouncebar-effect ui-zannouncebar ui-zannouncebar-expand "+(this._transitionSupport?"ui-zannouncebar-transition":"ui-zannouncebar-non-transition");t.element.attr("class",e),t._transitionSupport||t.element.slideDown(t._openEffectDuration),setTimeout(function(){t._triggerEvent(t._EVENTS.ONOPEN)},t._openEffectDuration)}},close:function(n){var t=this._triggerEvent(this._EVENTS.ONBEFORECLOSE,n);if(!1!==t){this._transitionSupport?this.element.attr("class",this._defaultClass+" ui-zannouncebar ui-zannouncebar-effect"):this.element.slideUp(this._closeEffectDuration);var e=this;setTimeout(function(){e.element.addClass("ui-zannouncebar-collapse"),e._triggerEvent(e._EVENTS.ONCLOSE)},e._closeEffectDuration)}},_triggerEvent:function(n,t){var e=this;return this._trigger(n,t,e)},_getString:function(t,e){return n.i18n?n.i18n(e?e:"zannouncementbar",t):this.options.keys[t]},destroy:function(){n(this.element).empty(),n(this.element).unbind("."+this.widgetName),n.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery);var AnnouncementBanner=function(n){function e(){if(!r){if(r=!0,DR_SERVER){var e="<div ctype='zannouncementbar'   id='zannouncementbarnewRO' data=\"{'type':'announcement', 'message':'"+jsMsg["Banner.ReadOnly.App.Server"]+"',autoOpen:true}\" ></div>";return void t("zannouncementbarnewRO",e)}if((jsOPEN_DOC_VIEW||jsSHARE_VIEW)&&!cdview){var o=ctxpath+"bannerRequest.do",a=localStorage?localStorage.getItem("AB"):null;""==(a||"")&&(a=null);var i="BANNER_MSG",u="BANNER_LEARN",c="BANNER_LINK",d="BANNER_TYPE";n.ajax({type:"POST",url:o,data:{action:ActionConstants.REQUEST_BANNER,bannerName:a,bv:BUILD_VERSION}}).done(function(e){if(!n.isEmptyObject(e)){if(isUndefined(e[i])||""==e[i])return;var o,a="announcement";if(e[d]&&(a=e[d]),isUndefined(e[u])||""==e[u])if(isUndefined(e[c])||""==e[c]){var r="<div ctype='zannouncementbar' id='zannouncementbarnew' data=\"{'type':'"+a+"', 'message':'"+e[i]+"',autoOpen:true}\" ></div>";o=!0}else var r="<div ctype='zannouncementbar' id='zannouncementbarnew' data=\"{'type':'"+a+"', 'message':'"+e[i]+"',autoOpen:true,'learnMoreLink':'"+e[c]+"'}\" ></div>";else r="<div ctype='zannouncementbar' id='zannouncementbarnew' data=\"{'type':'"+a+"', 'message':'"+e[i]+"',autoOpen:true,'learnMoreLink':'"+e[c]+"','learnMoreText':'"+e[u]+"'}\" ></div>";t("zannouncementbarnew",r,e.bannerName,o)}})}}}function t(e,t,o,u){n("#"+e).remove(),n("#bannerHolder").remove();var c=n("<div>",{id:"aboveTopBand"}),d=n("#ztb-topband"),s=d.position().top,p=d.position().left;c.css({top:s,left:p,width:d.width(),height:"34px",zIndex:0+BASEZINDEX}),c.addClass("ui-ztopband-background"),n(document.body).prepend(c);var m=n("<div>",{id:"bannerHolder"});m.css({position:"absolute",top:c.position().top,left:c.position().left,width:"100%",height:c.height()+"px"}),n(document.body).append(m),m.append(t),a();var b=n("#"+e);0!=b.length&&(u&&b.bind("zannouncementbaronbeforeopen",function(){n(".ui-zannouncebar-content").find("span:first").hide(),n(".ui-zannouncebar-closebtn").hide()}),b.bind("zannouncementbaronopen",function(){"zannouncementbarnewRO"===e&&DR_SERVER&&n("#zannouncementbarnewRO .ui-zannouncebar-content").find("span:first").hide()}),b.bind("zannouncementbaronclose",function(){c.remove(),i(),r=!1,setTimeout(function(){m.remove(),n("#"+e).remove()},1e3),"zannouncementbarnew"===e&&o&&localStorage&&localStorage.setItem("AB",o)}),n.ui.utils.initDeferredComponents(b,1))}function o(){if(n("#copyButton").length>0)var e=n("#copyButton").offset();else var e=n("#rocopyButton").offset();null!==e&&n("#copyButtonDiv").css({left:e.left,top:e.top})}function a(){resetSheetDim(),o()}function i(){resetSheetDim(),o(),appEvent.trigger("docpanel.resetDim")}var r=!1;return jsVERSION_VIEW||setTimeout(function(){e()},5e3),{showBanner:t}}(jQuery);var autoFormula=function(){function e(e){var a="";switch(e){case"DOLLAR":a=decodeURIComponent("%24");break;case"EURO":a=decodeURIComponent("%E2%82%AC");break;case"POUND":a=decodeURIComponent("%C2%A3");break;case"RUPEE":a=decodeURIComponent("Rs.");break;case"YEN":a=decodeURIComponent("%EF%BF%A5");break;case"RMB":a=decodeURIComponent("%EF%BF%A5");break;case"PERCENT":a=decodeURIComponent("%25")}return a}function a(e){decimalSymbol=44===decSymbol?",":".";var a=e.getAttribute("format"),t=e.getAttribute("cv"),n=e.getAttribute("fn"),o={"#DIV/0!":"0","#NAME?":"1","#N/A":"2","#NULL!":"3","#NUM!":"4","#REF!":"5","#VALUE!":"6","#CIRCULARREF!":"7"},r=-1,u=-1,s=-1,i=-1;return null!==t&&(r=t.indexOf(userThousandSeparator),u=t.indexOf(decimalSymbol),s=t.indexOf("{="),i=t.indexOf("/")),o[t]||"STRING"===a?!1:(null===a||"CURRENCY"===a||"FRACTION"===a&&i>-1)&&isNaN(t)&&null!==n?!0:"DATE"===a||"TIME"===a||"DATETIME"===a||"SCIENTIFIC"===a||"PERCENT"===a?!0:t!==n&&null!==n&&("FLOAT"===a||null===a&&-1===s)||r>-1||u>-1?!0:!1}function t(e,a,t,o){var r=getCellRange();if(r.startRow===e&&r.startCol===a&&r.endRow===t&&r.endCol===o){null!==C&&(null!==p&&(p.className="disabled"),"none"===b.style.display&&(b.style.display="inline-block"));var u=getServerRange(r.startRow,r.startCol,r.endRow,r.endCol),e=u.startRow,a=u.startCol,t=u.endRow,o=u.endCol,s=new RequestParameters(ActionConstants.AUTO_SUM);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,a,t,o);var i=new AjaxRequest;i.init("POST",s.getURL(),!0,s.getParametersAsString()),i.addEventListener("onComplete",function(r){var u=parseJSON(r.responseText);isFromServer=!0;var s=u.statusFunc;if(void 0!==s){var i,l=0;for(i in s)l++;var c="{";c+=1===l?'"Count":"'+s.count+'"':'"Sum":"'+s.sum+'","Count":"'+s.count+'","Average":"'+s.avg+'","Count Numbers":"'+s.cn+'","Minimum":"'+s.min+'","Maximum":"'+s.max+'"',c+="}",n(e,a,t,o,JSON.parse(c))}else C="",n(e,a,t,o);isFromServer=!0}),i.sendRequest()}else clearInterval(g)}function n(e,a,t,n,u){var s=getCellRange(),i=s.endCol;if(isRowSelected()&&(i=getColMax()-1),s.startRow===e&&s.startCol===a&&s.endRow===t&&i===n){if(void 0!==u&&(C=u[A]),null!==p&&(r(C),p.className=""),null!==b&&(b.style.display="none"),void 0!==u)if(void 0!==u["Count Numbers"]&&0!==u["Count Numbers"]){for(var l in S)S[l]=u[l];R=!1}else R=!0,S.Count=u.Count,C=u.Count;o(A,""),null===C||""===C?$("#statusTD").hide():$("#statusTD").show()}}function o(e){var a=getObj("totalSum"),t=getObj("totalSumName");return R?(e="Count",void(0!==S[e]&&(t.innerHTML=jsMsg["StatusBar."+e],null!==a&&null!==t&&(a.className="",r(S[e]))))):(A=e,t.innerHTML="Count Numbers"===A?jsMsg["StatusBar.CountNumbers"]:jsMsg["StatusBar."+A],null!==a&&null!==t&&(a.className="","Sum"===A?"PERCENT"===v?r(S[A],"%"):r(S[A]):"Average"===A?"PERCENT"===v?r(S[A],"%"):r(S[A]):"Minimum"===A?"PERCENT"===v?r(S[A],"%"):r(S[A]):"Maximum"===A?"PERCENT"===v?r(S[A],"%"):r(S[A]):("Count"===A||"Count Numbers"===A)&&r(S[A])),void $("#statusTD").show())}function r(e,a){var t=$("#totalSum"),n=($("#totalSumName"),void 0!==e?e+"":"");a=a?a:"",n.length>15&&t.addClass("autoSumEllipsis"),"hi"===docLocale.substring(0,2)&&(n=n.replace(/0/g,decodeURIComponent("%E0%A5%A6")).replace(/1/g,decodeURIComponent("%E0%A5%A7")).replace(/2/g,decodeURIComponent("%E0%A5%A8")).replace(/3/g,decodeURIComponent("%E0%A5%A9")).replace(/4/g,decodeURIComponent("%E0%A5%AA")).replace(/5/g,decodeURIComponent("%E0%A5%AB")).replace(/6/g,decodeURIComponent("%E0%A5%AC")).replace(/7/g,decodeURIComponent("%E0%A5%AD")).replace(/8/g,decodeURIComponent("%E0%A5%AE")).replace(/9/g,decodeURIComponent("%E0%A5%AF"))),44===decSymbol&&isFromServer!==!0&&(n=n.replace(".",",")),t.html(" = "+n)}function u(){var e=[];"hi"===docLocale.substring(0,2)&&(S.Sum=i(S.Sum),S.Count=i(S.Count),S.Average=i(S.Average),S.Minimum=i(S.Maximum),S.Maximum=i(S.Minimum),S.Count=i(S.Count),S["Count Numbers"]=i(S["Count Numbers"])),44===decSymbol&&isFromServer!==!0&&(S.Sum=S.Sum.toString().replace(/\./g,","),isFromServer=!1),R?e.push({id:"stbarCnt",data:"{label:'"+jsMsg["StatusBar.Count"]+" : "+S.Count.toString().replace(/'/g,"\\'")+"', icon:'ui-individual-icon ui-icon-ztick', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Count'}}"}):(e.push({id:"stbarSum",data:"{label:'"+jsMsg["StatusBar.Sum"]+" : "+S.Sum.toString().replace(/'/g,"\\'")+"', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Sum'}}"}),e.push({id:"stbarAvrg",data:"{label:'"+jsMsg["StatusBar.Average"]+" : "+S.Average.toString().replace(/'/g,"\\'")+"', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Average'}}"}),e.push({id:"stbarMin",data:"{label:'"+jsMsg["StatusBar.Minimum"]+" : "+S.Minimum.toString().replace(/'/g,"\\'")+"', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Minimum'}}"}),e.push({id:"stbarMax",data:"{label:'"+jsMsg["StatusBar.Maximum"]+" : "+S.Maximum.toString().replace(/'/g,"\\'")+"', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Maximum'}}"}),e.push({id:"stbarCnt",data:"{label:'"+jsMsg["StatusBar.Count"]+" : "+S.Count.toString().replace(/'/g,"\\'")+"', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Count'}}"}),e.push({id:"stbarCntNum",data:"{label:'"+jsMsg["StatusBar.CountNumbers"]+" : "+S["Count Numbers"].toString().replace(/'/g,"\\'")+"', appData:{dynamic:true, callback: 'autoFormula.updateFormulaStatusBar', arg:'Count Numbers'}}"}));var a={target:$("#status"),clearcache:!0};sheetMenu.showMenu("statusBarMenu",e,a),R||l(),$("#statusBarMenu").css({top:"auto",bottom:wmsBarHt+"px"})}function s(){if(!jsGADGET_VIEW){for(var e in S)S[e]=0;jQuery("#statusTD").hide(),C="",R=!0}}function i(e){var a=e.toString().replace(/0/g,decodeURIComponent("%E0%A5%A6")).replace(/1/g,decodeURIComponent("%E0%A5%A7")).replace(/2/g,decodeURIComponent("%E0%A5%A8")).replace(/3/g,decodeURIComponent("%E0%A5%A9")).replace(/4/g,decodeURIComponent("%E0%A5%AA")).replace(/5/g,decodeURIComponent("%E0%A5%AB")).replace(/6/g,decodeURIComponent("%E0%A5%AC")).replace(/7/g,decodeURIComponent("%E0%A5%AD")).replace(/8/g,decodeURIComponent("%E0%A5%AE")).replace(/9/g,decodeURIComponent("%E0%A5%AF"));return a}function l(){var e=$("#statusBarMenu");switch(e.zmenu("changeIcon","stbarSum","ui-zmenu-no-icon"),e.zmenu("changeIcon","stbarAvrg","ui-zmenu-no-icon"),e.zmenu("changeIcon","stbarMin","ui-zmenu-no-icon"),e.zmenu("changeIcon","stbarMax","ui-zmenu-no-icon"),e.zmenu("changeIcon","stbarCnt","ui-zmenu-no-icon"),e.zmenu("changeIcon","stbarCntNum","ui-zmenu-no-icon"),A){case"Sum":e.zmenu("changeIcon","stbarSum","ui-individual-icon ui-icon-ztick");break;case"Average":e.zmenu("changeIcon","stbarAvrg","ui-individual-icon ui-icon-ztick");break;case"Minimum":e.zmenu("changeIcon","stbarMin","ui-individual-icon ui-icon-ztick");break;case"Maximum":e.zmenu("changeIcon","stbarMax","ui-individual-icon ui-icon-ztick");break;case"Count":e.zmenu("changeIcon","stbarCnt","ui-individual-icon ui-icon-ztick");break;case"Count Numbers":e.zmenu("changeIcon","stbarCntNum","ui-individual-icon ui-icon-ztick")}}function c(){if(isCellRange()){if(isFromServer=!1,jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE)return;var n,u=void 0,i=void 0,l=0,c=0,m=0,v={"#DIV/0!":"0","#NAME?":"1","#N/A":"2","#NULL!":"3","#NUM!":"4","#REF!":"5","#VALUE!":"6","#CIRCULARREF!":"7"};if(R=!0,f=!1,U=void 0,!jsGADGET_VIEW){for(var M in S)S[M]=0;var N=getCellRange();if(b=getObj("loadIcon"),p=getObj("totalSum"),N.startRow>=getAvailableStartRow()&&N.endRow<=getAvailableEndRow()){if(!Row.isHidden(N.startRow)){var h=getCell(N.startRow,N.startCol),F=N.startCol;if(null===h)for(;null===h&&F>=0;)F-=1,h=getCell(N.startRow,F)}if(h=getCell(N.startRow,F),!Row.isHidden(N.startRow)&&h){var T=h.getAttribute("format");U=null!==T&&"null"!==T?h.getAttribute("format").toUpperCase():"STANDARD"}else var U="STANDARD";var w=(e(U),!0);if(h&&(w=a(h)),w)clearTimeout(d),d=setTimeout(function(){t(N.startRow,N.startCol,N.endRow,N.endCol)},350),isFromServer=!0;else{null!==h.getAttribute("cv")&&(containThousandSeparator=-1!==h.getAttribute("cv").indexOf(thousandSeparator)?!0:!1);var y=N.endRow,k=N.endCol;N.startRow<usedCursRow&&y>usedCursRow&&(y=usedCursRow),N.startCol<usedCursCol&&k>usedCursCol&&(k=usedCursCol);var x=new Range(N.startRow,N.startCol,y,k),D=x.getIterator();D.iterate(function(e,a){var t=getCell(e,a);if("undefined"!=typeof t&&null!==t){var r=getCellFunctionValueWOF(t),s=t.getAttribute("format"),d=t.getAttribute("cv");if("PERCENT"!==U&&(a>N.startRow||a>N.startCol)&&"PERCENT"===s?r/=100:"PERCENT"===U&&(a>N.startRow||a>N.startCol)&&"PERCENT"!==s&&(r=100*r),"FRACTION"===s&&(f=!1,isStr(r)&&r.indexOf(" ")>0)){r.indexOf("-")>=0&&(I=!0);var g=r.split(" "),p=g[0];p.indexOf("-")>=0&&(minusPos=p.indexOf("-"),p=p.substring(minusPos+1,p.length));var M=g[1];M.indexOf("-")>=0&&(minusPos=M.indexOf("-"),M=M.substring(minusPos+1,M.length)),isNaN(M)||(M=parseFloats(M));var h=parseFloat(p)+parseFloat(M);I&&(h=-h,I=!1),r=h}null!==r&&(c+=1,S.Count=c,isNaN(r)||"DATE"===s||"TIME"===s||"STRING"===s||"DATETIME"===s||v[d]?f=!0:""!==r&&(void 0===u&&(u=r),void 0===i&&(i=r))),""===r&&(f=!0);var F=b.style.display;if("DATE"===s||f||null===r||(l+=1),null===r||f)R&&f&&null!==r&&r.length>0&&(m+=1,S.Count=m,C=S.Count,o(),"block"===F&&(b.style.display="none"),E=!1);else{for(var T in S)switch(T){case"Sum":S[T]+=parseFloat(r),C=S[T],"block"===F&&(b.style.display="none");break;case"Average":n=parseFloat(C)/l,S[T]=parseFloat(n).toFixed(2),"block"===F&&(b.style.display="none");break;case"Minimum":S[T]=Math.min(r,u),u=S[T],"block"===F&&(b.style.display="none");break;case"Maximum":S[T]=Math.max(r,i),i=S[T],"block"===F&&(b.style.display="none");break;case"Count":"block"===F&&(b.style.display="none");break;case"Count Numbers":S[T]=l,"block"===F&&(b.style.display="none")}E=!1,R&&(R=!1),o(A,U),44===decSymbol&&(C=C.toString().replace(/\./g,","),S.Average=S.Average.toString().replace(/\./g,","),S.Maximum=S.Maximum.toString().replace(/\./g,","),S.Minimum=S.Minimum.toString().replace(/\./g,","))}f=!1}}),E?null!==p&&(p.className="",C="",r(C)):E=!0}}else isUndefined(g)||(null!==p&&(p.className="disabled"),"none"===b.style.display&&(b.style.display="inline-block"),clearInterval(g)),g=setTimeout(function(){t(N.startRow,N.startCol,N.endRow,N.endCol)},250);null!==C&&""!==C||"number"==typeof C?$("#statusTD").show():$("#statusTD").hide()}}else s()}function m(){return S}var d,g,C,p,b,A="Sum",R=!0,v=void 0,S={Sum:0,Count:0,Average:0,"Count Numbers":0,Minimum:0,Maximum:0},E=!1,f=!1,I=!1;return appEvent.on("book.onbeforesheetswitch",function(){s()}),appEvent.on("range.update range.updatedata",function(){c()}),appEvent.on("range.focus cell.focus select.range",$.debounce(500,function(){c()})),{showStatusBarMenu:u,getAutoFormulas:m,updateFormulaStatusBar:o}}();var DataValidation_UI=function(){function e(e){var a="Create"===e?jsMsg["VersionDialog.Create"]:jsMsg[e];if(Q===!0&&(a=jsMsg["VersionDialog.Create"]),$("#ui-dialog-title-"+sheetdialog.getDialogName()+"zdialog").text(jsMsg["DataVal.DV"]+" - "+a),"Manage"===e)i(),$("#CloseDvManage").bind("click",function(){N()});else{K=!1,X=!1,q=null,$("#CancelSetting").bind("click",function(){N()}),$("#SaveSetting").bind("click",function(){p()}),$("#manageSelect").find("option:gt(1)").remove(),$("#createDvRuleContent").find("input[type=text]").val("");var n=$("#dvCellRangeField");n.attr("spellcheck",!1),$("#listInputField").attr("spellcheck",!1),"Edit"===e&&Q===!1?($("#rangeInp,#rangeInpSpan").hide(),n.attr("disabled",!0)):($("#rangeInp,#rangeInpSpan").show(),n.attr("disabled",!1),"Copy"===e&&g(),"Create"===e&&($("#errInp").val(jsMsg["DataVal.StopErrorMsg"]),DataValidation_UI.setHelpText()),n.focus(function(){var e=this;RangeSelector.on({el:e,allowSheetSwitch:!0,appendSheetName:!0})}),n.focus(),$("#errSel").next().find("div.ui-zcombo-select-item span:eq(0)").css("margin-top","2px"));var o=$("#listRow");$("#textS3Div,#dateOptDiv").hide(),o.find("span:eq(0)").hide(),o.find("span:eq(1)").show(),o.find("span:eq(2)").hide(),$("#ignBlank").attr("checked","checked"),$("#sortlist").hide(),$(".dateandtime").hide(),$("#errInp").find("input[type=text]").attr("disabled",!1),("Edit"===e||"Copy"===e)&&DataValidation_UI.toggleDeck(!0),t(e,DataValidation_UI.initRange)}}function t(e,t){if(void 0===t){var a=getCellRange();a=getServerRange(a.startRow,a.startCol,a.endRow,a.endCol),$("#dvCellRangeField").val(CellUtils.constructCellName(a.startRow,a.startCol,a.endRow,a.endCol,!1,CURRSHEETNAME))}else $("#dvCellRangeField").val(t);DataValidation_UI.initRange=void 0}function a(){getObj("createDvRuleContent").style.display="",getObj("manageDvRulesContent").style.display="none"}function i(){$("#ui-dialog-title-"+sheetdialog.getDialogName()+"zdialog").text(jsMsg["DataVal.DV"]+" - "+jsMsg["DataVal.Manage"]),getObj("createDvRuleContent").style.display="none",getObj("manageDvRulesContent").style.display="",$("#rangeFilterspan").hide(),G=!1,Y=!1,Q=!1,q=null,J=null,B=!1,RangeSelector.off();var e=$("#manageSelect");e.find("option:gt(1)").remove();for(var t=CellUtils.getRequiredSheetNames().sheetNames,a=0;a<t.length;a++)if($("<option/>",{value:ActionConstants.DATA_VALIDATION_READSHEET,text:t[a]}).appendTo($("#manageSelect")),t[a]===CURRSHEETNAME)var i=a+2;$("#manageDvRulesContent").find("#createFromManage").on("click",function(){T()}),e.zcombo("refresh"),e.zcombo("setSelectedIndex",i),f(ActionConstants.DATA_VALIDATION_READSHEET,1)}function n(e,t,a,i){if(-1!==e&&-1!==t&&-1!==a&&-1!==i){var n=new Range(e,t,a,i),o=n.getIterator();o.iterate(function(e,t){var a=getCell(e,t);a&&FadeCell.fadeElement(a)})}}function o(e,t,a){formatWithConditions.dummyev=a,formatWithConditions.changeMenuStyle("show",t);var i=$(t),n=[];n.push({data:"{label:'"+jsMsg["DataVal.EditValidation"]+"'}"}),n.push({data:"{label:'"+jsMsg["DataVal.CopyValidation"]+"'}"}),n.push({data:"{label:'"+jsMsg["DataVal.ClearValidation"]+"'}"});var o={target:$(i),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("dvUL",n,o);var l=$("#dvUL");l.css("top",i.offset().top+20),l.css("left",i.offset().left-14),l.on({mouseover:function(){$(this).show(),formatWithConditions.changeMenuStyle("show",t)},mouseout:function(){$(this).hide(),sheetMenu.hideMenu(a),formatWithConditions.changeMenuStyle("hide",t)}}),$(sheetMenu.currMenu).bind("menuitemclicked",function(t,a){var i=$(a.menuitem).index();0===i?w(e):1===i?F(e):2===i&&_(e)}),a.stopPropagation(),RangeSelector.off()}function l(e){if(e&&"Manage"===Z.tab){var t=function(e){o(e.data.rname,this,e)},a=function(){formatWithConditions.mouseOutmenuHide(this)},i=$("#dataValManage");if($("#novalidations").hide(),$("#dvexpandCollapse").show(),$(i).children().not("#novalidations").remove(),e.length>0){var n,l=$("<div/>",{class:"dvtreeExpand",click:function(){formatWithConditions.toggleRuleList(this)}}),s=$("<span/>",{class:"dvappliesTo"}),r=$("<table/>",{style:"table-layout:fixed;margin: 0 7px 5px 20px;",cellspacing:"3",cellpadding:"3"});for(n in e)if("undefined"!=typeof e[n][JSONConstants.CRITERIA_NUM]){var d=e[n],c=C(d.RANGENAME),g=d.VALUE,v=parseInt(d[JSONConstants.CRITERIA_NUM]),u=d[JSONConstants.CRITERIA_TYPE],h=formatWithConditions.getFormula(v,g,u),p=l.clone(!0),m=s.clone(!0).text(c);m.click(function(e){var t=$(this).text();Goto.gotoCellInit(t);var a=DataValidation.util.getDvRangeValues(t);moveDialogBox(a.startRow,a.startCol),stopEvt(e)});var E=$("<div/>",{class:"cfSetting"}).on("mouseover click",{rname:c},t).mouseout(a);p.append(m),p.append(E),i.append(p);var f=r.clone(!0).appendTo(i),D=document.createElement("tr"),R=document.createElement("td");$(R).addClass("breakWrap"),$(R).html(h),$(D).append($(R)),$(f).append($(D))}}else $(i).children().not("#novalidations").remove(),$("#novalidations").show(),$("#dvexpandCollapse").hide();setTimeout(function(){"range"===$("#manageSelect").val()&&($("#dataValManage").show(),S())},200)}}function s(e){if(e){var t=e,a=getDataFrom2DRangeText(t),i=a.sR,n=a.sC,o=a.eR,l=a.eC,s=a.sheetName;s=WorkSheets.getSheetCodeFromName(s),f(ActionConstants.DATA_VALIDATION_READRANGE,2,i,n,o,l,s)}}function r(e){if(!isUndefined(e)){var t=$("#dtrow"),a=$("#listRow"),n=($("#dvCellRangeField"),$("#sortasc")),o=$("#hintCB"),l=$("#errCB"),s=$("#errSel"),r=$("#errInp"),c=$("#hintInp"),g=$("#listsort"),u=e[JSONConstants.CRITERIA_TYPE],h=e[JSONConstants.CRITERIA_NUM],p=t.find(":input[type=text]"),m=a.find(":input[type=text]"),E=e.val1?e.val1:"",f=e.val2?e.val2:"",C=e.val3?e.val3:"",S=e.val4?e.val4:"";if("LIST"===u){var D="";if(0===E.indexOf("="))D=E.substr(1),$("#criteriaS1").zcombo("setSelectedIndex",6);else{$("#criteriaS1").zcombo("setSelectedIndex",5);for(var R=0;R<E.length;R++)D+=E[R]+"\n";var I=a.find("textarea").css("max-height");isUndefined(I)?a.find("textarea").css("height","auto"):a.find("textarea").css("height",I)}d("criteriaS1"),"NO"===e[JSONConstants.CV_LISTDISPLAYTYPE]?(g.attr("checked",!1),n.attr("checked",!1),DataValidation_UI.toggleHintMsg($("#listsort"))):(g.attr("checked",!0),"SORT_ASCENDING"===e[JSONConstants.CV_LISTDISPLAYTYPE]?n.attr("checked",!0):n.attr("checked",!1)),6===$("#criteriaS1").zcombo("getSelectedIndex")?$("#listInputField").val(D):a.find("textarea").val(D)}else"DATE"===u&&h<=ConditionalFormatOperator.NOT_EQUAL?($("#criteriaS1").zcombo("setValue",u),d("criteriaS1"),$("#dateOpts").zcombo("setValue",""+h),v("dateOpts"),e.checkDate===!0&&(p[0].value=E),e.checkTime===!0&&(p[3].value=C)):"DATE"!==u||h!==ConditionalFormatOperator.BETWEEN&&h!==ConditionalFormatOperator.NOT_BETWEEN?h<=ConditionalFormatOperator.NOT_EQUAL?($("#criteriaS1").zcombo("setValue",u),d("criteriaS1"),$("#rangeS2").zcombo("setValue",""+h),v("rangeS2"),m[0].value=E):h===ConditionalFormatOperator.BETWEEN||h===ConditionalFormatOperator.NOT_BETWEEN?($("#criteriaS1").zcombo("setValue",u),d("criteriaS1"),$("#rangeS2").zcombo("setValue",""+h),v("rangeS2"),m[1].value=E,m[2].value=f):h>=ConditionalFormatOperator.TEXT_CONTAINING&&h<=ConditionalFormatOperator.TEXT_ENDINGWITH?($("#criteriaS1").zcombo("setValue",u),d("criteriaS1"),$("#textS3").zcombo("setValue",""+h),v("textS3"),m[0].value=E):h>=ConditionalFormatOperator.YESTERDAY&&h<=ConditionalFormatOperator.NEXT_YEAR&&($("#criteriaS1").zcombo("setValue",u),d("criteriaS1"),$("#dateOpts").zcombo("setValue",""+h),v("dateOpts"),$("#sortlist").hide(),a.hide()):($("#criteriaS1").zcombo("setValue",u),d("criteriaS1"),$("#dateOpts").zcombo("setValue",""+h),v("dateOpts"),e.checkDate===!0&&(p[1].value=E,p[2].value=f),e.checkTime===!0&&(p[4].value=C,p[5].value=S));var A=DataValidation_UI.setHelpText("Get"),N=e[JSONConstants.CV_HINT][JSONConstants.VALUE];if(isUndefined(N)||"undefined"===N){N=A;var T=!1;DataValidation_UI.hintFieldListener(c,T)}else if(A!==N){var T=!0;DataValidation_UI.hintFieldListener(c,T)}c.val(N),$("#ignBlank").attr("checked",e[JSONConstants.CV_ALLOWBLANKCELLS]),o.attr("checked",e[JSONConstants.CV_HINT][JSONConstants.IS_DISPLAY]),DataValidation_UI.toggleHintMsg($("#hintCB"));var O=e[JSONConstants.CV_ERROR][JSONConstants.VALUE];O=replaceParams(O,[""]),O=O.trim(),r.val(O),O&&("STOP"===s.val()&&O!==jsMsg["DataVal.StopErrorMsg"]||"INFORMATION"===s.val()&&O!==jsMsg["DataVal.InfoErrorMsg"]?(X=!0,DataValidation_UI.errFieldListener(r,!0)):DataValidation_UI.errFieldListener(r,!1)),l.attr("checked",e[JSONConstants.CV_ERROR][JSONConstants.IS_DISPLAY]),$(s).zcombo("setValue",e[JSONConstants.CV_ERROR][JSONConstants.MESSAGE_TYPE]),DataValidation_UI.toggleHintMsg($("#errCB")),(G||Y)&&($("#CancelSetting").unbind("click"),$("#CancelSetting").bind("click",function(){i()})),P.dataToInit=null,P.loadForEdit=!1}}function d(e){var t=$("#"+e).zcombo("getSelectedIndex"),a=$(".dateandtime"),i=$("#dtrow"),n=$("#listRow"),o=n.find("#listInputField");$(o).unbind("click"),n.find(":input[type=text]").val("");var l=n.find("span:eq(0)"),s=n.find("span:eq(1)"),r=n.find("span:eq(2)");if(n.show(),0===t||1===t||3===t)$("#rangeS2Div").show(),$("#rangeS2").zcombo("setSelectedIndex",0),$("#sortlist,#textS3Div,#dateOptDiv").hide(),a.hide(),s.show(),l.hide(),r.hide();else if(2===t)$("#textS3Div").show(),$("#textS3").zcombo("setSelectedIndex",0),$("#sortlist,#rangeS2Div,#dateOptDiv").hide(),l.show(),s.hide(),r.hide(),a.hide(),n.find(":input[type=text]:eq(0)").attr("placeholder",jsMsg["Solver.UI.Value"]);else if(4===t){$("#dateOptDiv").show(),$("#dateOpts").zcombo("setSelectedIndex",0),$("#sortlist,#rangeS2Div,#textS3Div").hide(),l.hide(),s.hide(),r.hide();var d=i.find(":input[type=text]:lt(3)");$(d).datepicker({showAnim:"fadeIn",changeMonth:!0,changeYear:!0,constrainInput:!1}),$("#listRow").hide(),v("dateOpts")}else 5===t?($("#sortlist").show(),$("#rangeS2Div,#textS3Div,#dateOptDiv,#cellrange").hide(),l.hide(),s.hide(),r.show(),a.hide(),$("#listofvalues").show(),$("#cellrange").hide(),setTimeout(function(){$("#listofvalues").focus()},300)):6===t&&($("#listInputField").focus(function(){var e=this;RangeSelector.on({el:e,multiRangeSelection:!0,appendSheetName:!0,isAbsoluteRef:!0,callback:function(t){DataValidation_UI.setRangeInInput(e,t),$(e).focus()}})}),$("#sortlist").show(),$("#rangeS2Div,#textS3Div,#dateOptDiv,#listofvalues").hide(),$("#cellrange").show(),$("#rangeInpSpan_l").show(),l.hide(),s.hide(),r.show(),$("#listofvalues").hide(),a.hide(),setTimeout(function(){$("#listInputField").focus()},300));DataValidation_UI.setHelpText()}function c(){var e=getDataFrom2DRangeText($("#dvCellRangeField").val());k=e.sR,j=e.sC,L=e.eR,W=e.eC}function g(){var e=formatWithConditions.cfRange();if(!isUndefined(e)){k=e.startRow,j=e.startCol,L=e.endRow,W=e.endCol;var t=getCell(k,j);return k===L&&j===W&&null!==t&&null===t.getAttribute("dv")?!1:!0}}function v(e){var t=parseInt($("#"+e).zcombo("getValue")),a=$(".dateandtime"),i=$("#dtrow"),n=$("#listRow"),o=n.find(":input[type=text]:eq(0)"),l=n.find(":input[type=text]:eq(1)"),s=(n.find(":input[type=text]:eq(2)"),n.find("span:eq(0)")),r=n.find("span:eq(1)"),d=n.find("span:eq(2)"),c=$("#criteriaS1").zcombo("getValue");if("DATE"===c&&t<=ConditionalFormatOperator.NOT_EQUAL){var g=i.find(":input[type=text]:eq(0)"),v=$("#timeDiv").find(":input[type=text]");a.show(),i.find("span:eq(0),span:eq(2)").show(),i.find("span:eq(1),span:eq(3)").hide(),g.datepicker({showAnim:"fadeIn",changeMonth:!0,changeYear:!0,constrainInput:!1});var u=DataValidation_UI.getDateFormat();g.datepicker({dateFormat:u}),g.datepicker("option","dateFormat",u),g.val(i.find(":input[type=text]:eq(1)").val()),""!==v[1].value&&(v[0].value=v[1].value)}else if("DATE"!==c||t!==ConditionalFormatOperator.BETWEEN&&t!==ConditionalFormatOperator.NOT_BETWEEN)t<=ConditionalFormatOperator.NOT_EQUAL?(s.show(),r.hide(),d.hide(),""!==l.val()&&o.val(l.val())):t===ConditionalFormatOperator.BETWEEN||t===ConditionalFormatOperator.NOT_BETWEEN?(s.hide(),r.show(),d.hide(),""!==o.val()&&l.val(o.val())):t>=ConditionalFormatOperator.TEXT_CONTAINING&&t<=ConditionalFormatOperator.TEXT_ENDINGWITH?(s.show(),r.hide(),d.hide()):t>=ConditionalFormatOperator.YESTERDAY&&t<=ConditionalFormatOperator.NEXT_YEAR&&a.hide();else{var h=i.find("input[type=text]:eq(1),:input[type=text]:eq(2)"),u=DataValidation_UI.getDateFormat();a.show(),i.find("span:eq(0),span:eq(2)").hide(),i.find("span:eq(1),span:eq(3)").show(),h.datepicker({showAnim:"fadeIn",changeMonth:!0,changeYear:!0}),h.datepicker({dateFormat:u}),h.datepicker("option","dateFormat",u);var v=$("#timeDiv").find(":input[type=text]"),p=i.find("input[type=text]:eq(0)").value;p&&""!==p&&(h[0].value=p),""!==v[0].value&&(v[1].value=v[0].value)}DataValidation_UI.setHelpText()}function u(e){var t="{",a=$("#createDvRuleContent").find("select"),i=$(a[0]).zcombo("getSelectedIndex"),n=0,o=a[0].value,l="NO";0===i||1===i||3===i?n=a[1].value:2===i?n=a[2].value:4===i?n=a[3].value:(5===i||6===i)&&(n=b,o="LIST",l=$("#listsort").is(":checked")?$("#sortasc").is(":checked")?"SORT_ASCENDING":"UNSORTED":"NO");var s=$("#hintCB").is(":checked"),r=s?$("#hintInp").val():void 0,d=$("#ignBlank").is(":checked"),g=$("#errCB").is(":checked"),v=$("#errSel").val(),u=$("#errInp").val();u=X||"STOP"!==v?u:jsMsg["DataVal.StopMsg"],0===u.trim().length&&(u=$("#hintInp").val()),c();var p=CURRSHEETNAME;-1!==e.indexOf(".")&&(p=e.substring(0,e.indexOf("."))),t+=' "'+JSONConstants.ASSOCIATED_SHEET_NAME+'" : "'+WorkSheets.getSheetCodeFromName(p)+'", "'+JSONConstants.CRITERIA_NUM+'" : '+n+",",t+='"'+JSONConstants.CV_HINT+'":{"'+JSONConstants.IS_DISPLAY+'":'+s+', "'+JSONConstants.VALUE+'" : "'+encodeURIComponent(r)+'"},"'+JSONConstants.START_ROW+'" : '+k+",",t+=' "'+JSONConstants.START_COLUMN+'" : '+j+', "'+JSONConstants.END_ROW+'" : '+L+', "'+JSONConstants.END_COLUMN+'" : '+W+',"'+JSONConstants.CV_LISTDISPLAYTYPE+'":"'+l+'"',t+=',"val1" : "'+encodeURIComponent(z)+'", "val2" : "'+encodeURIComponent(H)+'"',t+=',"'+JSONConstants.CV_ERROR+'":{"'+JSONConstants.IS_DISPLAY+'":'+g+', "'+JSONConstants.VALUE+'" : "'+encodeURIComponent(u)+'", "'+JSONConstants.MESSAGE_TYPE+'" : "'+v+'"}',t+=',"'+JSONConstants.CV_ALLOWBLANKCELLS+'":'+d+', "'+JSONConstants.CRITERIA_TYPE+'" : "'+o+'"',t+="}";var m=RangeSelector.returnsourceSheet();m!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(m),"open");var E=new RequestParameters(ActionConstants.DATA_VALIDATION_APPLY);E.setParameters(WorkSheets.getSheetCodeFromName(p),k,j,L,W,t);var f=new AjaxRequest;f.init("POST",E.getURL(),!0,E.getParametersAsString()),f.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),actionManager.addRequest(f),h(k,j,L,W),sheetdialog.close()}function h(e,t,a,i){var n=new Range(e,t,a,i),o=n.getIterator();o.iterate(function(e,t){var a=$(getCell(e,t));a.hasClass("highlightInvalid")&&a.removeClass("highlightInvalid").removeClass("dvAnimation")})}function p(){var e=$("#dvCellRangeField").val();if(DataValidation_UI.isEmptyField(e))return void showAlertDialog(jsMsg.Rangecannotbeempty);var t=DataValidation_UI.validateDvRange(e);if(!t)return void showAlertDialog(jsMsg.InvalidRange);var a,i=$("#criteriaS1").zcombo("getSelectedIndex"),n=!1,o=-1,l=!1,s=!1,r=!1,d=$("#criteriaS1").zcombo("getValue");switch(i){case 0:case 1:case 3:n=!0,o=parseInt($("#rangeS2").zcombo("getValue"));var c=$("#listRow").find(":input[type=text]");o<=ConditionalFormatOperator.NOT_EQUAL?(z=c[0].value,a=c[0],DataValidation_UI.isEmptyField(z)&&(r=!0)):(o===ConditionalFormatOperator.BETWEEN||o===ConditionalFormatOperator.NOT_BETWEEN)&&(z=c[1].value,a=c[1],H=c[2].value,(DataValidation_UI.isEmptyField(z)||DataValidation_UI.isEmptyField(H))&&(r=!0));break;case 2:a=$("#listRow").find(":input[type=text]:first");var g=$(a).val();DataValidation_UI.isEmptyField(g)?r=!0:z=g;break;case 4:if(o=parseInt($("#dateOpts").zcombo("getValue")),!(o>=ConditionalFormatOperator.YESTERDAY&&o<=ConditionalFormatOperator.NEXT_YEAR)){n=!0;var v=$("#dtrow").find(":input[type=text]");a=v[0],o<=ConditionalFormatOperator.NOT_EQUAL?DataValidation_UI.isEmptyField(v[0].value)||DataValidation_UI.isEmptyField(v[3].value)?DataValidation_UI.isEmptyField(v[0].value)?DataValidation_UI.isEmptyField(v[3].value)?r=!0:(z=v[3].value,l=!0,a=v[3]):z=v[0].value:z=v[0].value+" "+v[3].value:(o===ConditionalFormatOperator.BETWEEN||o===ConditionalFormatOperator.NOT_BETWEEN)&&(a=v[1],DataValidation_UI.isEmptyField(v[1].value)||DataValidation_UI.isEmptyField(v[2].value)||DataValidation_UI.isEmptyField(v[4].value)||DataValidation_UI.isEmptyField(v[5].value)?DataValidation_UI.isEmptyField(v[1].value)||DataValidation_UI.isEmptyField(v[2].value)?DataValidation_UI.isEmptyField(v[4].value)||DataValidation_UI.isEmptyField(v[5].value)||(z=v[4].value,H=v[5].value,l=!0,a=v[4]):(z=v[1].value,H=v[2].value):(z=v[1].value+" "+v[4].value,H=v[2].value+" "+v[5].value,s=!0),(DataValidation_UI.isEmptyField(v[1].value)&&!DataValidation_UI.isEmptyField(v[2].value)||!DataValidation_UI.isEmptyField(v[1].value)&&DataValidation_UI.isEmptyField(v[2].value)||DataValidation_UI.isEmptyField(v[4].value)&&!DataValidation_UI.isEmptyField(v[5].value)||!DataValidation_UI.isEmptyField(v[4].value)&&DataValidation_UI.isEmptyField(v[5].value))&&(r=!0))}break;case 5:var h=$("#listRow").find("textarea").val();if(a=$("#listRow").find("textarea"),DataValidation_UI.isEmptyField(h))r=!0;else{z=h;var p=(h.match(/\n/g)||[]).length;if(p>y)return void sheetdialog.showAlertDialog(jsMsg["DataVal.ListSizeItemError"].inpEle);var m=h.length-p;if(m>x)return void sheetdialog.showAlertDialog(jsMsg["DataVal.ListSizeLengthError"],a);var E=z;E+="\n",E=E.replace(/\n/g,"\\n"),E=E.replace(/\";\"/g,"\\;"),z=E}break;case 6:var f=$("#listInputField").val();a=$("#listInputField"),f=0===f.indexOf("=")?f.substring(1,f.length):f,z=f;var C=!1,S=!1;if(f=f.replace(/\$/g,""),DataValidation.util.checkNRexists(f)?(C=!0,DataValidation.util.isRange1D(f,2)||(S=!0)):DataValidation_UI.validateDvRange(f)&&(C=!0,DataValidation.util.isRange1D(f,1)||(S=!0)),!C)return void sheetdialog.showAlertDialog(jsMsg["DataVal.ListSourceRangeAlert"],a);if(S)return void sheetdialog.showAlertDialog(jsMsg["DataVal.ListSourceAlert"],a)}if(r)return void sheetdialog.showAlertDialog(jsMsg["CFormat.FieldsBlank"],a);if(n){var D=CURRSHEETNAME;-1!==t.indexOf(".")&&(D=t.substring(0,t.indexOf(".")));var R='{"'+JSONConstants.ASSOCIATED_SHEET_NAME+'" : "'+WorkSheets.getSheetCodeFromName(D)+'", "'+JSONConstants.CRITERIA_NUM+'" : '+o;R+=', "val1" : "'+encodeURIComponent(z)+'", "val2" : "'+encodeURIComponent(H)+'"',R+=', "'+JSONConstants.CRITERIA_TYPE+'" : "'+d+'"',R+=', "'+JSONConstants.START_ROW+'" : '+k+', "'+JSONConstants.START_COLUMN+'" : '+j+', "'+JSONConstants.END_ROW+'" : '+L+', "'+JSONConstants.END_COLUMN+'" : '+W,R+="}";var I=new RequestParameters(ActionConstants.VALIDATE_INPUT);I.setParameters(WorkSheets.getAssociatedActiveSheetName(),k,j,L,W,"datavalidation",R);var A=new AjaxRequest;A.init("POST",I.getURL(),!0,I.getParametersAsString()),A.addEventListener("onComplete",function(e){var i=parseJSON(e.responseText);if(Boolean(i.valinp.isError)!==!1){var n=d,r=i.valinp.errorMsg,c=jsMsg[""+r];-1===r.indexOf("DataVal.InputError")||o!==ConditionalFormatOperator.BETWEEN&&o!==ConditionalFormatOperator.NOT_BETWEEN||(c=jsMsg["DataVal.InputError2"]),l&&(n="TIME"),s&&(n="DATETIME"),l=s=!1;var g=replaceParams(c,new Array(formatWithConditions.keypair[n]));return void sheetdialog.showAlertDialog(g,a)}u(t)}),A.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),A.sendRequest()}else u(t)}function m(e){var t=e.val();if("range"===t){$("#rangeFilterspan").show();var a=$("#rangeFilter"),i=getCellRange();i=getServerRange(i.startRow,i.startCol,i.endRow,i.endCol),a.val(CellUtils.constructCellName(i.startRow,i.startCol,i.endRow,i.endCol,!1,CURRSHEETNAME)).attr("spellcheck",!1),E(cellRange),a.focus(function(){var e=this;RangeSelector.on({el:e,multiRangeSelection:!1,appendSheetName:!0,isAbsoluteRef:!1,callback:function(e){E(e)}})}),a.unbind("change"),a.change(function(){var e=$(this).val();DataValidation_UI.validateDvRange(e)||(e=""),E(e)}),a.focus()}else if(t===ActionConstants.DATA_VALIDATION_READWORKBOOK)RangeSelector.off(),$("#rangeFilterspan").hide(),f(t,1);else{RangeSelector.off(),$("#rangeFilterspan").hide();var n=e.find("option:selected").text(),o=WorkSheets.getSheetCodeFromName(n);f(t,1,void 0,void 0,void 0,void 0,o)}}function E(e){if("Manage"===Z.tab&&"range"===$("#manageSelect").val()){var t=DataValidation.util.getDvRangeValues(e).sheetName;if(isUndefined(t)&&(t=CURRSHEETNAME),B!==!0&&t!==J){var a=WorkSheets.getSheetCodeFromName(t);f(ActionConstants.DATA_VALIDATION_READSHEET,1,void 0,void 0,void 0,void 0,a)}else S(e)}}function f(t,i,n,o,s,d,c){var g="undefined"==typeof c?WorkSheets.getAssociatedActiveSheetName():c,v=parseInt(t);"undefined"==typeof n&&(n=k,o=j,s=L,d=W);var u=DataValidation_UI.getDateFormat(!0),h="HH:mm",p=new RequestParameters(v);p.setParameters(g,u,h,n,o,s,d);var m=new AjaxRequest;m.init("POST",p.getURL(),!0,p.getParametersAsString()),m.addEventListener("onComplete",function(t){switch(i){case 1:q=null,J=null,B=!1;var n=parseJSON(t.responseText);if(n.dataval){var o=n.dataval;q=o,v===ActionConstants.DATA_VALIDATION_READWORKBOOK?B=!0:J=WorkSheets.getSheetNameFromCode(g),l(o)}break;case 2:var n=parseJSON(t.responseText);if(n.dataval&&"undefined"!=typeof n.dataval[JSONConstants.CRITERIA_NUM])if(G||Y){var s=Y===!0?"Edit":"Copy";a(),e(s),r(n.dataval)}else{var d=n.dataval;d.RANGENAME=C(d.RANGENAME),A(n.dataval)}else I()}}),m.addEventListener("onError",function(){showAlertDialog(jsMsg["Error.Internal.Server"])}),m.sendRequest()}function C(e){if(e){var t=65535,a=255,i=e.split(":"),n=CellUtils.getCellPosByLabel(i[1]),o=i[0].split("."),l=CellUtils.getCellPosByLabel(o[1]);return n.row>t&&(n.row=t),n.col>a&&(n.col=a),l.row>t&&(l.row=t),l.col>a&&(l.col=a),e=CellUtils.constructCellName(l.row,l.col,n.row,n.col,!1,o[0])}}function S(e){if("Manage"===Z.tab&&"range"===$("#manageSelect").val()&&q&&0!==q.length){isUndefined(e)&&(e=$("#rangeFilter").val());var t=$("#dataValManage");if(""===e)return void $(contentDiv).children().not("#novalidations").hide();var a=DataValidation.util.getDvRangeValues(e);if(a)var i=new Range(a.startRow,a.startCol,a.endRow,a.endCol);t.children().show();var n,o=0;for(n in q)if("undefined"!=typeof q[n][JSONConstants.CRITERIA_NUM]){var l=q[n].RANGENAME,s=DataValidation.util.getDvRangeValues(l),r=a.sheetName?a.sheetName:CURRSHEETNAME;if(s.sheetName!==r){t.find("div.dvtreeExpand:eq("+n+"),div.dvtreeCollapse:eq("+n+"),table:eq("+n+")").hide(),o++;continue}DataValidation.util.isRangeIntersect(s,i)||(t.find("div.dvtreeExpand:eq("+n+"),div.dvtreeCollapse:eq("+n+"),table:eq("+n+")").hide(),o++)}var d=o===q.length?!0:!1;setTimeout(D(d),100)}}function D(e){$("#novalidations").hide(),$("#dvexpandCollapse").show(),e&&($("#novalidations").show(),$("#dvexpandCollapse").hide())}function R(e,t){"undefined"!=typeof e[JSONConstants.CRITERIA_NUM]&&(P.loadForEdit=!0,P.dataToInit=e,isUndefined(t)?DataValidation_UI.initRange=P.dataToInit.RANGENAME:(DataValidation_UI.initRange=void 0,g()),V("Edit"))}function I(){P.loadForEdit=!1,P.dataToInit=null,V("Create")}function A(e){if($.isEmptyObject(e))return void I();if("OVERWRITE"===e.RangeValidate){var t={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){I(),$(this).zdialog("close")}},{text:jsMsg.Cancel,click:function(){$(this).zdialog("close")}}]},a=jsMsg["DataVal.OverwriteSelection"];sheetdialog.close(),sheetdialog.showConfirmDialog(a,t)}else if(e.RANGENAME||"EXTEND"===e.RangeValidate){var t={buttons:[{text:jsMsg["Dialog.confirm.Yes"],class:"ui-zbutton-primary",click:function(){if(e.RANGENAME){var t=formatWithConditions.getRangeValues(e.RANGENAME),a=!0;focusCellRange(t.startRow,t.startCol,t.endRow,t.endCol,void 0,a)}R(e),$(this).zdialog("close")}},{text:jsMsg["Dialog.confirm.No"],click:function(){Q=!0,R(e,!0),$(this).zdialog("close")}},{text:jsMsg.Cancel,click:function(){$(this).zdialog("close")}}]},a=e.RANGENAME?jsMsg["DataVal.ExpandSelection"]:jsMsg["DataVal.ExtendSelection"];sheetdialog.close(),sheetdialog.showConfirmDialog(a,t)}else R(e)}function N(){K=!1,X=!1,Y=!1,G=!1,Q=!1,J=null,$("#manageSelect").find("option:gt(1)").remove();var e=RangeSelector.returnsourceSheet();e!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open"),RangeSelector.off(),sheetdialog.close()}function T(){var e=getCellRange();ProtectedRanges.isRangeLocked(e.startRow,e.startCol,e.endRow,e.endCol)||(g()===!0?f(ActionConstants.DATA_VALIDATION_READRANGE,2):I())}function O(){var e=getCellRange();if(!ProtectedRanges.isRangeLocked(e.startRow,e.startCol,e.endRow,e.endCol)){var t={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){if(g()){var e=CURRSHEETNAME+"."+getColHeadLabel(j+1)+(k+1)+":"+getColHeadLabel(W+1)+(L+1);_(e),n(k,j,L,W)}$(this).zdialog("close")}},{text:jsMsg.Cancel,click:function(){$(this).zdialog("close")}}]},a=jsMsg["DataVal.ClearValidationWarning"];sheetdialog.showConfirmDialog(a,t)}}function V(e){if("Delete"!==e){sheetdialog.isDialogOpen()===!0&&"datavalidationdialog"===sheetdialog.getDialogName()&&sheetdialog.close();var t={autoOpen:!1,width:550,resizable:!1,title:jsMsg["DataVal.DV"],close:function(){N(),sheetdialog.allowToClose=!0}};Z.tab=e,sheetdialog.open("datavalidationdialog",t,Z)}else if(g()){var a=CURRSHEETNAME+"."+getColHeadLabel(j+1)+(k+1)+":"+getColHeadLabel(W+1)+(L+1);_(a)}}function _(e){if(e){var t=formatWithConditions.getRangeValues(e),a=t.startRow,i=t.startCol,n=t.endRow,o=t.endCol,l=t.sheetName,s=(fetchRowHeights(a,n),new RequestParameters(ActionConstants.DATA_VALIDATION_CLEAR));s.setParameters(WorkSheets.getSheetCodeFromName(l),a,i,n,o);var r=new AjaxRequest;r.init("POST",s.getURL(),!0,s.getParametersAsString()),r.addEventListener("onComplete",function(){h(a,i,n,o),setTimeout(function(){f(ActionConstants.DATA_VALIDATION_READSHEET,1)},500)}),r.sendRequest()}}function w(e){e&&(Y=!0,G=!1,DataValidation_UI.initRange=e,s(e))}function F(e){if(e){G=!0,Y=!1;var t=getDataFrom2DRangeText(e),a=t.sR,i=t.sC,n=t.eR,o=t.eC,l=t.sheetName;l=WorkSheets.getSheetCodeFromName(l),f(ActionConstants.DATA_VALIDATION_READRANGE,2,a,i,n,o,l)}}function M(){if(isHighlightInvalidData===!0)return void U();var e=new RequestParameters(ActionConstants.DATA_HIGHLIGHT_INVALID);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){isHighlightInvalidData=!0;var t=parseJSON(e.responseText);isUndefined(t.invalidCells)||DataValidation.highlightCells(t.invalidCells.invalidValues,!0)}),t.sendRequest()}function U(){if(isHighlightInvalidData===!1)return void M();$(".highlightInvalid").removeClass("highlightInvalid").removeClass("dvAnimation");var e=new RequestParameters(ActionConstants.RESET_HIGHLIGHT_INVALID);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(){isHighlightInvalidData=!1}),t.sendRequest()}var x=16e3,y=1e3,b=-1,k=-1,L=-1,j=-1,W=-1,z="",H="",P={loadForEdit:!1,dataToInit:null},q=null,J=null,B=!1,Y=!1,G=!1,K=!1,X=!1,Q=!1,Z={tab:"",set:function(e,t,a){var i=e.action;"dvCriteriaChanged"===i?(RangeSelector.off(),d(e.arg)):"getListItems"===i?v(e.arg):"changeErrorText"===i?(DataValidation_UI.changeErrorText(t),$("#errSel").next().find("div.ui-zcombo-select-item span:eq(0)").css("margin-top","2px")):"listdvrules"===i&&m(a)},init:function(){sheetdialog.allowToClose=!1,e(Z.tab),P.loadForEdit===!0&&(r(P.dataToInit),P.loadForEdit=!1)},destroy:function(){var e=RangeSelector.returnsourceSheet();e!==CURRSHEETNAME&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open")}};return{toggleHighlight:function(){var e=$("span#dv_highlightInvalid_tick");e.is(":visible")?e.hide():e.show()},initDvMenu:function(){var e=$("#datavalidationmenu");e.bind("menubeforeshow",function(){isHighlightInvalidData===!0?e.zmenu("changeIcon","dv_highlightInvalid","ui-individual-icon ui-icon-ztick"):e.zmenu("changeIcon","dv_highlightInvalid","ui-zmenu-no-icon")}),e.bind("menuitemclicked",function(e,t){var a=$(t.menuitem).attr("id");"dv_create"===a?T():"dv_clear"===a?O():"dv_manage"===a?V("Manage"):"dv_highlightInvalid"===a&&(DataValidation_UI.toggleHighlight(),M())}),$("#dataValidation_toolbar").on("click",function(){T()})},hintFieldListener:function(e,t){if(e){var e=$(e);0===e.val().trim().length||t===!1?(K=!1,e.removeAttr("title"),e.css("background",""),isUndefined(t)&&DataValidation_UI.setHelpText()):(K=!0,t||e.css("background","#FBFAD9"),e.attr("title",jsMsg["DataVal.HintTitle"]))}},errFieldListener:function(e,t){if(e){var e=$(e);if(0===e.val().trim().length||t===!1){X=!1,e.removeAttr("title"),e.css("background","");var a=$("#errSel").val(),i=jsMsg["DataVal.StopErrorMsg"];"INFORMATION"===a&&(i=jsMsg["DataVal.InfoErrorMsg"]),e.val(i)}else X=!0,t||e.css("background","#FBFAD9"),e.attr("title",jsMsg["DataVal.ErrAlertTitle"])}},changeErrorText:function(e){X||$("#errInp").val("STOP"===e?jsMsg["DataVal.StopErrorMsg"]:jsMsg["DataVal.InfoErrorMsg"])},toggleDeck:function(e){var t=$("#deck"),a=$("#arrow");t.is(":visible")?e||(a.toggleClass("arrow-right",!0).toggleClass("arrow-down",!1),t.slideToggle(500)):(a.toggleClass("arrow-right",!1).toggleClass("arrow-down",!0),t.slideToggle(500))},getDateFormat:function(e){var t="mm",a="yy";e&&(t="MM",a="yyyy");var i=t+"/dd/"+a;return"MDY"===userDateFormatType&&(i=t+userDateSeparator+"dd"+userDateSeparator+a),"DMY"===userDateFormatType&&(i="dd"+userDateSeparator+t+userDateSeparator+a),"YMD"===userDateFormatType&&(i=a+userDateSeparator+t+userDateSeparator+"dd"),i},isEmptyField:function(e){return""===(e||"")},setHelpText:function(e){var t,a,i,n,o=parseInt($("#criteriaS1").zcombo("getSelectedIndex")),l=$("#criteriaS1").zcombo("getValue"),s="";if(!K){if(5===o||6===o){if(n="DataVal.LIST",s=jsMsg["DataVal.LIST"],"Get"===e)return s}else i=parseInt($("#rangeS2").zcombo("getValue")),4===o&&(i=parseInt($("#dateOpts").zcombo("getValue"))),2===o&&(i=parseInt($("#textS3").zcombo("getValue"))),n="DataVal."+l+i;var r=new Array("","");4===o?(t=$("#dtrow").find(":input[type=text]"),i<=ConditionalFormatOperator.NOT_EQUAL?r=this.isEmptyField(t[0].value)||this.isEmptyField(t[3].value)?new Array(this.isEmptyField(t[3].value)?t[0].value:t[3].value):new Array(t[0].value,t[3].value):(i===ConditionalFormatOperator.BETWEEN||i===ConditionalFormatOperator.NOT_BETWEEN)&&(this.isEmptyField(t[1].value)||this.isEmptyField(t[2].value)||this.isEmptyField(t[4].value)||this.isEmptyField(t[5].value)?this.isEmptyField(t[4].value)||this.isEmptyField(t[5].value)?this.isEmptyField(t[1].value)||this.isEmptyField(t[2].value)||(r=new Array(t[1].value,t[2].value)):r=new Array(t[4].value,t[5].value):r=new Array(t[1].value+" "+t[4].value,t[2].value+" "+t[5].value))):(a=$("#listRow").find(":input[type=text]"),r=i===ConditionalFormatOperator.BETWEEN||i===ConditionalFormatOperator.NOT_BETWEEN?new Array(a[1].value,a[2].value):new Array(a[0].value)),s=replaceParams(jsMsg[n],r),"Get"!==e&&$("#hintInp").val(s)}return s},toggleHintMsg:function(e){var t=$(e).nextAll("input:text");t.is("input:text")||(t=$(e).nextAll().find("input:text"));var a=$(e).next().nextAll();$(e).attr("checked")?($(a).css("opacity",""),$(t).removeAttr("disabled"),$(t).css({"background-color":"",color:""}),mask.toolbar(!1,$(a),"errorDivmask")):("listsort"===$(e).attr("id")?$(a).css("opacity","0.3"):$(a).css("opacity","0.4"),$(t).attr("disabled","disabled"),$(t).css({"background-color":"#f0f0f0",color:"#A5A1A1"}),mask.toolbar(!0,$(a),"errorDivmask"))},setRangeInInput:function(e,t){"listInputField"===$(e).attr("id")&&(!DataValidation.util.isRange1D(t,1)||isRowSelected()&&selRow-currRow>=1||isColSelected()&&selCol-currCol>=1||isRowSelected()&&isColSelected())&&showAlertDialog(jsMsg["DataVal.ListSourceAlert"])},validateDvRange:function(e){return isValidRangeGlobal(e)?e:!1}}}();!function(){UIComponents.executeOnDeferredInit(function(){DataValidation_UI.initDvMenu()})}();var currentHeader="autoFilterHeader",isFilterOpenedLeft=!1,displayMaxDataInfo=!1,maxFilterCriteria,cellColor=new Array,textColor=new Array,isReset=!1,currentFilterIndex;Filter.width={normalContainerWidth:"271px",expandedContainerWidth:"311px",topBotComboWidth:"80px",normalComboWidth:"150px",expandedComboWidth:"190px",normalSubComboWidth:"127px",expandedSubComboWidth:"169px",topBotExpandedContainerWidth:"272px"},Filter.initComponents=function(e){$.ui.utils.initComponents($(e)),$.ZToolbarHandler.init($(e))},Filter.showFilterOptions=function(e,t,r,l,i){var o,a=!!e,s=Filter.header;if(a&&(browser_ie?(e=window.event,o=e.srcElement):o=e.target),isCellEdited()&&submitCell(),!READ_WRITE)return void showAlertDialog(jsMsg["Filter.readOnly.alertMessage"]);sheetdialog.close(),isUndefined(t)&&(t=currCol);var d,n,c;r||(d=a?o:Filter.getIcon(t),n=d.parentNode),c=r?!0:n.getAttribute("pivot");var F;if(c&&(F=r?-1!==l.pft.indexOf("page"):"page"===n.getAttribute(JSONConstants.PIVOT_FIELD_TYPE)?!0:!1),Filter.isPivotFilter=c?!0:!1,!c)var u=Filter.getInstance(),f=u.range;var v=getObj("filterColumnData"),m=a?parseInt(n.getAttribute("col")):r?l.col:t,h=a?parseInt(n.getAttribute("index")):r?0/0:t-f.sc;if(!v||"none"===v.style.display||(Filter.hideFilterOptions(),currentFilterIndex!==h)){if(Filter.currCol=m,c||u.isFilteredCol(m)||(Filter.getIcon(m).src=IMAGE_PATH+"filter_state.png"),v){v.style.display="block";var I=Filter.width;$(v).css("width",I.normalContainerWidth)}currentFilterIndex=h;var p,C=new AjaxRequest;if(c){var g=r?l.row:n.getAttribute("row"),x=getCell(g,t),b=r?l.cellValue:getCellContent(x);pivot.Collection.setPivotId(g,t,r?l.asn:void 0),p=new RequestParameters(ActionConstants.READ_PIVOT_FILTER_DATA),p.setParameters(pivotId,encodeURIComponent(b))}else p=new RequestParameters(ActionConstants.GET_FILTER_DATA),p.setParameters(WorkSheets.getAssociatedActiveSheetName(),m,h);return C.init("POST",p.getURL(),!0,p.getParametersAsString()),C.addEventListener("onComplete",function(e){var o=parseJSON(e.responseText);if(o){var a=r?l.col:c?t:h+f.sc,I=o.dT,p=o.hV,C=o.o1,x=o.o2,O=o.v1,S=o.v2,w=o.ft,T=o.isc;maxFilterCriteria=o.mfc;var D=o.aft;Filter.currColData=o.cD,cellColor=o.ccs,textColor=o.tcs,isReset=!0,Filter.selectedItemIndexes=o.selectedItemIndexes;var H=o.smd;if(c){Filter.ascendingSort=o[JSONConstants.ASCENDING_SORT],Filter.sortMode=o[JSONConstants.PIVOT_SORTMODE],$("#sort_asc").show(),$("#sort_desc").show(),F?($(".pivotSortByDiv").hide(),$("#sort_asc").attr("disabled","disabled"),$("#sort_desc").attr("disabled","disabled")):($(".pivotSortByDiv").show(),$("#sort_asc").removeAttr("disabled"),$("#sort_desc").removeAttr("disabled"),Filter.sortMode<1?($("#sort_asc").removeAttr("title"),$("#sort_desc").removeAttr("title")):Filter.ascendingSort?($("#sort_asc").addClass("sSo"),$("#sort_desc").removeAttr("title")):($("#sort_desc").addClass("sSo"),$("#sort_asc").removeAttr("title"))),Filter.fieldType=r?l.pft:n.getAttribute(JSONConstants.PIVOT_FIELD_TYPE),Filter.headerIndex=r?l[JSONConstants.HEADER_INDEX]:n.getAttribute(JSONConstants.HEADER_INDEX),Filter.sortDataIndex=o[JSONConstants.PIVOT_DATAFIELDINDEX],p=b,H=!1,Filter.selectedItemIndexes&&Filter.selectedItemIndexes.length&&(D="fbv"),cellColor=[],textColor=[];{Filter.ascendingSort?"sort_asc":"sort_desc"}$("#fL").show(),getObj("headers").style.display="none",getObj("cellColorId").style.display="none",getObj("textColorId").style.display="none",getObj("customFilterId").style.display="none",$("#filterSearch").addClass("pvt"),$(".filterOption").hide(),getObj("filterColumnData").style.width="250px",$("#autoFilterIdContent").css("border-top","1px dashed #e8e8e8"),$("#filterColumnData #btn").show(),Filter.initComponents("#pivotSortBy");var y=PivotUtil.getsortByValues(Filter.fieldType,Filter.headerIndex),k=$("#pivotSortBy");k.html("");var E=-1;for(V=0;V<y.length;V++)o[JSONConstants.PIVOT_DATAFIELDINDEX]==E?$("<option/>",{value:E,selected:"selected",text:y[V]}).appendTo(k):$("<option/>",{value:E,text:y[V]}).appendTo(k),E++;$("#sort_asc").attr("title",jsMsg["Pivot.Tooltip.Asc.By"]),$("#sort_desc").attr("title",jsMsg["Pivot.Tooltip.Desc.By"]),k.zcombo("refresh"),k.bind("combochange",function(){$("#sort_asc").removeClass("sSo"),$("#sort_desc").removeClass("sSo")})}else $(".pivotSortByDiv").hide(),$("#fL").hide(),getObj("headers").style.display="block",getObj("cellColorId").style.display="block",getObj("textColorId").style.display="block",getObj("customFilterId").style.display="block",$("#filterSearch").removeClass("pvt"),$("#autoFilterIdContent").css("border-top","0px"),$(".filterOption").show(),$("#sort_asc").removeAttr("disabled"),$("#sort_desc").removeAttr("disabled"),getObj("filterColumnData").style.width="271px",$("#sort_asc").show(),$("#sort_desc").show(),$("#filterColumnData #btn").show(),$("#sort_asc").removeAttr("title"),$("#sort_desc").removeAttr("title");Filter.initComponents("#btn"),Filter.initComponents("#sortBtn");{Filter.updateAppliedFilterDetails(D)}c||(Filter.appendItems(D,"#cellColorDiv",cellColor),Filter.appendItems(D,"#textColorDiv",textColor)),$("#autoFilterId").off("click"),$("#cellColorId").off("click"),$("#textColorId").off("click"),$("#customFilterId").off("click"),$("#sort_asc").off("click"),$("#sort_desc").off("click"),$("#autoFilterId").click(function(){Filter.setHeader("autoFilterHeader")}),$("#cellColorId").click(function(){Filter.setHeader("cellColorHeader")}),$("#textColorId").click(function(){Filter.setHeader("textColorHeader")}),$("#customFilterId").click(function(){Filter.initComponents("#div4"),Filter.setHeader("customFilterHeader")}),Filter.initComponents("#div4");var H=o.smd,A=getObj("dataDiv");A.innerHTML="";var j=document.createDocumentFragment(),_=document.createElement("div");A.onmousedown=Filter.applyFilter1;var M,R=""===Filter.currColData[0],V=0;if(R){var N=_.cloneNode(!0);M="fbv"===D&&Filter.isItemSelected(V)?s.selectedItem:s.deselectedItem,$(N).attr("itemIndex",V++).text("(Blanks)").addClass(M),j.appendChild(N)}for(var P=Filter.currColData.length;P>V;V++)if(Filter.currColData[V]&&"object"!=typeof Filter.currColData[V]){var B=_.cloneNode(!0),M="fbv"===D&&Filter.isItemSelected(V)?s.selectedItem:s.deselectedItem;$(B).attr("itemIndex",V).attr("title",Filter.currColData[V]).text(Filter.currColData[V]).addClass(M),j.appendChild(B)}A.appendChild(j);var L=getObj("maxDataInfo");H?(L.style.display="",displayMaxDataInfo=!0):(L.style.display="none",displayMaxDataInfo=!1),Filter.changeCriteriaLabels(I,T);var W=$("#fo1"),z=$("#fo2");if(T){var U=$("#foCategory"),q=$("#fVal3");Filter.customFilter(!0);var J=o.sOpr,X=o.sC,G=o.sVal,Y="items"===X?"values":"percent";W.zcombo("setValue",J),U.zcombo("setValue",Y),q.zspinner("setValue",G),Filter.setWidth(J)}else if("fc"===D){Filter.initComponents("#div4");var K=$("#fVal1"),Z=$("#fVal2");W.zcombo("setValue",C),z.zcombo("setValue",x),K.val(O),Z.val(S),"AND"===w?getObj("and").checked=!0:getObj("or").checked=!0,Filter.setWidth(C),Filter.datePickerHandler(C,"fo1"),Filter.datePickerHandler(x,"fo2")}!c&&u.columns[m]&&(u.columns[m].dataType=I)}isFilterOptionsDIVOpened=!0;var Q=getNormalizedScrollLeft(),et=getColLeft(a)+getColWidth(a);a>FREEZED_COL&&(et-=Q);var tt=r?et:et-d.offsetWidth;isFilterOpenedLeft=!1,tt+v.offsetWidth>getSheetWidth()+rowHeadWidth-ssVScrollbar.offsetWidth&&(tt=et-v.offsetWidth,isFilterOpenedLeft=!0),tt+=rowHeadWidth-1,filterStartRow=c?g:u.range.sr;var rt,lt=getSheetScrollTop(),it=getRowTop(parseInt(filterStartRow)+1)-lt,ot=it;it+v.offsetHeight>getSheetHeight()&&(it=getRowTop(parseInt(filterStartRow))+r?0:d.offsetTop-v.offsetHeight-lt,rt=parseInt(it)+parseInt(sheetTop)+"px"),0>it+sheetTop&&(it=parseInt(ot)+parseInt(sheetTop)+"px",getSheetHeight()-ot<v.offsetHeight&&(rt=0)),FREEZED_ROW>filterStartRow&&(rt=getSheetHeight()-(lt-Math.abs(ot))<v.offsetHeight?0:0>ot?parseInt(sheetTop)+lt-Math.abs(ot):parseInt(sheetTop)+ot),rt=void 0!=rt?rt:parseInt(it)+parseInt(sheetTop)+"px",r?PivotChartUtility.showFilterMenu(v,l,i):isRTL?($(v).css({right:tt+"px",zIndex:1e4+BASEZINDEX,top:rt}),$(v).css("left","")):$(v).css({left:tt+"px",zIndex:1e4+BASEZINDEX,top:rt})}),C.sendRequest(),!1}},Filter.setHeader=function(e){$("#ui-datepicker-div").hide(),currentHeader=e,isReset=!1},Filter.getSelectedItems=function(){var e="[",t=!1;if("div1"===Filter.currentEl)for(var r=0,l=Filter.currColData.length;l>r;r++)Filter.isItemSelected(r)&&(t=!0,e+='"'+encodeURIComponent(Filter.currColData[r].replace(/\"/g,'\\"'))+'",');else"div2"===Filter.currentEl?jQuery.each(Filter.selectedItemIndexes,function(t,r){1===r&&(e+='"bycellcolor('+cellColor[t]+')",')}):"div3"===Filter.currentEl&&jQuery.each(Filter.selectedItemIndexes,function(t,r){1===r&&(e+='"byfontcolor('+textColor[t]+')",')});return t&&(e=e.substring(0,e.length-1)),e+="]"},Filter.getSelectedTabDataLen=function(){return"autoFilterHeader"===currentHeader?Filter.currColData.length:"cellColorHeader"===currentHeader?cellColor.length:"textColorHeader"===currentHeader?textColor.length:0},Filter.applyFilterCriteria=function(e,t,r,l,i,o,a,s,d){var n=Filter.getInstance();if(n)var c=n.range,F=c.sr,u=c.sc,f=c.er,v=c.ec;var m=new AjaxRequest,h=ActionConstants.APPLY_FILTER,I=actionManager.addRequest.bind(actionManager),c=n.range;if(e=WorkSheets.getSheetCodeFromName(e),jsVERSION_VIEW){var p=jsVERSION_VIEW&&""===DOCUMENT_VERSION?!0:void 0,h=ActionConstants.APPLY_FILTER_READ_ONLY;I=m.sendRequest.bind(m),m.addEventListener("onComplete",function(e){var t=JSON.parse(e.responseText);updateJson(t)});var C=new RequestParameters(h);C.setParameters(e,t,r,l,i,o,a,s,d,F,u,f,v,p),m.init("POST",C.getURL(),!0,C.getParametersAsString()),I(m)}else{var C=new RequestParameters(h);C.setParameters(e,t,r,l,i,o,a,s,d,F,u,f,v),m.init("POST",C.getURL(),!0,C.getParametersAsString()),I(m)}Filter.enableDisableInsertIcon(!1),Filter.hideFilterOptions()},Filter.datePickerHandler=function(e,t){var r=Filter.getInstance();if(r&&r.getColumnData(Filter.currCol))var l=r.getColumnData(Filter.currCol).dataType;var i=$("fo1"===t?"#fVal1":"#fVal2");if("DATE"!==l||"lt"!==e&&"lte"!==e&&"gt"!==e&&"gte"!==e)i.removeClass("datePickerIcon"),i.datepicker("destroy");else{var o=getDateFormat();i.addClass("datePickerIcon"),i.datepicker({changeMonth:!0,changeYear:!0,constrainInput:!1,dateFormat:o}),$("#ui-datepicker-div").click(function(){isReset||($("#filterOk").enable(),Filter.closeSearchBox(),Filter.headerTickShow(!0,!0),Filter.resetSelectedItemIndexes())})}},Filter.setWidth=function(e){if(!Filter.isPivotFilter){var t=Filter.width,r=$("#filterColumnData"),l=(r.offset().left,r.width()),i=$("#fo1").siblings("div"),o=$("#fo2").siblings("div");if("top"===e||"bottom"===e)290!==l&&r.width(t.topBotExpandedContainerWidth),i.width(t.topBotComboWidth),i.children(".ui-zcombo-select-item").width(t.topBotComboWidth);else if("lte"===e||"gte"===e||"!begins"===e||"!ends"===e)330!==l&&(r.width(t.expandedContainerWidth),i.width(t.expandedComboWidth),i.children(".ui-zcombo-select-item").width(t.expandedSubComboWidth),o.width(t.expandedComboWidth),o.children(".ui-zcombo-select-item").width(t.expandedSubComboWidth));else{var a=getObj("fo1").value,s=getObj("fo2").value,d="gte"===a||"lte"===a||"!begins"===a||"!ends"===a||"gte"===s||"lte"===s||"!begins"===s||"!ends"===s;d||(290!==l&&r.width(t.normalContainerWidth),i.width(t.normalComboWidth),i.children(".ui-zcombo-select-item").width(t.normalSubComboWidth),o.width(t.normalComboWidth),o.children(".ui-zcombo-select-item").width(t.normalSubComboWidth))}}},Filter.showSpecialConditions=function(e){if(e){var t=e.zcombo("getValue");Filter.setWidth(t);var r=["autoFilterId","cellColorId","textColorId","clearFilter","filterOk","sort_asc","sort_desc","customFilterId"];if($("#customFilterBack").css("box-shadow",""),$("#"+r[selectedFilterTabIndex]).css("box-shadow",""),"top"===t||"bottom"===t){var l=["#autoFilterId","#cellColorId","#textColorId"];Filter.headerTickHide(l,!1),$("#filterOk").enable(),Filter.customFilter(!0),isReset||Filter.resetSelectedItemIndexes()}else Filter.customFilter(!1),""===$("#fVal1").val()&&""===$("#fVal2").val();var i=$(e).attr("id");Filter.datePickerHandler(t,i)}},Filter.customFilter=function(e){e?($("#fVal1").hide(),$("#fo2").parent().hide(),$("#fval2").hide(),$("#radioOpr").hide(),$("#topBottomDiv").show()):($("#topBottomDiv").hide(),$("#fVal1").show(),$("#fval2").show(),$("#and").show(),$("#or").show(),$("#radioOpr").show(),$("#fo2").parent().show())},Filter.searchInputKeydown=function(e,t){return Filter.searckeyEventsManager(e,t)},Filter.closeSearchBox=function(){var e=$("#searchIconCont"),t=$("#filterSearch");e.is(":checked")&&(e.click(),t.val(""),Filter.searchItems(""),t.blur())},Filter.textBoxMouseDown=function(e){var t=Filter.getInstance();if(t.getColumnData(Filter.currCol))var r=t.getColumnData(Filter.currCol).dataType;"DATE"===r&&("fVal1"!==e||"gt"!==$("#fo1").zcombo("getValue")&&"gte"!==$("#fo1").zcombo("getValue")&&"lt"!==$("#fo1").zcombo("getValue")&&"lte"!==$("#fo1").zcombo("getValue")?"fVal2"!==e||"gt"!==$("#fo2").zcombo("getValue")&&"gte"!==$("#fo2").zcombo("getValue")&&"lt"!==$("#fo2").zcombo("getValue")&&"lte"!==$("#fo2").zcombo("getValue")||$("#ui-datepicker-div").show():$("#ui-datepicker-div").show()),$("#"+e).focus(),Filter.resetTicks(!0,!0,!0);var l=["autoFilterId","cellColorId","textColorId","clearFilter","filterOk","sort_asc","sort_desc","customFilterId"];$("#"+l[selectedFilterTabIndex]).css("box-shadow",""),$("#customFilterBack").css("box-shadow",""),$("#filterOk").enable()},Filter.searchMouseDown=function(){var e=$("#filterSearch");$("#searchIconCont").is(":checked")?setTimeout(function(){e.focus()},100):(e.val(""),Filter.searchItems(""),e.blur())},Filter.dataDivMouseDown=function(){if(2!==selectedFilterTabIndex){var e=["autoFilterId","select1","searchCont","clearFilter","filterOk","sort_asc","sort_desc","customFilterId"];$("#"+e[selectedFilterTabIndex]).css("box-shadow","");selectedFilterTabIndex=2}$("#filterSearch").blur()},Filter.searckeyEventsManager=function(e,t){var r="autoFilterHeader"===currentHeader?"dataDiv":"cellColorHeader"===currentHeader?"cellColorDiv":"textColorDiv";return 40===e.keyCode?($("#cF").focus(),hoverItem=0,void $($("#"+r).children()[hoverItem]).addClass("fhover")):(39===e.keyCode?(hoverItem=-2,Filter.searchMouseDown()):9===e.keyCode?e.shiftKey?Filter.isPivotFilter?null!==getObj("sort_desc").getAttribute("disabled")&&"disabled"===getObj("sort_desc").getAttribute("disabled")?selectedFilterTabIndex=5:(selectedFilterTabIndex=7,$("#sort_desc").css("box-shadow","0px 0px 2px 2px #addfff")):(selectedFilterTabIndex=0,hoverItem=-2,$("#select1").removeClass("fhover"),$("#autoFilterId").trigger("click"),$("#autoFilterId").css("box-shadow","0px 0px 2px 2px #addfff")):($("#cF").focus(),Filter.shortCutHandler(e)):27===e.keyCode&&Filter.hideFilterOptions(),Filter.clearSearchTimeout(),void(Filter.timeoutId=window.setTimeout(function(){Filter.onSearchTimeout(t)},10)))},Filter.keyEventsManager=function(e){$("#filterOk").enable(),Filter.resetTicks(!1,!0,!0),browser_ie&&(e=window.event);var t=e.keyCode,r=e.altKey;if(27===t||r&&38===t)return Filter.hideFilterOptions(),!1;if(r){var l=!1,i=Filter.currCol,o=Filter.getInstance().range;if(37===t&&i>o.sc&&(l=!0,i-=1),39===t&&i<o.ec&&(l=!0,i+=1),l)return Filter.showFilterOptions(void 0,i),!1}return 13===t?(Filter.applyCustomFilter(),!1):("autoFilterHeader"===currentHeader||"cellColorHeader"===currentHeader||"textColorHeader"===currentHeader)&&65===t&&(os_mac&&e.metaKey||os_windows&&e.ctrlKey)&&e.shiftKey?(Filter.selectAllItems(),!1):void(isReset||(Filter.closeSearchBox(),Filter.resetSelectedItemIndexes()))},Filter.onSearchTimeout=function(e){Filter.searchItems(e.value.toLowerCase())},Filter.clearSearchTimeout=function(){isUndefined(Filter.timeoutId)||window.clearTimeout(Filter.timeoutId)},Filter.deselectAll=function(){for(var e=0,t=Filter.currColData.length;t>e;e++)Filter.selectedItemIndexes[e]=0},Filter.searchItems=function(e){var t=Filter.currColData,r=document.createElement("div"),l=document.createDocumentFragment(),i=""===e,o=0;Filter.resultantSearchItemIndexes=[];var a=Filter.header,s=0,d=0,n=""===Filter.currColData[0];if(n&&i){var c=0,F=r.cloneNode(!0),u="div1"===Filter.currentEl?Filter.isItemSelected(s):!1,f=u?(o++,c=1,a.selectedItem):a.deselectedItem;$(F).text("(Blanks)").attr("itemIndex",s).addClass(f),Filter.resultantSearchItemIndexes.push(c),l.appendChild(F),s++}for(var d=0,v=t.length;v>s;s++){var m=t[s];if(i||m.toLowerCase().indexOf(e)>-1){var c=0,F=r.cloneNode(!0),u="div1"===Filter.currentEl?Filter.isItemSelected(s):!1,f=u?(o++,c=1,a.selectedItem):a.deselectedItem;$(F).text(m).attr("itemIndex",s).addClass(f),$(F).text(m).attr("searchItemIndex",d++),Filter.resultantSearchItemIndexes.push(c),l.appendChild(F)}}var h=getObj("dataDiv").childNodes[0];h.innerHTML=i?a.selectAllItemsMsg:a.selectAllItemsMsg;var I=getObj("filterSearch");if(0===Filter.resultantSearchItemIndexes.length){h.style.visibility="hidden",I.className="filterSearchBox filterSearchError aFlrInp",Filter.isPivotFilter&&$("#filterSearch").addClass("pvt"),$("#dataDiv").html("");var p=document.createElement("div");$(p).text(jsMsg["Filter.noSearchResults"]),$(p).addClass("fltrNoRes"),$(p).attr("id","searchId"),$("#dataDiv").append(p)}else{h.style.visibility="visible",I.className="aFlrInp",Filter.isPivotFilter&&$("#filterSearch").addClass("pvt");var C=a.partiallySelectedItem;Filter.isViewFiltered()&&(o=Filter.selectedItemIndexes.toString().split("1").length-1),0===o?(C=a.deselectedItem,$("#filterOk").disable()):Filter.resultantSearchItemIndexes.toString().indexOf("0")<0&&(C=a.selectedItem,$("#filterOk").enable());var g=getObj("dataDiv");g.innerHTML="",g.appendChild(l),h.className=C}},Filter.selectedIndexes=[],Filter.isItemSelected=function(e){return parseInt(Filter.selectedItemIndexes[e])},Filter.resetSelectedItemIndexes=function(){Filter.resetTicks(!0,!0,!0),("autoFilterHeader"===currentHeader?"div1"!==Filter.currentEl:"cellColorHeader"===currentHeader?"div2"!==Filter.currentEl:"textColorHeader"===currentHeader?"div3"!==Filter.currentEl:"div4"!==Filter.currentEl)&&(Filter.currentEl="autoFilterHeader"===currentHeader?"div1":"cellColorHeader"===currentHeader?"div2":"textColorHeader"===currentHeader?"div3":"div4",Filter.selectedItemIndexes=new Array(Filter.getSelectedTabDataLen()+1).join("0").split(""),isReset=!0)},Filter.resetTicks=function(e,t,r){var l=Filter.header,i=["#dataDiv","#cellColorDiv","#textColorDiv"];e&&("autoFilterHeader"===currentHeader?i.splice(0,1):"cellColorHeader"===currentHeader?i.splice(1,1):"textColorHeader"===currentHeader&&i.splice(2,1));for(var o=0;o<i.length;o++){if(t){var a=$(i[o]).siblings();a.attr("class",l.deselectedItem)}if(r)for(var s=$(i[o]).children("div"),d=0;d<s.length;d++)s[d].className===l.selectedItem&&(s[d].className=l.deselectedItem)}},Filter.headerTickShow=function(e){var t="autoFilterHeader"===currentHeader?"#autoFilterId":"cellColorHeader"===currentHeader?"#cellColorId":"textColorHeader"===currentHeader?"#textColorId":"",r=$(t);r&&r.id&&$("#"+r.id).click();var l=$("#"+r[0].id);if($(l).children().animate({opacity:0},0).animate({opacity:1},300).show(),r.addClass("selected bTc dAt"),e){var i=["#autoFilterId","#cellColorId","#textColorId",""];i.splice(i.indexOf(t),1),Filter.headerTickHide(i,!0)}},Filter.headerTickHide=function(e){if("object"==typeof e)for(var t=0;t<e.length;t++){var r=$(e[t]);if($("#"+r.attr("id")).removeClass("selected bTc dAt"),$("#"+r.attr("id")).children()[0]){var l=$("#"+r.attr("id"));$(l).children().animate({opacity:0},0).hide()}}else{var i=$(e);$(i).children().animate({opacity:0},0).hide(),i.removeClass("selected bTc dAt")}},Filter.resetCustomFilter=function(){Filter.customFilter(!1);var e=$("#fVal1"),t=$("#fVal2");e.val(""),t.val(""),Filter.datePickerHandler("eq","fo1"),Filter.datePickerHandler("","fo2"),Filter.setWidth("eq")},Filter.selectItem=function(e){isReset||(Filter.resetSelectedItemIndexes(),Filter.resetCustomFilter(),"autoFilterHeader"!==currentHeader&&Filter.closeSearchBox()),hoverItem>=0&&($($("#"+e.parentElement.id).children()[hoverItem]).removeClass("fhover"),selectedFilterTabIndex=3),hoverItem=$(e).index();var t=$(e),r=parseInt(t.attr("itemIndex")),l=Filter.isItemSelected(r),i=Filter.header;e.className=l?(l=0,i.deselectedItem):(l=1,i.selectedItem),Filter.selectedItemIndexes[r]=l;var o=Filter.isViewFiltered();if(o){var a=parseInt(t.attr("searchItemIndex"));Filter.resultantSearchItemIndexes[a]=l}var s=o?Filter.resultantSearchItemIndexes:Filter.selectedItemIndexes,d=Filter.setSelectAllStyle(s);if(!d&&o){var n=Filter.selectedItemIndexes.toString();d=n.indexOf(1)>-1}if(d)Filter.headerTickShow(!0,!0),$("#filterOk").enable();else{var c="autoFilterHeader"===currentHeader?"#autoFilterId":"cellColorHeader"===currentHeader?"#cellColorId":"#textColorId";Filter.headerTickHide(c,!0),$("#filterOk").disable()}},Filter.setSelectAllStyle=function(e){var t=Filter.header,r=e.toString(),l=r.indexOf(0)>-1,i=r.indexOf(1)>-1,o=l?i?t.partiallySelectedItem:t.deselectedItem:t.selectedItem;return getObj(Filter.currentEl).childNodes[0].className="div1"==Filter.currentEl?o:o,i},Filter.isViewFiltered=function(){return""!==getObj("filterSearch").value},Filter.itemSelectorMouseDown=function(e,t){Filter.resetCustomFilter(),Filter.headerTickShow(!0,!0),isReset||Filter.resetSelectedItemIndexes(),Filter.selectAllItems(e,t)},Filter.selectAllItems=function(e,t){var r=Filter.isViewFiltered(),l=Filter.header,i="div1"==e?getObj(e).childNodes[0]:getObj(e).childNodes[0],o=l.selectedItem,a=!0;i.className===l.selectedItem&&(o=l.deselectedItem,a=!1),i.className=a?l.selectedItem:l.deselectedItem;for(var s=getObj(t).childNodes,d=a?1:0,n=0,c=s.length;c>n;n++){var F=s[n];F.className=o,r&&(Filter.resultantSearchItemIndexes[n]=d),Filter.selectedItemIndexes[parseInt(F.getAttribute("itemIndex"))]=d}var u=-1===Filter.selectedItemIndexes.toString().indexOf("1");if(u?$("#filterOk").disable():$("#filterOk").enable(),!a){var f="autoFilterHeader"===currentHeader?"#autoFilterId":"cellColorHeader"===currentHeader?"#cellColorId":"#textColorId";Filter.headerTickHide(f,!0)}},Filter.clickFunction=function(e){$(e).on("click",function(){Filter.selectItem(this)})},Filter.appendItems=function(e,t,r){var l=Filter.header;$(t).html("");for(var i=0;i<r.length;i++){var o=document.createElement("div");$(o).attr({colorname:r[i],itemindex:i}),$(o).addClass(("fbcc"===e&&"#cellColorDiv"===t||"fbtc"===e&&"#textColorDiv"===t)&&Filter.isItemSelected(i)?l.selectedItem:l.deselectedItem),Filter.clickFunction(o);var a=document.createElement("span");$(o).append(a),""===r[i]?"#textColorDiv"===t?($(a).css({"background-color":"#000000"}),$(o).append(jsMsg["Filter.default"])):$(o).append(jsMsg["Filter.noFill"]):$(a).css({"background-color":r[i]}),$(t).append(o)}},Filter.changeCriteriaLabels=function(e,t){var r=$("#fo1"),l=$("#fo2");if(t||"NUMBER"===e){if(!$("#fo1 option[value='top']").length){var i="<optgroup mtype='separator'></optgroup><option value='top'>"+jsMsg["Condition.top"]+"</option><option value='bottom'>"+jsMsg["Condition.bottom"]+"</option>";r.append(i)}}else("DATE"===e||"TEXT"===e)&&r.find("option[value='top']").length&&(r.find("option[value='top']").remove(),r.find("option[value='bottom']").remove(),r.find("optgroup:last").remove());"DATE"===e?(r.find("option[value='gt']").text(jsMsg["Condition.DateAfter"]),r.find("option[value='gte']").text(jsMsg["Condition.DateOnOrAfter"]),r.find("option[value='lt']").text(jsMsg["Condition.DateBefore"]),r.find("option[value='lte']").text(jsMsg["Condition.DateOnOrBefore"]),l.find("option[value='gt']").text(jsMsg["Condition.DateAfter"]),l.find("option[value='gte']").text(jsMsg["Condition.DateOnOrAfter"]),l.find("option[value='lt']").text(jsMsg["Condition.DateBefore"]),l.find("option[value='lte']").text(jsMsg["Condition.DateOnOrBefore"])):(r.find("option[value='gt']").text(jsMsg["Condition.GreaterThan"]),r.find("option[value='gte']").text(jsMsg["Condition.GreaterThanOrEqualTo"]),r.find("option[value='lt']").text(jsMsg["Condition.LessThan"]),r.find("option[value='lte']").text(jsMsg["Condition.LessThanOrEqualTo"]),l.find("option[value='gt']").text(jsMsg["Condition.GreaterThan"]),l.find("option[value='gte']").text(jsMsg["Condition.GreaterThanOrEqualTo"]),l.find("option[value='lt']").text(jsMsg["Condition.LessThan"]),l.find("option[value='lte']").text(jsMsg["Condition.LessThanOrEqualTo"])),r.zcombo("refresh"),l.zcombo("refresh")},Filter.updateAppliedFilterDetails=function(e){if(Filter.currentEl="div1",currentHeader="autoFilterHeader",e){var t=getObj("btn").childNodes[0];t.onmousedown=Filter.applyFilterAll,$("#clearFilter").enable(),$("#filterOk").enable(),"fc"===e?(Filter.currentEl="div4",currentHeader="customFilterHeader",$("#customFilterId").mousedown()):("fbv"===e?(Filter.showHeader("#autoFilterIdContent"),Filter.currentEl="div1",currentHeader="autoFilterHeader",$("#autoFilterId").trigger("click")):"fbcc"===e?(Filter.showHeader("#cellColorIdContent"),Filter.currentEl="div2",currentHeader="cellColorHeader",$("#cellColorId").trigger("click")):"fbtc"===e&&(Filter.showHeader("#textColorIdContent"),Filter.currentEl="div3",currentHeader="textColorHeader",$("#textColorId").trigger("click")),Filter.setSelectAllStyle(Filter.selectedItemIndexes),Filter.headerTickShow(!1,!0))}else $("#clearFilter").disable(),$("#filterOk").disable(),$("#customFilterBack").click(),$("#autoFilterId").trigger("click"),Filter.selectedItemIndexes=new Array(Filter.getSelectedTabDataLen()+1).join("0").split("")},Filter.showHeader=function(e){var t=["#autoFilterIdContent","#cellColorIdContent","#textColorIdContent","#customFilterIdContent"],r=$(e);("#autoFilterIdContent"===e||"#cellColorIdContent"===e||"#textColorIdContent"===e)&&$("#customFilterBack").click(),"#customFilterIdContent"===e&&($("#fB").text(jsMsg["Filter.customFilter"]),$("#fV").hide(),$("#customFilterId").hide(),$("#customFilterBack").show(),$("#headers").hide()),r.show(),t.splice(t.indexOf(e),1);for(var l=0;l<t.length;l++)$(t[l]).hide()},Filter.setMaxRange=function(e){if(e){var t=$("#fVal3");0===e.selectedIndex?t.zspinner("setMaxvalue",65536):1===e.selectedIndex&&t.zspinner("setMaxvalue",100)}},Filter.resetAutoFilterOptions=function(){var e=getObj("maxDataInfo");e.style.display="none",Filter.closeSearchBox()},Filter.closeFilterOptions=function(){isFilterOptionsDIVOpened&&Filter.hideFilterOptions()},Filter.applyCustomFilter=function(){if(Filter.isPivotFilter){for(var e=Filter.currColData,t=Filter.selectedItemIndexes,r=[],l=0;l<e.length;l++)1===t[l]&&r.push(e[l]);return PivotUtil.filter(Filter.fieldType,Filter.headerIndex,r,$("#select1").hasClass("filterItemSelect")),Filter.hideFilterOptions(),!1}var i,o=Filter.header,a=Filter.getInstance(),s=Filter.currCol-a.range.sc,d="TEXT";a.getColumnData(Filter.currCol)&&(d=a.getColumnData(Filter.currCol).dataType);for(var n=["#dataDiv","#cellColorDiv","#textColorDiv"],l=0;l<n.length;l++)for(var c=$(n[l]).children("div"),F=0;F<c.length;F++){var u=c[F].className;if(u===o.selectedItem){i=!0;break}}var f=getObj("fo1").value;if("top"===f||"bottom"===f){var v=f,m=getObj("fVal3").value,h=getObj("foCategory").value;return void Filter.applySpecialCondition(v,m,h,d,s)}if("div1"===Filter.currentEl||"div2"===Filter.currentEl||"div3"===Filter.currentEl)var I=i?!0:!1;var p,C,g,x,b;if(""===g)return Filter.hideFilterOptions(),!1;if(I){if(Filter.selectedItemIndexes.toString().indexOf("1")<0)return;p=Filter.getSelectedItems(),g="eq",b="OR"}else p=getObj("fVal1").value,p=encodeURIComponent(p),C=getObj("fVal2").value,C=encodeURIComponent(C),g=getObj("fo1").value,x=getObj("fo2").value,b=getObj("or").checked?"OR":"AND";if(I&&Filter.selectedItemIndexes.toString().indexOf("0")<0)Filter.applyFilterAll();else{if(I&&Filter.selectedItemIndexes.toString().split("1").length-1>maxFilterCriteria)return void showAlertDialog(replaceParams(jsMsg["Filter.Criteria.Selection"],new Array(maxFilterCriteria.toString())));Filter.applyFilterCriteria(CURRSHEETNAME,s,d,p,g,C,x,b)}return sheetdialog.close(),!1},Filter.applySpecialCondition=function(e,t,r,l,i){if(!(t>=1))return Filter.hideFilterOptions(),!1;t=Math.round(t);var o=e+" "+r;Filter.applyFilterCriteria(CURRSHEETNAME,i,l,t,o,void 0,void 0,void 0,ActionConstants.SPECIAL_CRITERIA)},Filter.applyFilterAll=function(){if(Filter.isPivotFilter)return PivotUtil.filter(Filter.fieldType,Filter.headerIndex,Filter.currColData,!0),void Filter.hideFilterOptions();var e=Filter.getInstance();if(e){var t=Filter.currCol-e.range.sc;Filter.applyFilterCriteria(CURRSHEETNAME,t,void 0,void 0,void 0,void 0,void 0,void 0,ActionConstants.APPLY_FILTER_ALL)}},Filter.applyFilterBlank=function(e){var t;browser_ie?(e=window.event,t=e.srcElement):t=e.target,Filter.selectItem(t,""),stopEvt(e)},Filter.applyFilter1=function(e){var t;return browser_ie?(e=window.event,t=e.srcElement):t=e.target,t.id?!1:void Filter.selectItem(t)},Filter.custom=function(e){Filter.initComponents("#div4"),$("#fVal3").zspinner("setValue",10),$("#fo1").zcombo("setValue","eq"),$("#fo2").zcombo("setValue","");var t=$("#fo1").zcombo("getDropDown");if("block"===t.css("display"))t.hide();else{var r=$("#fo2").zcombo("getDropDown");"block"===r.css("display")&&r.hide()}"customFilterHeader"===currentHeader&&Filter.setHeader("autoFilterHeader");var l=e.id;if("customFilterId"==l){var i=["autoFilterId","cellColorId","textColorId","clearFilter","filterOk","sort_asc","sort_desc","customFilterId"];$("#fB").show(),$("#"+i[selectedFilterTabIndex]).css("box-shadow",""),selectedFilterTabIndex=8,$("#fB").text(jsMsg["Filter.customFilter"]),$("#fV").hide(),$("#customFilterId").hide(),$("#customFilterBack").show(),$("#headers").hide(),$(".filterOption").addClass("cFd"),Filter.showOption(e)}else $("#fB").hide(),$("#fV").text(jsMsg["Filter.by.cellValue"]),$("#fV").show(),$("#customFilterId").show(),$("#customFilterBack").hide(),$("#customFilterBack").css("box-shadow",""),$("#headers").show(),$(".filterOption").removeClass("cFd"),Filter.showOption("textColorHeader"===currentHeader?$("#textColorId"):"cellColorHeader"===currentHeader?$("#cellColorId"):$("#autoFilterId"))},Filter.showOption=function(e){var t=["autoFilterId","cellColorId","textColorId","clearFilter","filterOk","sort_asc","sort_desc","customFilterId"],r=["dataDiv","cellColorDiv","textColorDiv"];$("#"+t[selectedFilterTabIndex]).css("box-shadow",""),$($("#headers").find(".fselected")).css("box-shadow",""),$("#"+r[t.indexOf(selectedFilterTab)]).scrollTop(0),hoverItem>-1&&$($("#"+r[t.indexOf(selectedFilterTab)]).children()[hoverItem]).removeClass("fhover"),$("#autoFilterIdContent").hide(),$("#cellColorIdContent").hide(),$("#textColorIdContent").hide(),$("#customFilterIdContent").hide();var l;l=e.id,l||(l=e.attr("id")),selectedFilterTab=l,hoverItem=-2,$("#"+l+"Content").show(),"autoFilterId"===l?($("#fV").text(jsMsg["Filter.by.cellValue"]),$(".dA").css("left","9px"),$("#cellColorId").removeClass("fselected"),$("#textColorId").removeClass("fselected"),$("#autoFilterId").addClass("fselected")):"cellColorId"===l?($("#fV").text(jsMsg["Filter.by.cellColor"]),$(".dA").css("left","97px"),$("#autoFilterId").removeClass("fselected"),$("#textColorId").removeClass("fselected"),$("#cellColorId").addClass("fselected")):"textColorId"===l&&($("#fV").text(jsMsg["Filter.by.textColor"]),$(".dA").css("left","181px"),$("#cellColorId").removeClass("fselected"),$("#autoFilterId").removeClass("fselected"),$("#textColorId").addClass("fselected"))},Filter.sortFilterRange=function(e){if(Filter.hideFilterOptions(),Filter.isPivotFilter){if("page"===Filter.fieldType)return;var t=getObj("pivotSortBy").value;isUndefined(e)&&(e=getObj("custSortAsc").checked?!0:!1),(0===Filter.sortMode||Filter.ascendingSort!=e||Filter.sortDataIndex!=t)&&PivotUtil.sort(Filter.fieldType,Filter.headerIndex,e,t)}else{var r=Filter.getInstance();if(r){var l=r.range,i=[],o={};o.f=Filter.currCol-l.sc,o.s=e,i.push(o),sortvalues(i,1,!1,!0,!1,!1,!0)}}};!function(e){var t={widgetEventPrefix:"import",_documentNameEle:void 0,_documentName:void 0,_fetchRequest:!0,_dialogEle:void 0,_dialogBase:void 0,_importCompleted:!1,_requestSentFrom:void 0,_importResourceId:void 0,_placeholderText:"http://",_importInfo:{documentName:void 0,passwordprotected:!1,fileExtn:void 0,importedFileName:void 0,importedFileURL:void 0,filePassword:void 0,importFromLocal:!0},_blinkCount:3,_uploadPer:30,_EVENTS:{ONSUCCESS:"success",ONFAIL:"fail",ONMINIMIZE:"minimize",ONMAXIMIZE:"maximize"},options:{errorMessages:{},passwordprotected:!1,uploadLabel:!1,uploadServerStatus:!1,serviceType:"SW",uploadServerURL:"",progressType:"indeterminate"},_create:function(){var t=this;this.options=e.extend({},e.ui.zimport.config,this.options);var i=e(this.element);this._dialogBase=this.element.parent(),this.options.uploadServerStatus=this.options.uploadServerStatus?this.options.uploadServerStatus:!1,this.options.uploadServerStatus=""!=this.options.uploadServerURL?this.options.uploadServerStatus:!1,this._customErrorMsg=this.options.errorMessages,i.parent().zdialog({hideOnClose:!1}),i.parent().dialog("option",{position:"center",width:460,buttons:[{text:t._getString("import.label"),class:"ui-zbutton-primary",click:function(){var e=t.getDocumentInfo();if(t.options.importData){var i=t.options.importData(e);t.uploadDocument(i)}},id:"import"},{text:t._getString("cancel.label"),click:function(){t._dialogBase.dialog("close")},id:"close"}],title:t._getString("import.label"),resizable:!1,beforeClose:function(t){var i=e(t.target).closest(".ui-dialog-titlebar-close");return!i.hasClass("ui-state-disabled")}}),this._dialogEle=this._dialogBase.parent(".ui-dialog"),this._createImportContainer(i),this._createImportStatusContainer(i),this._titlebar=this._dialogEle.find(".ui-dialog-titlebar"),this._minimizeBtn=this._titlebar.find(".ui-dialog-titlebar-minimize"),this._minimizeBtn.hide(),this._closeIcon=this._titlebar.find(".ui-dialog-titlebar-close").filter(":not(.ui-dialog-titlebar-minimize)"),this._btnPane=this._dialogEle.find(".ui-dialog-buttonpane"),this._importBtn=this._btnPane.find("#import").button("disable"),this._closeBtn=this._btnPane.find("#close"),i.parent().on("zdialogmaximize",function(i,o){t._importCompleted?t._btnPane.hide():t._btnPane.show(),e(document).trigger(t.widgetEventPrefix+t._EVENTS.ONMAXIMIZE,o)}),i.parent().on("zdialogminimize",function(i,o){e(document).trigger(t.widgetEventPrefix+t._EVENTS.ONMINIMIZE,o)}),i.parent().on("zdialogaftershow",function(){t._minimizeBtn=t._titlebar.find(".ui-dialog-titlebar-minimize"),t._minimizeBtn.hide()})},cancelImport:function(){},_createImportContainer:function(t){var i=e("<div>").addClass("ui-import-container").appendTo(t);this._createImportFromContainer(i),this._createNotesContainer(i),this._createDocumentInfoContainer(i),this._importBase=i},_createImportStatusContainer:function(t){var i=e("<div>").addClass("ui-import-status-container").appendTo(t).hide(),o=e("<div>").addClass("ui-import-status").appendTo(i),s=this._getString((this.options.uploadLabel?"uploading":"importing")+".label"),a=(e("<span>").addClass("ui-import-status-label").text(s).appendTo(o),e("<div>").appendTo(o));a.zprogressbar({type:this.options.progressType,labelEle:!1});e("<span>").addClass("ui-import-status-filename").text("Imported File Name").appendTo(o);this._importStatusbase=i},updateProgress:function(e,t){var i=this._importStatusbase.find(".ui-zprogressbar");if(this.options.statusFetchURL){var o=100-this._uploadPer;e=parseInt(e/100*o)+this._uploadPer}i.zprogressbar("setValue",e),t&&this._importStatusbase.find(".ui-import-status-label").text(t)},uploadDocument:function(t){var i=this.getDocumentInfo();this._importBtn.button("option","label",this._getString("importing.label")),this._importBtn.button("disable");var o=this,s={progress:function(e,t){o._importBase.fadeOut("slow").hide(),o.showImportStatusContainer();var i=o._importStatusbase.find(".ui-zprogressbar");o._importBtn.hide(),o._btnPane.hide(),o._closeIcon.disable(),o._positionDialog(),i.zprogressbar("setValue",t)},success:function(e){var t=JSON.parse(e);"success"===t.status?(o._importBase.fadeOut("slow").hide(),o._importStatusbase.hide(),o._dialogBase.zdialog("isMinimized")||o._btnPane.show(),o._closeIcon.enable(),o._importBtn.hide(),o._closeBtn.button("option","label",o._getString("close.label")),o.showMessage("success",o._getString("successmessage.label"),t)):o._handleImportFail(e)},fail:function(e){o._handleImportFail(e)}};if(this.options.uploadServerStatus&&this._importInfo.importFromLocal&&this._checkAjaxUploadAndProgressEvents())this._udServerUpload(i,s),this._requestSentFrom="uploadserver";else{var a=this.options.uploadURL,r=e(this.element).metadata().componentOptions;"object"==typeof r&&(a=r.uploadURL||this.options.uploadURL),this._requestSentFrom="local",e.ajaxUpload(a,t,s)}},_handleImportFail:function(t){this._importBase.fadeOut("slow").hide(),this._importStatusbase.fadeOut("slow").hide(),this._importBtn.hide(),this._dialogBase.zdialog("isMinimized")||this._btnPane.show(),this._closeIcon.enable();var i=this._getString("errormessage.label");"object"!=typeof t&&(t=e.parseJSON(t)),"object"==typeof t&&""!==t.message&&""!==t.errorCode&&(i=this._getErrorMessage(t,"errorCode")),this.showMessage("error",i)},_checkAjaxUploadAndProgressEvents:function(){var e=new XMLHttpRequest;return!!(e&&"upload"in e&&"onprogress"in e.upload)},_udServerUpload:function(t,i){var o=new XMLHttpRequest,s=o.upload;s.fileIndex=0,s.fileName=encodeURIComponent(t.documentName),s.downloadStartTime=(new Date).getTime(),s.currentStart=s.downloadStartTime,s.currentProgress=0,s.startData=0,this._uploadId=s.fileIndex+"_new_"+e.now()+"_",o.onreadystatechange=function(){4===o.readyState&&200!==o.status?i.fail(o):1===o.readyState&&i.progress(o)},o.open("POST",this.options.uploadServerURL,!0),o.setRequestHeader("Connection","Keep-Alive"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("x-service","EX"),o.setRequestHeader("x-streammode","1"),o.setRequestHeader("charset","utf-8"),o.setRequestHeader("upload-id",this._uploadId),o.setRequestHeader("upload-from",this.options.serviceType),o.setRequestHeader("x-filename",encodeURIComponent(t.documentName+t.fileExtn)),o.setRequestHeader("x-doc_conversion",!0),o.setRequestHeader("x-content_type",t.documentType),o.setRequestHeader("x-uploadTo","myfolders"),o.setRequestHeader("x-folderId","-1"),o.withCredentials=!0,o.send(this._fromLocalPane[0].files[0])},_positionDialog:function(){this._dialogBase.zdialog("isMinimized")||this._dialogBase.dialog("option","position","center")},_fetchImportStatus:function(t,i){if(this._fetchRequest){var o=this;this._statusFetchRequest=e.ajax({type:"GET",url:o.options.statusFetchURL,data:{sch_id:t,DATE:(new Date).getTime()},success:function(e,t){o._statusResp(e,t,i)},error:function(){setTimeout(function(){o._fetchImportStatus(t,i)},5e3)}})}},_statusResp:function(e,t,i){var o=JSON.parse(e),s=o.STATUS,a=this,r=o.IMPORT_ID,n=a._importStatusbase.find(".ui-progressbar");if(2==s)n.zprogressbar("setValue",100),a._importStatusbase.fadeOut("slow").hide(),a._dialogBase.zdialog("isMinimized")||a._btnPane.show(),a._closeBtn.button("option","label",a._getString("close.label")),a._closeIcon.enable(),a._positionDialog(),a.showMessage("success",a._getString("successmessage.label"),o);else if(3==s)a._importStatusbase.fadeOut("slow").hide(),a.showMessage("error",a._getString("errormessage.label"),o),a._dialogBase.zdialog("isMinimized")||a._btnPane.show(),a._closeBtn.button("option","label",a._getString("close.label")),a._closeIcon.enable(),a._positionDialog();else if(0==s||1==s){var l=n.zprogressbar("getValue");l>90&&98>l?(l+=2,n.zprogressbar("setValue",l),setTimeout(function(){a._fetchImportStatus(r,i)},1e3)):setTimeout(function(){a._fetchImportStatus(r,i)},5e3)}},showImportStatusContainer:function(e){this._minimizeBtn.show(),this._importCompleted=!0;var t=this._importStatusbase;e&&t.find(".ui-import-status-label").text(e),this._documentName&&t.find(".ui-import-status-filename").text(this._documentName),t.show()},_createFileOpenLink:function(t){e("#ui-zimport-openlink").length&&e("#ui-zimport-openlink").remove();var i=e("<span>").attr({class:"ui-zimport-fileopenlink-container",id:"ui-zimport-openlink"}).text(this._getString("open.label")).appendTo(t);this._fileOpenElement=e("<a>").attr({href:"#",target:"_blank"}).addClass("ui-import-fileopen-link").text(this._documentName).appendTo(i)},_blinkContainer:function(t,i,o){e(t)[e(t).hasClass(i)?"removeClass":"addClass"](i),o||(o=1);var s=this;o<2*this._blinkCount&&setTimeout(function(){o+=1,s._blinkContainer(t,i,o)},500)},setImportResourceId:function(e){return this._uploadId===e.eventid&&(this._importResourceId=e.resourceId),this._uploadId},setErrorMessage:function(e){this._customErrorMsg=e},_getErrorMessage:function(e,t){var i={D9200:"errormessage.label",D9201:"emptyfileuploaderror.label",D9202:"validsizemessage.label",D9203:"filecontainsvirus.label",D9205:"errormessage.label",D9210:"errormessage.label",D9211:"errormessage.label",D9300:"errormessage.label",D9301:"errormessage.label",D201:"errormessage.label",D202:"successmessage.label",D200:"successmessage.label",D199:"errormessage.label",F252:"errormessage.label",F227:"errormessage.label"};return msg=void 0!=i[e.status_code]?this._getString(i[e.status_code]):"",(""===msg||void 0===msg)&&(t=void 0!==t?e.errorCode:e.status_code,msg=void 0!=this._customErrorMsg[t]?this._customErrorMsg[t]:"",""===msg&&(msg=this._getString("errormessage.label"))),msg},showMessage:function(t,i,o){var s="";if("status"==t){var a=this._uploadId!==i.eventid?!1:!0;if(!a&&(a=this._importResourceId!==i.resourceId?!1:!0,!a))return!1;if("D201"==i.status_code||"D200"==i.status_code||"D199"==i.status_code)return!1;t="D202"==i.status_code?"success":"fail",o={status:t,resinfo:{rid:i.resourceId}},"success"===t?(s=this._getString("successmessage.label"),this._importBase.fadeOut("slow").hide(),this._importStatusbase.hide(),this._dialogBase.zdialog("isMinimized")||this._btnPane.show(),this._closeIcon.enable(),this._importBtn.hide(),this._closeBtn.button("option","label",this._getString("close.label"))):(s=this._getErrorMessage(i),this._importBase.fadeOut("slow").hide(),this._importStatusbase.fadeOut("slow").hide(),this._importBtn.hide(),this._dialogBase.zdialog("isMinimized")||this._btnPane.show(),this._closeIcon.enable())}else s=i;this._importCompleted=!1;var r="success"==t;this._triggerEvent(this._EVENTS[r?"ONSUCCESS":"ONFAIL"]);var n=e(this.element);if(this._dialogBase.zdialog("isMinimized")){{var l=this._dialogEle.find(".ui-dialog-titlebar"),p=l.find(".ui-dialog-title");p.text()}this._blinkContainer(l,"ui-state-highlight")}else this._minimizeBtn.hide();var d=r?"status":"error";e("#ui-zimport-message").length&&e("#ui-zimport-message").remove();{var u=e('<div id="ui-zimport-message">').addClass("ui-corner-all ui-znotifier ui-state-"+d).appendTo(n),m=e("<span>").addClass("ui-znotifier-message").text(s).appendTo(u);e("<span>").addClass("ui-components-icon ui-state-"+d+"-icon").appendTo(m)}r&&this._createFileOpenLink(n);var c=this.options.callbacks,h=e.extend({},this._importInfo);h.fileOpenURL=this.options.fileOpenURL,h.fileOpenElement=this._fileOpenElement,c&&(r?c.success&&c.success(o,h,this.options.fileOpenURL):c.fail&&c.fail(o,h,this.options.fileOpenURL)),u.hide().fadeIn("slow").show()},_checkFileExtn:function(t){var i=this.options.supportedFileFormats;"string"==typeof i&&(i=i.replace(/\s/g,"").split(",")),this._importInfo.importFromLocal&&(t=t.substr(t.lastIndexOf("\\")+1));var o=t.lastIndexOf("."),o=o>0?o:t.length;this._documentName=t.substring(0,o);var s=t.substr(o);return s=s?s.toLowerCase():void 0,e.inArray(s,i)<0?!1:!0},_getInternetExplorerVersion:function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseInt(RegExp.$1))}return e},_createImportFromContainer:function(t){var i=this,o=e("<div/>").addClass("ui-zimport-from").appendTo(t),s=e("<input/>").attr({type:"radio",checked:!0,value:this.options.importLocalFileName,name:"importfrom"}).appendTo(o);s.zstatebutton({label:this._getString("localfile.label")});var a=e("<input/>").attr({type:"radio",value:this.options.importURLFileName,name:"importfrom"}).appendTo(o);a.zstatebutton({label:this._getString("fromurl.label")});var r=(t.width()-4,43),n=this._getInternetExplorerVersion();-1!==n&&10>n&&(r=17);var l=e("<div/>").addClass("ui-zimport-from-container").appendTo(t),p=e("<input/>").attr({name:this.options.importLocalFileName,type:"file",size:r}).appendTo(l);this._fromLocalPane=p,p.on("change",function(){i._checkFile(p),""==e(this).val()&&(i._documentNameEle.val(""),i._documentName="")}),i._importInfo.importFromLocal=!0;var d=e("<input/>").attr({name:this.options.importURLFileName,type:"text"}).appendTo(l).hide();d.val(i._placeholderText),d.on("keyup",function(){i._checkFile(d,!0)}).on("blur",function(){""==d.val()?d.val(i._placeholderText):i._checkFile(d,!0)});{var u=s.add(a);l.find("input")}u.on("statechange",function(e,t){l.find("input").hide(),l.find("input[name="+t.value+"]").show();var o=t.value==i.options.importLocalFileName?!0:!1;i._importInfo.importFromLocal=o;var s=o?p:d;i._updateFileInfo(s.val(),!1),i._checkFile(s,!o,!0)})},_checkFile:function(e,t,i){var o=e.val();if(t){var s=new RegExp("^(http|https)://","i");o=s.test(o)?o:this._placeholderText+o,o===this._placeholderText||""===o?this._importBtn.button("disable"):this._showHideErrorMessage(!1),this._updateFileInfo(o,!0),this._importInfo.urlEle=void 0,this._importInfo.web_url=o}else if(""!==o){var a=this._checkFileExtn(o);if(a){var r=this._checkSize(e);r?(this._clearFile(e),alert(this._getString("validsizemessage.label"))):(this._showHideErrorMessage(!1),this._updateFileInfo(o,!1),this._importInfo.urlEle=e,this._importInfo.web_url=void 0)}else this._importBtn.button("disable"),i||(this._clearFile(e),alert(this._getString("validfilemessage.label","zerror")))}else this._importBtn.button("disable")},_updateFileInfo:function(e,t){e=e.trim();var i=t?"/":"\\",o=e.substr(e.lastIndexOf(i)+1);-1!==e.indexOf(i)&&""===o&&(e=e.substring(0,e.length-1),o=e.substr(e.lastIndexOf(i)+1));var s=o.lastIndexOf("."),a=o.substr(s),r=o.substr(0,s);r=-1!=o.lastIndexOf(".")?r:o,0===r.indexOf("www.")&&(r=r.replace("www.","")),this._importInfo.fileExtn=a,this._importInfo.importedFileName=r,this._importInfo.documentName=r,this._importInfo.importedFileURL=e,t&&(this._documentName=r),this._documentName=r||this._documentName,this._documentNameEle.val(r)},_checkSize:function(e){if(window.FileReader){var t=e.get(0).files[0].size>this.options.allowedFileSize?!0:!1;return t?!0:(this._importInfo.documentType=e.get(0).files[0].type,!1)}},_clearFile:function(e){e.wrap("<form>").closest("form").get(0).reset(),e.unwrap(),this._importBtn.button("disable")},_createNotesContainer:function(t){var i=e("<div>").addClass("ui-import-notes-container ui-corner-all"),o=e("<div>").addClass("ui-import-notes ui-import-fileformats").text(this._getString("supportedfileformats.label")+this.options.supportedFileFormats),s=this._bytesToSize(this.options.allowedFileSize),a=e("<div>").addClass("ui-import-notes ui-import-filesize").text(this._getString("maximumallowedfilesize.label")+s);if(o.appendTo(i),a.appendTo(i),!this.options.passwordprotected){var r=e("<div>").addClass("ui-import-notes ui-import-filesize").text(this._getString("passwordprotectedmessage.label"));r.appendTo(i)}i.appendTo(t)},_createDocumentInfoContainer:function(t){var i=this,o=e("<div>").addClass("ui-import-info-container").appendTo(t);if(this.options.passwordprotected){var s=e("<div>").addClass("ui-import-passwordprotected-container").appendTo(o),a=(e("<span>").addClass("ui-import-passwordprotected-label").appendTo(s).text(this._getString("ispasswordprotected.label")),e("<input/>").attr({type:"radio",name:"passwordprotected",value:"YES"}).appendTo(s));a.zstatebutton({label:this._getString("yes.label")});var r=e("<input/>").attr({type:"radio",name:"passwordprotected",value:"NO",checked:!0}).appendTo(s);r.zstatebutton({label:this._getString("no.label")});var n=e("<span>").addClass("ui-import-passwordcontainer").appendTo(o).hide(),l=e("<input/>").attr({type:"password",placeholder:this._getString("enterpassword.label")}).addClass("ui-import-password").appendTo(n),p=a.add(r);p.on("statechange",function(e,t){var o="YES"==t.value;n[o?"show":"hide"](),i._importInfo.passwordprotected=o}),l.on("blur",function(){i._importInfo.password=l.val()})}var d=e("<div>").addClass("ui-import-documentname-container").appendTo(o),u=(e("<span>").addClass("ui-import-documentname-label").text(this._getString("documentname.label")).appendTo(d),e("<input>").attr({type:"text",name:"documentname"}).addClass("ui-import-documentname").appendTo(d));u.on("blur",function(){0===u.val().trim().length&&u.val(i._documentName),i._documentName=u.val(),i._importInfo.documentName=u.val()}),this._documentNameEle=u},updateDocumentName:function(e){this._documentNameEle.val(e),this._importInfo.documentname=e},_showHideErrorMessage:function(){this._importBtn.button("enable")},_bytesToSize:function(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return e+""+t[0];var i=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,i),2)+" "+t[i]},setMaxAllowedFileSize:function(e){this.options.allowedFileSize=e;var t=this._bytesToSize(e);this._importBase.find(".ui-import-filesize").text(this._getString("maximumallowedfilesize.label")+t)},getMaxAllowedFileSize:function(){return this.options.allowedFileSize},setSupportedFileFormats:function(e){var t=e;this.options.supportedFileFormats=t.replace(/\s/g,"").replace(/,/g,", ",g),this._importBase.find(".ui-import-fileformats").text(this._getString("supportedfileformats.label")+this.options.supportedFileFormats)},getSupportedFileFormats:function(){return this.options.supportedFileFormats},getDocumentInfo:function(){return this._importInfo},_triggerEvent:function(e){var t=this._importInfo;return this._trigger(e,e,t)},_getString:function(t,i){return e.i18n?e.i18n(i?i:"zimport",t):this.options.keys[t]},disable:function(){e(this.element).attr("disabled","true")},enable:function(){e(this.element).removeAttr("disabled")},destroy:function(){e(this.element).empty(),e(this.element).off("."+this.widgetName),e.Widget.prototype.destroy.apply(this,arguments)}};e.widget("ui.zimport",t),e.ui.zimport.config={keys:{"validfilemessage.label":"Please select a valid file","supportedfileformats.label":"Supported File Formats: ","maximumallowedfilesize.label":"Maximum file size allowed is ","localfile.label":"Local File","fromurl.label":"From URL","import.label":"Import","cancel.label":"Cancel","ispasswordprotected.label":"Is Password Protected?","yes.label":"Yes","no.label":"No","documentname.label":"Document Name:","importing.label":"Importing...","uploading.label":"Uploading...","successmessage.label":"Imported Successfully","errormessage.label":"Unable to Import due to an unknown error in the specified file","cancelmessage.label":"Import Cancelled","open.label":"Open","splCharacError.label":'Document Name cannot contain "<" character',"validsizemessage.label":"The file size exceeds the limit allowed.","emptyfileuploaderror.label":"The file is empty. Therefore, this file cannot be imported.","filecontainsvirus.label":"A virus has been detected. Therefore, this file cannot be imported."}}}(jQuery);!function(t){var e={_stateGroup:void 0,widgetEventPrefix:"state",_EVENTS:{ONCHANGE:"change"},_create:function(){var e=this;this.options=t.extend({},t.ui.zstatebutton.defaults,this.options);var i=t(this.element);t(i).each(function(){var i=t(this);e._addLabelTag(i),e._addIcon(i,e.options)}),t(i).on("click."+this.widgetName,function(){e._triggerEvent(e._EVENTS.ONCHANGE)}),this.element.is(":disabled")&&this.disable()},_addIcon:function(e,i){if(i.icon){var s=t("<span>").addClass("ui-zstate-icon "+i.icon);t(s).insertAfter(e)}},_addLabelTag:function(e){var i=t("<label>").addClass("ui-zstate");t(i).insertAfter(t(e)),t(i).append(e),this._text=t("<span>").text(this.options.label),t(e).after(this._text),this._stateGroup=i},setText:function(t){this._text.text(t)},_triggerEvent:function(e){var i={stateEle:t(this.element),value:t(this.element).val(),checked:t(this.element)[0].checked};return this._trigger(e,e,i)},disable:function(){t(this.element).attr("disabled","true"),t(this._stateGroup).addClass("ui-state-disabled")},enable:function(){t(this.element).removeAttr("disabled"),t(this._stateGroup).removeClass("ui-state-disabled")},widget:function(){return this._stateGroup},destroy:function(){var e=this.widget(),i=this.element;i.insertAfter(e),e.remove(),this.element.off("."+this.widgetName),t.Widget.prototype.destroy.apply(this,arguments)}};t.widget("ui.zstatebutton",e),t.ui.zstatebutton.defaults={}}(jQuery);!function(s){var e={_progressbar:void 0,_progressDiv:void 0,_value:0,_tieout:void 0,_create:function(){this.options=s.extend({},s.ui.zprogressbar.defaults,this.options),this._createProgressBar(),this._isDisabled(this.element)&&this.disable(this.element)},_createProgressBar:function(){if(this._progressbar=s(this.element).addClass("ui-zprogressbar ui-widget ui-widget-content"),this._progressDiv=s("<div>").addClass("ui-zprogressbar-progressdiv ui-widget-header"),this._progressDiv.appendTo(this._progressbar).css({float:"fromleft"==this.options.direction?"left":"right"}),"determinate"!=this.options.type)return this._progressDiv.addClass("ui-zprogressbar-indeterminate").css({width:"100%"}),!1;if(this._progressDiv.addClass("ui-state-default"),this.options.show||this._progressbar.hide(),this.options.labelEle&&"indeterminate"!=this.options.type){var e=s("<span>").addClass("ui-zprogressbar-label");"left"==this.options.labelAlignment?(e.insertBefore(this._progressDiv),e.css({left:0})):(e.insertAfter(this._progressDiv),e.css({right:0}))}},updateProgress:function(s){if(this._isDisabled(this._progressbar)||"determinate"!=this.options.type||this._progressbar.is(":hidden"))return!1;var e=/\d/g;if(!s.toString().match(e))return!1;var t=s++,i=this._progressbar.find(".ui-zprogressbar-label");if(s>=t){this._progressDiv.css({width:t+"%"});{i.text(parseInt(t)+"% ")}}this._value=parseInt(t)},stopProgress:function(){},getValue:function(){return this._isDisabled(this._progressbar)||"determinate"!=this.options.type||this._progressbar.is(":hidden")?!1:this._value},setValue:function(s){this._isDisabled(this.element)||this.updateProgress(s)},_isDisabled:function(s){return s.is("[disabled=true]")||s.is("[disabled=disabled]")},show:function(){this._progressbar.show()},hide:function(){this._progressbar.hide()},disable:function(){this._progressbar.addClass("ui-state-disabled"),this._progressbar.attr("disabled","true")},enable:function(){this._progressbar.removeClass("ui-state-disabled"),this._progressbar.removeAttr("disabled")},destroy:function(){this._progressbar.removeAttr("class").off("."+this.widgetName).empty(),s.Widget.prototype.destroy.apply(this,arguments)}};s.widget("ui.zprogressbar",e),s.ui.zprogressbar.defaults={type:"determinate",direction:"fromleft",labelEle:!0,labelAlignment:"right",show:!0}}(jQuery);jQuery(function(e){e.extend({_isAjaxUploadCompatible:function(){return void 0==this._isCompatible&&(this._isCompatible="undefined"!=typeof(new XMLHttpRequest).upload),this._isCompatible},_isFileParam:function(t){if("object"==typeof t)try{var n=e(t)[0];if(n.name||n.files||n.nodeType&&e(n).is("input[type=file]"))return!0}catch(e){}return!1},_parseFiles:function(t){var n={},a=this;return t=e.isArray(t)?t:[t],this._isAjaxUploadCompatible()?e.each(t,function(t,r){e.each(r,function(t,i){var o=a._isFileParam(i);if(o){var s=[];if(e(i).is("input[type=file]")){for(var u=0;u<e(i).length;u++){var l=e(i)[u];l.nodeType&&l.files&&s.push(l.files)}n[t]=s}else n[t]=i;r[t]=void 0,delete r[t]}})}):e.each(t,function(t,r){e.each(r,function(t,i){var o=a._isFileParam(i);if(o){var s=e(i)[0];s.nodeType&&e(s).is("input[type=file]")&&s.files&&(i=s.files),n[t]=i,r[t]=void 0,delete r[t]}})}),n},ajaxUpload:function(e,t,n,a,r,i){var o=this._parseFiles(t);return this._getUploader().post(this,e,t,o,n,a,r,i)},ajaxDownload:function(e,t,n,a){return this.uploaders.iframeUploader.get(this,e,t,[],n,a)},_getUploader:function(){return this.uploaders[this._isAjaxUploadCompatible()?"ajaxUploader":"iframeUploader"]},_getParamFilledURL:function(t,n){return e.each(n,function(e,n){t+=-1==t.indexOf("?")?"?":"&",t+=e+"="+unescape(encodeURIComponent(n))}),t},uploaders:{ajaxUploader:{post:function(t,n,a,r,i,o,s,u){var l=this;r=this._getFiles(r);var c=[];return u?e(r).each(function(e,r){var u=l.upload(t,n,a,r,i,o,s);c.push(u)}):c=l.upload(t,n,a,r,i,o,s),this._controller(c,r)},_controller:function(t,n){return{files:n,abort:function(){e.each(t,function(e,t){t.abort()})},getFilesDetails:function(){var t=[];return e(n).each(function(e,n){t.push({name:n.fileName,size:n.size})}),t}}},_getFiles:function(t){var n=this,a=[];return e.each(t,function(t,r){r.name?(r.pname=t,a.push(r)):e.each(r,function(e,r){if(r.name)r.pname=t,a.push(r);else for(var i=n._getFiles(r),e=0;e<i.length;e++){var o=i[e];o&&(o.pname=t,a.push(o))}})}),a.length||(a[0]=void 0),a},_getFileName:function(e){return e.fileName?e.fileName:e.name},_getFileSize:function(e){return e.fileSize?e.fileSize:e.size},upload:function(e,t,n,a,r,i,o){var s=new XMLHttpRequest;if(s.onreadystatechange=function(){if(4==s.readyState){var e=200==s.status?r.success:r.fail;e&&e(s.responseText,s)}},r.progress){var u=function(e){var t=Math.floor(e.loaded/e.total*100);e.file=a,r.progress(e,t)};s.addEventListener("progress",u,!1),s.upload.addEventListener("progress",u,!1)}return r.complete&&(s.addEventListener("load",r.complete,!1),s.upload.addEventListener("load",r.complete,!1)),r.beforeSend&&r.beforeSend(),s.open("POST",t,!o),this["undefined"!=typeof FormData?"_doFormUpload":"_doBinaryUpload"](s,n,a),s},_doFormUpload:function(t,n,a){var r=new FormData;e.each(n,function(e,t){r.append(e,t)}),e.each(a,function(e,t){t&&r.append(t.pname,t)}),t.send(r)},_doBinaryUpload:function(t,n,a){var r="zoho",i="---------------"+r+Math.random(),o="\r\n--"+i,s="",u=this;e.each(n,function(e,t){s+="\r\n"+u._getMultiPartParamStr(e,t),s+="\r\n--"+i}),o+=s,a?(o+="\r\n",o+=this._getMultiPartFileParamStr(a.pname,a),o+="\r\n--"+i+"--"):o+="--",t.setRequestHeader("Content-Length",o.length),t.setRequestHeader("Content-Type","multipart/form-data; charset: UTF-8; accept-charset: UTF-8; boundary="+i),t.setRequestHeader("Connection","close"),t.sendAsBinary(o)},_getMultiPartFileParamStr:function(e,t){return'Content-Disposition: form-data; name="'+e+'"; filename="'+unescape(encodeURIComponent(t.fileName))+'"\r\nContent-Type: application/octet-stream\r\n\r\n'+t.getAsBinary()},_getMultiPartParamStr:function(e,t){return'Content-Disposition: form-data; name="'+e+'"\r\n\r\n'+unescape(encodeURIComponent(t))}},iframeUploader:{post:function(e,t,n,a,r,i){return this._perform(e,t,n,a,r,i)},get:function(e,t,n,a,r,i){return this._perform(e,t,n,a,r,i,!0)},_perform:function(t,n,a,r,i,o,s){var u=this._createIframe(),l=this._fillParams(t,n,a,r,u.attr("name"),s),t=this;return u.load(function(){var n=t.getResponse(e(u[0].contentWindow.document.body),o);i.success&&i.success(n),l.remove(),u.remove()}),i.beforeSend&&i.beforeSend(),l.submit(),this._controller(u,l,r)},getResponse:function(t,n){switch(n){case"json":case"jsonp":return e.parseJSON(t.text());case"html":return t.html();case"text":default:return t.text()}},_controller:function(t,n,a){return{files:[a],abort:function(){t[0].contentWindow.stop()},getFilesDetails:function(){var t=[];return e(a).each(function(n,a){a=e(a),t.push({name:a.val(),size:""})}),t}}},_createIframe:function(){var t="uploadFrame"+(new Date).getTime(),n=e('<iframe name="'+t+'">').attr({src:"about:blank",height:"0",width:"0",frameborder:"0",id:t});return this._iframe=n,e(document.body).append(n),n},_getParamFilledForm:function(t,n,a){e.each(n,function(n,a){if(a){var r=e("<input type=hidden name="+n+">").attr({value:a});t.append(r)}}),e.each(a,function(n,a){a=e(a),a.data("parent",a.parent());var r=a.clone(!0);r.insertBefore(a),t.append(a)})},_fillParams:function(t,n,a,r,i,o){var s=e("<form>").attr({method:o?"get":"post",target:i,action:n});return o||(s.attr("enctype","multipart/form-data"),s[0].encoding="multipart/form-data"),e(document.body).append(s.fadeTo(0,0)),this._getParamFilledForm(s,a,r),s}}}})});jQuery(function(t){function o(o,e){try{var i=t.parseJSON(e);return i.componentOptions?i.componentOptions:i={content:e}}catch(t){return eleOptions={content:e}}}function e(o,e){var i="["+e+"]";try{o=o.is(i)?o:t(o.parents(i).get(0))}catch(t){}return o}function i(i){this._windowEle=t(window),this._windowWidth=this._windowEle.width(),S.maxWidth=S.maxWidth||this._windowWidth-30;var n=this;this._windowEle.on("resize."+this.widgetName,function(){n._windowWidth=n._windowEle.width()}),this._documentEle=t(document),this._documentEle.on("keydown."+this.widgetName,function(t){27==t.keyCode&&h(t)}),t(i).on("buttondisabled",function(o,e){var i=t(e.element),a=i.attr("title");e.disabled?(i.removeAttr("title"),i.data("ztooltip",a)):i.attr("title",i.data("ztooltip"))}),t(i).on("mouseover."+this.widgetName+" mouseup."+this.widgetName+" mousemove."+this.widgetName,function(i){var s=e(t(i.target),"title"),u=s.attr("title");if(!u)return void(s.length&&s.is(w)&&h());if(s.length&&"document"!==s[0].nodeName.toLowerCase()){if(W&&clearTimeout(W),s.attr("disabled")||s.hasClass("ui-state-disabled")||s.hasClass("ui-ztooltip-ignore"))return a(s),h(),!1;A=s,a(s),x=t.extend({},Y,o(s,u));var r=s.attr("callout");void 0!==r&&""!==X[r]&&(x.callout=r),t(T).length&&t(T).find(".ui-ztooltip-close").remove(),y=800,l(i,s),b=s,E=u,s.on("click.ztooltip",function(){h()}),s.off("mouseleave.ztooltip").on("mouseleave.ztooltip",function(t){x.timeout&&clearTimeout(j),W&&clearTimeout(W),W=setTimeout(function(){x.autohide&&(s.unbind("mousemove"),h(t))},200),a(s,!0)}),n._documentEle.off("mousedown.ztooltip").on("mousedown.ztooltip",function(t){x.autohide&&(s.unbind("mousemove"),h(t)),a(s,!0)}),x.mousetrack&&s.off("mousemove.ztooltip").on("mousemove.ztooltip",function(t){f(t,s)})}})}function a(o,e){var i=e?o.data("parents"):o.parents("[title]");e?o.data("parents",void 0):(i.push(o),o.data("parents",i)),i&&t.each(i,function(o,i){i=t(i);var a="",n=i.attr("title");e?(a=n!=i.data("title")&&void 0!==n?n:i.data("title"),i.attr("title",a)):(i.data("title",n),i.removeAttr("title"))})}function n(o){var e=T?!0:!1,i="ui-corner-all",a=x.ajaxContent?"ui-ztooltip-ajaxcontent ":x.autohide?"ui-ztooltip-content ":"ui-ztooltip-contentwithclose ";if(e)y=0;else{T=t("<div>").attr("class","ui-ztooltip ui-widget"),k=void 0;var n=t("<div>").attr("class","ui-ztooltip-overlaydiv ui-corner-all");_=t("<div>").attr("class","ui-ztooltip-header ui-corner-top"),H=t("<div>").attr({class:a+i,id:"ui-ztooltip-content"}).css({"max-width":S.maxWidth}),F=t("<span>").attr("class","ui-ztooltip-img "+x.iconclass).appendTo(n),_.appendTo(n),H.appendTo(n),n.appendTo(T),t("body").append(T)}if(x.containerClass?T.addClass(x.containerClass):T.attr("class","ui-ztooltip ui-widget"),_.css("display",""),F.css("display",""),x.iconclass&&F.css({display:"inline-block"}),x.title&&(_.text(x.title),i="ui-corner-bottom",_.css({display:"inline-block"})),!x.autohide){var l=t("<span>").attr("class","ui-ztooltip-close ui-icon ui-components-icon").on("click",function(o){t(b).off("mousemove"),h(o),t(b).attr("title",E)});l.appendTo(T),t(b).attr("noAutoHide",!0)}if(H.attr("class",a+" "+i),!x.ajaxContent){g=x.content;var s="html"==x.contentType;if(s&&x.isContentElementId){var r=t("<div>").append(t("#"+x.content).clone().show());g=r.html()}if(S&&t.ui&&t.ui.shortcutkeys&&S.showShortcutKey){o=o.is("label.ui-button")?o.prev("input"):o;var d=t(document).shortcutkeys("getShortcutKey",o);d&&(g=g+" ("+d+")")}}z&&z.remove(),z=T.clone(),t("body").append(z);var s="html"==x.contentType;return z.removeAttr("style").hide(),z.find("#ui-ztooltip-content").removeAttr("style"),z.find("#ui-ztooltip-content")[s?"html":"text"](g),x.callout&&!x.ajaxContent?(k||(k=t("<div>").attr("class","ui-ztooltip-callout").appendTo(T)),v=u(x.callout,k,T)):k=void 0,T}function l(i,a,l){if(l){var u=e(a,"title");if(!u.length)return;var c=u.attr("title");if(!c)return;x=t.extend({},Y,o(a,c)),displayTimeDelay=0}var p="html"==x.contentType;if((x.mouseEnter===!0||x.mousetrack===!0)&&(x.callout="northwest"),tooltipEle=n(a),displayTimeDelay=y,l&&(displayTimeDelay=0),tooltipEle){var f=void 0;i.originalEvent?f=x.callout&&!x.ajaxContent?r(i):{left:i.pageX+10,top:i.pageY+10}:(f=a.offset(),f.left+=a.width(),f.top+=a.height()),f=s(f,a,z),clearTimeout(C),clearTimeout(O),C=setTimeout(function(){if(a.is(":visible")||a.is("option")){if(x.ajaxContent){var o=t("<div>").attr("class","ui-ztooltip-content-loading");t(T).find(".ui-ztooltip-ajaxcontent").append(o),O=setTimeout(function(){t.ajax({type:"GET",url:x.ajaxContent,data:"",success:function(o){t(T).find(".ui-ztooltip-ajaxcontent").html(o)},error:function(){t(T).find(".ui-ztooltip-ajaxcontent").empty()}})})}x.timeout&&x.autohide&&(j=setTimeout(function(){h(i)},parseInt(x.timeout))),tooltipEle.show(1,function(){H[p?"html":"text"](g),k.css(v),f=d(i,tooltipEle,f,a),f&&tooltipEle.css(f),x.calloutHideMode&&T.find(".ui-ztooltip-callout").hide(),w=a})}},displayTimeDelay)}}function s(t,o,e,i){var a=x.callout?x.callout:i,n=o.offset(),l=n.left,s=n.top;return o.is("option")&&(l=o.parent("select").offset().left,s=o.parent("select").offset().top+o.offset.top),a&&(-1!=a.indexOf("north")?(x.mouseEnter||x.mousetrack||(t.left="northwest"===a?l:"northeast"===a?l-(e.width()-o.outerWidth()):l-8-(e.width()/2-8)+o.outerWidth()/2),t.top=s+o.outerHeight()+9):-1!=a.indexOf("south")?(t.left="southwest"===a?l:"southeast"===a?l-(e.width()-o.outerWidth()):l-8-(e.width()/2-8)+o.outerWidth()/2,t.top=s-e.outerHeight()-9):"west"===a?(t.left=parseInt(l+o.outerWidth()+9),t.top=s-e.height()/2+o.outerHeight()/2):"east"===a&&(t.left=parseInt(l-e.width()-9),t.top=s-e.height()/2+o.outerHeight()/2)),t}function u(t,o){if(!T)return!1;var e={};o.removeAttr("class").attr("class","ui-ztooltip-callout ui-ztooltip-callout-"+X[t]);var i=o.outerWidth(),a=o.outerHeight(),n=z.width(),l=z.height();switch(t){case"north":e={left:n/2-i/2+"px",top:"-"+(a-1)+"px"};break;case"west":e={left:"-"+(i-1)+"px",top:l/2-a/2+"px"};break;case"east":e={left:n-1+"px",top:l/2-a/2+"px"};break;case"south":e={left:n/2-i/2+"px",top:l-1+"px"};break;case"northeast":e={left:n-2*i+"px",top:"-"+(a-1)+"px"};break;case"northwest":e={left:i+"px",top:"-"+(a-1)+"px"};break;case"southwest":e={left:i+"px",top:l-1+"px"};break;case"southeast":e={left:n-2*i+"px",top:l-1+"px"};break;default:o.addClass("ui-ztooltip-callout-top"),e={left:i+"px",top:"-"+(a-1)+"px"}}return e}function r(t){T.css({left:"auto",top:"auto"}).hide(),t.tooltipWidth=T.outerWidth(),t.tooltipHeight=T.height();if(t._OFFSET=10,!T)return!1;var o=T.find(".ui-ztooltip-callout");t.calloutWidth=o.outerWidth(),t.calloutHeight=o.outerHeight();var e=I[x.callout];return e||(e=I.defaultFn),e(t)}function h(){T&&("html"===x.contentType&&x.isContentElementId&&t(T).find("#"+x.content).appendTo("body").hide(),t(T).remove(),T=void 0)}function d(t,o,e,i){if(o&&e){var a,n=e.top-this._documentEle.scrollTop(),l=e.left-this._documentEle.scrollLeft(),s=l+o.width(),u=n+o.height(),r=void 0,h=5;if(s>=this._windowWidth?(e.left=this._windowWidth-(o.outerWidth(!0)+h),e.left+o.width()-i.offset().left<=15&&(x.callout="east"),r=x.callout):0>l&&(e.left=e.left+h-l,i.offset().left+i.width()-this._documentEle.scrollLeft()<=20&&(x.callout="west"),r=x.callout),u>=this._windowEle.height()?(e.top=i.offset().top-o.outerHeight()-9,r="south",a=n):0>n&&(e.top=i.offset().top+i.outerHeight()+9,r="north",a=n),r){var d=o.find(".ui-ztooltip-callout");c(t,r,d,o,e,l,a)}}return e}function c(t,o,e,i,a,n,l){var s=x.callout?x.callout:o;switch(o){case"north":s="south"==s?"north":"southeast"==s?"northeast":"southwest"==s?"northwest":s;break;case"south":s="north"==s?"south":"northeast"==s?"southeast":"northwest"==s?"southwest":s;break;case"west":s="east"==s?"west":s;break;case"east":s="west"==s?"east":s}return p(t,s,e,i,o,a,n,l)}function p(o,e,i,a,n,l,r,h){if(i){x.callout=e;var d=i.position();h&&(d=u(e,i),d||(d=i.position())),"east"===e||"west"===e?(d=u(e,i),l=s(l,t(o.target),a,n)):"northwest"===e||"northeast"===e||"southwest"===e||"southeast"===e?d=u(e,i):0>r?(d.left=a.width()/2-i.outerWidth()/2+r-5,d.left<=10&&(d.left=10)):(d.left=a.width()/2-i.outerWidth()/2+(r-l.left),a.width()-d.left<=20&&(d.left=a.width()-20)),d&&i.css(d)}return l}function f(o,e){var i=t(T),a=(i.width(),i.height(),x.callout&&!x.ajaxContent?r(o):{left:o.pageX+5,top:o.pageY+5});a=d(o,T,a,e),i.width()+parseInt(a.left)>this._windowWidth&&i.width(this._windowWidth-(parseInt(a.left)+50)),i.css(a)}function m(o,e,a){var n=t(this);S=t.extend({},Y,"object"==typeof o&&o);var s=n.data("z-ztooltip");s?"show"===o?l(e,a,!0):"remove"===o&&h():(i(n),n.data("z-ztooltip",!0))}var w,v,g,x={},z=void 0,W=void 0,y=800,T=void 0,b=void 0,E=void 0,_=void 0,H=void 0,k=void 0,F=void 0,C=void 0,O=void 0,j=void 0,S={},X={northwest:"top",north:"top",northeast:"top",west:"left",east:"right",southwest:"bottom",south:"bottom",southeast:"bottom"},Y={callout:"north",autohide:!0,mousetrack:!1,mouseEnter:!1,showShortcutKey:!0,contentType:"text",positionAlterable:!0,calloutHideMode:!1},A=void 0,I={north:function(t){return{left:t.pageX-t.tooltipWidth/2,top:t.pageY+(t.calloutHeight+t._OFFSET)}},west:function(t){return{left:t.pageX+(t.calloutWidth+t._OFFSET),top:t.pageY-t.tooltipHeight/2}},east:function(t){return{left:t.pageX-(t.calloutWidth+t._OFFSET)-t.tooltipWidth,top:t.pageY-t.tooltipHeight/2}},south:function(t){return{left:t.pageX-t.tooltipWidth/2,top:t.pageY-(t.calloutHeight+t._OFFSET)-t.tooltipHeight}},northeast:function(t){return{left:t.pageX-(t.tooltipWidth-(t.calloutWidth+t.calloutWidth/2)),top:t.pageY+t.calloutHeight+t._OFFSET}},northwest:function(t){return{left:t.pageX-(t.calloutWidth+t.calloutWidth/2),top:t.pageY+t.calloutHeight+t._OFFSET}},southwest:function(t){return{left:t.pageX-(t.calloutWidth+t.calloutWidth/2),top:t.pageY-(t.calloutHeight+t._OFFSET)-t.tooltipHeight}},southeast:function(t){return{left:t.pageX-(t.tooltipWidth-(t.calloutWidth+t.calloutWidth/2)),top:t.pageY-(t.calloutHeight+t._OFFSET)-t.tooltipHeight}},defaultFn:function(t){return I.north(t,t.calloutHeight,t.calloutWidth)}};t.fn.ztooltip=m});!function(e){e.widget("ui.ztokens",{widgetEventPrefix:"ztokens",_tokenClasses:"ui-widget ui-state-default ui-corner-all ui-ztokens-token",_tokenErrorClassName:"ui-ztokens-token-error",_elementClasses:"ui-widget ui-ztokens",_EVENTS:{ONREMOVE:"remove",ONBEFOREREMOVE:"beforeremove",ONADD:"add",ONBEFOREADD:"beforeadd",ONCLICK:"click",ONCHANGE:"change"},_create:function(){this.element.addClass(this._elementClasses),this.options=e.extend({},e.ui.ztokens.defaults,this.options),this._initTokens(),this._createTokenInput()},_initTokens:function(t){var n=this;t=t?t:this.element.children(),e(t).each(function(t,i){n._initToken(e(i))})},_createTokenInput:function(){var t=this;if(this.options.addTokenInput){this._tokenInputDuplicate=e("<span>").addClass("ui-ztoken-input-duplicate").appendTo(e("body")),this._tokenInput=e("<input>").attr("type","text").addClass("ui-widget-content ui-corner-all ui-ztoken-input").on("contextmenu",function(){return!1}),this._tokenInput.appendTo(this.element);var n=this._tokenInput;this._tokenInput.on("blur.token",function(){n.removeClass("ui-ztoken-selected"),n=e(this)}).on("keydown.token keyup.token",function(i){("keyup"===i.type||"keydown"===i.type)&&("keydown"===i.type&&(0===e(this).val().length?(8===i.which||46===i.which||37===i.which||39===i.which||40===i.which)&&(n.hasClass("ui-ztoken-selected")&&37!==i.which&&39!==i.which&&40!==i.which?(n.find(".ui-ztokens-close").trigger("click"),n=t._tokenInput):37===i.which||39===i.which||40===i.which?(37===i.which&&n.prev().hasClass("ui-ztokens-token")||39===i.which&&n.next().hasClass("ui-ztokens-token"))&&!e(".ui-autocomplete").is(":visible")?(n.removeClass("ui-ztoken-selected"),n=37===i.which?n.prev():n.next(),n.addClass("ui-ztoken-selected")):(39===i.which&&n.next()[0]===t._tokenInput[0]||40===i.which||37===i.which)&&(n.removeClass("ui-ztoken-selected"),n=t._tokenInput,t._tokenInput.trigger("click"),t._tokenInput.trigger("focus")):e(".ui-autocomplete").is(":visible")||(n.hasClass("ui-ztokens-token")?n.addClass("ui-ztoken-selected"):(n.prev().addClass("ui-ztoken-selected"),n=n.prev()))):(n.removeClass("ui-ztoken-selected"),n=t._tokenInput,t._tokenInput.trigger("click"))),t._tokenInputDuplicate.text(e(this).val()),e(this).width(t._tokenInputDuplicate.innerWidth()+3))}).on("click",function(){n.removeClass("ui-ztoken-selected"),n=e(this)})}},_isDisabled:function(){return this.element.is(".ui-state-disabled")},_initToken:function(t,n){t.addClass(this._tokenClasses),n&&t.addClass(this._tokenErrorClassName),t.hover(function(){i._isDisabled()||t.addClass("ui-state-hover")},function(){i._isDisabled()||t.removeClass("ui-state-hover")});var i=this;t.on("mousedown."+this.widgetName,function(){i._isDisabled()||t.addClass("ui-state-active"),e(document).one("mouseup."+i.widgetName,function(){t.removeClass("ui-state-active")})}),t.on("click."+this.widgetName,function(e){i._isDisabled()||i._triggerEvent(i._EVENTS.ONCLICK,{token:t,data:t.data("value")},e)}),this.options.removeable&&this._makeRemoveable(t)},_makeRemoveable:function(t){{var n=e("<span>").addClass("ui-ztoken-icon-holder");e("<span>").addClass("ui-icon ui-components-icon ui-ztokens-close").appendTo(n)}t.append(n),n.hover(function(){n.addClass("ui-state-hover")},function(){n.removeClass("ui-state-hover")}),n.on("mousedown",function(){return!1});var i=this;n.click(function(e){if(!i._isDisabled()){var n=t.data("value"),s=i._triggerEvent(i._EVENTS.ONBEFOREREMOVE,{token:t,data:n},e);return s===!1?!1:(t.width(t.width()),t.height(t.height()),t.empty(),t.animate({width:0},i.options.animateOnRemove?300:0,function(){t.remove(),i._triggerEvent(i._EVENTS.ONREMOVE,{token:t,data:n},e)}),!1)}})},_createToken:function(t,n){var n=void 0!=n?n:t;return e("<div>")[this.options.htmlContent?"html":"text"](t).data("value",n)},addToken:function(e,t,n){var i=void 0!=t?t:void 0,s=this._createToken(e,i);this.options.addTokenInput?this._tokenInput.before(s):this.element.append(s),this._initToken(s,n),this._triggerEvent(this._EVENTS.ONADD,{token:s,data:i})},addTokens:function(t,n){n&&this.removeAllTokens();var i=this,s=[];e.each(t,function(e,t){var n=i._createToken(t);i.element.append(n),s.push(n)}),this._initTokens(s)},removeAllTokens:function(){this.element.children(".ui-ztokens-token").remove()},setValue:function(e){return this.addTokens(e,!0)},getValue:function(){var t=this.element.children(".ui-ztokens-token"),n=[];return t.each(function(t,i){n.push(e(i).text())}),n},getData:function(){var t=this.element.children(".ui-ztokens-token"),n=[];return t.each(function(t,i){e(i).hasClass("ui-ztokens-token-error")||n.push(e(i).data("value"))}),n},getInputElement:function(){return this._tokenInput},_triggerEvent:function(e,t,n){return(e===this._EVENTS.ONADD||e===this._EVENTS.ONREMOVE)&&(t.action=e===this._EVENTS.ONADD?"add":"remove",this._trigger(this._EVENTS.ONCHANGE,n,t)),this._trigger(e,n,t)},disable:function(){this.element.addClass("ui-state-disabled")},enable:function(){this.element.removeClass("ui-state-disabled")},destroy:function(){var t=this;this.element.removeClass(this._elementClasses),this.element.children().each(function(n,i){i=e(i),i.removeClass(t._tokenClasses),i.off("."+t.widgetName),i.find(".ui-ztoken-icon-holder").remove(),i.off("mouseenter mouseleave")}),this._tokenInput&&this._tokenInput.remove(),e.Widget.prototype.destroy.apply(this,arguments)}}),e.ui.ztokens.defaults={removeable:!0,animateOnRemove:!0,addTokenInput:!0,htmlContent:!1}}(jQuery);!function(o){var e={_containerBase:void 0,_baseColorContainer:void 0,_shadedColorContainer:void 0,_standardColorContainer:void 0,_recentColorContainer:void 0,_advColorpalette:void 0,widgetEventPrefix:"colorpalette",_colorpicker:void 0,_selectedColor:void 0,_EVENTS:{ONBEFORESHOW:"beforeshow",ONSHOW:"show",ONHIDE:"hide",ONCOLORSELECTED:"colorselected",ONHOVER:"hover"},_create:function(){this.options=o.extend({},o.ui.zcolorpalette.defaults,this.options),this._createBaseContainers(),this._initColors(this.element),this._bindEvents()},_bindEvents:function(){var e=this;o(document).on("keyup."+this.widgetName,function(o){27==o.keyCode&&e.element.is(":visible")&&e._hide()}),o(".ui-zcolorpalette-colorbox",this.element).on("mouseenter",function(){e._triggerHoverEvent(this.style.backgroundColor)})},_createBaseContainers:function(){this._containerBase=o(this.element).addClass("ui-widget ui-widget-content ui-zcolorpalette ui-widget-shadow-new ui-corner-all"),this._defaultColorContainer=o("<div>").addClass("ui-zcolorpalette-default ui-secondary").appendTo(this._containerBase).hide();var e=o("<button>").button({label:this.options.defaultColorLabel?this.options.defaultColorLabel:this._getString("defaultcolor.label"),icons:{primary:"ui-components-icon ui-icon-transparent"}}).appendTo(this._defaultColorContainer),t="default",i=this;this.options.defaultColor&&(t=this._getFormattedColor(this.options.defaultColor),e.find(".ui-icon").css({"background-image":"none","background-color":t})),e.on("click",function(){i._applyColorInPreview(t),i._triggerEvent(i._EVENTS.ONCOLORSELECTED,i._colorpicker,t)}),this._nofillColorContainer=o("<div>").addClass("ui-zcolorpalette-nofill ui-secondary").appendTo(this._containerBase).hide();o("<button>").button({label:this.options.noFillColorLabel?this.options.noFillColorLabel:this._getString("nofill.label")}).appendTo(this._nofillColorContainer).on("click",function(){i._applyColorInPreview("transparent"),i._triggerEvent(i._EVENTS.ONCOLORSELECTED,i._colorpicker,"transparent")});this._determineColorpaletteType(),this.options.title&&(this._header=o("<div>").addClass("ui-color-head").text(this.options.title).appendTo(this._containerBase)),this._baseColorContainer=o("<ul>").addClass("ui-zcolorpalette-colors-container"),this._shadedColorContainer=o("<div>").addClass("ui-zcolorpalette-shaded-container");var l=o("<div>").text(this._getString("standardcolors.label")).addClass("ui-zcolorpalette-sub-head ui-state-active");if(this._standardColorContainer=o("<ul>").addClass("ui-zcolorpalette-colors-container standardcolors"),this._containerBase.append(this._baseColorContainer).append(this._shadedColorContainer).append(l).append(this._standardColorContainer),this.options.showMoreColors){var i=this,r=o("<div>").text(this._getString("recentcolors.label")).addClass("ui-zcolorpalette-sub-head ui-state-active");this._recentColorContainer=o("<ul></ul>").addClass("ui-zcolorpalette-colors-container recentcolors"),this._containerBase.append(r).append(this._recentColorContainer);var s=o("<div><a href='javascript:void(0);' onclick='return false;'>"+this._getString("morecolors.label")+"</a></div>").addClass("ui-zcolorpalette-morecolors-text").appendTo(this._containerBase),n=o("<div>").attr("id","adv"+this.element.attr("id"));o("body").append(n),this._advColorpalette=n,n.zadvancedcolorpalette(),n.on("advcolorpalettechange",function(o,e){i._triggerHoverEvent(e.rgbSrc)});var a={position:"center",width:n.outerWidth()+50,buttons:[{text:o.i18n?o.i18n("common","ok"):this.options.keys["ok.label"],class:"ui-zbutton-primary",click:function(){var e=n.zadvancedcolorpalette("getColorObject").rgb;i._setColor(e),o(this).dialog("close")}},{text:o.i18n?o.i18n("common","cancel"):this.options.keys["cancel.label"],click:function(){o(this).dialog("close")}}],close:function(){i._triggerEvent(i._EVENTS.ONHIDE,i._colorpicker)},zIndex:o.ui.dialog.zIndex?o.ui.dialog.zIndex:1e4,title:i._getString("advancedcolorpalette.label"),resizable:!1,autoOpen:!1};n.dialog(a);var c=o(s).children("a").get(0);o(c).on("click."+this.widgetName,function(){i._openAdvancedColorPalette()}),this._advColorpalette=n,this._isDisabled(this.element)&&this.disable(),this.options.show&&this._containerBase.show()}},closeAdvancedColorPalette:function(){this._advColorpalette.dialog("close")},_openAdvancedColorPalette:function(){this._isDisabled(this.element)||(this._advColorpalette.dialog("open"),this.element.parent().is("body")&&this._containerBase.hide())},openAdvancedColorPalette:function(e,t){this.options=o.extend({},this.options,t),this._openAdvancedColorPalette()},_determineColorpaletteType:function(){this._defaultColorContainer[this.options.defaultColor?"show":"hide"](),this._nofillColorContainer[this.options.nofill?"show":"hide"]()},_getFormattedColor:function(o){return-1==o.toString().indexOf("rgb")&&-1==o.toString().indexOf("#")?o="rgb("+o[0]+", "+o[1]+", "+o[2]+")":0==o.toString().indexOf("#")&&(o=zoho.color.hexToRgb(o)),o},_isDisabled:function(o){return o.is("[disabled=true]")||o.is("[disabled=disabled]")},_show:function(e,t){this._colorpicker=o(e);var i=o(t).offset();i.top+=o(t).height()+2;var l=i.top+this._containerBase.outerHeight();l>o(window).height()&&(i.top-=this._containerBase.outerHeight()+(o(t).height()+4));var r=i.left+this._containerBase.outerWidth();r>o(window).width()&&(i.left=i.left+o(t).width()-this._containerBase.outerWidth()),o(this._containerBase).css({position:"absolute",left:i.left,top:i.top,display:"block"}),this._triggerEvent(this._EVENTS.ONSHOW,this._colorpicker)},_hide:function(){this._containerBase.is(":visible")&&(this._containerBase.hide(),this._triggerEvent(this._EVENTS.ONHIDE,this._colorpicker))},_initColors:function(){var e=this;o(this._containerBase).on("click."+this.widgetName,function(t){!e._isDisabled(e.element)&&o(t.target).hasClass("ui-zcolorpalette-colorbox")&&e._colorSelected(t)}),this._fillColorBoxes(this._baseColorContainer,this.options.baseColors),this._drawShades(!1),this._fillColorBoxes(this._standardColorContainer,this.options.standardColors),this._fillColorBoxes(this._recentColorContainer,this.options.recentlyusedcolors,!0)},_fillColorBoxes:function(e,t,i){var l=this;o(t).each(function(o,t){var r=l._createColorBox(e);"string"==typeof t?r.addClass(t):i?(l._fillColor(r,t,!1,!1,i),r.addClass("ui-zcolorpalette-empty")):l._fillColor(r,t,!1)})},_drawShades:function(e){var t=this,i=o(this.options.baseColors);e||t._shadedColorContainer.empty(),o.each(i,function(o,i){t._createShadedClrContainers(t._shadedColorContainer,i,o,e)})},_createColorBox:function(e){var t=o("<li></li>").addClass("ui-zcolorpalette-colorbox");return o(e).append(t),t},_createShadedClrContainers:function(e,t,i,l){var r=zoho.color.brightness(t.color?t.color:t),s=r>=240&&255>=r?[.05,.15,.25,.35,.5]:r>=0&&15>=r?[.5,.35,.25,.15,.05]:r>=224&&240>r?[.1,.25,.5,.75,.9]:r>15&&31>=r?[.9,.75,.5,.25,.1]:[.8,.6,.4,.25,.5],n="",a=this;if(!l){var c=o("<ul></ul>").addClass("ui-zcolorpalette-shadecontainer");e.append(c)}o(s).each(function(o,e){n=l?a._shadedColorContainer.children("ul").eq(i).children("li").eq(o):a._createColorBox(c);var s=r>=210&&255>=r||r>=0&&38>=r?!1:!0;a._applyShadedColors(t,n,e,o,s,l)})},_fillColor:function(e,t,i,l,r){var s=t.color?t.color:t,n=s;if(-1==s.toString().indexOf("rgb")&&-1==s.toString().indexOf("#"))n="rgb("+s[0]+", "+s[1]+", "+s[2]+")";else{0==s.toString().indexOf("#")&&(s=zoho.color.hexToRgb(n));var a=s.split("(")[1].split(")")[0].split(",");s=[a[0],a[1],a[2]]}var c=this.options.selectedColor;if(c?(c=-1==c.toString().indexOf("rgb")&&-1==c.toString().indexOf("#")?"rgb("+c[0]+", "+c[1]+", "+c[2]+")":0==c.toString().indexOf("#")?zoho.color.hexToRgb(c):this._formatRgb(c),c==n&&(this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected"),o(e).addClass("ui-zcolorpalette-colorbox-selected"))):(this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected"),this.element.find(".ui-zcolorpalette-colorbox:first").addClass("ui-zcolorpalette-colorbox-selected")),o(e).css({"background-color":n}),l){var d=o(".ui-zcolorpalette-colorbox[title = '"+s.toString()+"']">this.element);d.trigger("hover")}if(!r){var h=t.title?t.title+" ("+s+")":s;o(e).attr("title",h)}},_applyShadedColors:function(e,t,i,l,r,s){var n=e.color?e.color:e,a=zoho.color.isDark(n);r&&(a=2>=l);var c=zoho.color[a?"lighten":"darken"](n,i),d=a?"lighten":"darken",h=(e.title?e.title+" - ":"")+100*i+"% "+this._getString(d+".label");this._fillColor(t,{color:c,title:h},s),o(t).attr("baseColor",n).attr("percentage",i).attr("mode",d)},_setRecentlyUsedColor:function(e){var t=o(this._recentColorContainer).children("li"),i=!1,l=this;if(o(t).each(function(t,r){var s=l._formatRgb(o(r).css("background-color"));s==e&&(i=!0)}),!i){var r=this._createColorBox(this._recentColorContainer).addClass("ui-zcolorpalette-colorbox-selected");this._fillColor(r,e,!1,!0);var s=o(this._recentColorContainer).children("li:first");o(r).insertBefore(s);var n=o(this._recentColorContainer).children("li:last");o(n).remove(),this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected"),o(r).addClass("ui-zcolorpalette-colorbox-selected")}o(".ui-zcolorpalette-colorbox-selected",this.element).on("mouseenter",function(){l._triggerHoverEvent(this.style.backgroundColor)})},_colorSelected:function(e){this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected");var t=o(e.target),i="";if(t.hasClass("ui-zcolorpalette-colorbox")&&!t.hasClass("ui-zcolorpalette-empty")){t.addClass("ui-zcolorpalette-colorbox-selected"),i=t.css("background-color"),this.options.closeOnSelect&&this._containerBase.hide(),this.options.returnAsHex&&(i=zoho.color.rgbToHex(i)),this.options.callback&&this.options.callback(i),this._selectedColor=i;var l=t.parent().hasClass("ui-zcolorpalette-shadecontainer")?t.parent():t.parent().hasClass("standardcolors")||t.parent().hasClass("recentcolors")?void 0:t,r=-1;l&&(r=o(l).parent().children().index(l)),this._applyColorInPreview(i),this._triggerEvent(this._EVENTS.ONCOLORSELECTED,this._colorpicker,i,t,r)}},show:function(e,t,i){var l=this;if(t){if(!i){var r=this._triggerEvent(this._EVENTS.ONBEFORESHOW,e);if(r===!1)return!1}this.options=o.extend({},this.options,t);var s=o(this._baseColorContainer).children("li");o(s).each(function(o,e){l._fillColor(e,l.options.baseColors[o],!1)}),this._drawShades(!0);var n=this.options.selectedColor;if(n){var a=this._getSelectedColorElement(n);this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected"),a?o(a).addClass("ui-zcolorpalette-colorbox-selected"):this._setRecentlyUsedColor(n),-1==n.indexOf("#")&&(n=zoho.color.rgbToHex(n)),this.options.showMoreColors&&o(this._advColorpalette).zadvancedcolorpalette("setValue",n)}if(this._determineColorpaletteType(),this.options.defaultColor){var c=this._defaultColorContainer.find(".ui-button"),d=this._getFormattedColor(this.options.defaultColor);c.find(".ui-icon").css({"background-image":"none","background-color":d})}this.options.showMoreColors&&this._advColorpalette.dialog("option","modal",t.modal?!0:!1)}i||this._show(e,this.options.relativeToEle)},hide:function(){this._hide()},_getSelectedColorElement:function(e){var t=this.element.find(".ui-zcolorpalette-colorbox"),i=void 0;0==e.indexOf("#")&&(e=zoho.color.hexToRgb(e)),e=this._formatRgb(e);var l=this;return o.each(t,function(t,r){var s=l._formatRgb(o(r).css("background-color"));s==e&&(i=o(r))}),i},_formatRgb:function(o){if(o&&"transparent"!=o&&"default"!=o){0==o.toString().indexOf("#")&&(o=zoho.color.hexToRgb(o));var e=o.split("(")[1];e=e.split(")")[0],e=e.split(","),-1==e[1].indexOf(" ")&&(o="rgb("+e[0]+", "+e[1]+", "+e[2]+")")}return o},_applyColorInPreview:function(e){this.options.previewElement&&o(this.options.previewElement).css("background-color",e)},_setColor:function(o){this.setColor(o),this._applyColorInPreview(o),this._triggerEvent(this._EVENTS.ONCOLORSELECTED,this._colorpicker,o)},setColor:function(e){if(e&&!this._isDisabled(this.element)){var t=this._getSelectedColorElement(e);if(t&&t.length?(this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected"),o(t).addClass("ui-zcolorpalette-colorbox-selected")):this._setRecentlyUsedColor(e),this._selectedColor=e,this.options.callback&&this.options.callback(e),this.options.showMoreColors){var i=void 0;-1==e.indexOf("#")&&(i=zoho.color.rgbToHex(e)),o(this._advColorpalette).zadvancedcolorpalette("setValue",i)}this.options.returnAsHex&&(e=zoho.color.rgbToHex(e))}else this.element.find(".ui-zcolorpalette-colorbox-selected").removeClass("ui-zcolorpalette-colorbox-selected")},getColor:function(){return this._selectedColor},disable:function(){this._containerBase.addClass("ui-state-disabled"),this._containerBase.attr("disabled","true")},enable:function(){this._containerBase.removeClass("ui-state-disabled"),this._containerBase.removeAttr("disabled")},setBaseColors:function(o,e){var t={baseColors:o};e?this.options.baseColors=o:this.show(void 0,t,!0)},_triggerEvent:function(e,t,i,l,r){var s={colorpalette:o(this.element),colorpicker:t,color:void 0!=i?i:"none",baseColor:void 0!=l?l.attr("baseColor"):void 0,percentage:void 0!=l?l.attr("percentage"):void 0,mode:void 0!=l?l.attr("mode"):void 0,index:r};return this._trigger(e,e,s)},_getString:function(e){return o.i18n?o.i18n("zcolorpalette",e):this.options.keys[e]},_triggerHoverEvent:function(o){this._triggerEvent(this._EVENTS.ONHOVER,this._colorpicker,o)},destroy:function(){this.element.off("."+this.widgetName).empty().removeClass("ui-widget ui-widget-content ui-zcolorpalette ui-widget-shadow-new ui-corner-all"),o(document).off("."+this.widgetName),o.Widget.prototype.destroy.apply(this,arguments)}};e=o.extend({},o.ui.key,e),o.widget("ui.zcolorpalette",e),o.ui.zcolorpalette.defaults={baseColors:[[255,255,255],[0,0,0],[238,236,225],[31,73,125],[79,129,189],[192,80,77],[155,187,89],[128,100,162],[75,172,198],[247,150,70]],standardColors:[[192,0,0],[255,0,0],[255,192,0],[255,255,0],[146,208,80],[0,176,80],[0,176,240],[0,112,192],[0,32,96],[112,48,160]],recentlyusedcolors:[[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255]],callback:function(){},closeOnSelect:!1,returnAsHex:!1,showMoreColors:!0,keys:{"standardcolors.label":"Standard Colors","recentcolors.label":"Recent Colors","morecolors.label":"More Colors","advancedcolorpalette.label":"Advanced Colorpallete","ok.label":"OK","cancel.label":"Cancel","defaultcolor.label":"Default Color","nofill.label":"No Fill","lighten.label":"Lighten","darken.label":"Darken"},previewElement:void 0,title:void 0,defaultColor:void 0,nofill:void 0,defaultColorLabel:void 0,noFillColorLabel:void 0}}(jQuery);!function(e){var t={widgetEventPrefix:"advcolorpalette",_EVENTS:{ONCHANGE:"change"},_create:function(){this.options=e.extend({},e.ui.zadvancedcolorpalette.defaults,this.options),this._initComponents()},_initComponents:function(){this.element.addClass("ui-zadvcolorpalette"),this._addComponents(),this._hexEntered(this.options.defaultcolor),this.setMode(),this._setDefaults(),this._isDisabled(this.element)&&this.disable();var e=this.element.clone().appendTo("body");this.element.width(e.width()),e.remove()},_setDefaults:function(){this._sampleBase.css("backgroundColor",this._colorObj.hex)},_addComponents:function(){this._createSwatches(),this._createSliderBar(),this._createModifiers(),this._createPicker()},_getPickerContainment:function(){var e=this._swatchMain,t=e.height(),i=e.width(),r=this._picker.outerHeight(),s=this._picker.outerWidth(),a=e.offset();return[a.left-s/2,a.top-r/2,a.left+i-s/2,a.top+t-r/2]},_createPicker:function(){this._picker=e("<div>").addClass("ui-components-icon ui-zadvcolorpalette-picker");var t=this._swatchMain;t.append(this._picker);var i=t.height(),r=t.width(),s=this._picker.outerHeight(),a=this._picker.outerWidth(),o=(t.offset(),this);this._picker.draggable({drag:function(e,t){var n=t.position.top+s/2,l=t.position.left+a/2,h=l/r,c=n/i;o._colorSelected(h,c)}}),this._picker.mousedown(function(){if(!o._isDisabled(o.element)){var e=o._getPickerContainment();o._picker.draggable("option","containment",e)}})},_createSwatches:function(){this._pickerArea=e("<div>").addClass("ui-zadvcolorpalette-pickerarea"),this.element.append(this._pickerArea),this._createSwatchComponents()},_createSwatchComponents:function(){this._swatchMain=e("<div>").addClass("ui-zadvcolorpalette-swatchmain"),this._swatchBase=e("<div>").addClass("ui-zadvcolorpalette-swatchbase"),this._swatchOverlay=e("<div>").addClass("ui-zadvcolorpalette-swatchoverlay"),this._pickerArea.append(this._swatchMain.append(this._swatchBase).append(this._swatchOverlay));var t=this;this._swatchOverlay.on("mousedown",function(e){t._isDisabled(t.element)||(t._colorPicked(e),t._picker.trigger(e))}),this._swatchOverlay.fadeTo(0,0)},_createSliderBarOverlay:function(t){var i=e("<div>").addClass("ui-zadvcolorpalette-baroverlay ui-zadvcolorpalette-bar-"+t);return this._pickerBarOverlays[t]=i,this._pickerBar.append(i),i},_getPickerBarContainment:function(){var e=this._pickerBar.offset().top,t=this._pickerBarSlider.height(),i=this._pickerBar.height(),r=this._pickerBar.width(),s=this._pickerBarSlider.offset();return[s.left,e-t/2,s.left+r,e+i-t/2]},_createSliderBar:function(){this._pickerBar=e("<div>").addClass("ui-zadvcolorpalette-bar"),this._pickerBarOverlays={};var t=this;e(["bl","br","tr","tl"]).each(function(e,i){t._createSliderBarOverlay(i)}),this.element.append(this._pickerBar),this._pickerBarSlider=e("<div>").addClass("ui-components-icon ui-zadvcolorpalette-slider"),this._pickerBar.append(this._pickerBarSlider);var t=this,i=this._pickerBarSlider.height(),r=this._pickerBar.height();this._pickerBarSlider.draggable({axis:"y",drag:function(e,s){var a=s.position.top+i/2,o=a/r;t._sliderDragged(o)}}),this._pickerBar.mousedown(function(e){if(!t._isDisabled(t.element)){t._fixOffsets(e);var i=e.layerY/r;t._setSliderBarPosition(1-i),t._sliderDragged(i),t._pickerBarSlider.trigger(e)}}),this._pickerBarSlider.mousedown(function(e){if(t._picker.trigger(e),!t._isDisabled(t.element)){var i=t._getPickerBarContainment();return t._pickerBarSlider.draggable("option","containment",i),!1}})},_sliderBarPosition:0,_sliderDragged:function(e){this._sliderBarPosition=e,this._colorPickers[this.options.mode].call(this),this._fillValues(),this._setSwatchBaseColor()},_createModifiers:function(){this._modifierArea=e("<div>").addClass("ui-zadvcolorpalette-modarea"),this.element.append(this._modifierArea);var t=this;this._sampleBase=e("<div>").addClass("ui-zadvcolorpalette-samplebase").on("click",function(i){e(i.target).hasClass("ui-zadvcolorpalette-samplebase")&&t.setValue(zoho.color.rgbToHex(e(i.target).css("background-color")))}),this._modifierArea.append(this._sampleBase),this._sampleArea=e("<div>").addClass("ui-zadvcolorpalette-samplearea"),this._sampleBase.append(this._sampleArea),this._createSpinners();var t=this;this._colorCode=e("<input>").attr("type","text").addClass("ui-zadvcolorpalette-colorcode ui-input-text").on("change",function(){t._colorObj.isFrom="HEX",t._hexEntered()}),this._modifierArea.append(e("<div>").addClass("ui-zadvcolorpalette-spinnerpane").append(this._colorCode))},_getString:function(t){return e.i18n?e.i18n("zadvancedcolorpalette",t):this.options.keys[t]},_createSpinners:function(){var t=this._modifierArea;this._modifierAreaSpinnerWidth=0,this._hspinner=this._createRadioSpinner(this._getString("hue.label"),"hue",{max:"360",min:"0",step:"1"},void 0,t),this._sspinner=this._createRadioSpinner(this._getString("saturation.label"),"saturation",{max:"100",min:"0",step:"1"},{unit:"%"},t),this._lspinner=this._createRadioSpinner(this._getString("value.label"),"value",{max:"100",min:"0",step:"1"},{unit:"%"},t),this._rspinner=this._createRadioSpinner(this._getString("red.label"),"red",{max:"255",min:"0",step:"1"},void 0,t),this._gspinner=this._createRadioSpinner(this._getString("green.label"),"green",{max:"255",min:"0",step:"1"},void 0,t),this._bspinner=this._createRadioSpinner(this._getString("blue.label"),"blue",{max:"255",min:"0",step:"1"},void 0,t),this._modifierArea.width(this._modifierAreaSpinnerWidth+10),e(".ui-zadvcolorpalette-spinnerpane").css("width","100%");var i=this;e("input[type=radio]",e(t)).on("change."+this.widgetName,function(t){var r=t.target;i.setMode(e(r).val())}),e(".ui-zadvcolorpalette-spinner",e(t)).on("spinnerchange."+this.widgetName,function(e,t){i._spinnerChanged(e,t)})},_spinnerChanged:function(t,i){var r=e(t.target).attr("mode"),s=r.charAt(0),a=this._colorObj;a[s]=parseInt(i.value),"h"==s||"s"==s||"v"==s?(this._colorPickers.fixHSVtoRGB.call(this),a.isFrom="HSV"):(this._colorPickers.fixRGBToHSV.call(this),a.isFrom="RGB"),a.hex=zoho.color.rgbToHex([a.r,a.g,a.b]),this._updateAllUI()},_createRadioSpinner:function(t,i,r,s,a){var o=e("<input>").addClass("ui-zadvcolorpalette-spinner").attr(r);o.attr("mode",i);var t=e('<span class="ui-zadvcolorpalette-label">').text(t+": "),n=e("<input>").css({float:"left"}).attr({type:"radio",name:this.element.attr("id")+"spinnergrp"}).val(i),l=e('<div class="ui-zadvcolorpalette-spinnerpane">').append(n).append(t).append(o);return a.append(l),this._modifierAreaSpinnerWidth=this._modifierAreaSpinnerWidth<l.width()?l.width():this._modifierAreaSpinnerWidth,o.zspinner(s),o},setValue:function(e){this._hexEntered(e),this._setDefaults(e)},_hexEntered:function(e){var t=this._colorObj,i=e?e:this._colorCode.val();0!=i.indexOf("#")&&(i="#"+i);var r=zoho.color.hexToRgb(i,t.hex);t.hex=zoho.color.rgbToHex(r);var s=r.match(/\d{1,3}/g);t.r=s[0],t.g=s[1],t.b=s[2],this._colorPickers.fixRGBToHSV.call(this),this._updateAllUI()},_updateAllUI:function(){this._fillValues(),this._setSwatchBaseColor(),this._setPickerBarColor(),this._updateUIComponents()},update:{hsv:function(e){this._setSpinnerVal(this._hspinner,e.h),this._setSpinnerVal(this._sspinner,e.s),this._setSpinnerVal(this._lspinner,e.v)},rgb:function(e){this._setSpinnerVal(this._rspinner,e.r),this._setSpinnerVal(this._gspinner,e.g),this._setSpinnerVal(this._bspinner,e.b)},hex:function(e){e.hex=zoho.color.rgbToHex([e.r,e.g,e.b]),this._colorCode.val(e.hex)}},_updateColorModes:{HSV:["rgb","hex"],RGB:["hsv","hex"],HEX:["hsv","rgb"]},_fillValues:function(){var t=this,i=this._colorObj,r=i.isFrom?this._updateColorModes[i.isFrom]:["hsv","rgb","hex"];e(r).each(function(e,r){t.update[r].call(t,i)}),this._sampleArea.css("backgroundColor",i.hex),delete i.isFrom,this._triggerEvent(this._EVENTS.ONCHANGE)},_setSpinnerVal:function(e,t){e.zspinner("setValue",t)},setMode:function(t){var i="ui-zadvcolorpalette-";this.element.removeClass(i+this.options.mode+"chooser"),t?this.options.mode=t:e("input[type=radio][value="+this.options.mode+"]").click(),this.element.addClass(i+this.options.mode+"chooser"),this._setSwatchBaseColor(),this._setPickerBarColor(),this._updateUIComponents()},_updateUIComponents:function(){var e=this._colorPickers[this.options.mode+"Pos"].call(this),t=256,i=256;this._positionPicker(e.x*i,e.y*t),e.overlay?(this._swatchOverlay.fadeTo(0,1-e.z),this._colorPickers.setBarOps.call(this,e.x,e.y)):(e.dontFixOverlay||this._swatchOverlay.fadeTo(0,0),this._pickerBarOverlays.bl.fadeTo(0,1),this._pickerBarOverlays.bl.css({filter:"none"})),this._setSliderBarPosition(e.z)},_setSliderBarPosition:function(e){this._sliderBarPosition=1-e;var t=this._pickerBar.height(),i=this._pickerBarSlider.height();this._pickerBarSlider.css("top",t*(1-e)-i/2)},_getBarPercentage:function(){return this._sliderBarPosition},_positionPicker:function(e,t){var i=this._picker.outerHeight(),r=this._picker.outerWidth();this._picker.css({left:e-i/2,top:t-r/2})},_fixOffsets:function(e){e.layerX||(e.layerX=e.offsetX,e.layerY=e.offsetY)},_colorPicked:function(e){var t=this._pickerArea;this._fixOffsets(e);var i=e.layerX/t.width(),r=e.layerY/t.height();this._colorSelected(i,r),this._positionPicker(e.layerX,e.layerY)},_colorSelected:function(e,t){this._colorPickers[this.options.mode].call(this,e,t),this._fillValues(),this._setPickerBarColor()},_setPickerBarColor:function(){var e=void 0,t=this._colorObj;switch(this.options.mode){case"saturation":e=zoho.color.rgbToHex(zoho.color.HSVToRGB([t.h,"100",t.v]));break;case"value":e=zoho.color.rgbToHex(zoho.color.HSVToRGB([t.h,t.s,"100"]));break;default:e=void 0}e?this._pickerBar.css("backgroundColor",e):this._pickerBar.removeAttr("style")},_setSwatchBaseColor:function(){var e="hue"==this.options.mode?zoho.color.rgbToHex(zoho.color.HSVToRGB([this._colorObj.h,"100","100"])):void 0;e?this._swatchBase.css("backgroundColor",e):this._swatchBase.removeAttr("style")},_colorPickers:{hue:function(e,t){var i=1-this._getBarPercentage();this._swatchOverlay.fadeTo(0,0),this._colorPickers.setHSV.call(this,i,e,void 0!=t?1-t:t)},saturation:function(e,t){var i=this._getBarPercentage();return this._colorPickers.setHSV.call(this,e,1-i,void 0!=t?1-t:t),this._swatchOverlay.fadeTo(0,i),!0},value:function(e,t){var i=1-this._getBarPercentage();this._colorPickers.setHSV.call(this,e,void 0!=t?1-t:t,i),this._swatchOverlay.fadeTo(0,i)},huePos:function(){var e=this._colorObj;return{x:e.s/100,y:1-e.v/100,z:e.h/360}},saturationPos:function(){var e=this._colorObj;return this._swatchOverlay.fadeTo(0,1-e.s/100),{x:e.h/360,y:1-e.v/100,z:e.s/100,dontFixOverlay:!0}},valuePos:function(){var e=this._colorObj;return this._swatchOverlay.fadeTo(0,e.v/100),{x:e.h/360,y:1-e.s/100,z:e.v/100,dontFixOverlay:!0}},red:function(e,t){var i=1-this._getBarPercentage();this._swatchOverlay.fadeTo(0,1-i),this._colorPickers.setBarOps.call(this,e,t),this._colorPickers.setRGB.call(this,i,t?1-t:t,e)},green:function(e,t){var i=1-this._getBarPercentage();this._swatchOverlay.fadeTo(0,1-i),this._colorPickers.setBarOps.call(this,e,t),this._colorPickers.setRGB.call(this,t?1-t:t,i,e)},blue:function(e,t){var i=1-this._getBarPercentage();this._swatchOverlay.fadeTo(0,1-i),this._colorPickers.setBarOps.call(this,e,t),this._colorPickers.setRGB.call(this,e,t?1-t:t,i)},redPos:function(){var e=this._colorObj;return{x:e.b/255,y:1-e.g/255,z:e.r/255,overlay:!0}},greenPos:function(){var e=this._colorObj;return{x:e.b/255,y:1-e.r/255,z:e.g/255,overlay:!0}},bluePos:function(){var e=this._colorObj;return{x:e.r/255,y:1-e.g/255,z:e.b/255,overlay:!0}},setBarOps:function(e,t){if(!isNaN(e)&&!isNaN(t)){var i=(256-256*e)/256,r=(256-256*t)/256;this._pickerBarOverlays.bl.fadeTo(0,t>i?i:t),this._pickerBarOverlays.br.fadeTo(0,t>e?e:t),this._pickerBarOverlays.tr.fadeTo(0,r>e?e:r),this._pickerBarOverlays.tl.fadeTo(0,r>i?i:r)}},setHSV:function(e,t,i){var r=this._colorObj,s=Math.round;r.h=isNaN(e)?r.h:s(360*e),r.s=isNaN(t)?r.s:s(100*t),r.v=isNaN(i)?r.v:s(100*i),this._colorPickers.fixHSVtoRGB.call(this)},setRGB:function(e,t,i){var r=this._colorObj,s=Math.round;r.r=isNaN(e)?r.r:s(255*e),r.g=isNaN(t)?r.g:s(255*t),r.b=isNaN(i)?r.b:s(255*i),this._colorPickers.fixRGBToHSV.call(this)},fixHSVtoRGB:function(){var e=this._colorObj,t=zoho.color.HSVToRGB([e.h,e.s,e.v]),i=Math.round;e.r=i(t[0]),e.g=i(t[1]),e.b=i(t[2])},fixRGBToHSV:function(){var e=this._colorObj,t=zoho.color.RGBToHSV([e.r,e.g,e.b]),i=Math.round;e.h=i(t[0]),e.s=i(t[1]),e.v=i(t[2])}},_colorObj:{},_triggerEvent:function(e){var t=this,i=t._colorObj,r={basecolor:t.options.defaultcolor,hex:i.hex,rgb:[i.r,i.g,i.b],rgbSrc:"rgb("+i.r+", "+i.g+", "+i.b+")",colobj:i};return this._trigger(e,e,r)},getColorObject:function(){var e=this._colorObj;return e.rgb="rgb("+e.r+", "+e.g+", "+e.b+")",this._colorObj},_isDisabled:function(e){return e.is("[disabled=true]")||e.is("[disabled=disabled]")},disable:function(){e(this.element).attr("disabled","true").addClass("ui-state-disabled"),this._picker.draggable("disable"),this._pickerBarSlider.draggable("disable"),e(".ui-zadvcolorpalette-modarea").find(".ui-zadvcolorpalette-spinner").zspinner("disable"),e(".ui-zadvcolorpalette-modarea").find(".ui-zadvcolorpalette-spinnerpane").find("input").attr("disabled",!0)},enable:function(){this._isDisabled(this.element)&&(e(this.element).removeAttr("disabled").removeClass("ui-state-disabled"),this._picker.draggable("enable"),this._pickerBarSlider.draggable("enable"),e(".ui-zadvcolorpalette-modarea").find(".ui-zadvcolorpalette-spinner").zspinner("enable"),e(".ui-zadvcolorpalette-modarea").find(".ui-zadvcolorpalette-spinnerpane").find("input").removeAttr("disabled"))}};e.widget("ui.zadvancedcolorpalette",t),e.ui.zadvancedcolorpalette.defaults={mode:"saturation",defaultcolor:"#811f4a"}}(jQuery);var colorpalette=function(o){var t=!1,e=[],r=[],n=function(){p(),u()},l=function(){var t=document.getElementsByClassName("ui-widget ui-widget-content ui-zcolorpalette ui-widget-shadow-new ui-corner-all");o(t).attr("id","colorpaletteID");var e=o(".ui-zcolorpalette-colors-container").children(),r=o(".ui-zcolorpalette-shaded-container").children().children(),n=e.add(r);return n},c=function(o,t,e){var r=getCellRange().startRow,n=getCellRange().endRow,l=getCellRange().startCol,i=getCellRange().endCol;if(!ProtectedRanges.isRangeLocked(r,l,n,i,null,!0))if(isCellRange()){var c=0,u=new Range(r,l,n,i),d=u.getIterator();d.iterate(function(r,n){var l=getCell(r,n);l&&("apply"===e?a(l,t,o):s(l,t,o,c),c+=1)})}else"apply"===e?a(currCell,t,o):s(currCell,t,o,0)},a=function(o,t,n){if("bg"===t){if(""!==o.style.getPropertyPriority("background-color"))return;var l=o.style.backgroundColor,i=n.style.backgroundColor;r.push(l),i&&(o.style.backgroundColor=i,o.style.borderBottomColor||(o.style.borderBottomColor="transparent"),o.style.borderRightColor||(o.style.borderRightColor="transparent"))}else{var c=[];if(c.push(o.style.color),c.push("important"==o.style.getPropertyPriority("color")?1:0),e.push(c),o.style.color=n.style.backgroundColor,o.children)for(var a=0;a<o.children.length;a++)o.children[a].style.color=n.style.backgroundColor}},s=function(o,t,n,l){if("bg"===t){if(""!==o.style.getPropertyPriority("background-color"))return;o.style.backgroundColor=r[l],r[l]||("transparent"==o.style.borderRightColor&&(o.style.borderRight=""),"transparent"==o.style.borderBottomColor&&(o.style.borderBottom=""))}else if(e.push(o.style.color),1==e[l][1]?o.style.setProperty("color",e[l][0],"important"):o.style.color=e[l][0],o.children)for(var i=0;i<o.children.length;i++)o.children[i].style.color=e[l][0]},u=function(){o("#bgcolorDropDown").unbind("click"),o("#bgcolorDropDown").bind("click",function(){t=!1;var e=o(o("#colorpaletteID").children()[1]).children(),r=l(),n=r.add(e);for(i=0;i<n.length;i++)d(n[i]),g(n[i])})},d=function(e){r=[],o(e).unbind("mouseenter"),o(e).bind("mouseenter",function(){o("#bgcolorDropDown").hasClass("ui-state-highlight")&&c(e,"bg","apply")}),o(e).bind("click",function(){t=!0})},g=function(e){o(e).unbind("mouseout"),o(e).bind("mouseout",function(){(!t||o("#bgcolorDropDown").hasClass("ui-state-highlight"))&&c(e,"bg","remove")})},p=function(){o("#fontcolorDropDown").unbind("click"),o("#fontcolorDropDown").bind("click",function(){t=!1;var e=o(o("#colorpaletteID").children()[0]).children(),r=l(),n=r.add(e);for(i=0;i<n.length;i++)f(n[i]),h(n[i])})},f=function(r){e=[],o(r).unbind("mouseenter"),o(r).bind("mouseenter",function(){o("#fontcolorDropDown").hasClass("ui-state-highlight")&&c(r,"font","apply")}),o(r).bind("click",function(){t=!0})},h=function(e){o(e).unbind("mouseout"),o(e).bind("mouseout",function(){(!t||o("#fontcolorDropDown").hasClass("ui-state-highlight"))&&c(e,"font","remove")})};o.ZContextMenu.registerColorpalette(),UIComponents.executeOnDeferredInit(function(){n(),o("#bgcolorDropDown").bind("colorpalettecolorselected",function(o,t){var e=ActionConstants.COLOR;format_new(e,t.colorpicker.prev().attr("id"),t.color)}).bind("colorpaletteshow",function(t,e){var r=o(currCell).css("background-color");o(e.colorpalette[0]).zcolorpalette("setColor",r)}),o("#fontcolorDropDown").bind("colorpalettecolorselected",function(o,t){var e=ActionConstants.TEXTCOLOR;format_new(e,t.colorpicker.prev().attr("id"),t.color)}).bind("colorpaletteshow",function(t,e){var r=o(currCell).css("color");o(e.colorpalette[0]).zcolorpalette("setColor",r)})})}(jQuery);!function(i){var t={widgetEventPrefix:"zsplitpane",_EVENTS:{ONRESIZE:"resize"},_create:function(){this.windowSize=this._getWindowSize(),this._initDefaults(),this._initComponents(),this._bindEvents()},_initDefaults:function(){this.options=i.extend({},i.ui.zsplitpane.defaults,this.options),this.isX="x"==this.options.axis,this.gpos=this.isX?"left":"top",this.gsize=this.isX?"width":"height",this.tsize="outer"+(this.isX?"Width":"Height"),this.isize="inner"+(this.isX?"Width":"Height")},_initComponents:function(){this.element.addClass("ui-zsplitpane ui-widget ui-widget-content"),this._leftComponent=this.element.children(":first"),this._rightComponent=this._leftComponent.next(),this._initComponent(this._leftComponent),this._initComponent(this._rightComponent),this.options.callback&&this.options.callback(this.element),this._addDivider(this._leftComponent),this._fixSizeAndDraggable()},_initComponent:function(i){i.data("visible",!0),i.addClass("ui-zsplitpane-components ui-zsplitpane-components-"+this.options.axis)},_uninitComponent:function(i){i.removeClass("ui-zsplitpane-components ui-zsplitpane-components-"+this.options.axis)},_addDivider:function(t){var e=i("<div>"),s=this.options.axis;e.addClass("ui-state-active ui-zsplitpane-divider ui-zsplitpane-divider-"+s);var n=i("<span>").addClass("ui-components-icon ui-icon ui-zsplitpane-icon");n.appendTo(e),e.insertAfter(t);var o=this.options.oneTouchExpandable;o&&this._addExpandableArrow(e,s,o),e.attr("id",s),this._divider=e},_addExpandableArrow:function(t,e,s){var n=i("<div>").addClass("ui-icon ui-icon-layout ui-zsplitpane-arrowDiv"),o="ui-icon-triangle-1-"+("x"==e?"second"==s?"e":"w":"second"==s?"s":"n");if("x"==e){var a=parseInt((t.height()/2-8)/t.height()*100);n.css({top:a+"%",left:-1*t.width()})}else{var h=parseInt((t.width()/2-8)/t.width()*100);n.css({left:h+"%",top:-1*t.height()})}n.addClass(o),t.append(n);var r=this;n.on("click",function(i){r._oneTouchExpandable(i,s)})},_oneTouchExpandable:function(t,e){var s=t.target,n="second"===e?e:"first";this.toggleComponent(n,!0),i(s).hasClass("ui-icon-triangle-1-w")||i(s).hasClass("ui-icon-triangle-1-e")?i(s).hasClass("ui-icon-triangle-1-w")?i(s).removeClass("ui-icon-triangle-1-w").addClass("ui-icon-triangle-1-e"):i(s).removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-w"):i(s).hasClass("ui-icon-triangle-1-s")?i(s).removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-n"):i(s).removeClass("ui-icon-triangle-1-n").addClass("ui-icon-triangle-1-s")},_fixSizeAndDraggable:function(t){var e=this._leftComponent,s=this._rightComponent,n=e.metadata(),o=s.metadata(),a=e[this.tsize](),h=s[this.tsize](),r=this.element[this.gsize](),d=this._divider[this.tsize](),p=0,l=0,m=void 0,g=void 0;if(n.max&&o.max){if(p=a,l=r-p-d,l>o.max){var u=l-o.max;p+=u,l=o.max}else if(void 0!=o.min&&o.min>l){var u=o.min-l;l=o.min,p-=u}m=n.max,g=r-o.max-d}else if(n.max){if(p=a,(!a||p>n.max)&&(p=n.max),l=r-p-d,l<o.min){var u=o.min-l;l=o.min,p+=u}m=n.max,g=n.min?n.min:0}else if(o.max){if(l=h,(!h||l>o.max)&&(l=o.max),p=r-l-d,p<n.min){var u=n.min-p;p=n.min,l+=u}m=n.max}else l=h,p=a,h?p=r-h-d:!h&&a?(p=a,l=r-p-d):h||a||(p=l=(r-d)/2);if(void 0!=g){g=1*g,m=1*m;var f=this.element.position();g+=f[this.gpos],m+=f[this.gpos]}var c=void 0==g?this.element:[g,g,m,m],v=this._divider;if(this._isVisible(e)||(p=0,l=h),this._isVisible(s)||(l=0,p=a),e[this.gsize](Math.floor(p)),s[this.gsize](Math.floor(l)-8),t)v.draggable("option","containment",c);else{var _=this,C=v.clone();i(v).draggable({addClasses:!0,opacity:.5,helper:function(){return C.css(_.isX?"height":"width",_.element["outer"+(_.isX?"Height":"Width")]()-2+"px").empty(),C},containment:c,axis:_.options.axis,start:function(){return _.options.freeze?!1:void 0},stop:function(i,t){_._updatePosition(t)}})}},_fixComponentsSize:function(i,t,e,s){var n=this._leftComponent,o=this._rightComponent;t||(i=-1*i);var a=n[this.gsize]()+i,h=o[this.gsize]()-(e?-1*i:i);n.css(this.gsize,a>0?a:0),o.css(this.gsize,h>0?h:0);var r={showOrHideComponent:s};this._triggerEvent(this._EVENTS.ONRESIZE,void 0,r)},_isVisible:function(t){return i(t).data("visible")},isVisible:function(i){return this._isVisible(i)},_updatePosition:function(i){var t=i.position[this.gpos];this._fixComponentsSize(t-i.originalPosition[this.gpos],!0,!1)},_bindEvents:function(){var t=this;this.options.refreshOnWindowResize&&i(window).on("resize."+this.widgetName,i.debounce(250,function(i){var e=t._getWindowSize(),s=t.windowSize;(e.height!=s.height||e.width!=s.width)&&(t.windowSize=e,setTimeout(function(){t._fixSizeAndDraggable(!0),t._triggerEvent(t._EVENTS.ONRESIZE,i)},100))}))},_getWindowSize:function(){var t=i(window);return{height:t.height(),width:t.width()}},destroy:function(){i(window).off(this.widgetName),this._uninitComponent(this._leftComponent),this._uninitComponent(this._rightComponent),this.element.removeClass("ui-zsplitpane ui-widget ui-widget-container"),this._divider.draggable("destroy"),this._divider.remove(),i.Widget.prototype.destroy.apply(this,arguments)},_triggerEvent:function(t,e,s){var n=this,o=e&&"resize"===e.type?!0:!1,a=i.extend(!0,{axis:n.options.axis,windowResized:o},s);this._trigger(t,t,a)},COMPONENT_INDEX_STRING:{first:"left",second:"right"},_getComponent:function(i){var t=this.COMPONENT_INDEX_STRING[i.toLowerCase()];return this["_"+t+"Component"]},hideComponent:function(i,t,e){var s=this._getComponent(i),n=this._isVisible(s);if(n){var o=s[this.tsize](!0)+(e?this._divider[this.tsize](!0):0);s.data("lastSize",o),s.data("visible",!1),this.options.freeze=!t&&n,s.hide(),e&&this._divider.hide();var a="first"===i.toLowerCase();this._fixComponentsSize(o,!a,void 0,"hide")}},showComponent:function(i){var t=0;this._divider.is(":visible")||(this._divider.show(),t=this._divider[this.tsize](!0));var e=this._getComponent(i),s=this._isVisible(e);if(!s){e.data("visible",!0),this.options.freeze=!1,e.show();var n=e.data("lastSize")-t,o="first"===i.toLowerCase(),a=this._getComponent(o?"second":"first");this._fixComponentsSize(-1*n,!o,void 0,"show");var h=a[this.tsize]()-t;a[this.tsize](h)}},toggleComponent:function(i,t){var e=this._getComponent(i),s=this._isVisible(e);this[(s?"hide":"show")+"Component"](i,t)},getComponent:function(i){return this._getComponent(i)},refresh:function(i){var t=i.position[this.gpos];this._fixComponentsSize(t-i.originalPosition[this.gpos],!0,!0)}};i.widget("ui.zsplitpane",t),i.ui.zsplitpane.defaults={axis:"x",freeze:!1,oneTouchExpandable:void 0,refreshOnWindowResize:!1}}(jQuery);!function(t){t.widget("ui.zcollaborator",{widgetEventPrefix:"collaborator",_STATUS:{ONLINE:"online",OFFLINE:"offline"},_NUMERIC_STATUS:["offline","online","active"],_EVENTS:{ONUSERNAMECLICKED:"usernameclicked",ONCHATENTERED:"chatentered",ONNAMECHANGE:"namechanged",ONUSERCOLORCLICKED:"usercolorclicked",ONADD:"add",ONREMOVE:"remove",ONSTATUSUPDATE:"statusupdate",ONOPEN:"open",ONCLOSE:"close"},options:{type:"panel"},_defaults:{users:[],chat:!0,keys:{"customchatmessage.label":"Type your message for collaborators...","activeusers.label":"Active Users","otherusers.label":"Others","sharedusers.label":"Shared Users","collaborators.label":"Collaborators","actions.label":"Actions"},showGroupsTitle:!0},_create:function(){this.options.dockable="pane"==this.options.type?!0:!1,this._customKeys={},t.ui.zcollaborator.defaults&&(this._defaults=t.extend({},this._defaults.keys,t.ui.zcollaborator.defaults)),this.options.keys&&(this._customKeys=t.extend({},this._defaults.keys,this.options.keys)),this.options=t.extend({},this._defaults,this.options),this._initComponents(),this._bindEvents()},_bindEvents:function(){var e=this;this.element.on("click."+this.widgetName,function(t){return e._checkAndTrigger(t)?!1:void 0}),this._groupText.on("keydown."+this.widgetName,function(t){e._checkAndTrigger(t)}).on("blur."+this.widgetName,function(t){return e._checkAndTrigger(t),!1}).on("focus."+this.widgetName,function(t){return e._checkAndTrigger(t),!1}),e.options.dockable||t(window).on("resize."+e.widgetName,t.debounce(500,function(){e._onDocumentResized(!0),e.element.dialog("option","position","right"),e._dialogBase.css({bottom:"28px",top:""})}))},_onDocumentResized:function(){if(this.options.dockable){var e=this._mainHeader.is(":visible")?this._mainHeader.outerHeight(!0):0,s=this.options.chat?this._groupTextBase.outerHeight(!0)+e:e;this._baseHeight=this.element.height()-s,this.element.width(this.element.width()),this._mainHeader.width(this.element.width()-30)}else this._dialogHeight=2*(t(window).innerHeight()-t(".ui-ztab-menutab").outerHeight(!0))/3,this._dialogBase.height(this._dialogHeight),this._baseHeight=this._dialogHeight-95;this.options.chat?(this._eleHeight=Math.round((this._baseHeight-9)/2),this._listBase.height(Math.ceil(this._eleHeight)),this._groupChats.height(Math.ceil(this._eleHeight)),this._groupBase.height(Math.floor(this._eleHeight))):(this._eleHeight=Math.round(this._baseHeight),this._listBase.height(Math.ceil(this._eleHeight))),this._baseContainer.height(this._baseHeight)},destroy:function(){this.element.off(this.widgetName),this._groupText.off(this.widgetName),this._tabs&&(this._tabs.off(this.widgetName),this._tabs.ztab("destroy"))},_checkAndTrigger:function(e){var s=t(e.target);if("click"==e.type){if(s.parent(".ui-zcollaborator-list").length||s.is(".ui-zcollaborator-img")||s.is(".ui-zcollaborator-name")){var i=s.closest(".ui-zcollaborator-user"),a={user:i,uid:i.attr("uid")};return this._triggerEvent(this._EVENTS.ONUSERNAMECLICKED,e,a),!0}}else if("focus"==e.type)s.is("textarea")&&s.val()==this._getString("customchatmessage.label")&&(s.val(""),s.addClass("ui-zcollaborator-textarea-focus").removeClass("ui-zcollaborator-textarea-blur"));else if("blur"==e.type)s.is("textarea")&&""==s.val()&&(s.val(this._getString("customchatmessage.label")),s.removeClass("ui-zcollaborator-textarea-focus").addClass("ui-zcollaborator-textarea-blur"));else if(e.keyCode===t.ui.keyCode.ENTER&&!e.shiftKey){var o=s.val();e.preventDefault(),o.trim().length&&(s.val(""),this._triggerEvent(this._EVENTS.ONCHATENTERED,e,o))}},_triggerEvent:function(t,e,s){this._trigger(t,e,s)},_initComponents:function(){this.element.addClass("ui-zcollaborator"),this._initBase(),this._fillUsers()},_initBase:function(){var e=this;if(this._initGroupChat(),this._initListBase(),this._initTextChatBase(),this._initList(),this._baseContainer=t("<div>").addClass("ui-zcollaborator-base"),this.options.dockable?(this._initHeader(),this.element.append(this._mainHeader),this.element.addClass("ui-zcollaborator-frame")):(this.element.zdialog({autoOpen:!0,hideOnClose:!1,minimizable:!0,resizable:!1,width:"300px"}),this.element.dialog("option",{position:"right",dialogClass:"zcollaborator-dialog",title:this._getString("collaborators.label"),open:function(t,s){e._triggerEvent(e._EVENTS.ONOPEN,s)},close:function(t,s){e._triggerEvent(e._EVENTS.ONCLOSE,s)}}),this.element.dialog("close"),this._dialogBase=this.element.parent(),this._dialogBase.css({bottom:"28px",top:"",left:"",right:"0",height:this._dialogHeight}),this._titlebar=this._dialogBase.find(".ui-dialog-titlebar"),this._titlebar.find(".ui-dialog-titlebar-close").addClass("ui-dialog-titlebar-minimize").find(".ui-icon-closethick").removeClass("ui-icon-closethick").addClass("ui-components-icon ui-icon-minus"),this._minimizeBtn=this._titlebar.find(".ui-dialog-titlebar-minimize"),this._minimizeBtn.on("click",function(){e.close()}),this._titlebar.on("dblclick."+this.widgetName,function(){e.close()})),this.element.append(this._baseContainer),this._collabHeader=this.options.dockable?this._mainHeader:this._titlebar,this.options.actionsMenu){actionsBtn=t("<a>").attr({title:this._getString("actions.label"),popup:this.options.actionsMenu}).addClass("ui-dialog-titlebar-close").appendTo(this._collabHeader);{t("<span>").addClass("ui-components-icon ui-icon-zsettings-small").appendTo(actionsBtn)}actionsBtn.hover(function(){t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")}).on("dblclick."+this.widgetName,function(t){t.stopPropagation()}),this.options.dockable&&actionsBtn.css("right","5px")}this._baseContainer.append(this._listBase),this._baseContainer.append(this._groupBase),this.element.append(this._groupTextBase),this._onDocumentResized(!1);var s=function(s){e._groupChats.css({height:t(s).children(":last").height()})};this._baseContainer.zsplitpane({axis:"y",callback:s}),this._baseContainer.on("zsplitpaneresize",function(){e._groupChats.css({height:e._baseContainer.height()-e._listBase.height()-9})}),this._groupBase.height(this._eleHeight),this.options.chat||(this._groupTextBase.hide(),this._groupBase.prev().hide(),this._baseContainer.zsplitpane("hideComponent","second"))},_initGroupChat:function(){this._groupBase=t("<div>").addClass("ui-zcollaborator-chatbase"),this._groupInner=t("<div>").addClass("ui-zcollaborator-chatinner"),this._groupChats=t("<div>").addClass("ui-zcollaborator-content"),this._groupInner.append(this._groupChats),this._groupBase.append(this._groupInner)},_initTextChatBase:function(){this._groupText=t("<textarea>").attr({autofocus:!1,class:"ui-zcollaborator-textarea",placeholder:this._getString("customchatmessage.label")}).text(this._getString("customchatmessage.label")),this._groupTextBase=t("<div>").addClass("ui-widget-content ui-zcollaborator-chat"),this._groupTextBase.append(this._groupText)},_initListBase:function(){this._listBase=t("<div>").addClass("ui-zcollaborator-content")},_initHeader:function(){this._mainHeader=t("<div>").addClass("ui-zcollaborator-header"),t("<span>").text(this._getString("collaborators.label")).attr("class","ui-zcollaborator-title").appendTo(this._mainHeader)},_initList:function(){this._list=t("<div>").addClass("ui-zcollaborator-list"),this._listBase.append(this._list)},_fillListArea:function(){if(this.options.tabs&&this.options.tabs.length){var e=t("<div>");this._tabs=e,e.append(t("<ul>")),this._baseContainer.append(e);var s=this;return e.ztab(),e.find(".ui-tabs-panel").css({padding:"0",border:"0"}),e.find(".ui-ztab-custom").hide(),t.each(this.options.tabs,function(t,i){var a=e.ztab("addTab",{label:i.label,selected:!t,id:i.id});t||a.relatedPane.append(s._listBase)}),e}return this._baseContainer.append(this._listBase),this._listBase},open:function(){this._dialogBase.is(".ui-dialog-minimized")&&this.element.zdialog("maximize");var t=this._dialogBase.css("top");this.element.dialog("open"),this._dialogBase.focus(),this._dialogBase.css({top:t,height:this._dialogHeight})},close:function(){this.element.dialog("close")},_fillUsers:function(){var e=this;t.each(this.options.users,function(t,s){e.addUser(s)})},_getClassForStatus:function(t){var e=t?this._STATUS[t.toString().toUpperCase()]:void 0;return void 0==e&&(e="online"),"ui-zchat-"+e},_getUser:function(t){return this.element.find("[uid='"+t+"']")},_getCamelizedSetter:function(t){return"set"+t.charAt(0).toUpperCase()+t.substring(1,t.length)},replaceUser:function(e,s){s=s?s:e.zuid;var i=this._getUser(s),a=i.data("user"),o=this;t.each(e,function(t,e){var i=o[o._getCamelizedSetter(t)];i?i.call(o,s,e):o._setUserInfo(a,t,e)}),e.userEle=i,i.data("user",e)},_getAllUsers:function(){return this._list.children(".ui-zcollaborator-user")},_getAllUserObjects:function(){var e=[],s=this._getAllUsers();return t(s).each(function(s,i){e[s]=t(i).data("user")}),e},_getUsersOfStatus:function(e){return!e&&"object"==typeof e&&e.status?this._list.children().not(t("[status]")):this._list.find("[status="+("object"==typeof e?e.status:e)+"]")},_getFrom:function(e,s,i){var a=this._getUsersOfStatus(s);return 1==a.length||a[0]==e[0]?t(a[0]):t(e).nextAll("[status="+s+"]:"+(i?"last":"first"))},_getNextBestPosition:function(t){var e="object"==typeof t?t.status:t;e&&(e=e.toString().toLowerCase());var s=this._list.find(".ui-zcollaborator-user:first");if(!s.length)return void 0;var i=void 0,a=!0,o=this._STATUS;switch(e){case o.ONLINE:i=this._getFrom(s,o.BUSY),i.length||(i=this._getFrom(s,o.IDLE)),i.length||(i=this._getFrom(s,o.OFFLINE));break;case o.OFFLINE:i=this._getFrom(s,o.UNDEFINED),i.length||(a=!1,i=this._getFrom(s,o.IDLE,!0)),i.length||(a=!1,i=this._getFrom(s,o.BUSY,!0))}return{isPrev:a,item:i}},_appendUser:function(e,s,i){s||(s=e.data("user"));var a=this._traverseAndFindPosition(s);if(a&&a.item&&t(a.item).length)this._checkAndRemoveEmptyGroup(s,i),e[a.isPrev?"insertBefore":"insertAfter"](a.item);else if(!this._getUsersOfStatus(s).length){if(this._checkAndRemoveEmptyGroup(s,i),"active"==s.status){var o=this._createGroup("activeusers");this._list.prepend(o),e.insertAfter(o)}else{var r=t.extend({},s),n="online"==r.status?"offline":"online";r.status=n,this._getUsersOfStatus(r).length||this._list.append(this._createGroup("otherusers")),this._list.append(e)}this.options.showGroupsTitle||this._hideGroupTitle(s.status)}},hideGroupTitle:function(t){this._hideGroupTitle(t)},showGroupTitle:function(t){this._hideGroupTitle(t,!0)},_hideGroupTitle:function(e,s){"active"==e?t(".ui-zcollaborator-group[group=activeusers]")[s?"show":"hide"]():t(".ui-zcollaborator-group[group=otherusers]")[s?"show":"hide"]()},_checkAndRemoveEmptyGroup:function(e,s){var i=t.extend({},e);if(s&&(i.status=s),!this._getUsersOfStatus(i).length)if("active"==i.status)this._removeGroup("activeusers");else{var a="online"==i.status?"offline":"online";i.status=a,this._getUsersOfStatus(i).length||this._removeGroup("otherusers")}},_createGroup:function(e){var s=e;if("otherusers"!=e||t("[group=activeusers]").length){var i=t("[group=otherusers]");i.length&&i.text(this._getString("otherusers.label"))}else s="sharedusers";return t("<div>").attr("group",e).addClass("ui-zcollaborator-group").text(this._getString(s+".label"))},_removeGroup:function(e){t(".ui-zcollaborator-group[group="+e+"]").remove()},_getString:function(e){return t.i18n&&t.isEmptyObject(this._customKeys)?t.i18n("zcollaborator",e):this._customKeys[e]},_traverseAndFindPosition:function(e){var s=this._getUsersOfStatus(e),i=void 0,a=!0;return s.length?(s.each(function(s,a){var o=t(a).data("user");return o.dname.toLowerCase()>e.dname.toLowerCase()?(i=a,!1):void 0}),i||(i=s.last(),a=!1),{item:i,isPrev:a}):this._getNextBestPosition(e)},addUser:function(e){var s=this._getUser(e.zuid);if(s.length)return this.replaceUser(e);var i=t("<div>").addClass("ui-zcollaborator-user").attr("uid",e.zuid),a=t("<span>").addClass("ui-zcollaborator-imgcontainer"),o=t("<img>").addClass("ui-zcollaborator-img");if(a.append(o),e.image&&(o.attr("src",e.image),o.css({background:"none"})),void 0!=e.status){try{var r=parseInt(e.status);isNaN(r)||(e.status=r)}catch(t){}isNaN(e.status)||(e.status=this._NUMERIC_STATUS[e.status]),c=i.attr("status"),i.attr("status",e.status)}i.append(a);var n=t("<div>").attr("contenteditable",!1).addClass("ui-zcollaborator-name").text(e.dname);if(i.append(n),e.role){t("<span>").addClass("ui-zcollaborator-user-role").text("("+e.role+")").insertAfter(n)}if(e.editable){var u=this,l={user:i,uid:i.attr("uid")};n.addClass("ui-zcollaborator-user-editable");var h=n.val();n.on("click."+this.widgetName,function(){return n.attr("contenteditable",!0).addClass("ui-zcollaborator-user-editing").focus(),h=n.text(),!1}).on("blur."+this.widgetName,function(t){return n.hasClass("ui-zcollaborator-user-editing")?(n.removeClass("ui-zcollaborator-user-editing"),i.data("user").dname=""!=n.text()?n.text():h,l.dname=""!=n.text()?n.text():h,n.text(""!=n.text()?n.text():h).focusout().removeAttr("contenteditable"),n.text()!=h&&u._triggerEvent(u._EVENTS.ONNAMECHANGE,t,l),!1):void 0}).on("keydown."+this.widgetName,function(e){return e.keyCode==t.ui.keyCode.ENTER?(n.removeClass("ui-zcollaborator-user-editing"),i.data("user").dname=""!=n.text()?n.text():h,l.dname=""!=n.text()?n.text():h,n.text(""!=n.text()?n.text():h).focusout().removeAttr("contenteditable"),n.text()!=h&&u._triggerEvent(u._EVENTS.ONNAMECHANGE,e,l),!1):void 0})}var d=t("<div>").addClass("ui-zcollaborator-status-message"),c=void 0,g=void 0,_=e.box;_&&("active"==e.status?this._createColorBox(e,d,_):d.append(t("<span>").addClass("ui-zcollaborator-status").addClass(this._getClassForStatus(e.status)))),e.ustatus&&(g=i.attr("ustatus"),i.attr("ustatus",e.ustatus.toLowerCase())),e.button&&d.append(e.button),i.append(d),e.userEle=i,i.data("user",e),this._appendUser(i,e),e=this._updateUsersCount(e),this._triggerEvent(this._EVENTS.ONADD,void 0,e)},_updateUsersCount:function(t){var e=this._getUsersOfStatus("active").length,s=this._getUsersOfStatus("online").length+this._getUsersOfStatus("offline").length;return t.activeUsers=e,t.otherUsers=s,t},_createColorBox:function(e,s,i){var a=this,o=t("<span>").addClass("ui-zcollaborator-user-colorbox").on("click",function(t){a._triggerEvent(a._EVENTS.ONUSERCOLORCLICKED,t,i),t.stopPropagation()});s.append(o),i&&(o.css({"background-color":i.color,border:"1px solid "+i.color}),i.fill&&"none"==i.fill?(e.permission=0,o.css({background:"none"})):e.permission=1,i.title&&o.attr("title",i.title))},removeUser:function(t){var e=this._getUser(t),s=e.data("user");e.remove(),s=this._updateUsersCount(s),this._triggerEvent(this._EVENTS.ONREMOVE,void 0,s),this._checkAndRemoveEmptyGroup(s,s.status)},_getUserInfo:function(t,e){var s=this._getUser(t);return s&&s.length?s.data("user")[e]:void 0},_setUserInfo:function(t,e,s){var i="object"==typeof t?t:this._getUser(t);if(i&&i.length){var a=i.data("user"),o=a[e];return a[e]=s,{user:i,userObj:a,prevValue:o}}},setStatus:function(t,e){isNaN(e)||(e=this._NUMERIC_STATUS[e]),e=e?e.toString().toLowerCase():void 0;var s=this._setUserInfo(t,"status",e);if(s){var i=s.user.attr("status"),a=this._getClassForStatus(s.prevValue),o=s.user.find(".ui-zcollaborator-innerstatus");o.removeClass(a),o.addClass(this._getClassForStatus(e)),s.user.attr("status",s.userObj.status);var r=s.user.remove();r.data("user",s.userObj),this._appendUser(r,s.userObj,i),this._updateUserStatusItem(s);var n=s.userObj;n=this._updateUsersCount(n),this._triggerEvent(this._EVENTS.ONSTATUSUPDATE,void 0,n)}},_updateUserStatusItem:function(e){var s=e.user.find(".ui-zcollaborator-status-message"),i=e.userObj;"active"!=i.status?s.empty().append(t("<span>").addClass("ui-zcollaborator-status").addClass(this._getClassForStatus(i.status))):(s.empty(),this._createColorBox(i,s,i.box))},getStatus:function(t){return this._getUserInfo(t,"status")},setUserStatus:function(t,e){var s=this._setUserInfo(t,"ustatus",e);if(s){var i=s.user.attr("ustatus");s.user.attr("ustatus",e.toLowerCase()),s.user.find(".ui-zcollaborator-status-text").text(e);var a=this._list.find("[ustatus="+e.toLowerCase()+"]").length;this._updateMessageItem(e.toLowerCase(),a,i)}},setUserColor:function(t,e){var s=this._setUserInfo(t,"color",e),i=s.user.find(".ui-zcollaborator-user-colorbox");return void 0==e||"undefined"==e||""==e?void i.hide():void(s&&(i.css(0!=s.userObj.permission?{"background-color":e,border:"1px solid "+e}:{border:"1px solid "+e}),i.show()))},setUserPermission:function(t,e,s){var i=this._setUserInfo(t,"permission",e);if(i){var a=i.user.find(".ui-zcollaborator-user-colorbox");a.css(0!=i.userObj.permission?{"background-color":i.userObj.box.color}:{border:"1px solid "+i.userObj.box.color,background:"none"}),a.attr("title",s)}},getStatusMessage:function(t){return this._getUserInfo(t,"ustatus")},setName:function(t,e,s){return this.setUserName(t,e,s)},setUserName:function(t,e,s){var i=this._setUserInfo(t,"dname",e);if(i&&i.user.find(".ui-zcollaborator-name").text(e),s){var i=this._setUserInfo(t,"role",s);i&&i.user.find(".ui-zcollaborator-user-role").text("("+s+")")}},getUserName:function(t){return this._getUserInfo(t,"dname")},setColor:function(t,e){return this.setUserColor(t,e)},setImage:function(t,e){return this.setUserImage(t,e)},setUserImage:function(t,e){var s=this._setUserInfo(t,"image",e);s&&s.user.find(".ui-zcollaborator-img").attr("src",e)},addChatMessage:function(e,s,i){var a=t("<div>").addClass("ui-zcollaborator-chatblock");if(this._lastChatEnteredUser!=e){var o=t("<span>").addClass("ui-zcollaborator-username").text(e+":");a.append(o)}var r=t("<span>").addClass("ui-zcollaborator-chatmsg")[i?"html":"text"](s);a.append(r),this._groupChats.append(a).scrollTop(this._groupChats[0].scrollHeight),this._lastChatEnteredUser=e},setCustomButton:function(t,e){this.removeCustomButton(t);var s=this._setUserInfo(t,"button",e);s&&e.insertAfter(s.user.find(".ui-zcollaborator-status-message"))},removeCustomButton:function(t){var e=this._getUserInfo(t,"button");e&&this._getUser(t).find("#"+e.attr("id")).remove()},_fillStatusBarItems:function(){var e=t("<div>").addClass("ui-statusbar").css({float:"right"});this._listStatus.append(e),this.options.statusBarKeys&&(this.options.statusBarKeys.messageKeys&&this._fillMessageKeyItems(),this.options.statusBarKeys.statusKeys&&this._fillStatusKeyItems())},_fillMessageKeyItems:function(){var e=this,s=this.options.statusBarKeys.messageKeys;t.each(s,function(t,s){e._addStatusItem(t,0,s)})},_fillStatusKeyItems:function(){var e=this,s=this.options.statusBarKeys.statusKeys;t.each(s,function(t,s){e._addStatusItem(s,e._list.find("[status="+s+"]").length)})},_addStatusItem:function(e,s,i){var a=t("<span>").attr("stype",e).attr("title",'{"componentOptions": {"content": "'+e+'", "callout": "north"}}'),o=t("<span>").addClass("ui-statusbar-icon");o.addClass(i?i:"ui-zcollaborator-colorbox ui-zchat-"+e);var r=t("<span>").addClass("ui-statusbar-text").text(s);o.appendTo(a),r.appendTo(a),a.appendTo(this._listStatus.children(".ui-statusbar"))},_setStatusItem:function(t,e){if(this.options.showStatusBar){var s=this._listStatus.find("[stype='"+t+"']");s.children(".ui-statusbar-text").text(e.toString())}},setStatusItem:function(t,e){this._setStatusItem(t,e)},_updateStatusItem:function(t,e,s){(this.options.statusBarKeys.statusKeys.length&&-1!=this.options.statusBarKeys.statusKeys.toString().indexOf(t)||s)&&(e||(e=this._list.find("[status="+t+"]").length),-1!=this.options.statusBarKeys.statusKeys.toString().indexOf(s)&&this._setStatusItem(s,this._list.find("[status="+s+"]").length),this._setStatusItem(t,e))},_updateMessageItem:function(t,e,s){(this.options.statusBarKeys.messageKeys&&this.options.statusBarKeys.messageKeys[t]||s)&&(e||(e=this._list.find("[ustatus="+t+"]").length),this.options.statusBarKeys.messageKeys[s]&&this._setStatusItem(s,this._list.find("[ustatus="+s+"]").length),this._setStatusItem(t,e))},fitToWindow:function(e){var s=e?e:this.element.height();if(this.element.height(s),this._onDocumentResized(!0),this.options.chat){var i=t(this.element).find(".ui-zsplitpane-divider").offset();this._baseContainer.zsplitpane("refresh",{position:{top:s/2},originalPosition:i})}}})}(jQuery);function checkDay(){if($(".chatTimeStamp").length>0){var e=new Date(parseFloat($(".chatTimeStamp")[$(".chatTimeStamp").length-1].id)).setHours(0,0,0,0),t=(new Date).setHours(0,0,0,0);return e===t?!1:!0}return!0}function showMsg(e){if("undefined"!=typeof document.hidden&&parseFloat(collabZid)!==zuid){var t=null;document.hidden===!0?("docname"===e&&(document.title=DOC_NAME,t="chatMsg"),"chatMsg"===e&&(document.title=replaceParams(jsMsg.CollabChatSaying,new Array(dname))+"...",t="docname"),setTimeout(function(){showMsg(t)},1)):document.title=DOC_NAME}else document.title=DOC_NAME}var CollabPanel=function(e){var t=PHOTO_SERVER_URL,a=zuid,n=e("#collabContiner"),o={},r="",s=!1,l=[],c=[],u=!0,d=!0,h=!0,g=!0,f=!0,p=!0,C=!1,m=function(){n.unbind("collaboratorchatentered"),n.unbind("collaboratorusernameclicked"),n.zcollaborator({type:"pane",statusBarKeys:{messageKeys:{editing:"ui-icon ui-components-icon ui-icon-zdocedit",viewing:"ui-icon ui-components-icon ui-icon-zview"},statusKeys:["online","offline"]},showGroupsTitle:!1}),n.bind("collaboratorchatentered",function(e,t){w(encodeURIComponent(t))});var t=e("<span/>").addClass("cCb").appendTo(e(".ui-zcollaborator-header"));t.on("click",function(){docPanel.close()}),IS_DOCUMENT_SHARED&&y(),_()},E=function(){if(e(".ui-zcollaborator-user").unbind("mouseover"),l.length>0&&e("#userStatusDiv").removeClass("chatBlink").removeClass("userOnline").addClass("userOnline"),b(),v(),needScrollBottom){needScrollBottom=!1;var t=e(".ui-zcollaborator-content")[1];t.scrollTop=t.scrollHeight}},v=function(){for(i=0;i<l.length;i++){var e=l[i].zuid;(REMOTE.ISRMVIEW||!e)&&(e=l[i].uname);var t="#"+getColorCode(e);n.zcollaborator("setColor",e,t)}},b=function(){if(e("#collabContiner").is(":visible")){var t=e("#ssBottomPanel").height()+e("#bottomBand").height(),a=e("#spreadSheet").offset().top+e("#cHC").height()+e("#docPanelTab").parent().height(),o=findClientDim().height-(a+t)+15;n.zcollaborator("fitToWindow",o);var r=e("#collabContiner .ui-zsplitpane-components-y"),s=e("#collabContiner").height(),i=e("#collabContiner .ui-zcollaborator-header").outerHeight(),l=(s-i)/2;r[0]&&r[1]&&(r[0].style.height=l+"px",r[1].style.height=l-60+"px",e("#collabContiner .ui-zcollaborator-content")[1].style.height=l-60+"px")}},S=function(e){return 0==e.length&&0!=c.length?void T(e):void((0!==e.length||0!==c.length)&&(T(e),A(e)))},R=function(a){var r=a.dname,s=a.uname,i=a.zuid,c=a.rsid,u=t+"/file?fs=thumb&ID="+i;REMOTE.ISRMVIEW&&(r=o[s]),(REMOTE.ISRMVIEW||-1==i||!i)&&(u=t+"/file?fs=thumb&ID=none",i=s,a.dname=r),a.color&&(userColorCode[i]=a.color);var d="#"+getColorCode(i);a.sRow=-1,a.sCol=-1,a.eRow=-1,a.eCol=-1,a.sheet=CURRSHEETNAME,n.zcollaborator("addUser",{dname:r,image:u,zuid:i,ustatus:"1",status:2,color:d,box:{fill:d,color:d}}),l.push(a),X(i),setTimeout(function(){var t=V(i);if(-1==t.sCol||-1==t.sRow){var a=userPresence.getVisualCueDiv(c);if(a){a=e(a);var n=a.css("top"),o=a.css("left"),r=findRowInYPos(parseInt(n)),s=findColInXPos(parseInt(o));Q(c,CURRSHEETNAME,r,s,r,s,i)}}var a=e(".ui-zcollaborator-user[uid='"+i+"']");a.on("click",function(){CollabPanel.doGoTo(c)})},1e3)},A=function(e){if(0!==e.length){for(i=0;i<e.length;i++){var t=e[i],n=t.zuid,o=REMOTE.ISRMVIEW||!n||-1==n?"uname":"zuid";l.contains(t,o)||t.zuid==a||R(t),c.contains(t,"rsid")||c.push(t)}for(var r=0;r<e.length;r++)e[r].zuid!==zuid&&onlineStatusUserQueue.push(e[r]);onlineStatusUserQueue.length>0&&(onLineStatusTimeOut=collabChat.showOnlineStatus())}},T=function(e){var t=[];if(0!==c.length){for(clearTimeout(onLineStatusTimeOut),i=0;i<c.length;i++){var a=c[i],n=a.zuid,o=REMOTE.ISRMVIEW||!n||-1==n?"uname":"zuid";e.contains(c[i],o)?t.push(c[i]):O(c[i])}c=t}},O=function(t){var o=t.zuid;if((REMOTE.ISRMVIEW||!o||-1==o)&&(o=t.uname),n.length&&o!=a){var r=B(o);if(1>=r){try{n.zcollaborator("removeUser",o)}catch(e){}var s=[],i=onlineStatusUserQueue;onlineStatusUserQueue=[];for(var c=0;c<l.length;c++)o!=l[c].uname&&s.push(l[c]),o==l[c].uname&&(e("#userJoinStatus").hide(),e("#connectUserName").text(""),e("#userQuitStatus").show(),e("#connectUserName").text(l[c].dname),setTimeout(M,2e3));for(var u=0;u<i.length;u++)o!=i[u].uname&&onlineStatusUserQueue.push(i[u]);onlineStatusUserQueue.length>0&&(onLineStatusTimeOut=collabChat.showOnlineStatus()),l=s}}},M=function(){e("#userQuitStatus").hide(),e("#connectUserName").text("")},I=function(e,t){if("object"==typeof e){for(var a=0;a<e.length;a++){for(var n=0;n<c.length;n++)e[a].rsid==c[n].rsid&&(O(c[n]),c.splice(n,1),userPresence.remove(e[a].rsid));jsREMOTE_SAVE_VIEW&&delete o[e[a].uname]}t&&H()}},_=function(){z()&&IS_DOCUMENT_SHARED?menutabListener.doAction(TOOLBAR.SHARE,{id:"shareDocPort",action:"enable",callback:applyStyle_zbutton,args:["shareDocPort","enable","notifysharedusers"]}):menutabListener.doAction(TOOLBAR.SHARE,{id:"shareDocPort",action:"disable",callback:applyStyle_zbutton,args:["shareDocPort","disable","notifysharedusers"]}),H()},w=function(e){var t=new RequestParameters(ActionConstants.CHAT_MSG),a=new AjaxRequest;t.setParameters(e),a.init("POST",t.getURL(),!0,t.getParametersAsString()),a.sendRequest()},D=function(t,a,o,r,s){if(dname=L(t),t==zuid&&(dname=jsMsg.CollbChatMe),docPanel.isClosed()||DISABLECHAT){e("#userStatusDiv").removeClass("userOnline").addClass("chatBlink");var i=a,l={type:"PopUp",dname:dname,chatContent:i,popupType:"chat",href:{action:"docPanel.show",args:"chat",text:jsMsg.EnterDiscussionRoom}};SheetNotifier.open(l)}var c=!1;if(u){a=a.replace(/(\r\n|\n|\r)/gm,"<br>");var d=LinkMaker.convert(a);c=d.hasLinkMsg,a=d.msg}"undefined"!=typeof document.hidden&&parseFloat(t)!==zuid&&setTimeout(function(){showMsg("chatMsg")},1);e(e(".ui-zcollaborator-content")[1]).scrollTop();collabZid=t,n.zcollaborator("addChatMessage",dname,a,c,t,o,r,s)},L=function(e){if(!e)return"Guest";if(0!==l.length)if(jsREMOTE_SAVE_VIEW){if(o[e])return o[e];if(e==RMUSER)return LOGINNAME}else for(el in l)if(l[el].uname===e)return l[el].dname;return LOGIN_FULL_NAME},P=function(e){for(var t=[],a=0;a<e.length;a++){var n=jsREMOTE_SAVE_VIEW?o[e[a].uname]:e[a].dname;t.contains(n)||t.push(n)}return t.join(", ")},z=function(){return jsVERSION_VIEW||REMOTE.ISRMVIEW&&!REMOTE.ISCOLLABEDITVIEW&&!REMOTE.ISCOLLABVIEW||jsPUBLIC_VIEW?!1:!0},U=function(){y(!0)},y=function(e){if(d&&z()&&WebMessanger.getRawSid()){var t=e?"refresh":"init",a=new RequestParameters(ActionConstants.GET_WMS_USERS),n=new AjaxRequest;a.setParameters(t),n.init("POST",a.getURL(),!0,a.getParametersAsString()),n.addEventListener("onComplete",function(e){var a=e.response;if(a){var n=parseJSON(a);if(n){var o=n[ActionConstants.GET_WMS_USERS],r=n[ActionConstants.UPDATE_COLLABORATOR_COLORS];r&&k(r),o&&(d=!1,j(o,"init"===t))}}}),n.addEventListener("onError",function(){d=!1}),n.sendRequest()}},N=function(){var e=new RequestParameters(ActionConstants.GET_WMS_USERS),t=new AjaxRequest;e.setParameters("delete",COLLAB_ID),t.init("POST",e.getURL(),!1,e.getParametersAsString()),t.sendRequest()},j=function(e,t){if(z()&&e&&"object"==typeof e&&e.length){for(var n=0;n<e.length;n++)if(e[n].rsid==WebMessanger.getRawSid()){e.splice(n,1);break}if(0!==c.length||0!==e.length){for(var o=[],n=0;n<e.length;n++)e[n].zuid!=a&&o.push(e[n]);if(0===c.length){if(S(e),o.length){var r={type:"PopUp",href:{action:"docPanel.show",args:"chat",text:jsMsg.EnterDiscussionRoom}};r.content=P(o)+" ",r.content+=t?r.content.split(",").length>1?jsMsg.areCurrentlyPresentDocument:jsMsg.isCurrentlyPresentDocument:jsMsg.hasOpenedDoc}}else{for(var s=e.slice(0),i=c.slice(0),n=0;n<i.length;n++)for(var l=0;l<s.length;l++)if(i[n].rsid==s[l].rsid){i.splice(n,1),s.splice(l,1),n--;break}var u=!1,d=!1;if(i.length>0){for(var h=[],n=0;n<i.length;n++)i[n].zuid!=a&&h.push(i[n]);if(h.length>0){var r={type:"PopUp",href:{action:"docPanel.show",args:"chat",text:jsMsg.EnterDiscussionRoom}};r.content=P(h)+" "+jsMsg.hasClosedDocument}I(i),u=!0,d=!0}if(s.length>0){for(var h=[],n=0;n<s.length;n++)s[n].zuid!=a&&h.push(s[n]);if(h.length>0){var r={type:"PopUp",href:{action:"docPanel.show",args:"chat",text:jsMsg.EnterDiscussionRoom}};r.content=P(h)+" "+jsMsg.hasOpenedDoc;var g=u?300:0;setTimeout(function(){},g)}A(s),d=!0}}H(),c.length>0&&userPresence.send(!0)}}},H=function(){var t=e("#userStatusDiv"),a=l.length;if(0==a&&IS_DOCUMENT_SHARED&&!cdview||a>0){t.show(),a>0?(t.hasClass("userOnline")||t.addClass("userOnline"),t.hasClass("chatBlink")&&t.removeClass("chatBlink"),menutabListener.doAction(TOOLBAR.SHARE,{id:"chatwithusersPanel",action:"enable",callback:button_enable,args:["chatwithusersPanel"]})):(t.removeClass("userOnline").removeClass("chatBlink"),menutabListener.doAction(TOOLBAR.SHARE,{id:"chatwithusersPanel",action:"enable",callback:button_enable,args:["chatwithusersPanel"]}));var n=getObj("sharedUserStatus");if(null!==n){var o=1===a?jsMsg["Share.Collaborator"]:jsMsg["Share.Collaborators"];n.innerHTML="<b>"+a+"</b> "+o,n.title=jsMsg.SharedUserStatus}COLLABORATIVE_EDITING="ON"}else t.removeClass("userOnline"),t.hide(),menutabListener.doAction(TOOLBAR.SHARE,{id:"chatwithusersPanel",action:"disable",callback:button_disable,args:["chatwithusersPanel"]}),COLLABORATIVE_EDITING="OFF"},k=function(e){for(userPresence.removeAll(),i=0;i<e.length;i++){var t=e[i].zuid,a=e[i].colorCode;userColorCode[zuid]=a?a:getColorCode(t)}},V=function(e){var t="";for(el in l)if(l[el].uname==e){t=l[el];break}return t},W=function(e){var t="";for(el in c)if(c[el].rsid==e){t=c[el];break}return t},B=function(e){var t=0;for(el in c)c[el].uname==e&&t++;return t},x=function(e,t){if(1==e.DU&&!jsPUBLIC_VIEW)switch(e.a){case ActionConstants.CHAT_MSG:var a=e.msg;D(t,a,e.chatid,e.t,e.rsid);break;case ActionConstants.REFRESH_COLLAB_DETAILS:if("init"===e.subaction&&e.rsid==WebMessanger.getRawSid())return;j(e.msg)}},$=function(e){if("object"==typeof e)for(var t=0;t<e.length;t++){var a=V(e[t].uname);I(a,!0)}else if("string"==typeof e){var a=V(e);I(a,!0)}},F=function(e){if(h&&WebMessanger.getRawSid()&&""!==COLLAB_ID&&"null"!==COLLAB_ID&&z()&&ALLOW_TO_WRITE&&0!==c.length){var t={},a=getCellRange(),n=a.startRow,o=a.startCol,r=a.endRow,s=a.endCol;e&&(n=ActiveCellInfo.getStartRow(),o=ActiveCellInfo.getStartCol(),r=a.endRow,s=a.endCol),t[ActionConstants.COLLAB_USER_EDIT]=[WebMessanger.getRawSid(),CURRSHEETNAME,n,o,r,s,LOGIN_FULL_NAME,zuid,getColorCode(zuid)];var i={a:t};e&&(WMSREQ_SEND_COUNT++,WebMessanger.sendMessage(COLLAB_ID,JSON.stringify(i)))}},G=function(t,a,n,o,r){if(h){if("true"===r){var s=W(t);if(s){var i=s.zuid;jsREMOTE_SAVE_VIEW&&(i=s.uname);var l=a+"."+getCellLabel(parseInt(n),parseInt(o)),c=replaceParams(jsMsg["CollabPanel.Msg.Editing"],new Array(l));X(i,c)}}if(userPresence.isPresent(t)){var u=e(userPresence.getVisualCueDiv(t));if("true"===r)try{if(a===CURRSHEETNAME){if(s.sRow!=parseInt(n)||s.sCol!=parseInt(o))return;var d=u[0].style.borderColor,g="rgb("+d.slice(4,-1).split(",").map(function(e){return Math.round(parseInt(e)+.8*(255-e))}).toString()+")";e(u).css({"background-color":g,"border-style":"dotted",opacity:"0.9"}),C&&e(u).show(),clearTimeout(e(u.children()[0]).stop().data("timer")),e(u.children()[0]).css("opacity","1").fadeIn(function(){var t=e(this);e.data(this,"timer",setTimeout(function(){t.fadeOut()},5e3))})}}catch(e){}else""!==e(u).css("background-color")&&(e(u).css({"background-color":"","border-style":"",opacity:""}),C&&e(u).hide(),e(u.children()[0]).hide())}}},Q=function(e,t,a,n,o,r,s){if(g){var i=W(e);i.sRow=a,i.sCol=n,i.eRow=o,i.eCol=r,i.sheet=t,-1!=s&&s||(s=i.uname);var l=B(s),c=replaceParams(jsMsg["CollabPanel.Msg.Session"],new Array(l+""));if(1==l){var u=t+"."+getCellLabel(parseInt(a),parseInt(n))+":"+getCellLabel(parseInt(o),parseInt(r));a==o&&n==r&&(u=t+"."+getCellLabel(parseInt(a),parseInt(n))),c=replaceParams(jsMsg["CollabPanel.Msg.IsOn"],new Array(u))}0!==l&&X(s,c)}},q=function(e,t){for(i=0;i<l.length;i++){var a=l[i];a.sheet==t&&Q(a.rsid,e,a.sRow,a.sCol,a.eRow,a.eCol,a.zuid)}},Y=function(t){if(t){var a=W(t),n=a.sRow,o=a.sCol,s=(a.eRow,a.eCol,a.sheet);if(s!=CURRSHEETNAME)return showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(s),"open",!1),void(r=t);var i=Goto.gotoCellPosition(n,o);if(i){var l=e(userPresence.getVisualCueDiv(t));if(C&&l.show(),e(l.children()[0]).show(),l.addClass("pulse animated"),setTimeout(function(){l.removeClass("pulse animated"),e(l.children()[0]).hide(),C&&l.hide()},1e3),r)return r="",appEvent.preventDefault()}}},J=function(t){z()&&f&&!e("#actionStreamPanel").is(":visible")||(AuditTrail.currentViewingChangeLog=[],AuditTrail.currentViewingChangeLog.push(t),AuditTrail.appendChangeLogToDom(0,0,!0),e("#actionStreamContiner").animate({scrollTop:e("#actionStreamContiner")[0].scrollHeight},"slow"))},K=function(){var t=[];t.push({id:"MoreDetails",data:"{label:'More Details', appData:{dynamic:true, callback: 'AuditTrail.showActionDetails', arg:',true,event'}}"}),t.push({id:"clearActionStream",data:"{label:'Clear', appData:{dynamic:true, callback: 'CollabPanel.clearActionStream'}}"});var a={target:e("#actionStreamOptions"),clearcache:!1,menuoptions:{type:"text_only"}};sheetMenu.showMenu("versionMenu",t,a),e(".atSetting").css("opacity","1")},Z=function(){e("#actionStreamContiner").html("")},X=function(t,a){var n=e(".ui-zcollaborator-user[uid='"+t+"']").find(".ui-zcollaborator-name");if(n.length&&(n.html(""),e("<span/>",{text:L(t),style:"float:left;"}).appendTo(n),a)){n.css("top","-2px");var o=e("<span/>",{style:"float:left; font-size:11px; color:#ccc; top:3px; position:relative; overflow:hidden; text-overflow:ellipsis;"}).appendTo(n);o.html(a)}},et=function(e,t){V(t);n.zcollaborator("setColor",t,"#"+e)},tt=function(){return{allowUserSessionInit:d,allowActionStream:f,includeTabActionStream:p}},at=function(t){var a=e(".vcD");s=t?t.toBoolean():s,s?(C=!0,a.hide()):a.is(":visible")||(C=!1,a.show())};appEvent.on("collabpanel.hidePresence",function(){var t=e("#showHideUsers");s?(t.zmenu("changeIcon","hideCollabUsers","ui-individual-icon ui-icon-ztick"),t.zmenu("changeIcon","showCollabUsers","ui-zmenu-no-icon")):(t.zmenu("changeIcon","showCollabUsers","ui-individual-icon ui-icon-ztick"),t.zmenu("changeIcon","hideCollabUsers","ui-zmenu-no-icon"))});var nt=function(){return l},ot=function(){return c},rt=function(){return l.length},st=function(){d=!0};return jsPUBLIC_VIEW||m(),appEvent.on("collabpanal.update",function(e){S(e)}),appEvent.on("collabpanal.senduseredit",function(e){F(e)}),appEvent.on("collab.reconnect",function(){d=!0,y()}),appEvent.on("collab.userlistchange",function(e){if(jsREMOTE_SAVE_VIEW)for(var t=0;t<e.length;t++)o[e[t].uname]=e[t].dname;y()}),appEvent.on("collab.handlepresence",function(e,t,n,r,s){return jsREMOTE_SAVE_VIEW&&COLLAB_ID===e&&n!==a?(0===s||"0"===s?delete o[t]:(1===s||"1"===s)&&(o[t]=r),!1):void((0===s||"0"===s)&&$(t))}),appEvent.on("collab.crossproductmsg",function(e,t){var n=t.RESOURCE_ID?t.RESOURCE_ID:t.resourceId;if(n==RESOURCE_ID){var o=t.ACTION;if("RESOURCE_SHARED"==o){var r=JSON.parse(t.ACTION_INFO);32!=r.SHARED_TYPE&&256!=r.SHARED_TYPE&&8192!=r.SHARED_TYPE&&(IS_DOCUMENT_SHARED||(IS_DOCUMENT_SHARED=!0,_()))}else if("RESOURCE_UNSHARED"==o){var r=JSON.parse(t.ACTION_INFO);r.SHARED_TO==a&&N()}}}),appEvent.on("wms.messageprocessed",function(e,t,a,n){x(e,t,a,n)}),appEvent.on("docpanel.resetDim",function(){b()}),appEvent.on("sheet.onnamechanged",function(e,t){q(e,t)}),appEvent.on("grid.afterload",function(){return Y(r)}),{showCollabPanel:E,getPanelPermissions:tt,isAllowed:z,getCollabUserName:L,setColor:et,doGoTo:Y,getCollaborators:ot,getActiveCollaborators:nt,getCollaboratorsCount:rt,changeUserPresenceState:at,syncUserSessions:U,updateUserEdit:G,setCollboratorStatus:Q,updateActionStream:J,showActionStreamOptionsMenu:K,clearActionStream:Z,handleUserDelete:$,allowUserSessionInit:st}}(jQuery);$.ui.zcollaborator.prototype&&$.ui.zcollaborator.prototype.addChatMessage&&($.ui.zcollaborator.prototype.addChatMessage=function(e,t,a,n,o,r,s){if(0===t.length)return!1;if(0===$(".ui-zcollaborator-chatmsg").length&&collabChat.getChat(50,!0),$("#"+o).length>0)return this._lastChatEnteredUser=e,!1;var i=0;$(".chatTimeStamp")[$(".chatTimeStamp").length-1]&&(i=parseFloat($(".chatTimeStamp")[$(".chatTimeStamp").length-1].id));var l=r,c=new Date(i),u=new Date(l),d=$("<span>");d.addClass("chatTimeStamp"),d.attr("id",l);var h=!1,g=null;c.getYear()!==u.getYear()?g=collabChat.dateLocaleFormat(u):c.getMonth()!==u.getMonth()?g=collabChat.dateLocaleFormat(u):c.getDay()!==u.getDay()?g=collabChat.dateLocaleFormat(u):c.getHours()!==u.getHours()?g=collabChat.dateLocaleFormat(u):c.getMinutes()!==u.getMinutes()?g=collabChat.dateLocaleFormat(u):0===i&&(g=collabChat.dateLocaleFormat(u)),null!==g&&d.html(g),encodeURIComponent(t).indexOf("%0A")>-1&&(a=!0,t=encodeURIComponent(t).split("%0A").join("<br>"),t=decodeURIComponent(t));var f=$("<div>").addClass("ui-zcollaborator-chatblock");if(f.attr("id",o),checkDay()){var p=$("<fieldset>"),C=$("<legend>");p.addClass("cTsD").addClass("2Dchat"),C.text(jsMsg.CollabChatToday),p.append(C),f.append(p)}if(this._lastChatEnteredUser!=e){var m=$("<span>").addClass("ui-zcollaborator-username").text(e+":");f.append(m),m.append(d)}else h=!0;var E=$("<span>").addClass("ui-zcollaborator-chatmsg")[a?"html":"text"](t);null!==g&&h&&E.prepend(d),f.append(E),this._lastChatEnteredUser=e,collabChat.isAtBottom()||s===WebMessanger.getRawSid()?this._groupChats.append(f).scrollTop(this._groupChats[0].scrollHeight):this._groupChats.append(f)},$.ui.zcollaborator.prototype._checkAndTrigger=function(e){var t=$(e.target);if("click"==e.type){if(t.parent(".ui-zcollaborator-list").length||t.is(".ui-zcollaborator-img")||t.is(".ui-zcollaborator-name")){var a=t.closest(".ui-zcollaborator-user"),n={user:a,uid:a.attr("uid")};return this._triggerEvent(this._EVENTS.ONUSERNAMECLICKED,e,n),!0}}else if("focus"==e.type)t.is("textarea")&&t.val()==this._getString("customchatmessage.label")&&(t.val(""),t.addClass("ui-zcollaborator-textarea-focus").removeClass("ui-zcollaborator-textarea-blur"));else if("blur"==e.type)t.is("textarea")&&""==t.val()&&(t.val(this._getString("customchatmessage.label")),t.removeClass("ui-zcollaborator-textarea-focus").addClass("ui-zcollaborator-textarea-blur"));else if(e.keyCode===$.ui.keyCode.ENTER&&!e.shiftKey){var o=t.val();e.preventDefault(),o.trim().length&&o.trim().length<=2e4?(t.val(""),this._triggerEvent(this._EVENTS.ONCHATENTERED,e,o)):o.trim().length>2e4&&showAlertDialog(replaceParams(jsMsg.CollabChatMessageExceed,new Array("20000")))}});jQuery(function(t){function e(e){var h=t(s.container?"#"+s.container:"body");s.container=s.container?"#"+s.container:window;var u=h.find(".ui-znotifier-base-"+s.position),p=!1;if(u.length||(u=t(-1==t(e).get(0).nodeName.indexOf("document")?e:"<div>"),d=e,u.addClass("ui-znotifier-base ui-znotifier-base-"+s.position),p=!0),t(".ui-znotifier-base").children().length&&s.staticNotifier)return!1;r=u,a=t("<div>").addClass("ui-znotifier ui-state-"+s.type+" ui-corner-all").css({width:s.width+"px"});var l=t("<span>").addClass("ui-znotifier-message").appendTo(a);if(s.iconclass){var g=t("<span>").addClass(s.iconclass);l.append(g)}if(l.html(l.html()+s.content),a.attr("close",!0),!s.autohide&&(a.removeAttr("close"),s.closebutton)){t("<span>").addClass("ui-icon ui-icon-close").appendTo(a).on("click",function(e){var i=t(e.target).parent().parent();i.trigger("notifierclose"),t(e.target).parent().remove(),o(i)})}r.children().length?":first"==f[s.position]?a.appendTo(r):a.insertBefore(r.children(":first")):a.appendTo(r),h.append(r),p&&r.css(i(s.position)),n(r),t(s.container).on("resize",function(){i(s.position),r.css(c)})}function i(e,i,n){var o={};i=i?t(i):r,n=n?t(n):a;var d=t(s.container).offset()?t(s.container).offset():{left:0,top:0},f="northeast"==e||"southeast"==e||"east"==e?t(s.container).width()-i.outerWidth(!0):"north"==e||"south"==e||"center"==e?t(s.container).width()/2-n.outerWidth(!0)/2:0,u="south"==e||"southeast"==e||"southwest"==e?t(s.container).height():"west"==e||"east"==e||"center"==e?t(s.container).height()/2-n.outerHeight(!0)/2:0;switch(e){case"southeast":case"southwest":case"south":o=s.container==window?{top:u,left:f}:{"margin-top":u,"margin-left":f},h={top:i.offset().top-n.outerHeight(!0)},c={top:d.top+t(s.container).height()-i.outerHeight(!0)};break;case"west":case"east":case"center":case"northwest":case"northeast":case"north":o=s.container==window?{top:u,left:f}:{"margin-top":u,"margin-left":f},h={height:i.outerHeight(!0)+n.outerHeight(!0)},c={height:i.outerHeight(!0)-n.outerHeight(!0)}}return o}function n(n){var r="up";if(-1!=s.position.indexOf("south")){i(s.position);var c=n.height()*n.parent().children().length;n.parent().height(c),n.css(h),r="down"}a||e(),s.animate&&a.hide().show(s.animationType,{direction:r,mode:"show"},500),s.autohide&&setTimeout(function(){var e=n.children("[close]"),i="down"==r?t(e).length-1:0;t(e).length&&(e=t(e)[i]);var a=t(e).parent();s.animate?t(e).hide(s.animationType,{direction:r,mode:"hide"},function(){t(e).remove(),o(a)}):(t(e).remove(),o(a))},s.timeout)}function o(e){i(s.position,e),t(e).css(c),e.children().length||(e.trigger("notifierdestroy"),e.remove())}var s={},r=void 0,a=void 0,h={},c={},d=void 0,f={north:":first",northeast:":first",northwest:":first",south:":last",southeast:":last",southwest:":last"};t.ZNotifier=function(i,n){s=t.extend({},t.fn.znotifier.defaults,n),e(i)};var u={hide:function(t){t.length&&t.hide()},destroy:function(t){t.length&&(t.trigger("notifierdestroy"),t.remove())}};t.fn.znotifier=function(e){"object"==typeof e?t.ZNotifier(this,e):u[e](-1==t(this).get(0).nodeName.indexOf("document")?t(this):r)},t.fn.znotifier.defaults={autohide:!0,timeout:1e4,content:"This is the default Notifier",type:"info",animate:!1,animationType:"slide",position:"southeast",closebutton:!0}});pivot.Prompt=Backbone.View.extend({el:"#pivotPromptDialog",events:{"click #nSheet":"newSheet","click #eSheet":"existingSheet","click #confirmPivot":"goToDestination","click #cancelPivot":"cancelPivot",keyup:"keyUpCall"},initialize:function(){if(this.model&&sheetdialog.getTitle()===jsMsg["Pivot.UI.Move.Title"])$("#sourceDiv").css("display","none");else{var e=this.model?!0:!1;if($("#sourceRange").focus(function(){var e=this;RangeSelector.on({el:e,appendSheetName:!0})}),$("#sourceRange").focus(),e){$("#targetDiv").css("display","none");var t=this.model[JSONConstants.ASSOCIATED_SOURCE_SHEET_NAME],o=this.model[JSONConstants.SOURCE_START_ROW],s=this.model[JSONConstants.SOURCE_START_COLUMN],i=this.model[JSONConstants.SOURCE_END_ROW],l=this.model[JSONConstants.SOURCE_END_COLUMN],n=WorkSheets.getSheetNameFromCode(t);WorkSheets.getAssociatedActiveSheetName()===t?(scrollCellIntoView(o,s),focusCellRangeFill(o,s,i,l,!0)):(showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(n),"open",!1,!1),setTimeout(function(){clearCellRangeFill(),scrollCellIntoView(o,s),focusCellRangeFill(o,s,i,l,!0)},500)),$("#sourceRange").val(CellUtils.constructCellName(o,s,i,l,!1,n))}else{var a=getCellRange();a.startRow===a.endRow&&a.startCol===a.endCol&&(a=PivotUtil.detectRange(a.startRow,a.startCol),focusCellRange(a.startRow,a.startCol,a.endRow,a.endCol,!1,!0));var r=CellUtils.constructCellName(a.startRow,a.startCol,a.endRow,a.endCol,!1,WorkSheets.getActiveSheetName());$("#sourceRange").val(r)}}e||($("#targetCell").focus(function(){var e=this;RangeSelector.on({el:e,single:!0,appendSheetName:!0,onupdate:function(){PivotUtil.enableDiasablePromptDlgBtn()}})}),$("#targetCell").on("input",function(){PivotUtil.enableDiasablePromptDlgBtn()})),$("#pivotpromptdialogzdialog").css("min-height",0)},newSheet:function(){$("#targetLoc").slideUp(200),$("#confirmPivot").removeClass("ui-button-disabled ui-state-disabled")},existingSheet:function(){$("#targetLoc").slideDown(200),$("#targetCell").focus(),PivotUtil.enableDiasablePromptDlgBtn()},goToDestination:function(){var e,t=sheetdialog.getTitle()===jsMsg["Pivot.UI.Source.Title"],o=new AjaxRequest,s=!1;if(!t){if($("#confirmPivot").hasClass("ui-button-disabled"))return;s=$("#nSheet").is(":checked");var i=$("#targetCell").val(),l=PivotUtil.getTargetLocation(i,s),n=l.row,a=l.col,r=this.model?!0:!1;if(!s){var C=CellUtils.getSheetNameFromCelLbl(i),S=WorkSheets.getSheetCodeFromName(C);if(!CellUtils.isSingleCell(i))return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),void $("#targetCell").focus();if(!PivotUtil.isValidTargetCell(S,l,r?this.model[JSONConstants.ID]:void 0))return void $("#targetCell").focus();if(r){var d=n+(this.model[JSONConstants.END_ROW]-this.model[JSONConstants.START_ROW]),c=a+(this.model[JSONConstants.END_COLUMN]-this.model[JSONConstants.START_COLUMN]);if(isPivotOrArrayRange(n,a,d,c,S,void 0,this.model[JSONConstants.ID])||ProtectedRanges.isRangeLocked(n,a,d,c))return;var g=this.model[JSONConstants.SOURCE_START_ROW],h=this.model[JSONConstants.SOURCE_END_ROW],v=this.model[JSONConstants.SOURCE_START_COLUMN],O=this.model[JSONConstants.SOURCE_END_COLUMN],m=this.model[JSONConstants.ASSOCIATED_SOURCE_SHEET_NAME];if(S===m&&(g>=n&&d>=g||h>=n&&d>=h||n>g&&h>d)&&(v>=a&&c>=v||O>=a&&c>=O||a>v&&O>c))return showAlertDialog(jsMsg["Error.Pivot.Table.Overlaps.With.Source"]),void $("#targetCell").focus()}}if(r){if(this.model[JSONConstants.ASSOCIATED_SHEET_NAME]=S,this.model[JSONConstants.START_ROW]=n,this.model[JSONConstants.START_COLUMN]=a,e=new RequestParameters(ActionConstants.MOVE_PIVOT),s){var R=new RequestParameters(ActionConstants.SHEET_INSERT);R.setParameters(WorkSheets.getAssociatedActiveSheetName(),!0,!0),o.init("POST",R.getURL(),!0,R.getParametersAsString()),e.setParameters(void 0,!1,n,a,this.model[JSONConstants.ID],!1),PivotUtil.setFollowUpAction(e)}else e.setParameters(S,!1,n,a,this.model[JSONConstants.ID],!1),PivotUtil.setLastAction(e),o.init("POST",e.getURL(),!0,e.getParametersAsString());return actionManager.addRequest(o),void sheetdialog.close()}}var N=$("#sourceRange").val();if(CellUtils.isSingleCell(N)||!CellUtils.checkCellLbl(N))return showAlertDialog(jsMsg["Error.Pivot.Source.Selection"]),void $("#sourceRange").focus();var u=CellUtils.getRangeFromCellLbl(N);if(pivot.Collection.isPivotRange(u.startRow,u.startCol,u.endRow,u.endCol,u.asn))return showAlertDialog(jsMsg["Error.Pivot.Source.Overlaps.With.Table"]),void $("#sourceRange").focus();if(t){var E=!1;if(this.model[JSONConstants.ASSOCIATED_SOURCE_SHEET_NAME]!==u.asn||this.model[JSONConstants.SOURCE_START_ROW]!==u.startRow)E=!0;else if(this.model[JSONConstants.SOURCE_START_COLUMN]!==u.startCol||this.model[JSONConstants.SOURCE_END_COLUMN]!==u.endCol){for(var U=this.model[JSONConstants.SOURCE_END_COLUMN],P=this.model[JSONConstants.SOURCE_START_COLUMN],A=[JSONConstants.PAGE_FIELDS,JSONConstants.ROW_FIELDS,JSONConstants.COLUMN_FIELDS,JSONConstants.DATA_FIELDS],T=0;T<A.length;T++){var f=A[T],_=this.model[f];if(_&&_.length>0)for(var D=0;D<_.length;D++){var p=_[D];U>p&&(U=p),p>P&&(P=p)}}(U<u.startCol||P>u.endCol)&&(E=!0)}if(!E){if(PivotUtil.isMaxNoOfFieldsExceeded(this.model))return;return e=new RequestParameters(ActionConstants.CHANGE_PIVOT_SOURCE),e.setParameters(u.asn,u.startRow,u.startCol,u.endRow,u.endCol,this.model[JSONConstants.ID],!1),PivotUtil.setLastAction(e),o.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(o),void sheetdialog.close()}var J=showConfirmDialog(jsMsg["Error.Pivot.Change.Source"]);if(!J)return;S=this.model[JSONConstants.ASSOCIATED_SHEET_NAME],n=this.model[JSONConstants.START_ROW],a=this.model[JSONConstants.START_COLUMN],C=WorkSheets.getSheetNameFromCode(S),PivotUtil.deletePivotWithoutAlert(this.model[JSONConstants.ID]),pivotId="temp"}if(pivot.Collection.get("temp")&&pivot.Collection.remove("temp"),s||S!==WorkSheets.getAssociatedActiveSheetName()||!ProtectedRanges.isRangeLocked(n,a,n,a)){var w={ssr:u.startRow,ssc:u.startCol,ser:u.endRow,sec:u.endCol,sasn:u.asn,sr:n,sc:a,asn:S,id:"temp",pf:[],rf:[],cf:[],df:[]},M=pivot.Collection.create(w);if(PivotUtil.getPivotFields(M)){if(s){var L=new RequestParameters(ActionConstants.SHEET_INSERT);return L.setParameters(WorkSheets.getAssociatedActiveSheetName(),!0,!0),o.init("POST",L.getURL(),!0,L.getParametersAsString()),o.addEventListener("onComplete",function(){}),actionManager.addRequest(o),void sheetdialog.close()}WorkSheets.getAssociatedActiveSheetName()===S?(focusCell(n,a,void 0,!0),scrollCellIntoView(n,a)):Goto.doGoto(C,n,n,a,a,!1),pivotId="temp",PivotUtil.openBuilder(!0)}}},cancelPivot:function(){PivotUtil.cancelPivot(),sheetdialog.close(),sheetdialog.getTitle()===jsMsg["Pivot.UI.Source.Title"]&&PivotUtil.cancelChangeSource(this.model[JSONConstants.ID])},keyUpCall:function(e){PivotUtil.isEnterKeyPressed(e)&&this.goToDestination()}});window.JST={},window.JST.fieldTemplate=_.template("<span class='fldS' title='<%- content %>'><span class='fld<%- type %>'></span><span class='fldL'><%- content %></span><span class='pDrpdwn' style='visibility:hidden'></span></span>"),window.JST.dragFieldTemplate=_.template("<div class='dragEle'><span class='fld<%- type %>'></span><span class='fldL'><%- content %></span></div>"),window.JST.dataFieldTemplate=_.template("<span class='fldS' title='<%- content %>'><span class='fld<%- type %>'></span><span class='fldL' id='dataContent'><%- content %></span><span class='pDrpdwn' id='<%-fieldtype%>DropDown'></span></span>"),window.JST.dateFieldTemplate=_.template("<span class='fldS' title='<%- content %>'><span class='fld<%- type %>'></span><span class='fldL'><%- content %></span><span class='pDrpdwn' id='<%-fieldtype%>DropDown'></span></span>");pivot.Dialog=Backbone.View.extend({el:"#pivot",allFieldTemplate:_.template("<div class='checkBox'><input type='checkbox' id='pvtChk<%- i %>' class='fieldItem'/><label for='pvtChk<%- i %>'></label></div><span class='fldS' title='<%- content %>'><span class='fld<%- type %>'></span><span class='fldL'><%- content %></span></span>"),events:{"click #createPivot":"createNewPivot","click #cancelPivot":"cancelPivot","click #dataDropDown":"showFunctions","click #dateDropDown":"showGroupings","click #listView":"gridChange","click #gridView":"gridChange","click #confirmPivot":"createNewPivot","click #overwrite":"overwrite","keyup #searchField":"searchField","keyup #targetCell":"targetCellChange"},initialize:function(){pivot.is_grid_dialog?PivotUtil.gridChange():($("#allFields").removeClass("pGridV"),$("#allFields").addClass("pListV")),$("#errMaxField").css("top",Math.round($(sheetdialog.getOpenedDialog()).offset().top-$("#pivotdialogzdialog").offset().top));for(var t=[JSONConstants.PAGE_FIELDS,JSONConstants.ROW_FIELDS,JSONConstants.COLUMN_FIELDS,JSONConstants.DATA_FIELDS],e=this.model[JSONConstants.ALL_FIELDS],n=this.model[JSONConstants.FUNCTION],a=[],s=0;s<t.length;s++){var i,o=t[s],l=this.model[o],r=$("#"+o).find("ul");if(l&&l.length>0)for(var d=0;d<l.length;d++){var c=l[d];if(-1===c){var u={content:"Values",colIndex:-1,type:"Tt"};i=JST.fieldTemplate(u),$('<li style="z-index:1000000"></li>').html(i).appendTo(r),a.push({content:u.content,colIndex:u.colIndex,field:o}),e.push(u)}else for(var S=0;S<e.length;S++){var h=e[S];if(c===h.colIndex){if(o===JSONConstants.DATA_FIELDS){var p=n[d].charAt(0).toUpperCase()+n[d].slice(1),v=replaceParams(jsMsg["Pivot.UI.Datafield.Content."+p],new Array(escapeSpecialCharacters(h.content)));i=JST.dataFieldTemplate({content:v,fieldtype:"data",type:h.type}),$('<li style="z-index:1000000" content="'+h.content+'"></li>').html(i).appendTo(r)}else i="Td"===h.type?JST.dateFieldTemplate({content:h.content,fieldtype:"date",type:h.type}):JST.fieldTemplate(h),$('<li style="z-index:1000000"></li>').html(i).appendTo(r);a.push({content:h.content,colIndex:h.colIndex,field:o})}}}}this.model[JSONConstants.USED_FIELDS]=a,this.constructFieldHtml(),this.model[JSONConstants.IS_SOURCE_CHANGED]||$("#createPivot").addClass("ui-button-disabled ui-state-disabled"),$("#createPivot").prepend("<span></span>"),PivotUtil.setErrDivWidth(),$("#targetCell").focus(function(){var t=this;RangeSelector.on({el:t,single:!0,appendSheetName:!0,onupdate:function(){PivotUtil.enableDisableOverwrite(!1)}})})},constructFieldHtml:function(){function t(t){var e=t.textContent,n=g(e);n&&d(n,e,!0);for(var a=$("#df li"),s=0;s<a.length;s++){var i=a[s];if(i){var o=i.getAttribute("content");o===e&&d(JSONConstants.DATA_FIELDS,o,!0)}}$(t).removeClass("used-element")}function e(t){return 27===t.which||27===t.keyCode?(_=!0,$(t.target).draggable().trigger("mouseup"),_=!1,!1):void 0}function n(t,e,n){for(var a=[JSONConstants.PAGE_FIELDS,JSONConstants.ROW_FIELDS,JSONConstants.COLUMN_FIELDS,JSONConstants.DATA_FIELDS],s=0;s<a.length;s++){var i=a[s],o=5,l=$("#"+i+" ul"),r=void 0;T&&n&&(r=g(n)),t&&r!==i&&(l.children().length<o||i===e)?l.addClass("dragStart"):l.removeClass("dragStart")}}function a(t,e){var n,a;n=5,a=jsMsg["Error.Pivot.Max.Field"];var i=$("#"+t+" li");return T||n++,i.length>=n?(u(e,f(e),!1),s(t,a),!0):!1}function s(t,e){var n=$("#errMaxField");$(n.children()[0]).html(e),n.slideDown(),$("#"+t).addClass("errMaxCont"),clearTimeout(P),P=setTimeout(function(){PivotUtil.hideMaxFieldError()},4e3)}function i(){var t=JSONConstants.COLUMN_FIELDS,e=$("#"+t+" li").length;if(e>=5&&(t=JSONConstants.ROW_FIELDS,e=$("#"+t+" li").length),e>=5)return!1;var n="Values";return p(void 0,n,t,e),J.push({content:n,colIndex:-1,type:"Tt"}),S(t,n,e),!0}function o(){for(var t=$("#"+JSONConstants.DATA_FIELDS+" li"),e=0;e<t.length;e++){var n=t[e];$(n).hasClass("dropPos")||d(JSONConstants.DATA_FIELDS,n.getAttribute("content"),!0)}}function l(t,e,n){var s=JSONConstants.DATA_FIELDS;if(a(s,e))return!1;var o=$("#"+s+" li");return 1!==o.length||i()?(p(t,e,JSONConstants.DATA_FIELDS,n),S(JSONConstants.DATA_FIELDS,e,n),!0):!1}function r(t,e,n){var s=t.parent()[0].id;a(s,e)||("allFields"===E||E===JSONConstants.DATA_FIELDS)&&(p(t,e,s,n),S(s,e,n))}function d(t,e,n,a){if(t===JSONConstants.ROW_FIELDS||t===JSONConstants.COLUMN_FIELDS||t===JSONConstants.DATA_FIELDS||t===JSONConstants.PAGE_FIELDS){v(t,e,a);var s=c(t,e,n,a);n&&-1===s&&o()}}function c(t,e,n,a){for(var s=-2,i=0;i<I.length;i++){var o=I[i];if(o.field===t&&o.content===e){s=o.colIndex,I.splice(i,1);break}}return s>=-1&&h(s,void 0,void 0,t,a),n&&-1!==s&&u(e,s,!1),s}function u(t,e,n){if(!O(e))for(var a=$("#allFields").children(),s=0;s<a.length;s++){var i=a[s];if(i.textContent===t){i.children[0].children[0].checked=n,n?$(i).addClass("used-element"):$(i).removeClass("used-element");break}}}function S(t,e,n){var a=f(e);I.push({content:e,colIndex:a,field:t}),h(a,n,t)}function h(t,e,n,a,s){I.length>0?$("#createPivot").removeClass("ui-button-disabled ui-state-disabled"):$("#createPivot").addClass("ui-button-disabled ui-state-disabled");var i=void 0;if(a){var o=F[a];if(void 0!==s&&s>-1&&a===JSONConstants.DATA_FIELDS){o.splice(s,1);var l=F[JSONConstants.FUNCTION];i=l.splice(s,1)[0]}else for(var r=0;r<o.length;r++)if(o[r]===t){o.splice(r,1),a===JSONConstants.DATA_FIELDS&&(l=F[JSONConstants.FUNCTION],i=l.splice(r,1)[0]);break}}if(n){var d=F[n];d.splice(e,0,t),i&&n===JSONConstants.DATA_FIELDS&&l.splice(e,0,i)}}function p(t,e,n,a){t||(t=$("#"+n+" ul"));var s=m(e),i="",o=e;if(n===JSONConstants.DATA_FIELDS){var l,r=F[JSONConstants.FUNCTION];_?l=r[a]:(l="Tn"===s?"sum":"count",r.splice(a,0,l)),l=l.charAt(0).toUpperCase()+l.slice(1),i="data",o=replaceParams(jsMsg["Pivot.UI.Datafield.Content."+l],new Array(escapeSpecialCharacters(e)))}else"Td"===s&&(i="date");var d;d=n===JSONConstants.DATA_FIELDS?JST.dataFieldTemplate({content:o,fieldtype:i,type:s}):"Td"===s?JST.dateFieldTemplate({content:o,fieldtype:i,type:s}):JST.fieldTemplate({content:e,type:s}),d=n===JSONConstants.DATA_FIELDS?$('<li style="z-index:1000000" content="'+e+'"></li>').html(d):$('<li style="z-index:1000000"></li>').html(d),d.addClass("drop"),0===a?t.prepend(d):$(t.children()[a-1]).after(d)}function v(t,e,n){var a,s=$("#"+t+" li"),i=t===JSONConstants.DATA_FIELDS;if(void 0!==n&&n>-1)a=s[n],a.parentNode.removeChild(a);else for(var o=0;o<s.length;o++){a=s[o];var l=i?a.getAttribute("content"):a.textContent;l===e&&a.parentNode.removeChild(a)}if(i&&1===C()){var r=g("Values");d(r,"Values",!1)}}function C(){for(var t=0,e=$("#df li"),n=0;n<e.length;n++){var a=$(e[n]);a.hasClass("dropPos")||t++}return t}function f(t){for(var e=0;e<J.length;e++){var n=J[e];if(n.content===t)return n.colIndex}return void 0}function g(t){for(var e=0;e<I.length;e++){var n=I[e];if(n.content===t&&n.field!==JSONConstants.DATA_FIELDS)return n.field}return void 0}function O(t){for(var e=[JSONConstants.PAGE_FIELDS,JSONConstants.ROW_FIELDS,JSONConstants.COLUMN_FIELDS,JSONConstants.DATA_FIELDS],n=!1,a=0;a<e.length;a++){var s=e[a],i=F[s];if(i.contains(t)){n=!0;break}}return n}function m(t){for(var e=0;e<J.length;e++){var n=J[e];if(n.content===t)return n.type}return"Tt"}function N(t){return t.hasClass("fldTn")&&F[JSONConstants.DATA_FIELDS].length<5?JSONConstants.DATA_FIELDS:t.hasClass("fldTd")&&F[JSONConstants.ROW_FIELDS].length<5?JSONConstants.ROW_FIELDS:D()}function D(){var t=F[JSONConstants.ROW_FIELDS].length,e=F[JSONConstants.COLUMN_FIELDS].length;return 5>t||5>e?t>e?JSONConstants.COLUMN_FIELDS:JSONConstants.ROW_FIELDS:0===F[JSONConstants.DATA_FIELDS].length?JSONConstants.DATA_FIELDS:F[JSONConstants.PAGE_FIELDS].length<5?JSONConstants.PAGE_FIELDS:void 0}for(var E,A,L,F=this.model,J=F[JSONConstants.ALL_FIELDS],I=F[JSONConstants.USED_FIELDS],T=!1,_=!1,b=!1,P=null,y=$("#allFields"),U=-1,M=0;M<J.length;M++){var k=J[M],x=k.colIndex;if(-1!==x){k.i=M+1;var R=this.allFieldTemplate(k),w=$('<li style="z-index:1000000"></li>').html(R);O(x)&&(w=w.addClass("used-element"),w.children().children()[0].checked=!0),w.appendTo(y)}}$(".fieldItem").bind("click",function(e){var n,a=e.currentTarget,s=a.parentNode.parentNode,i=s.textContent;if(a.checked){var o=$(s.children[1].children[0]);if(n=N(o)){$(s).addClass("used-element");var d=$("#"+n).children(),c=d[0].children.length;E="allFields",n===JSONConstants.DATA_FIELDS?l(d,i,c):r(d,i,c)}else showAlertDialog("Cannot add any more field"),a.checked=!1;E=void 0}else t(s)}),$("#resetPivot").bind("click",function(){for(var e=$("#allFields").children(),n=0;n<e.length;n++){var a=e[n];a.children[0].children[0].checked&&(a.children[0].children[0].checked=!1,t(a))}$("#createPivot").addClass("ui-button-disabled ui-state-disabled")}),$("#allFields li").draggable({appendTo:"body",connectToSortable:"#pf ul, #rf ul, #cf ul, #df ul",scroll:!1,helper:function(){var t="Tt",e=$(this.children[1].children[0]);e.hasClass("fldTn")?t="Tn":e.hasClass("fldTd")&&(t="Td");var n=$(JST.dragFieldTemplate({content:this.textContent,type:t}));return n.css({width:$(this).width(),height:$(this).height()}),n},cursor:"move",cursorAt:{top:6,left:70},start:function(){T=!0,$("#pivotdialogzdialog").dialog("option","closeOnEscape",!1),document.addEventListener("keyup",e,!1),n(!0,void 0,this.textContent)},stop:function(){T=!1,$("#pivotdialogzdialog").dialog("option","closeOnEscape",!0),document.removeEventListener("keyup",e,!1),n(!1)}}),$("#pf ul, #rf ul, #cf ul").sortable({zIndex:1e6,connectWith:"#pf ul, #rf ul, #cf ul, #df ul",scroll:!1,placeholder:"dropPos",start:function(){$("#pivotdialogzdialog").dialog("option","closeOnEscape",!1),document.addEventListener("keyup",e,!1),T||(E=$(this).parent().attr("id"),n(!0,E))},out:function(){$(this).removeClass("dragOver")},receive:function(t,e){E=e.sender.parent().attr("id"),L=$(this).parent()[0].id,"allFields"!==E||_||(e.item.hasClass("used-element")?A=!0:(e.item.addClass("used-element"),e.item.children().children()[0].checked=!0,A=!1),T||(E=L))},stop:function(t,i){if(L||(L=$(this).parent()[0].id),_){if(E||(E=i.item.parent().parent().attr("id")),"allFields"!==E){$("#"+E+" ul").sortable("cancel");var o=i.item.index();p($(this),i.item.text(),E,o)}i.item.remove()}else{var v,C=i.item.text();if(o=i.item.index(),"allFields"===E)if(i.item.remove(),A){var O=g(C);O?O===L||a(L,C)||(d(O,C,!1),r($(this),C,o)):r($(this),C,o)}else r($(this),C,o);else if(L===JSONConstants.DATA_FIELDS)v=f(C),a(L,C)||-1===v?$("#"+E+" ul").sortable("cancel"):(i.item.remove(),c(E,C,!1),l($("#"+JSONConstants.DATA_FIELDS).children(),C,o));else if(E===L)i.item.addClass("drop"),E=$(this).parent()[0].id,v=f(C),o>=0?h(v,o,E,E):u(C,v,!1);else{var m=$("#"+L+" li");m.length>5?(s(L,jsMsg["Error.Pivot.Max.Field"]),$("#"+E+" ul").sortable("cancel")):L===JSONConstants.PAGE_FIELDS&&-1===f(C)?$("#"+E+" ul").sortable("cancel"):(i.item.addClass("drop"),c(E,C,!1),S(L,C,o))}}E=void 0,L=void 0,$("#pivotdialogzdialog").dialog("option","closeOnEscape",!0),document.removeEventListener("keyup",e,!1),T||n(!1)}}).droppable({greedy:!0,hoverClass:"dragOver",drop:function(){b=!0},over:function(){var t=$(this).children().length;T&&t--;var e=$(this).parent().attr("id");E!==e&&t>5?$(".dropPos").css("display","none"):$(".dropPos").css("display","block")},out:function(){$(".dropPos").css("display","none")}}),$("#df ul").sortable({zIndex:1e6,connectWith:"#pf ul, #rf ul, #cf ul",scroll:!1,placeholder:"dropPos",start:function(t,a){$("#pivotdialogzdialog").dialog("option","closeOnEscape",!1),document.addEventListener("keyup",e,!1),T||(E=JSONConstants.DATA_FIELDS,n(!0,E)),a.item&&(U=a.item.index())},out:function(){$(this).removeClass("dragOver")},receive:function(t,e){L=JSONConstants.DATA_FIELDS,E=e.sender.parent().attr("id"),"allFields"!==E||_||(e.item.hasClass("used-element")?A=!0:(e.item.addClass("used-element"),e.item.children().children()[0].checked=!0,A=!1),T||(E=L))},stop:function(t,s){L||(L=$(this).parent()[0].id);var i,o;if(_)E||(E=s.item.parent().parent().attr("id")),E===JSONConstants.DATA_FIELDS&&($("#"+E+" ul").sortable("cancel"),o=s.item.index(),i=s.item.attr("content"),p($(this),i,E,o)),s.item.remove();else{o=s.item.index();var S=s.item.text();if("allFields"===E)s.item.remove(),l($(this),S,o);else if(L)if(i=s.item[0].getAttribute("content"),E!==L&&E===JSONConstants.DATA_FIELDS){if(a(L,i))$("#"+E+" ul").sortable("cancel");else{s.item.remove(),c(JSONConstants.DATA_FIELDS,s.item[0].getAttribute("content"),!1);var v=g(i);v?v!==L&&(d(v,i,!1),r($("#"+L+" ul"),i,o)):r($("#"+L+" ul"),i,o)}if(1===C()){var O=g("Values");d(O,"Values",!1)}}else if(E===L){var m=f(i);o>=0?h(m,o,E,E,U):u(i,m,!1)}}E=void 0,L=void 0,$("#pivotdialogzdialog").dialog("option","closeOnEscape",!0),document.removeEventListener("keyup",e,!1),T||n(!1),U=-1}}).droppable({greedy:!0,hoverClass:"dragOver",drop:function(){b=!0},over:function(){var t=$(this).children().length;T&&t--;var e=$(this).parent().attr("id");E!==e&&t>5?$(".dropPos").css("display","none"):$(".dropPos").css("display","block")},out:function(){$(".dropPos").css("display","none")}}),$("#main").droppable({drop:function(t,e){if(b||T||_)return void(b=!1);var n=e.draggable.parent().parent().attr("id"),a=n===JSONConstants.DATA_FIELDS?e.draggable[0].getAttribute("content"):e.draggable.text();d(n,a,!0,U)}})},showFunctions:function(t){var e=t.target,n=e.parentNode.parentNode,a=$(n).index(),s=this.model,i=$("#dataDropDown"),o=[];o.push({id:"Sum",data:"{label:'"+jsMsg["StatusBar.Sum"]+"', appData:{dynamic:true}}"}),o.push({id:"Count",data:"{label:'"+jsMsg["StatusBar.Count"]+"', appData:{dynamic:true}}"}),o.push({id:"Max",data:"{label:'"+jsMsg["Pivot.Submenu.Max"]+"', appData:{dynamic:true}}"}),o.push({id:"Min",data:"{label:'"+jsMsg["Pivot.Submenu.Min"]+"', appData:{dynamic:true}}"}),o.push({id:"Product",data:"{label:'"+jsMsg["Pivot.Submenu.Product"]+"', appData:{dynamic:true}}"});var l={target:i,clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("functions",o,l);var r=$("#functions");r.css("top",i.offset().top-159),r.css("left",i.offset().left-68),r.css("width",80),r.on({click:function(t){var e=t.target;e.id||(e=e.parentNode);var n=e.id,i=$("#df li")[a],o=i.getAttribute("content"),l=replaceParams(jsMsg["Pivot.UI.Datafield.Content."+n],new Array(escapeSpecialCharacters(o)));i.children[0].children[1].innerHTML=l;var r=s[JSONConstants.FUNCTION];r[a]=n.toLowerCase(),$("#createPivot").removeClass("ui-button-disabled ui-state-disabled")}})},showGroupings:function(t){var e=t.target,n=e.parentNode.parentNode,a=n.textContent,s=this.model[JSONConstants.ALL_FIELDS],i=$("#dateDropDown"),o=[];o.push({id:"gr1",data:"{label:'"+jsMsg.None+"', appData:{dynamic:true}}"}),o.push({id:"gr2",data:"{label:'"+jsMsg["Pivot.Submenu.Year"]+"', appData:{dynamic:true}}"}),o.push({id:"gr3",data:"{label:'"+jsMsg["Pivot.Submenu.Quarter"]+"', appData:{dynamic:true}}"}),o.push({id:"gr4",data:"{label:'"+jsMsg["Pivot.Submenu.Month"]+"', appData:{dynamic:true}}"}),o.push({id:"gr5",data:"{label:'"+jsMsg["Pivot.Submenu.Day"]+"', appData:{dynamic:true}}"}),o.push({id:"gr6",data:"{label:'"+jsMsg["Pivot.Submenu.Day.Week"]+"', appData:{dynamic:true}}"}),o.push({id:"gr7",data:"{label:'"+jsMsg["Pivot.Submenu.Quarter.Year"]+"', appData:{dynamic:true}}"}),o.push({id:"gr8",data:"{label:'"+jsMsg["Pivot.Submenu.Month.Year"]+"', appData:{dynamic:true}}"});var l={target:i,clearcache:!0};sheetMenu.showMenu("groups",o,l);var r=$("#groups");r.css("top",i.offset().top+10),r.css("left",i.offset().left-125);for(var d,c=0;c<s.length;c++){var u=s[c];"Td"===u.type&&u.content===a&&(d=u[JSONConstants.GROUP])}var S=void 0===d?"gr1":"gr"+(d+1);r.zmenu("changeIcon",S,"ui-individual-icon ui-icon-ztick"),r.on({click:function(t){var e=t.target,n=e.id?e.id:e.parentNode.id?e.parentNode.id:e.parentNode.parentNode.id,i=n.substring(2)-1;S&&r.zmenu("changeIcon",S,"ui-zmenu-no-icon"),r.zmenu("changeIcon",n,"ui-individual-icon ui-icon-ztick");for(var o=0;o<s.length;o++){var l=s[o];"Td"===l.type&&l.content===a&&(l[JSONConstants.GROUP]=i)}$("#createPivot").removeClass("ui-button-disabled ui-state-disabled")}})},createNewPivot:function(){var t=!1,e="block"===$("#err").css("display");if(e){if($("#confirmPivot").hasClass("ui-button-disabled"))return;t=$("#nSheet").is(":checked")||$("#nSheetErr").is(":checked");var n=$("#targetCell").val(),a=PivotUtil.getTargetLocation(n,t);if(this.model[JSONConstants.START_ROW]=a.row,this.model[JSONConstants.START_COLUMN]=a.col,!t){var s=CellUtils.getSheetNameFromCelLbl(n),i=WorkSheets.getSheetCodeFromName(s);if(!CellUtils.isSingleCell(n))return showAlertDialog(jsMsg["GoalSeek.Msg.InvalidCell"]),void $("#targetCell").focus();if(!PivotUtil.isValidTargetCell(i,a,"temp"!==u?this.model[JSONConstants.ID]:void 0))return void $("#targetCell").focus();this.model[JSONConstants.ASSOCIATED_SHEET_NAME]=i,$("#err").slideUp(1e3)}}var o=$("#createPivot");if(!o.hasClass("ui-button-disabled")&&!$(o.children()[0]).hasClass("generate")){var l=this.model[JSONConstants.FUNCTION],r=[];for(var d in l){var c=l[d];switch(c){case"sum":r.push(1);break;case"count":r.push(2);break;case"max":r.push(3);break;case"min":r.push(4);break;case"product":r.push(5)}}var u=pivotId,S=pivot.Collection.get(u);if("temp"!==u){if(PivotUtil.isLocked(u))return;for(var h=!0,p=[JSONConstants.PAGE_FIELDS,JSONConstants.ROW_FIELDS,JSONConstants.COLUMN_FIELDS,JSONConstants.DATA_FIELDS],v=0;v<p.length;v++){var C=p[v],f=this.model[C],g=S.get(C);if(f.length===g.length){for(var O=0;O<f.length;O++)if(f[O]!==g[O]){h=!1;break}}else h=!1;if(!h)break}if(h&&(h=!1),h)for(var m=S.get(JSONConstants.ALL_FIELDS),N=this.model[JSONConstants.ALL_FIELDS],D=0;D<N.length;D++){var E=m[D],A=N[D];if(A[JSONConstants.GROUP]!==E[JSONConstants.GROUP]){h=!1;break}}}if(h&&!this.model[JSONConstants.IS_SOURCE_CHANGED])return void $("#createPivot").addClass("ui-button-disabled ui-state-disabled");if(!PivotUtil.isMaxNoOfFieldsExceeded(this.model)){for(var L=this.model[JSONConstants.ALL_FIELDS],F={},J=0;J<L.length;J++){var I=L[J],T=I[JSONConstants.GROUP];if(void 0!==T){var _=I.colIndex;F[_.toString()]=T}}if(S.set(JSONConstants.ALL_FIELDS,JSON.parse(JSON.stringify(L))),this.model[JSONConstants.ROW_FIELDS].length<1&&this.model[JSONConstants.COLUMN_FIELDS].length<1&&this.model[JSONConstants.DATA_FIELDS].length<1)return void showAlertDialog(jsMsg["Error.Pivot.RowOrColOrData.Field"]);var b=this.model[JSONConstants.SOURCE_START_ROW],P=this.model[JSONConstants.SOURCE_START_COLUMN],y=this.model[JSONConstants.SOURCE_END_ROW],U=this.model[JSONConstants.SOURCE_END_COLUMN],M=this.model[JSONConstants.ASSOCIATED_SOURCE_SHEET_NAME],k="temp"===u?ActionConstants.CREATE_PIVOT:ActionConstants.EDIT_PIVOT,x=new RequestParameters(k),R=new AjaxRequest;if(t){var w=new RequestParameters(ActionConstants.SHEET_INSERT);w.setParameters(WorkSheets.getAssociatedActiveSheetName(),!0,!0),R.init("POST",w.getURL(),!0,w.getParametersAsString()),x.setParameters(M,b,P,y,U,void 0,this.model[JSONConstants.START_ROW],this.model[JSONConstants.START_COLUMN],JSON.stringify([this.model[JSONConstants.PAGE_FIELDS],this.model[JSONConstants.ROW_FIELDS],this.model[JSONConstants.COLUMN_FIELDS],this.model[JSONConstants.DATA_FIELDS]]),JSON.stringify(r),u,JSON.stringify(F),!1,!1),PivotUtil.setFollowUpAction(x)}else x.setParameters(M,b,P,y,U,this.model[JSONConstants.ASSOCIATED_SHEET_NAME],this.model[JSONConstants.START_ROW],this.model[JSONConstants.START_COLUMN],JSON.stringify([this.model[JSONConstants.PAGE_FIELDS],this.model[JSONConstants.ROW_FIELDS],this.model[JSONConstants.COLUMN_FIELDS],this.model[JSONConstants.DATA_FIELDS]]),JSON.stringify(r),u,JSON.stringify(F),!1,!1),PivotUtil.setLastAction(x),R.init("POST",x.getURL(),!0,x.getParametersAsString());actionManager.addRequest(R),PivotUtil.changeCreatePivotBt(!1),e&&PivotUtil.enableBuilder()}}},cancelPivot:function(){sheetdialog.close()},gridChange:function(t){PivotUtil.gridChange(t)},overwrite:function(){$("#overwrite").hasClass("ui-button-disabled")||(PivotUtil.resendRequest(),PivotUtil.enableBuilder())},targetCellChange:function(){PivotUtil.enableDisableOverwrite(""===$("#targetCell").val()?!0:!1)},searchField:function(){for(var t=$("#searchField").val().toLowerCase(),e=$("#allFields").children(),n=0;n<e.length;n++){var a=e[n];-1===a.textContent.toLowerCase().indexOf(t)?$(a).css("display","none"):$(a).css("display","block")}}});!function(t){var e={widgetEventPrefix:"zautosuggest",_EVENTS:{ONREMOVE:"remove",ONSELECT:"select",ONCHANGE:"change"},options:{searchType:"email",placeholder:void 0,searchParamName:"searchquery",customData:{},submitURL:void 0,sortable:!1,minLength:2,list:"",imageURL:""},_emailRegx:/^[a-zA-Z0-9]([\w\-\.\+]*)@([\w\-\.]*)(\.[a-zA-Z]{2,8}(\.[a-zA-Z]{2}){0,2})$/,_tokenEvents:!1,_addedData:[],_userDetails:[],_create:function(){this.options=t.extend({},t.ui.zautosuggest.config,this.options),this.options.placeholder=void 0!==this.options.placeholder?this.options.placeholder:this.element.attr("placeholder"),(void 0===this.options.placeholder||""===this.options.placeholder)&&(this.options.placeholder=this._getString("searchplaceholder.label")),this._tokenElement=t("<div>").attr({class:"ui-zautosuggest"}).appendTo(this.element);var e=this;this.element.on("click",function(){e._tokenInput.trigger("focus")}),this._isAuthor=!1,this._defaultCheck=!1;var n=t("<input>").hide().appendTo(t("body"));this._isPlaceholder=void 0===n[0].placeholder||null===n[0].placeholder,n.remove(),this._addedData.length=0,this.options.source=this.options.source||this.options.list,this._getSharedUserList(),this.setSource(this.options.source)},_getSharedUserList:function(){this._userDetails=this.options.source,this._imageURL=this.options.imageURL,this._defaultCheck||this._createMainContainer(),this._defaultCheck=!0},getData:function(){return this._tokenElement.ztokens("getData")},setValue:function(t){if(t&&"undefined"!=typeof t){var e=t;if("string"==typeof t&&(e=t.split(",")),e.length&&"string"==typeof e[0])for(var n=0;n<e.length;n++)emailValue=e[n].trim(),emailValue.length&&this.addToken({name:emailValue,id:emailValue,email:emailValue,type:"email"},!this._emailRegx.test(emailValue));this.options.sortable&&this._initSortable()}},_initSortable:function(){var t=this;this._tokenElement.sortable({items:"div:not(.ui-ztokens-token-error)"}).off("sortupdate").on("sortupdate",function(e){t._triggerSelectEvent(e)}),this._tokenElement.disableSelection()},_getPlaceHolderLabel:function(){return this.options.placeholder},setSource:function(e){this._userDetails=e,this.options.source=e,this._sourceData=this.options.source;var n=this;if("object"==typeof this.options.source)this._sourceData=function(e,o){var i=n._userDetails;i.sort(function(t,e){return t.name.toLowerCase()>e.name.toLowerCase()?1:t.name.toLowerCase()<e.name.toLowerCase()?-1:0});var a=t.grep(n._userDetails,function(e){return-1===t.inArray(e.email,n._addedData)}),s=t.ui.autocomplete.escapeRegex(e.term),r=new RegExp("^"+s,"i"),u=t.grep(a,function(t){return r.test(t.label||t.value||t)}),l=new RegExp(s,"i"),c=t.grep(a,function(e){return t.inArray(e,u)<0&&l.test(e.label||e.value||e)});o(u.concat(c))};else{this._cachedData=[],this._requestObj=void 0;var o=this.options.customData;this._sourceData=function(e,i){var a=e.term,s=n._checkStartsWith(a);if(""!==s){var r=n._cachedData[s];r.sort(function(t,e){return t.name.toLowerCase()>e.name.toLowerCase()?1:t.name.toLowerCase()<e.name.toLowerCase()?-1:0});var u=t.grep(n._userDetails,function(e){return-1===t.inArray(e.email,n._addedData)}),a=t.ui.autocomplete.escapeRegex(e.term),l=new RegExp("^"+a,"i"),c=t.grep(u,function(t){return l.test(t.label||t.value||t)}),h=new RegExp(a,"i"),p=t.grep(u,function(e){return t.inArray(e,c)<0&&h.test(e.label||e.value||e)});return void i(c.concat(p))}o[n.options.searchParamName]=a,this._requestObj&&(this._requestObj.abort(),this._requestObj=void 0),this._requestObj=t.ajax({type:"application/json",url:n.options.submitURL,data:o,success:function(t){n._cachedData[a]=t,i(t)}})}}this._refresh()},_checkStartsWith:function(t){if(t in baseObj._cachedData)return t;for(var e=baseObj._cachedData.length,n=0;e>n;n++){var o=baseObj._cachedData[n];if(t.length>0&&o.substring(0,t.length)===o)return t}return""},_createMainContainer:function(){var e=this;this._tokenElement.ztokens({htmlContent:!0,remove:function(t,n){if(e._tokenInput[0].disabled=!1,n.data&&n.data.email){var o=e._addedData.indexOf(n.data.email);o>-1&&e._addedData.splice(o,1)}e._tokenInput.trigger("focus"),e.options.source&&e.options.source.length&&e._tokenInput.autocomplete("close"),e._addedData.length||e._tokenInput.attr("placeholder",e._getPlaceHolderLabel()),e._triggerSelectEvent(t)}}).on("click",function(t){t.target===this&&e._tokenInput.trigger("focus")}),this.splitName=function(t){return t.split(",")[0]},this.addToken=function(n,o,i){if(n.name.trim().length&&-1===t.inArray(n.email,e._addedData)){var a="<span class='ui-zautosuggest-text'>"+this.splitName(n.name)+"</span>";o||(void 0!==this._imageURL&&(a+="<span class='ui-zautosuggest-img'><img src='"+e._getImage(n.id,n.type)+"' /></span>"),a="<span class='ui-zautosuggest-text'>"+this.splitName(n.name)+"</span>"),e._tokenElement.ztokens("addToken",a,n,o),o||e._addedData.push(n.email),e.element.scrollTop(e.element[0].scrollHeight),i!==!1&&e._tokenInput.trigger("focus")}},this._tokenInput=this._tokenElement.ztokens("getInputElement"),this._tokenInput[0].placeholder=this._getPlaceHolderLabel(),this._initTokensEvents()},_initTokensEvents:function(){var e=this;this._blurTimeout=void 0,this._tokenEvents=!0;var n=this._emailRegx,o=void 0,i=void 0,a=void 0;this._tokenInput.addClass("ui-zautosuggest-input").on("keyup.znotify",function(s){if(o=e._tokenInput.val().trim(),o&&("email"===e.options.searchType&&(s.which===t.ui.keyCode.ENTER||s.which===t.ui.keyCode.SPACE)||"email"!==e.options.searchType&&s.which===t.ui.keyCode.ENTER)){i=o.split(",");for(var r=0;r<i.length;r++)a=i[r].trim(),a.length&&e.addToken({name:a,id:a,email:a,type:"email"},!n.test(a));e._triggerSelectEvent(s),e._tokenInput.val("").trigger("focus"),e.options.sortable&&e._initSortable()}}).on("blur.znotify",function(t){e._blurTimeout=setTimeout(function(){if(o=e._tokenInput.val()){i=o.split(",");for(var s=0;s<i.length;s++)a=i[s].trim(),a.length&&e.addToken({name:a,id:a,email:a,type:"email"},!n.test(a),!1);e._tokenInput.val(""),e._triggerSelectEvent(t)}},200)})},_initKeydownEvent:function(){var e=this;this._tokenInput.on("keydown.znotify",function(n){e._tokenInput.autocomplete("enable"),e._tokenInput.val()||t(".ui-autocomplete.ui-widget:visible").length||37!==n.which&&39!==n.which&&40!==n.which&&46!==n.which&&8!==n.which||(40===n.which?e._tokenInput.autocomplete("search",""):(e._tokenInput.autocomplete("close"),e._tokenInput.autocomplete("disable")))})},_initAutoComplete:function(){function e(t,e,n){return n.replace(new RegExp(t,"i"),e)}var n=this;this._tokenInputHeight=void 0,"1.8.14"===t.ui.version&&this._tokenInput.on("autocompleteopen",function(){n._autoCompleteWidget.css("top",n._tokenInput.offset().top+n._tokenInputHeight)}).on("autocompletecreate",function(){n._autoCompleteWidget=n._tokenInput.autocomplete("widget"),n._tokenInputHeight=n._tokenInput.outerHeight()}).on("autocompleteclose",function(){n._autoCompleteWidget.css("margin-top","")}),this._tokenInput.autocomplete({autoFocus:!0,minLength:n.options.minLength,position:{my:"left-5 top",at:"left bottom+9",collision:"none"},source:n._sourceData,focus:function(){return!1},select:function(t,e){return n._blurTimeout&&clearTimeout(n._blurTimeout),n.addToken(e.item),n._triggerSelectEvent(t),n._tokenInput.val("").trigger("focus"),!1},response:function(){}}).data("autocomplete")._renderItem=function(o,i){o.addClass("ui-zautosuggest-autocomplete");var a=n._tokenInput.val(),s=void 0!==i.email?e(a,"<b style='color:#000'>"+a+"</b>",i.email):"",r="group"===i.type.toLowerCase()?"ui-group-name":"";return t("<li>").data("item.autocomplete",i).append("<a><img src='"+n._getImage(i.id,i.type)+"' /><span class="+r+">"+i.encodeName+"<br><span>"+s+"</span></span></a>").appendTo(o)},this._tokenInput.autocomplete("widget").on("mousedown.autosuggest",function(){n._resetTokenInputEvents()}).on("mouseup.autosuggest",function(){n._resetTokenInputEvents(),n._initTokensEvents()}),this._initKeydownEvent()},_resetTokenInputEvents:function(){this._tokenInput.off("keyup.znotify blur.znotify"),this._blurTimeout&&clearTimeout(this._blurTimeout)},_triggerSelectEvent:function(t){for(var e=this._tokenElement.ztokens("getData"),n=[],o=0;o<e.length;o++){var i=e[o];i&&i.email&&n.push(i.email)}var a={items:this._tokenElement.ztokens("getData"),value:n};this._triggerEvent(this._EVENTS.ONCHANGE,t,a)},_refresh:function(){this._tokenEvents||this._initTokensEvents(),(this._tokenInput.data("autocomplete")||this._tokenInput.data("ui-autocomplete"))&&this._tokenInput.off("keydown.znotify").autocomplete("destroy"),this.options.source&&this.options.source.length&&this._initAutoComplete()},refresh:function(){this._addedData.length=0,this._refresh(),this._tokenElement.ztokens("removeAllTokens"),this._tokenInput.val(""),this._triggerSelectEvent(void 0),this._tokenInput.attr("placeholder",this._getPlaceHolderLabel())},_getImage:function(t,e){e=e.toLowerCase(),"email"===e&&(t="abcd",e="");var n=this._imageURL+"/file?fs=thumb&ID="+t+"&t="+e;return n},_getString:function(e,n){if(t.i18n){var o=t.i18n(n?n:"zautosuggest",e);return o==="[noi18n] "+e&&(o=this.options.keys[e]),o}return this.options.keys[e]},_triggerEvent:function(t,e,n){return this._trigger(t,e,n)}};t.widget("ui.zautosuggest",e),t.ui.zautosuggest.config={keys:{"searchplaceholder.label":"Enter name"}}}(jQuery);window.onbeforeunload=function(){var e=isHighlightInvalidData;if(isCellEdited()||exprFieldKeyPressed)return jsMsg["ConfirmMsg.DocumetCloseCellEdit"];if(actionManager.isRequestAwaited())return jsMsg["ConfirmMsg.DocumetCloseRequestWait"];if(!SAVED&&jsREMOTE_SAVE_VIEW&&REMOTE.ISSAVEABLE)return jsMsg["confirmMsg.remoteDocSaveAndContinue"];if(jsVERSION_VIEW)t=workbookData.preActiveRow,o=workbookData.preActiveCol,s=workbookData.posBtm,a=workbookData.posLft,CURRSHEETNAME=workbookData.preSheetName;else var t=currRow,o=currCol,n=getXYPositions(),s=n.firstRow,a=n.firstCol;for(var r,i=workbooksheets.sheetcnt,d={},E=0;i>=E;E++)r=workbooksheets["sheet"+E],void 0!=r&&CURRSHEETNAME==r.sheetName&&(r.activeRowIndex=t,r.activeColIndex=o,r.activeERowIndex=t,r.activeEColIndex=o,r.positionBottom=s,r.positionLeft=a),d["sheet"+E]=r;var R=JSON.stringify(d);isFilterOptionsDIVOpened&&Filter.hideFilterOptions();var c="copyDoc="+copyDocument,p=new RequestParameters(ActionConstants.CLOSE_DOCUMENT);p.setParameters(CURRSHEETNAME,R,e);var C=new AjaxRequest;C.init("POST",p.getURL(),!1,p.getParametersAsString()),C.appendParams(c),C.addEventListener("onDisconnect",function(){}),C.addEventListener("onError",function(){}),C.sendRequest()},window.onunload=function(){if(!jsPUBLIC_VIEW){var e=new RequestParameters(ActionConstants.GET_WMS_USERS);if(navigator.sendBeacon){var t=new FormData;t.append("subaction","delete"),t.append("action",ActionConstants.CLOSE_DOCUMENT),t.append("zsreqcsr",readCookie(csrfCookieName)),WebMessanger.getRawSid()&&t.append("rsid",WebMessanger.getRawSid()),REMOTE.ISRMVIEW||t.append("rid",RESOURCE_ID),-1==zuid&&(t.append("RMNAME",RMUSER),t.append("doc",REMOTE_ENC_DOC_ID)),navigator.sendBeacon(e.getURL()+"?proxyURL=getwmsusers",t)}else{var o=new AjaxRequest;e.setParameters("delete"),o.init("POST",e.getURL(),!1,e.getParametersAsString()),o.sendRequest()}}appEvent.trigger("window.onunload")};