function resetglobalvariables(){FILE_FORMAT=null,DOCUMENT_VIEW="NEW_VIEW",COLOR_DIV_ID="bg_fill_div",jsVERSION_VIEW||(wmsCommErrorStatus=DOCUMENT_NAME=DOC_NAME=TAGLIST=currDocPanelId=currFocusFld=funcFocusFld=publicURL=SHEETNAMES=LOCKED_USER=deleteOptions=insertOptions=formatOptions=saveAsDialog=saveAsTemplateDialog=publishOptionsDialog=moreActionsDialog=DOCUMENT_NAME_URL=""),isErrorDoc=displayAll=DEFAULT_FILENAME_FLAG=isDocumentSemiPublic=doAutoSave=isEdit=isFuncDlgOpen=isStockConfigured=isDocumentPublic=IS_UNSAVED_SHEET=ALL_SHEET_SHARED=INSERT_SHEET_ALLOWED=ALLOW_TO_WRITE=READ_WRITE=DOCUMENT_LOCKED=jsREMOTE_SAVE_VIEW=jsVERSION_VIEW=jsTHROWAWAY_VIEW=jsREMOTE_VIEW=jsPUBLIC_VIEW=jsGUEST_VIEW=jsNEW_DOC_VIEW=jsOPEN_DOC_VIEW=jsSHARE_VIEW=jsTRASH_VIEW=INSERTIMAGE=fromGoTo=savingInProgress=isSheetLoading=PUBLIC_EDIT_MODE=jsEMBED_VIEW=hasOleMoved=allowOrgEdit=!1,panelOpenedFor=defineNameHTML=currentNamesListSPAN=ASSIGNEDTO=FOCUSSEDNAMEINPUTOBJECT="",wmsErrorMsgShown=!1,allowExportOrg=showFormulasOrg=allowExport=showFormulas=SAVED=DOC_SHARE_STATE=DOC_BASED_SHARE=savedFlag=OOLOADED=CANREADWRITE=!0,SHEETSWITCH=ENTEREDPERFCHECK=!1,SAVECHART="false",resetChartVars(),noOfUpdateRequestInProgress=0,loadoff(),getObj("htmlvalues").innerHTML="",getObj("htmlbackup").innerHTML="",versionDetailsNo=0,resetUNDO(),IMAGEOBJECT=XPOSITION=YPOSITION=lastSavedTime=null,getObj("waitmsg").style.display="none",CLONEIMAGE=!1,isEngineSupported=!1,WIDTHHEIGHTUNDO=!1,SHEET.FREEZE.resetVariables(),isRespondedInScroll=!0,availableStartRow=0,availableEndRow=-1,lastSavedTime=null,errorMsgShown=!1,errorInLoadObject=!1,documentBakeStatus.setRenderBake(!0),isAnyOnline=!1,ruleElem=null,colorElem=null,isReadOnlyViewMode=!1,fPainter.fPaintersingleclick=!1,fPainter.fPainterdoubleclick=!1,updatedSaveTime="",isCollabJoined=!1}function resetRTCvariables(){if(ENABLERTC){{getObj("sharedUserStatus")}getObj("chatLogs").innerHTML="",COLLABORATIVE_EDITING="OFF",RTCSHEETNAME=C_STARTROW=C_ENDROW=C_STARTCOL=C_ENDCOL=SHAREDUSERS=LISTOFCOLLABIDS="",SAVEDOC=RTC_EXISTS="false",ISSAMESHEET="true",SHAREDUSERSLIST=[],isCollabJoined=!1}}function resetChartVars(){HTMLCHARTINFO=[];for(var e in ExcelGraph._INSTANCES){var t=getObj(e);ExcelGraph.removeInstance(e),null!=t&&(t=null)}var s=getObj("chartLoadingDIV");"undefined"!=typeof s&&null!=s&&(s.innerHTML=""),availChartRange={}}function loadDocument(e){e==DOCUMENT_ID&&(e=RESOURCE_ID),document.location.href=ctxpath+"open/"+e}function collabopen(e,t,s,r,n,o){"false"==documentOpened&&e==COLLAB_DOCUMENT_ID&&openDoc1(e,t,s,r,n,o)}function deferLoadFiles(){isArray(scriptsToDownload)?scriptsToDownload.forEach(function(e){lazyLoad.JS(e)}):lazyLoad.JS(scriptsToDownload),isArray(stylesToDownload)?stylesToDownload.forEach(function(e){lazyLoad.CSS(e)}):lazyLoad.CSS(stylesToDownload),stylesToDownload=[],scriptsToDownload=[]}function loadDocumentObject(e,t,s,r,n,o,a,i){var l=new RequestParameters(ActionConstants.LOAD_BOOK),E=$("#mainOuterDiv");E&&mask.toolbar(!0,E);var d=!0;isPublished&&(d=!1);var h=getViewType();null===noExportV&&(noExportV=!1),null!=GDRIVEVIEW&&(isGDriveView=!0);var u={noprint:noPrintV,noexport:noExportV,hasWritePermission:HASWRITEPERMISSION,isCoOwner:ISCOOWNER,RemoteMode:REMOTEMODE,isDocShareRW:ISDOCSHARERW,isSheetBasedShare:ISSHEETBASEDSHARE,isDocOwner:ISDOCOWNER,gdriveView:GDRIVEVIEW,isCDView:ISCDVIEW,viewType:h,allowToLoadMenutab:d,isLoggedIn:isLoggedIn,pushFormat:pushFormat,allowToComment:ALLOW_TO_COMMENT},S=JSON.stringify(u);l.setParameters(DOCUMENT_REQUESTED_TIME,S),isNaN(e)||initServerCompLoadingActivities();var c=new AjaxRequest;c.init("POST",l.getURL(),!0,l.getParametersAsString()),c.addEventListener("onComplete",function(e){{var t=parseJSON(e.responseText);t.viewtype}if(t.a&&t.a==ActionConstants.SHOW_ERROR_MESSAGE)return void ErrorMsg.show(t);accLocale=t.workbook.accLocale;var s=t;return user.permissions=JSON.parse(t.permissions),HIDE_PUBLISH_OPTION=user.permissions.publish?!1:!0,deferLoadFiles(),userThousandSeparator=s.workbook.thousandSeparator,appEvent.trigger("documentLoad",[t]),e.status>=300?void errorAlert(e.status,e.statusText):(updateLoadObjectResponse(e.responseText,o,i),void((d||jsVERSION_VIEW)&&preprocessor.loadMenutab(t)))}),c.sendRequest()}function loadAfterLoadFiles(){if($("<div>").attr("id","HTMLTemplates").appendTo(document.body).load(ctxpath+"pages/afterload.jsp",function(){if(contextMenu.initContextMenu(),toolbarinited||($.ZToolbarHandler.init(["#toolbarContainer","#popupmenu","#versionview","#contextpopupmenus"]),toolbarinited=!1),!isPreview){var e={zmenu:"#rmenu, #sheettabrmenu, #filemenu"};$.ui.utils.initDeferredComponents(e,10)}appEvent.trigger("UI.Initialization.Done")}),-1===zuid&&!localStorage.getItem("isSignupPopupBlocked")&&(REMOTE.MODE===REMOTE.SCRATCHVIEW||REMOTE.MODE===REMOTE.EXCELVIEW)){var e=3e4;signupTriggerTimer=setTimeout(function(){showSignupDialog(),localStorage.setItem("isSignupPopupBlocked",!0)},e)}}function updateLoadObjectResponse(e,t){var s=JSON.parse(e),r=(s.docRequestedTime,s.DOCUMENT_ID);if(s.workbook&&(workbooksheets=s.workbook),!errorMsgShown)if(s.ERROR!=showErrorPanelMsg){documentBakeStatus.setObjectBake(!0);var n=JSON.parse(s.SHEETNAMES),o=n[0],a=n[1];if(WorkSheets.updateSheetNamesList(n),WorkSheets.updateAscActiveSheetName(),$("#sheetsTabContainer").length)for(i=0;i<o.length;i++){var l=o[i],E=SHEETNAMES_MAP[l],d=getObj(E);d&&d.setAttribute("id","sheetdiv-"+a[i])}documentBakeStatus.isBaked()&&postDocumentLoader(),docMetaDetails={},serverCompLoadedActivities(),tempPublicDocId=s.tempPublicDocId,isUndefined(tempPublicDocId)?(tempPublicDocId="",isInOOMode=!1):isInOOMode=!0,r==DOCUMENT_ID&&documentBakeStatus.isBaked()&&!t,t&&(editPublicDoc(!0,!0),stopLoadSheetObject())}else{message("","none"),errorMsgShown=!0;var h=getObj("waitmsg");if(h.style.display="none",isDocumentLoading=!1,jsPUBLIC_VIEW||jsGUEST_VIEW)handleServerError("ERROR",showErrorPanelMsg,!0);else if(errorInLoadObject=!0,-1!=s.MESSAGE.indexOf("Document.Parse.Error")){parseError=!0;var u=s.VIEW;DOCUMENT_ID=r,CURR_DOC_OWNERNAME=s.DOC_AUTHOR_NAME;var S=s.LAST_MODIFIED_TIME;S=isNaN(S)?null:parseInt(S);var c=s.HASVERSION;DOCUMENT_NAME=s.DOCUMENT_NAME,null!=$("#fileName")&&$("#fileName").text(DOCUMENT_NAME);var g="<a href='mailto:"+jsMsg.SupportMailId+"'>"+jsMsg.SupportMailId+"</a>";if(cdview&&c&&ALLOW_TO_WRITE){var O=returnTimeElaspsedinString(s.CURRENTTIME,S),T=getI18NLastSavedMsg(O.unit,O.count);errMsg=replaceParams(jsMsg["Document.Parse.Error.LastSavedTime"],new Array("<a href='#' onclick='AuditTrail.revertVersion(0)'>","</a>",T))}else if("SHARE_VIEW"==u)errMsg=replaceParams(jsMsg["ShareView.Document.Parse.Error"],new Array("<a href='#' onclick='notifySharedUsers(false)'>","</a>",g)),jsSHARE_VIEW=!0;else if("OPEN_VIEW"==u)if(ALL_SHEET_SHARED=!0,c){var O=returnTimeElaspsedinString(s.CURRENTTIME,S),f="";-1!=O.unit.indexOf("second")?f=jsMsg["Document.Parse.Error.LastSavedTimeinSeconds"]:"minutes"==O.unit?f=jsMsg["Document.Parse.Error.LastSavedTimeinMinutes"]:"hours"==O.unit?f=jsMsg["Document.Parse.Error.LastSavedTimeinHours"]:"days"==O.unit&&(f=jsMsg["Document.Parse.Error.LastSavedTimeinDays"]),errMsg=replaceParams(f,new Array("<a href='#' onclick='AuditTrail.revertVersion(0)'>","</a>",O.count,"<a href='#' onclick='AuditTrail.showVersionHistory()'>","</a>",g))}else errMsg=replaceParams(jsMsg["Document.Parse.Error.WithoutVersion"],new Array(g));return void handleServerError("ERROR",errMsg,!0)}}}function maskSheet(){if(!documentBakeStatus.isBaked()&&!jsPUBLIC_VIEW){errorDocMenutab(),getObj("Tv").readOnly=!0;var e=getObj("Trc");null!=e&&(e.readOnly=!0);var t=getObj("cF");if(null!=t&&(t.readOnly=!0),!jsTRASH_VIEW){getObj("waitmsg")}}}function unMaskSheet(){if(documentBakeStatus.isBaked()&&REMOTE.ISEDITABLE){errorMsgShown||errorDocMenutab("enable"),getObj("Tv").readOnly=!1;var e=getObj("Trc");null!=e&&(e.readOnly=!1);var t=getObj("cF");null!=t&&(t.readOnly=!1),message("","none"),toggleUNDO(),toggleREDO()}else(jsREMOTE_VIEW||jsPUBLIC_VIEW||jsVERSION_VIEW)&&(message("","none"),errorDocMenutab("enable"))}function openDocument(e){if(errorInLoadObject)return errorInLoadObject=!1,void message("","none");message(jsMsg.Loading,"none");var t=e.responseText;if("INVALID_VERSION"==t)return void showAlertDialog(jsMsg["Version.ViewVersionConflict"]);var s=t.substring(t.indexOf("<script>dataResponse=")+21,t.length-1);dataResponse=s.substring(0,s.indexOf("</script>"));var r=t.indexOf("<script>")+8,n=t.indexOf("</script>"),o=t.substring(r,n);if("null"==o||o==VIEW_REQUESTED_TIME){BACKUPCOLLABID=COLLAB_ID,IMPORTACC="0",getObj("widgetDIV").innerHTML=getOnlyHtml(e),isEditorClosed=!1,resetglobalvariables(),"undefined"!=typeof ole&&ole.reset(),Filter.clear(),populateValues(),scrollSheetTabToView(WorkSheets.getAssociatedActiveSheetName()),updateDocTitle(DOCUMENT_NAME),isDocumentLoading=!1,DOCUMENT_LOCKED&&!ENABLERTC&&(-1!=LOCKED_USER.indexOf(".")&&(LOCKED_USER=LOCKED_USER.substring(0,LOCKED_USER.indexOf("."))),showAlertDialog(replaceParams(jsMsg.CannotModifyAlert,new Array(LOCKED_USER)))),isDocumentPublic?constructpublicurl():removePublicUrl();var a=t.indexOf("<script>filterM");if(-1!==a){var i=t.substring(a+23,t.indexOf("</script>",a+23));"null"!==i.trim()&&(filterMetaInfo=JSON.parse(i),filterMetaInfo.isCriteriaApplied?Filter.create(CURRSHEETNAME,filterMetaInfo):filterMetaInfo=void 0)}if(btn_disabled(),assignInitialValues(),initSheet(ssServer,initSSWidth,initSSHeight,initCols,initRows,initColHeadHeight,initRowHeadWidth,initColWidth,initRowHeight,tablewidth,tableheight),$.ZToolbarHandler.init(["#versionview"]),disableToolBar(READ_WRITE),"doc_id"!=DOCUMENT_ID?maskSheet():serverCompLoadedActivities(!0),initBottomBand(),getCommentCalloutPropertyValues(),message("","none"),postDocumentLoader(),jsVERSION_VIEW&&(READ_WRITE=!1),"#FFFFFF"!=BACKGROUNDCOLOR&&""!=BACKGROUNDCOLOR&&(getObj("bg_fill_div").style.backgroundColor=BACKGROUNDCOLOR),""!==FONTCOLOR&&(getObj("text_color_div").style.backgroundColor=FONTCOLOR),isExprFieldExpanded&&expandExprField(),SET_LASTEDITED_DOCID&&"doc_id"!=DOCUMENT_ID){var l=document.domain;l=l.substring(l.indexOf(".")+1,l.length),set_cookie("ZS_DID",DOCUMENT_ID,null,null,l)}}}function populateValues(){for(var e=getObj("widgethiddenDIV"),t=e.childNodes,s=new Array(t.length),r=0,n=0;n<t.length;n++){var o=t[n];"INPUT"==o.tagName&&(s[r]=o.value,r++)}var a=s[0],i=s[1],l=s[2],E=s[3],d=s[4],h=s[5],u=s[6],S=s[7],c=s[8],g=s[9],O=s[10],T=s[11],f=s[12],m=s[13],R=(s[14],s[15]),v=s[16],I=s[17],C=s[18],p=s[19],A=s[20],D=s[21],N=s[22],M=s[23],_=s[24],b=s[25],L=s[26],W=s[27],w=s[28],V=s[30],j=s[31],P=s[33],U=s[34],H=s[35],y=s[36],k=s[37],B=s[38],x=(s[39],s[40],s[41]),F=(s[42],s[43],s[44],s[45]),G=s[46],q=s[47],X=s[49],z=s[50],J=s[51],K=s[52],Y=s[54],Z=s[55],Q=s[56],et=s[57],tt=s[58],st=s[59],rt=s[60],nt=getObj("sheethiddenDIV2");if(null!=nt){var t=nt.childNodes,ot=new Array(5);r=0;for(var n=0;n<t.length;n++){var o=t[n];if("INPUT"==o.tagName&&(ot[r]=o.value,r++),5==r)break}var at=ot[1],it=ot[2],lt=ot[3],Et=ot[4],dt=ot[0]}if("undefined"!=m&&"null"!=m){var ht=getServerPath();publicURL=ht+ctxpath+"published.do?rid="+RESOURCE_ID}if(null!=a&&(DOCUMENT_VIEW=a,identifyView()),null!=i&&(DOCUMENT_LOCKED=!1,"true"==i&&(DOCUMENT_LOCKED=!0)),null!=l&&(LOCKED_USER=l),null!=E&&(DOCUMENT_ID=E),null!=d&&(DOCUMENT_NAME=DOC_NAME=replaceSplChrs(d)),null!=h&&(CURRSHEETNAME=h),null!=u&&(TOTALSHEETS=u),null!=c&&(window.ALLOW_TO_WRITE=!1,"true"==c&&(window.ALLOW_TO_WRITE=!0)),null!=q&&(isSheetBasedShare=!1,"true"==q&&(isSheetBasedShare=!0)),wmsCommErrorStatus="true"==X&&ALLOW_TO_WRITE?"true":"false","true"==z&&(jsEMBED_VIEW=!0),"true"==J&&(isDocContainsArrayFormula=!0),null!=S&&(READ_WRITE=!1,"true"==wmsCommErrorStatus||jsTRASH_VIEW||jsSHARE_VIEW&&isSheetBasedShare&&!ALLOW_TO_WRITE||jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE?READ_WRITE=!1:"true"==S&&(READ_WRITE=!0)),null!=g&&(isDocumentPublic=!1,"true"==g&&(isDocumentPublic=!0)),null!=T&&("doc_id"===DOCUMENT_ID||jsVERSION_VIEW?CURRENTTIME=T:"true"===Y?CURRENTTIME=T:"false"!==Y&&"null"!==Y||documentBakeStatus.isBaked()||(CURRENTTIME=T)),null!=f&&(HTMLVIEW=!1,"true"==f&&(HTMLVIEW=!0)),null!=O&&(ALL_SHEET_SHARED=!1,"true"==O&&(ALL_SHEET_SHARED=!0)),null!=p&&(window.IS_REVERT_ALLOWED=!1,"true"==p&&(window.IS_REVERT_ALLOWED=!0)),null!=R&&(CURR_DOC_OWNERNAME=R),null!=at&&(initSSWidth=at),null!=it&&(initSSHeight=it),null!=lt&&(initColHeadHeight=lt),null!=Et&&(initRowHeadWidth=Et),null!=dt&&(ssServer=dt),jsSHARE_VIEW&&(isVersionPending=!0),null!=v&&(isDocumentSemiPublic=!1,"true"==v&&(isDocumentSemiPublic=!0)),null!=I&&(isEdit=!1,"true"==I&&(isEdit=!0)),null!=C&&(isStockConfigured=C),null!=A&&(DO_INDEX_SEARCH="true"==A?!0:!1),browser_ie&&DOCUMENT_NAME.indexOf("'")>-1&&$("#fileName")&&$("#fileName").text(DOCUMENT_NAME),null!=D&&(DOCUMENT_NAME_URL=D),null!=N&&(CURR_THEME=N),null!=M&&(DEFAULT_THEME=M),null!=_&&(USE_COMPRESSION="true"==_?!0:!1),null!=b&&(STYLE_PATH=b),null!=L&&(BUILD_VERSION=L),null!=W&&(OOLOADED="true"==W?!0:!1),null!=w&&(CANREADWRITE="true"==w?!0:!1),null!=V&&(allowExport=!1,"true"==V&&(allowExport=!0)),null!=j&&(showFormulas=!1,"true"==j&&(showFormulas=!0)),null!=P&&(INSERT_SHEET_ALLOWED=!1,"true"==P&&(INSERT_SHEET_ALLOWED=!0)),showPublic=null!=U&&"false"==U?!1:!0,showFormulasOrg=null!=H&&"false"==H?!1:!0,allowExportOrg=null!=y&&"false"==y?!1:!0,allowExportPublic=null!=k&&"false"==k?!1:!0,displayAll=null!=B&&"true"==B?!0:!1,null!=x&&(isEngineSupported=!1,"true"==x&&(isEngineSupported=!0)),null!=F){var ut=F;"COL"==ut?isColsOnlyFreezed=!0:"ROW"==ut?isRowsOnlyFreezed=!0:"ALL"==ut&&(isColsAndRowsFreezed=!0)}null!=G&&(FILE_FORMAT=G),allowOrgEdit=null!=K&&"true"==K?!0:!1,cursor_Row_Index="null"==Y?0:parseInt(Y),cursor_Col_Index="null"==Z?0:parseInt(Z),position_Bottom="null"==Q?0:parseInt(Q),position_Left="null"==et?0:parseInt(et),null!=tt&&(currUserColor=tt),USERPRESENCE_COLORS=st.substring(1,st.length-1).split(", ");var St="show_doc_";try{0==currSBItemNum&&(St="show_search_doc_")}catch(e){}try{var ct=getObj(St+DOCUMENT_ID);if(""==PREV_DOCUMENT_ID)PREV_DOCUMENT_ID=DOCUMENT_ID;else if(PREV_DOCUMENT_ID!=DOCUMENT_ID){var gt=getObj(St+PREV_DOCUMENT_ID);gt&&(gt.className=""),PREV_DOCUMENT_ID=DOCUMENT_ID}ct&&(ct.className="selected")}catch(e){PREV_DOCUMENT_ID=DOCUMENT_ID}ALLOW_TO_COMMENT=null!=rt&&"true"==rt?!0:!1}function generateTags(){}function identifyView(){"NEW_VIEW"==DOCUMENT_VIEW&&(jsNEW_DOC_VIEW=!0,DEFAULT_FILENAME_FLAG=!0),"OPEN_VIEW"==DOCUMENT_VIEW&&(jsOPEN_DOC_VIEW=!0),"SHARE_VIEW"==DOCUMENT_VIEW&&(jsSHARE_VIEW=!0),"TRASH_VIEW"==DOCUMENT_VIEW&&(jsTRASH_VIEW=!0),"GUEST_VIEW"==DOCUMENT_VIEW&&(jsGUEST_VIEW=!0),"PUBLIC_VIEW"==DOCUMENT_VIEW&&(jsPUBLIC_VIEW=!0),("THROWAWAY_VIEW"==DOCUMENT_VIEW||REMOTE.MODE===REMOTE.SCRATCHVIEW)&&(jsTHROWAWAY_VIEW=!0),"REMOTE_VIEW"==DOCUMENT_VIEW&&(jsREMOTE_VIEW=!0),"VERSION_VIEW"==DOCUMENT_VIEW&&(jsVERSION_VIEW=!0),"REMOTE_SAVE_VIEW"==DOCUMENT_VIEW&&(jsREMOTE_SAVE_VIEW=!0)}function constructpublicurl(){var e=getServerPath();publicURL=e+ctxpath+"published.do?rid="+RESOURCE_ID}function removePublicUrl(){}function showsheet(e,t,s,r,n){if("string"==typeof e&&(e=getObj(e)),jsVERSION_VIEW||(focusRemembering.setWorkbookData(),workbookData.switchSheet=!0),documentBakeStatus.isBaked()||(maskSheet(),initServerCompLoadingActivities(!0)),appEvent.trigger("book.onbeforesheetswitch",[CURRSHEETNAME]),isSheetLoading=!0,!jsSHARE_VIEW||null!=e){var o=CURRSHEETNAME,a=e?e.getAttribute("sheetname"):"",i=WorkSheets.getSheetObjByName(CURRSHEETNAME),l=WorkSheets.getSheetObjByName(a);i&&(a!==CURRSHEETNAME?($($(i).children()).css("cursor","pointer"),$($(l).children()).css("cursor","default")):$($(l).children()).css("cursor","default"));if((o!=a||void 0!=n)&&(hasOleMoved||resetChartVars(),SHEET.FREEZE.resetVariables()),sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BACKGROUND"}),CURRSHEETNAME=a,sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BORDER"}),WorkSheets.updateAscActiveSheetName(),o!=CURRSHEETNAME||void 0!=n){scrollSheetTabToView(WorkSheets.getAssociatedActiveSheetName()),"undefined"==typeof r&&message(jsMsg.Loading,"block","...");var E=getObj("html-"+CURRSHEETNAME);null!=E&&null!=DOCUMENT_ID&&"doc_id"!=DOCUMENT_ID&&"OFF"==COLLABORATIVE_EDITING&&""==COLLAB_ID?(isSSActive=!0,sheetHTML=replaceHTML(E.value),getObj("sheetdiv").innerHTML=sheetHTML,HTMLVIEW=!0,sheetDefault()):jsREMOTE_SAVE_VIEW||jsPUBLIC_VIEW&&!showFormulas?(HTMLVIEW=!1,sheetopen(t)):sheetopen(t)}}}function sheetopen(e,t){isFilterOptionsDIVOpened&&Filter.hideFilterOptions();var s=WorkSheets.getSheetObjByName(CURRSHEETNAME);s&&$($(s).children()).css("cursor","default");var r,n,o,a=new RequestParameters(ActionConstants.LOAD_SHEET);a.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,getViewType(),getSheetHeight(),getSheetWidth(),n,o,r);var i=new AjaxRequest;i.init("POST",a.getURL(),!0,a.getParametersAsString()),i.sendRequest(),i.addEventListener("onComplete",function(s){openSheet(s,e),t&&insertImage.loadSheetImages()})}function versionSheetopen(e){if(e&&e!=CURRSHEETNAME){appEvent.trigger("book.onbeforesheetswitch",[CURRSHEETNAME]),jsVERSION_VIEW||(focusRemembering.setWorkbookData(),workbookData.switchSheet=!0),sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BACKGROUND"}),CURRSHEETNAME=e,WorkSheets.updateAscActiveSheetName(),sheetTabBgColor.updateSheetTabColors({SHEETNAME:CURRSHEETNAME,TYPE:"BORDER"}),message(jsMsg.Loading,"block","..."),SHEET.FREEZE.resetVariables();var t=jsVERSION_VIEW&&""==DOCUMENT_VERSION?!0:void 0,s=new RequestParameters(ActionConstants.LOAD_SHEET);s.setParameters(WorkSheets.getAssociatedActiveSheetName(),null,getViewType(),getSheetHeight(),getSheetWidth(),null,null,null,t);var r=new AjaxRequest;r.init("POST",s.getURL(),!0,s.getParametersAsString()),r.addEventListener("onComplete",function(e){openVersionSheet(e)}),r.sendRequest()}}function openVersionSheet(e,t){openSheet(e,t),AuditTrail.showViewPortVersionChanges()}function openSheet(e){(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&chartOnLoad.removeSheetCharts(WorkSheets.getAssociatedActiveSheetName()),focusRemembering.localFromGoto=Goto.isPreventDefault(),Filter.hasFilter=!1,"undefined"!=typeof ole&&ole.reset(),Filter.clear();var t=getObj("tfr");t&&(t.innerHTML="");var s=e.responseText;if(sheetHTML=getOnlyHtml(s),sheetHTML==showErrorPanelMsg)return handleServerError("ERROR",sheetHTML,!0),void message("","none");var r=s.substring(s.indexOf("<script>dataResponse=")+21,s.length-1);dataResponse=r.substring(0,r.indexOf("</script>"));var n=s.indexOf("<script>filterM");if(-1!==n){var o=s.substring(n+23,s.indexOf("</script>",n+23));"null"!==o.trim()&&(filterMetaInfo=JSON.parse(o),filterMetaInfo.isCriteriaApplied?Filter.create(CURRSHEETNAME,filterMetaInfo):filterMetaInfo=void 0)}var a=sheetHTML.indexOf("<!--"),i=sheetHTML.indexOf("-->"),l="",E="";if(-1==sheetHTML.indexOf('<!-- [{"REPORT_ID":')&&-1!=a&&-1!=i){var r=sheetHTML.substring(a+4,i),d=JSON.parse(r),h=d[0];if(l=h.DOCUMENT_ID,E=h.SHEETNAME,l==DOCUMENT_ID&&E==CURRSHEETNAME){isSSActive=!0;var u=getObj("sheetdiv");if(browser_nn6){var S=u.offsetHeight;u.style.height=S+"px",u.style.overflow="hidden"}u.innerHTML=sheetHTML,sheetDefault(),browser_nn6&&(u.style.height="",u.style.overflow="")}}appEvent.trigger("book.onaftersheetswitch",[CURRSHEETNAME]),cursorchange()}function setSheetDivDefaultHeight(){if(browser_ie)var e=document.body.clientHeight;else if(browser_nn4||browser_nn6)var e=window.innerHeight;var t=e-findPosY(getObj("sheetdiv"))-getObj("bottomBand").offsetHeight,s=document.createElement("div");s.innerHTML="&nbsp;",s.style.height=t+"px";var r=getObj("sheetdiv");r.appendChild(s)}function insertSheet(e,t,s){if(!isServerComponentLoaded(!0))return!1;if(!(isErrorDoc||GoalSeek.dialog||Solver.dialog)&&documentBakeStatus.isBaked()){"undefined"==typeof s&&(s="false");var r="false";if("undefined"==typeof e){r="false",sheetdialog.close();var n=currSheetOnRightClick;""==n&&(n=CURRSHEETNAME)}else if("undefined"==typeof t){r="true";for(var o=getObj("sheetsTab").getElementsByTagName("TD"),a=0;a<o.length-1;a++)if("TD"==o[a].tagName){var n=o[a].getAttribute("sheetname");break}}else r=e,n=t;var i=document.createElement("TD");if(i.setAttribute("context","sheettabrmenu"),("undefined"==typeof t||t==CURRSHEETNAME)&&"false"==s){var l=WorkSheets.getSheetObjByName(CURRSHEETNAME);l.removeClass("selected")}if(i.onmousedown=function(e){return reorderSheet(e,this)},n=WorkSheets.getSheetCodeFromName(n),void 0!=n){var E=new RequestParameters(ActionConstants.SHEET_INSERT);E.setParameters(n,r,!1);var d=new AjaxRequest;d.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(d),IS_UNSAVED_SHEET=!0}}}function deleteSheet(e,t){if(documentBakeStatus.isBaked()){"undefined"==typeof t&&(t="false");if("undefined"==typeof e)var s=currSheetOnRightClick;else s=e;if(1==ProtectedRanges.getObject().hasProtectedSheet(s))return void alert(jsMsg["ProtectedSheet.alert.DeleteSheet"]);{var r=getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(s));r.parentNode}if(sheetdialog.close(),1>=TOTALSHEETS)return void(jsSHARE_VIEW&&"true"==t?loadDocument("ajaxnew.do"):showAlertDialog(jsMsg.documentMustContainAtleastOneSheet));var n=WorkSheets.getSheetCodeFromName(currSheetOnRightClick);if("undefined"==typeof e){if(FormObj.instances[n]){if(CURR_DOC_OWNERNAME===LOGINNAME){var o={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){deleteSheet(s),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};return sheetdialog.showConfirmDialog(jsMsg["Form.DeleteMessage.WhileDeletingSheet"],o),!1}return void showAlertDialog(jsMsg["Form.DeleteMessage.SharedUser.WhileDeletingSheet"])}var o={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){deleteSheet(s),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]},a=0;return sheetdialog.showConfirmDialog((a=Discussion.hasComments(s))?replaceParams(jsMsg["Discussion.DeleteCommentsOnSheet"],new Array(a+"")):jsMsg.TheSelectedSheetDeletedPermanently,o),!1}if(s=WorkSheets.getSheetCodeFromName(s),void 0!==s){documentBakeStatus.setRenderBake(!1);var i=new RequestParameters(ActionConstants.SHEET_REMOVE),l=void 0===WebForm.formRid?void 0:encodeURIComponent(WebForm.formRid);i.setParameters(s,l);var E=new AjaxRequest;E.init("POST",i.getURL(),!0,i.getParametersAsString()),actionManager.addRequest(E),ClipObject.checkIsServerClipSourceSheet(currSheetOnRightClick)}}}function showSheetRenameDialog(){if(isErrorDoc||!isServerComponentLoaded(!0)||!ALLOW_TO_WRITE&&REMOTE.MODE!==REMOTE.EXCELVIEW&&REMOTE.MODE!==REMOTE.SCRATCHVIEW)return!1;if(featurePermission.getPermission("hidesheetTabMenu"))return!1;var e=currSheetOnRightClick;if(1==ProtectedRanges.getObject().hasProtectedSheet(e))return void alert(jsMsg["ProtectedSheet.alert.RenameSheet"]);var t="<div class='divSpacing'>"+jsMsg.EnterSheetName+" :</div> <div><input type='text' id='newShName' value='"+e+"' maxlength='31' onkeydown='submitFuction(event,renameSheet);' style='width:250px' ></div>",s={width:300,modal:!0,title:jsMsg.Rename,buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){renameSheet()}},{text:jsMsg.Cancel,click:function(){sheetdialog.close()}}]};sheetdialog.open(t,s),setTimeout(function(){$("#newShName").focus(),$("#newShName").select()},400)}function renameSheet(e,t,s){if("undefined"==typeof s&&(s="false"),"undefined"==typeof e)var r=currSheetOnRightClick,n=(getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(r)),r),o=$("#newShName").val();else var r=e,n=r,o=t;if(n==o)return void sheetdialog.close();if(!o||0===o.trim().length)return void showAlertDialog(jsMsg["Rename.SheetNameCannotBeEmpty"]);if(o=o.trim(),WorkSheets.isNameExists(o,!0))return void showAlertDialog(jsMsg["Error.Sheet.Name.Exists"]);if(checkSheetName(o))return void showAlertDialog(jsMsg.SheetNameShouldContain);var a=new RequestParameters(ActionConstants.SHEET_RENAME);a.setParameters(n,o,WorkSheets.getSheetCodeFromName(CURRSHEETNAME));var i=new AjaxRequest;i.init("POST",a.getURL(),!0,a.getParametersAsString()),actionManager.addRequest(i),sheetdialog.close(),ClipObject.checkIsServerClipSourceSheet(CURRSHEETNAME)}function checkSheetName(e,t){if("Cell Reference"==t){var s=new RegExp("^[a-zA-Z0-9_\\u00A1-\\uFFFF!:]+$");return!s.test(e)}if("Define Name"==t){var s=new RegExp("^[a-zA-Z0-9_\\u00A1-\\uFFFF]+$");return!s.test(e)}var s=new RegExp("^[a-zA-Z0-9_ \\u00A1-\\uFFFF\\-]+$");return!s.test(e)}function reorderSheet(e,t){if(isSheetsTabDblClicked)return isSheetsTabDblClicked=!1,currSheetOnRightClick=t.getAttribute("sheetname"),void showSheetRenameDialog();isSheetsTabDblClicked=!0,setTimeout(function(){isSheetsTabDblClicked=!1},350);var s=Chart.container[WorkSheets.getAssociatedActiveSheetName()];if(s)for(var r in s)for(var n in s[r])"function"!=typeof s&&"string"==typeof s[r][n]&&"function"!==s[r]&&$("#"+s[r].id).css("z-index")>103&&$("#"+s[r].id).css("z-index",BASEZINDEX+103);if((!isErrorDoc||allowSheetSwitch)&&2!=e.button){if(isSheetPre)return!1;if(isSheetPre=!0,1==sheetOnMove)endReorderSheet();else{sheetOnMove=!0,currSheetOnMove=t;for(var o=getObj("sheetsTab").getElementsByTagName("TD"),n=0;n<o.length-1;n++)if(o[n]==currSheetOnMove){currSheetOnMoveIdx=n;break}var a=currSheetOnMove.getAttribute("sheetname"),i=WorkSheets.getSheetObjByName(a);i&&$($(i).children()).css("cursor","move"),movingSheet=document.createElement("div"),movingSheet.className="sheetsTab",movingSheet.style.position="absolute",RTLlang?browser_ie||browser_ff3?(movingSheet.style.right=getOffsetRight(t)-getSheetTabScroll()+1+"px",movingSheet.style.top=findPosY(t)+"px"):(movingSheet.style.right=getOffsetRight(t)-getSheetTabScroll()+"px",movingSheet.style.top=findPosY(t)-1+"px"):browser_ie||browser_ff3?(movingSheet.style.left=findPosX(t)-getSheetTabScroll()+1+"px",movingSheet.style.top=findPosY(t)+"px"):(movingSheet.style.left=findPosX(t)-getSheetTabScroll()+"px",movingSheet.style.top=findPosY(t)-1+"px");var l=UTIL.DOM.getOuterHTML(t);movingSheet.innerHTML="<table cellpadding='0' cellspacing='0'><tr>"+l+"</tr></table>",document.body.appendChild(movingSheet),currSheetOnMove.style.visibility="hidden",sheetTransPosCnt=0,sheetTransX=null,"undefined"!=typeof sheetTransIntvl&&window.clearInterval(sheetTransIntvl),movingSheetDiffX=RTLlang?clientDim.width-e.pageX-parseInt(movingSheet.style.right):e.pageX-parseInt(movingSheet.style.left),window.addEventListener("mousemove",doReorderSheet,!1),window.addEventListener("mouseup",endReorderSheet,!1),ole.getCurrObj()&&$("#"+ole.getCurrObj().id).css("z-index",BASEZINDEX+101)}}}function doReorderSheet(e){if(isServerComponentLoaded()){if(INSERT_SHEET_ALLOWED)return!1;if(clearTextSelection(),browser_ie)var t=RTLlang?clientDim.width-window.event.clientX-movingSheetDiffX+document.body.scrollLeft:window.event.clientX-movingSheetDiffX+document.body.scrollLeft;else if(browser_nn6)var t=RTLlang?clientDim.width-e.pageX-movingSheetDiffX:e.pageX-movingSheetDiffX;var s=getObj("sheetsTab"),r=($("#sheetsTabNavBar"),RTLlang?getOffsetRight(s):findPosX(s)),n=s.offsetWidth-currSheetOnMove.offsetWidth;if(r>t?scrollSheets("left"):t>n?scrollSheets("right"):(scrollSheetMouseUp("left"),scrollSheetMouseUp("right")),t<r+s.offsetWidth){movingSheet.style[RTLlang?"right":"left"]=t+"px";for(var o=(t+movingSheet.offsetWidth/2,t+movingSheet.offsetWidth),a=s.getElementsByTagName("TD"),i=0;i<a.length-1;i++){var l=a[i],E=RTLlang?getOffsetRight(l)-getSheetTabScroll():findPosX(l)-getSheetTabScroll(),d=E,h=E+l.offsetWidth/2,u=E+l.offsetWidth;if(t+getSheetTabScroll()<(RTLlang?getOffsetRight(currSheetOnMove):findPosX(currSheetOnMove))){if(t>=d&&h>=t){l.parentNode.insertBefore(currSheetOnMove,l);break}}else if(o>=h&&u>=o){l.parentNode.insertBefore(currSheetOnMove,a[i+1]);break}}}}}function endReorderSheet(){for(var e=getObj("sheetsTab").getElementsByTagName("TD"),t=0;t<e.length-1;t++)if(e[t]==currSheetOnMove){var s=t;break}var r="false";"undefined"!=typeof s&&currSheetOnMoveIdx!=s&&updateSheetOrder(currSheetOnMove.getAttribute("sheetname"),s,r),sheetOnMove=!1,sheetTransX=[],RTLlang?sheetTransPath(parseInt(movingSheet.style.right)+getSheetTabScroll(),getOffsetRight(currSheetOnMove),-1*getSheetTabScroll()):sheetTransPath(parseInt(movingSheet.style.left)+getSheetTabScroll(),findPosX(currSheetOnMove),-1*getSheetTabScroll()),sheetTransPitStops=sheetTransX.length>10?(sheetTransX.length-1)/10:1,sheetTransPosCnt=0,sheetTransIntvl=window.setInterval(function(){placeReorderedSheet()},1),window.removeEventListener("mousemove",doReorderSheet,!1),window.removeEventListener("mouseup",endReorderSheet,!1),scrollSheetMouseUp("left"),scrollSheetMouseUp("right")}function sheetTransPath(e,t,s){for(var r,n=Math.sqrt((t-e)*(t-e)),o=(t-e)/n,a=0;n>a;a++)r=e+o,sheetTransX[a]=r+s,e=r;return sheetTransX}function placeReorderedSheet(){null!=sheetTransX&&(sheetTransPosCnt<sheetTransX.length-1?(movingSheet.style[RTLlang?"right":"left"]=sheetTransX[sheetTransPosCnt]+"px",sheetTransPosCnt+=Math.round(sheetTransPitStops)):(sheetTransPosCnt=0,sheetTransX=null,window.clearInterval(sheetTransIntvl),document.body.removeChild(movingSheet),movingSheet="",isSheetPre=!1,currSheetOnMove.style.visibility="",jsREMOTE_SAVE_VIEW&&CURRSHEETNAME!=currSheetOnMove.getAttribute("sheetname")&&message(jsMsg.Loading,"block","..."),showsheet(currSheetOnMove,"open"),currSheetOnMove=""))}function updateSheetOrder(e,t){if(e=WorkSheets.getSheetCodeFromName(e),void 0!=e){var s=new RequestParameters(ActionConstants.SHEET_MOVE);s.setParameters(e,t);var r=new AjaxRequest;r.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(r)}}function scrollSheets(e){var t=getObj("sheetsTab");"first"==e?$(t).animate({scrollLeft:0},600,"easeInOutCubic",function(){toggleSheetsTabNavButtons()}):"left"==e?(t.scrollLeft-=5,scrollSheetMouseUp(e),sheetsSLIntvl=window.setInterval(function(){t.scrollLeft-=5},1)):"right"==e?(t.scrollLeft+=5,scrollSheetMouseUp(e),sheetsSRIntvl=window.setInterval(function(){t.scrollLeft+=5},1)):$(t).animate({scrollLeft:t.scrollWidth-t.offsetWidth},600,"easeInOutCubic",function(){toggleSheetsTabNavButtons()})}function scrollSheetMouseUp(e){window.clearInterval("right"==e?sheetsSRIntvl:sheetsSLIntvl),toggleSheetsTabNavButtons()}function scrollSheetTabToView(e){if(!jsGADGET_VIEW){var t=getObj("sheetsTab"),s=t.offsetWidth,r=getObj("sheetdiv-"+e),n=r.offsetLeft,o=r.offsetWidth;if(n-t.scrollLeft<0)t.scrollLeft=s>n?0:n,toggleSheetsTabNavButtons();else if(n+o-t.scrollLeft>s){var a=n+o-s;t.scrollLeft=n>=t.scrollWidth-s?t.scrollWidth:a,toggleSheetsTabNavButtons()}}}function showSheetsPickList(){if(!(isErrorDoc||GoalSeek&&GoalSeek.dialog||Solver&&Solver.dialog||AuditTrail&&AuditTrail.isActionDetailOpen)){for(var e=[],t=CellUtils.getRequiredSheetNames().sheetNames,s=0;s<t.length;s++){var r=t[s],n="sheetdiv-"+WorkSheets.getSheetCodeFromName(r),o=jsVERSION_VIEW?"versionSheetopen":"showsheet",a=jsVERSION_VIEW?r:n+",open";e.push(r==CURRSHEETNAME?{data:"{label:'"+r+"', icon:'ui-individual-icon ui-icon-ztick', appData:{dynamic:true, callback: '"+o+"', arg:'"+a+"'} }"}:{data:"{label:'"+r+"', appData:{dynamic:true, callback: '"+o+"', arg:'"+a+"'} }"})}var i={target:$("#sheetsMenu"),clearcache:!0};sheetMenu.showMenu("sheetlistMenu",e,i);var l=$("#sheetlistMenu"),E=$("#sheetsMenu").offset().top,d=clientDim.height-E,h=$("#sheetlistMenu").height();h>E&&(h=E-10);{l.width()}if(l.css({top:"auto",bottom:d+"px",height:h+"px"}),jsVERSION_VIEW){var u=l.children().children(".ui-zmenu-text");Object.keys(AuditTrail.sheetCallOuts).forEach(function(e){u.each(function(t){if(e==$(u[t]).text()){var s=AuditTrail.sheetCallOuts[e]>1?jsMsg.edits:jsMsg.edit,r=replaceParams(jsMsg["AT.sheetTabCallOutMsg"],new Array(AuditTrail.sheetCallOuts[e],s)),n=$("<span/>",{title:r,class:"versionSheetCallOut"}).text(AuditTrail.sheetCallOuts[e]);n.appendTo($(u[t])),l.children().width("auto"),l.css("width","auto")}})})}}}function toggleSheetsTabNavBar(){var e=getObj("sheetsTab"),t=e.getElementsByTagName("TABLE")[0];t.offsetWidth<e.offsetWidth?(getObj("sheetsTabNavBar").style.visibility="hidden",e.scrollLeft=0):isEditorClosed||(getObj("sheetsTabNavBar").style.visibility="visible"),toggleSheetsTabNavButtons()}function toggleSheetsTabNavButtons(){var e=getObj("sheetsTab"),t=getObj("sheetsTabNavFirst"),s=getObj("sheetsTabNavPrev"),r=getObj("sheetsTabNavNext"),n=getObj("sheetsTabNavLast"),o=t.className,a=s.className,i=r.className,l=n.className;0==e.scrollLeft?(t.className+=" disabled",s.className+=" disabled",r.className=i.indexOf(" ")>-1?i.substring(0,i.indexOf(" ")):i,n.className=l.indexOf(" ")>-1?l.substring(0,l.indexOf(" ")):l):e.scrollLeft==e.scrollWidth-e.offsetWidth?(t.className=o.indexOf(" ")>-1?o.substring(0,o.indexOf(" ")):o,s.className=a.indexOf(" ")>-1?a.substring(0,a.indexOf(" ")):a,r.className+=" disabled",n.className+=" disabled"):(t.className=o.indexOf(" ")>-1?o.substring(0,o.indexOf(" ")):o,s.className=a.indexOf(" ")>-1?a.substring(0,a.indexOf(" ")):a,r.className=i.indexOf(" ")>-1?i.substring(0,i.indexOf(" ")):i,n.className=l.indexOf(" ")>-1?l.substring(0,l.indexOf(" ")):l)}function setSheetsTabDim(){var e=getObj("sheetsTab");if(null!=e){if(e.style.width=e.parentNode.offsetWidth+"px",toggleSheetsTabNavBar(),browser_ie){var t=getObj("sheetdiv-"+WorkSheets.getAssociatedActiveSheetName());null!=t&&(t.getElementsByTagName("DIV")[0].className="tabItem selected")}e=null}}function resetSheetsTabDim(){var e=getObj("sheetsTab");null!=e&&(e.style.width="1px",setSheetsTabDim(),e=null)}function getViewType(){var e="NEW_VIEW";return jsVERSION_VIEW?e="VERSION_VIEW":jsNEW_DOC_VIEW?e="NEW_VIEW":jsOPEN_DOC_VIEW?e="OPEN_VIEW":jsTHROWAWAY_VIEW?e="THROWAWAY_VIEW":jsPUBLIC_VIEW?e="PUBLIC_VIEW":jsGUEST_VIEW?e="GUEST_VIEW":jsSHARE_VIEW?e="SHARE_VIEW":jsTRASH_VIEW?e="TRASH_VIEW":jsREMOTE_SAVE_VIEW?e="REMOTE_SAVE_VIEW":jsREMOTE_VIEW&&(e="REMOTE_VIEW"),e}function assignInitialValues(){var e=getObj("sheethiddenDIV2");if(null!=e){var t=e.childNodes,s=new Array(t.length),r=0;try{for(var n=0;n<t.length;n++){var o=t[n];"INPUT"==o.tagName&&(s[r]=o.value,r++)}}catch(e){}var a=s[6],i=s[5],l=s[7],E=s[8],d=s[9],h=s[10],u=s[11],S=s[12],c=s[13],g=s[14],O=s[15],T=s[16],f=s[17],m=s[18],R=s[19],v=s[20],I=s[21],C=s[22],p=s[23],A=s[24];null!=a&&(initCols=parseInt(a)),null!=i&&(initRows=parseInt(i)),null!=l&&(initColWidth=parseInt(l)),null!=E&&(initRowHeight=parseInt(E)),null!=d&&(defCellStyleStr=d,defCellStyle=defCellStyleStr.split("-")),null!=h&&(defCellFormat=h),null!=u&&(defCellHolderProp=u),null!=S&&(tablewidth=S),null!=c&&(tableheight=c),null!=g&&(usedCursCol=parseInt(g)),null!=O&&(usedCursRow=parseInt(O)),null!=T&&(wholeValAsStringInArrFormt=T),null!=f&&(rowDetailStr=f),null!=m&&(colDetailStr=m),null!=R&&(colMergeDetailStr=R),null!=v&&(isSheetFreezed="true"==v||1==v?!0:!1,isSheetFreezed&&(fromOpenFreeze=!0)),null!=I&&(persistedFreezedRow=parseInt(I)),null!=C&&(persistedFreezedCol=parseInt(C)),p=JSON.parse(p),null!==p&&(READ_WRITE=!!p),A=JSON.parse(A),!ALLOW_TO_WRITE&&ALLOW_TO_COMMENT&&READ_WRITE&&(READ_WRITE=!1)}}function disableToolBar(e){jsPUBLIC_VIEW||jsGADGET_VIEW||e&&!documentBakeStatus.isBaked()||(e?(e&&!jsPUBLIC_VIEW&&null!=getObj("addSheetBtn")&&(getObj("addSheetBtn").style.visibility="visible"),getObj("readymsg").style.display="none",getObj("Tv").readOnly=!1,getObj("Trc").readOnly=!1):(!OOLOADED&&CANREADWRITE&&(null!=getObj("addSheetBtn")&&(getObj("addSheetBtn").style.visibility="hidden"),ENTEREDPERFCHECK=!0),getObj("Tv").readOnly=!0,getObj("Trc").readOnly=!0))}function removeSheets(e){var t=getObj("html-"+e),s=getObj("save-"+e);if(null!=t&&"null"!=t){var r=t.parentNode;r.removeChild(t)}if(null!=s&&"null"!=s){var r=s.parentNode;r.removeChild(s)}ProtectedRanges.getObject().onSheetDelete(e)}function renameSheets(e,t){var s=getObj("html-"+e),r=getObj("save-"+e);"object"==typeof s&&null!=s&&(s.id="html-"+t,s.name="html-"+t),"object"==typeof r&&null!=r&&(r.id="save-"+t,r.name="save-"+t);for(var n=1;n<=ExcelGraph._INSCOUNT;n++){var o=ExcelGraph.getInstance("ExcelGraph"+n);o&&e==o.CP_DOCUMENTSHEET_NAME&&(o.CP_DOCUMENTSHEET_NAME=t)}Filter.renameFilterInstance(e,t)}function getisSheetWritable(){return IPHONE_VIEW||jsVERSION_VIEW||jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE?void(READ_WRITE=!1):void(jsREMOTE_SAVE_VIEW&&(READ_WRITE=ISGEEDITOR&&!ALLOW_TO_WRITE?!1:!0))}function duplicatesheet(e,t,s,r,n,o){if(documentBakeStatus.isBaked()){var a=!0;"undefined"==typeof e&&(e=$("#sheetSelect").zcombo("getValue")),"undefined"==typeof r&&(r=currSheetOnRightClick),"undefined"==typeof s&&(s=getObj("newsheetname").value.trim(),null===s||""===s?(showAlertDialog(jsMsg["Rename.SheetNameCannotBeEmpty"]),a=!1):checkSheetName(s)?(showAlertDialog(jsMsg.AllowedSheetName),a=!1):s.length>31&&(showAlertDialog(jsMsg["Error.Sheet.Name.Length.Exceed"]),a=!1));var i=WorkSheets.isNameExists(s);if(i&&(showAlertDialog(jsMsg["Error.Sheet.Name.Exists"]),a=!1,getObj("newsheetname").focus()),a){if("AfterCurrentSheet"==e||"BeforeCurrentSheet"==e||"At First"==e||"At End"==e?(o=e,e=currSheetOnRightClick):o="After",r=WorkSheets.getSheetCodeFromName(r),void 0==r)return;documentBakeStatus.setRenderBake(!1);var l=$("#copyLocks").is(":checked"),E=new RequestParameters(ActionConstants.SHEET_COPY);E.setParameters(s,r,o,e,l);var d=new AjaxRequest;d.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(d),sheetdialog.close()}else getObj("newsheetname").focus()}}function sheetmovement(e,t,s){if("undefined"==typeof e)currentsheetname=getObj("onclicksheetname").value,r=$("#SelectedSheet").zcombo("getValue"),s=!1;else{currentsheetname=e;var r=""}var n=getObj("sheetsTab").getElementsByTagName("TD");if("undefined"==typeof t)if("-"==r){showAlertDialog(jsMsg.MoveProperLocation);var o="no";document.getElementById("SelectedSheet").focus()}else if("MoveStart"==r)t=0;else if("MoveEnd"==r)t=n.length-2;else for(var a=0;a<n.length-1;a++){var i=n[a].getAttribute("sheetname");i==r&&(t=a)}if("no"!=o){sheetdialog.close(),updateSheetOrder(currentsheetname,t,s),nextsheetname=n[t+1].getAttribute("sheetname");var l=document.getElementById("sheetdiv-"+WorkSheets.getSheetCodeFromName(currentsheetname));if("MoveEnd"==r||t==n.length-1)var E=document.getElementById("dummySheetTab");else if(null!=nextsheetname)var E=document.getElementById("sheetdiv-"+WorkSheets.getSheetCodeFromName(nextsheetname));l.parentNode.insertBefore(l,E)}}function closeDocumentInstance(e,t){if(!e||SAVED&&MACROSAVED&&!RECORDINGMACRO||!ALLOW_TO_WRITE){var s="curtime="+CURRENTTIME;jsPUBLIC_VIEW&&isInOOMode&&(s+="&tempPublicDocId="+tempPublicDocId),t&&""!=COLLAB_ID&&"null"!=COLLAB_ID&&(s+="&collabId="+COLLAB_ID,s+="&uname="+(jsREMOTE_SAVE_VIEW?RMUSER:zuid)),s+="&viewType="+getViewType()+"&docowner="+CURR_DOC_OWNERNAME+"&docId="+DOCUMENT_ID;var r=new RequestParameters(ActionConstants.CLOSE_DOCUMENT),n=isHighlightInvalidData;r.setParameters(n);var o=new AjaxRequest;o.init("POST",r.getURL(),!1,r.getParametersAsString()),o.sendRequest()}else checksaved("closeButton")}function documentLoadInit(){""!=COLLAB_ID&&"null"!=COLLAB_ID&&Collaboration.quit(COLLAB_ID),resetRTCvariables(),$.ZToolbarHandler.init(["#toolbarContainer","#popupmenu","#contextpopupmenus"]),toolbarinited=!1,getCommentCalloutPropertyValues()}function getI18NLastSavedMsg(e,t){var s="";return"seconds"==e?s=replaceParams(jsMsg.DurationInSeconds,new Array(t)):"minutes"==e?s=replaceParams(jsMsg.DurationInMinutes,new Array(t)):"hours"==e?s=replaceParams(jsMsg.DurationInHours,new Array(t)):"days"==e&&(s=replaceParams(jsMsg.DurationInDays,new Array(t))),s}function stopLoadSheetObject(){var e=new RequestParameters(ActionConstants.CLOSE_DOCUMENT),t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()}function postDocumentLoader(){return allowPostDocCall?(allowPostDocCall=!1,serverCompLoadedActivities(!1),sheetTabBgColor.getSheetTabColors(),postSheetLoader(ActionConstants.POST_DOC_LOAD),void appEvent.trigger("postDocumentLoader")):!1}function postSheetLoader(e,t,s){var r=!0,n=chartOnLoad.getSheetCharts(WorkSheets.getAssociatedActiveSheetName()),o=null;if(n&&(r=!1,chartOnLoad.renderSheetCharts(WorkSheets.getAssociatedActiveSheetName())),e===ActionConstants.POST_DOC_LOAD)pivot.Collection.reset(),filterIconsPane.innerHTML="",filterIconsPane1.innerHTML="",filterIconsPane2.innerHTML="",filterIconsPane3.innerHTML="";else if(o=chartOnLoad.getAffectInfo(WorkSheets.getAssociatedActiveSheetName()),o&&(o=o.isChartReaded),n||void 0!==o)if(Chart.affect[WorkSheets.getAssociatedActiveSheetName()]&&Chart.affect[WorkSheets.getAssociatedActiveSheetName()].chartId)if(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)r=!0;else{r=!1;var a=chartOnLoad.getAffectInfo(WorkSheets.getAssociatedActiveSheetName()).chartId;chartOnLoad.renderSheetCharts(WorkSheets.getAssociatedActiveSheetName())}else!n||Chart.affect[WorkSheets.getAssociatedActiveSheetName()]&&Chart.affect[WorkSheets.getAssociatedActiveSheetName()].chartId||(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?r=!0:(r=!1,chartOnLoad.renderSheetCharts(WorkSheets.getAssociatedActiveSheetName())));else r=!0;var i=new RequestParameters(e),l=jsVERSION_VIEW&&""==DOCUMENT_VERSION?!0:void 0;if(e===ActionConstants.POST_DOC_LOAD){var E=Row.getVisibleRowsInViewPortAsJSONStr(!1),d='[{"sc": 0 ,"ec":'+totCols+"}]";i.setParameters(CURRSHEETNAME,l,s,r,a,E,d,totRows,totCols,FREEZED_ROW)}else i.setParameters(CURRSHEETNAME,l,s,r,a);var h=new AjaxRequest;h.init("POST",i.getURL(),!0,i.getParametersAsString()),h.addEventListener("onComplete",function(e){for(var s=parseJSON(e.responseText),r=0;r<s.length;r++){var n=s[r];if(isUndefined(n[JSONConstants.IS_NEW_DOC])){if(!isUndefined(n[JSONConstants.ISFORMEXISTS])){var o=n[JSONConstants.ISFORMEXISTS];appEvent.trigger("WebForm.updateFormInfo",[o,n])}if(isUndefined(n[JSONConstants.BUILD_VERSION_LABEL])||appEvent.trigger("Build.Version.label",[n[JSONConstants.BUILD_VERSION_LABEL]]),!isUndefined(n[JSONConstants.PIVOT_DETAILS])){var a=n[JSONConstants.PIVOT_DETAILS];a=JSON.parse(decodeURIComponent(JSON.stringify(a)));for(var i=0;i<a.length;i++)PivotUtil.createPivotObject(a[i])}isUndefined(n.cC)||ClipObject.setVars(n.cC),isUndefined(n.rtype)||ClipObject.setResourceType(n.rtype),isUndefined(n.htmlSrc)||(ClipRange.htmlSrc=n.htmlSrc),updateJson(n)}else isNewDocument=!0}var l=WorkSheets.getSheetCodeFromName(CURRSHEETNAME);scrollSheetTabToView(l);var E=ole.getObjects();if(E.length){var d=getOleUsedRow(totRows);d>totRows&&(totRows=d,totalTableHeight=getRowTop(totRows-1)+getRowHeight(totRows-1),setSheetTableHeight(totalTableHeight))}isSheetBasedShare&&disableToolBar(READ_WRITE),ZComponentTabs.initDefaults(),focusSheet(),t&&setTimeout(function(){AuditTrail.goToCellRef(t[0],t[1],t[2])},300);try{var h=getObj("currency");$(h).find("span").first().text(userCurrencySymbol),appEvent.trigger("setUserThousandSep",[userThousandSeparator])}catch(e){}appEvent.trigger("Audit.dismantleQueue")}),h.sendRequest(),appEvent.trigger("postSheetLoader")}function showSignupDialog(){0===$("#signUpDiv").length?$("<div>").attr("id","signUpDiv").appendTo($("#HTMLTemplates")).load(ctxpath+"signup"):SheetSignup.showDialog(!1)}var PREV_DOCUMENT_ID="",isDocumentLoading=!1,errorInLoadObject=!1,errorMsgShown=!1,workbooksheets=null,tempsheetname="",tempdocid="",isSheetLoading=!1,sheetHTML="",currSheetOnRightClick="",sheetOnMove=!1,currSheetOnMove="",movingSheet="",currSheetOnMoveIdx="",isSheetPre=!1,isSheetsTabDblClicked=!1,sheetTransX,sheetTransPitStops,sheetTransPosCnt,sheetsScrollLeft,sheetsScrollRight,sheetsScrollCnt=0,sheetsSRIntvl,sheetsSLIntvl=0,sheetTabSLCnt,sheetTabSRCnt,allowPostDocCall=!0;
function makepublishdialog(e,t){var l=user.permissions.unRegisteredUserEmail;if(l)return void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[l]));"undefined"!=typeof t&&(pubType=t);var s=new RequestParameters(ActionConstants.JSP_MAKE_PUBLISH),i={},a=showFormulas,r=allowExportPublic;if(("org"==t||-1!=zoid||isDocumentSemiPublic)&&(a=showFormulasOrg,r=allowExportOrg),"fromPublic"==e){publicURL=getServerPath()+location.href.substring(location.href.indexOf("/",SERVERSCHEME.length)),s.setParameters(publicURL,"true",null,isDocumentSemiPublic,"fromPublic",a,r,showPublic),i={width:500,modal:!0,title:jsMsg.EmbedToWebsiteBlog};var o=s.getURL()+"?"+s.getParametersAsString();sheetdialog.open("makepublishdialog",i,void 0,void 0,o)}else if(isDocumentSemiPublic&&"org"==t||isDocumentPublic){s.setParameters(publicURL,"true",null,isDocumentSemiPublic,"fromPublic",a,r,showPublic),i={width:520,modal:!0,title:jsMsg.EmbedToWebsiteBlog};var o=s.getURL()+"?"+s.getParametersAsString();sheetdialog.open("makepublishdialog",i,void 0,void 0,o)}else makepublishconfirm(pubType)}function makepublishconfirm(e){var t="";t="org"==e?null==orgDisplayName||""==orgDisplayName||"Organization"==orgDisplayName?jsMsg.EmbedwithinOrganization:replaceParams(jsMsg.EmbedwithinDomain,new Array(orgDisplayName)):"external"==e?jsMsg.EmbedToWebsiteBlog:jsMsg.EmbedToWebsiteBlog;var l=new RequestParameters(ActionConstants.JSP_MAKE_PUBLISH);if(0==DOCUMENT_NAME.toLowerCase().indexOf(jsMsg.Untitled.toLowerCase())){var s=showPromptDialog(jsMsg.RenameWhilePublish,$("#fileName").text());null!=s&&""!=s&&(renameDocument(s,e),isNewDocument=!1),l.setParameters(null,null,null,null,null,showFormulasOrg,allowExportOrg,null,e);var i={width:520,modal:!0,title:t},a=l.getURL()+"?"+l.getParametersAsString();sheetdialog.open("makepublishconfirmdialog",i,void 0,void 0,a)}else{l.setParameters(null,null,null,null,null,showFormulasOrg,allowExportOrg,"",e);var i={width:520,modal:!0,title:t},a=l.getURL()+"?"+l.getParametersAsString();sheetdialog.open("makepublishconfirmdialog",i,void 0,void 0,a)}}function makepublishsubmit(e){var t=new RequestParameters(ActionConstants.MAKE_PUBLIC);if("org"!=e||isDocumentSemiPublic)if(isDocumentPublic)sheetdialog.close(),makepublishdialog("",e);else{var l=!1,s=getObj("semipublic_confirmoption");null!=s&&(l=s.checked?!1:!0),showFormulas=!0;var i=getObj("public_formulaoption");null!=i&&(showFormulas=i.checked?!1:!0),allowExportPublic=!0;var a=getObj("public_exportoption");if(null!=a&&(allowExportPublic=a.checked?!0:!1),allowExportOrg=allowExportPublic,showFormulasOrg=showFormulas,showPublic=!0,"org"==e)showPublic="false",l="true";else if("external"==e)showPublic="true",null==s&&(l="false");else{var r=getObj("showPublicOption");null!=r&&(showPublic=r.checked?!0:!1)}t.setParameters(DOCUMENT_ID,"Make Public",l,encodeURIComponent(DOCUMENT_NAME),showFormulas,allowExportPublic,showPublic,e);var o=new AjaxRequest;o.init("POST",t.getURL(),!0,t.getParametersAsString()),o.addEventListener("onComplete",function(t){var s=t.responseText;return"Unconfirmed user"===s?void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail])):"Not Authorized"===s?void showAlertDialog(jsMsg.YouAreNotAuthorizedUserToMakeDocPublic):($("#orgpub").hide(),$("#extpub").show(),isDocumentPublic=!0,isDocumentSemiPublic=l,publicURL=t.responseText,void makepublishdialog("showURL",e))}),sheetdialog.close(),o.sendRequest()}else{var l=!1,s=getObj("semipublic_confirmoption");null!=s&&(l=s.checked?!1:!0),showFormulasOrg=!0;var i=getObj("public_formulaoption");null!=i&&(showFormulasOrg=i.checked?!1:!0),allowExportOrg=!0;var a=getObj("public_exportoption");null!=a&&(allowExportOrg=a.checked?!0:!1);var n=getObj("public_allowOrgEditoption");null!=n&&(allowOrgEdit=n.checked?!0:!1),showPublic=!0,showPublic="false",t.setParameters(DOCUMENT_ID,"Make Public",l,encodeURIComponent(DOCUMENT_NAME),showFormulasOrg,allowExportOrg,showPublic,e,"",allowOrgEdit);var o=new AjaxRequest;o.init("POST",t.getURL(),!0,t.getParametersAsString()),o.addEventListener("onComplete",function(t){var l=t.responseText;return"Unconfirmed user"===l?void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail])):"Not Authorized"===t.responseText?void showAlertDialog(jsMsg.YouAreNotAuthorizedUserToMakeDocPublic):($("#orgpub").show(),isDocumentSemiPublic=!0,publicURL=t.responseText,void makepublishdialog("showURL",e))}),sheetdialog.close(),o.sendRequest()}}function rangePublish(e,t){var l=getCellRange();if(void 0!=Merge.getCellInfo(l.startRow,l.startCol)&&!Merge.isCovered(l.startRow,l.startCol)){var s=Merge.getCellInfo(l.startRow,l.startCol);l.endRow=l.endRow<s.endRow?s.endRow:l.endRow,l.endCol=l.endCol<s.endCol?s.endCol:l.endCol}var a=user.permissions.unRegisteredUserEmail;if(a)return void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[a]));if(sheetdialog.close(),t){var r="confirm",o="org"==e&&null!=orgDisplayName&&""!=orgDisplayName&&"Organization"!=orgDisplayName?orgDisplayName:"",n="undefined"!=typeof e?e:"",g=new RequestParameters(ActionConstants.JSP_RANGE_SNIPPET);g.setParameters(n,r,o);var d={width:500,modal:!0,title:jsMsg.PublishRange},u=g.getURL()+"?"+g.getParametersAsString();return void sheetdialog.open("rangepublishdialog",d,void 0,void 0,u)}var p=l.startRow,b=l.startCol,c=l.endRow,h=l.endCol,R=getCell(c,h);null==R&&(R=getCell(getAvailableEndRow(),getAvailableEndCol())),cellColspan=R.colSpan,cellColspan>1&&(h=h+cellColspan-1);var m=0,E=0;for(message(jsMsg.Loading,"block","..."),i=p;c>=i;i++)m+=getRowHeight(i);for(i=b;h>=i;i++)E+=getColWidth(i);l=p+":"+b+":"+c+":"+h,dyn_updation="yes",col_head="yes",cell_width="yes",borders="yes",row_num="yes";var g=new RequestParameters(ActionConstants.RANGE_PUBLISH);g.setParameters(CURRSHEETNAME,l,e);var O=new AjaxRequest;O.init("POST",g.getURL(),!0,g.getParametersAsString()),O.addEventListener("onComplete",function(t){var l=t.responseText;if("Unconfirmed user"===l)return message("","none"),void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail]));if("Not Authorized to publish externally"==l)return void showAlertDialog(jsMsg["Publish.Alert.NotAuthorizedToPublishExternally"]);var s="";s=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(s+=":"+SERVERPORT),publishURL="org"==e?s+ctxpath+"publishrange.org":s+ctxpath+"publishrange.do",message(jsMsg.Loading,"none"),"external"==e?e="public":"org"==e&&(e="org"),showRangePublishURL(publishURL,"rangepublish",m,E,e,t.responseText)}),O.sendRequest()}function showPublishedRange(){if(sheetdialog.close(),null!=DOCUMENT_ID&&"doc_id"!=DOCUMENT_ID&&"DOCUMENT_ID"!=DOCUMENT_ID){message(jsMsg.Loading,"block","...");var e=new RequestParameters(ActionConstants.SHOW_PUBLISH_RANGE);e.setParameters(CURRSHEETNAME,orgDisplayName);var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=e.responseText;message(jsMsg.Loading,"none"),isRangeDialog=!0;var l={width:"auto",closeOnEscape:!1,title:jsMsg.PublishedRanges,close:function(){RangeSelector.off(),closePublsihedRangeDialog()}};sheetdialog.open(t,l)}),t.sendRequest()}else showAlertDialog(jsMsg.NoRangesPublishedFromThisSheet)}function closePublsihedRangeDialog(){isRangeEdit=!1,resetCellRangeFill("publishedRange")}function rangePublishActions(e,t,l,s,i,r,o,n){if(callFrom=n,"Remove"==t){if(a=showConfirmDialog(jsMsg["RangePublish.ShowPublishedRangeDialog.RevertRangePublishAlert.ConfirmMsg"])){var g=new RequestParameters(ActionConstants.UPDATE_PUBLISH_RANGE);g.setParameters("Remove",l,n);var d=new AjaxRequest;d.init("POST",g.getURL(),!0,g.getParametersAsString()),d.addEventListener("onComplete",function(t){"undefined"!=typeof e?(getObj("RangeRow_"+e).style.display="none",getObj("SnippetRow_"+e).style.display="none"):sheetdialog.close(),"-1"==t.responseText&&sheetdialog.close()}),d.sendRequest(),rangeEditText=="range_text_"+e&&resetCellRangeFill("publishedRange")}}else if("Cancel_Edit"==t)isRangeEdit=!1,rangeEditText="",rangeEditURL="",getObj("edit_"+e).style.display="",getObj("cancel_edit_"+e).style.display="none",getObj("range_span_"+e).style.display="",getObj("range_text_"+e).value=rangeEditValue,getObj("range_text_"+e).style.display="none",getObj("update_"+e).style.display="none",getObj("remove_"+e).style.display="",resetCellRangeFill("publishedRange");else if("Edit"==t){for(isRangeEdit=!0,rangeEditText="range_text_"+e,rangeEditURL=l,b=1;b<=parseInt(rangeCnt);b++)b!=e&&(getObj("edit_"+b).style.display="",getObj("cancel_edit_"+b).style.display="none",getObj("range_span_"+b).style.display="",getObj("range_text_"+b).style.display="none",getObj("update_"+b).style.display="none",getObj("remove_"+b).style.display=""),getObj("SnippetRow_"+b).style.display="none",getObj("hide_snippet_"+b).style.display="none",getObj("show_snippet_"+b).style.display="";getObj("edit_"+e).style.display="none",getObj("cancel_edit_"+e).style.display="",getObj("range_span_"+e).style.display="none",rangeEditValue=getObj("range_text_"+e).value,getObj("range_text_"+e).style.display="",$("#range_text_"+e).focus(function(){var e=this;RangeSelector.on({el:e,appendSheetName:!0})}),getObj("range_text_"+e).focus(),getObj("update_"+e).style.display="",getObj("remove_"+e).style.display="none",val=getObj("range_text_"+e).value,arr=val.split(".")}else if("Update"==t){if(""==getObj("range_text_"+e).value)return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);if(val=getObj("range_text_"+e).value,val=CellUtils.removeApostrophe(val),arr=val.split("."),2!=arr.length)return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);for(var u=0,p=getObj("sheetsTab").getElementsByTagName("TD"),b=0;b<p.length-1;b++)if(null!=p[b].getAttribute("sheetname")){var c=p[b].getAttribute("sheetname");c==arr[0]&&(u=1)}if(0==u)return void showAlertDialog(jsMsg.SpecifyValidSheetName);if(""==arr[0]||""==arr[1])return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);var h=formatWithConditions.getRangeValues(val);if(!h)return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);var R=h.sheetName,m=h.startCol,E=h.startRow,O=h.endCol,w=h.endRow;if(R==CURRSHEETNAME){var P=0,_=0;for(P+=getRowTop(w)+getRowHeight(w)-getRowTop(E),b=m;O>=b;b++)_+=getColWidth(b);var y="";y=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(y+=":"+SERVERPORT),y+=ctxpath,y+="org"==callFrom?"publishrange.org?id="+l:"publishrange.do?id="+l,y="<iframe src='"+y+"' frameborder='0' style='height:"+P+"px;width:"+_+"px' marginwidth='0' marginheight='0' scrolling='auto'>&nbsp;</iframe>",getObj("picPublishURL_"+e).value=y}var v=new RequestParameters(ActionConstants.UPDATE_PUBLISH_RANGE);v.setParameters("Update",l,n,R,E,m,w,O);var d=new AjaxRequest;d.init("POST",v.getURL(),!0,v.getParametersAsString()),d.addEventListener("onComplete",function(){isRangeEdit=!1,rangeEditText="",getObj("edit_"+e).style.display="",getObj("cancel_edit_"+e).style.display="none",getObj("range_span_"+e).style.display="",getObj("range_span_"+e).innerHTML=escapeSpecialCharacters(getObj("range_text_"+e).value),getObj("range_text_"+e).style.display="none",getObj("update_"+e).style.display="none",getObj("remove_"+e).style.display=""}),d.sendRequest(),resetCellRangeFill("publishedRange")}else if("ShowSnippet"==t){for(b=1;b<=parseInt(rangeCnt);b++)b!=e&&(getObj("SnippetRow_"+b).style.display="none",getObj("hide_snippet_"+b).style.display="none",getObj("show_snippet_"+b).style.display=""),getObj("edit_"+b).style.display="",getObj("cancel_edit_"+b).style.display="none",getObj("range_span_"+b).style.display="",getObj("range_text_"+b).style.display="none",getObj("update_"+b).style.display="none",getObj("remove_"+b).style.display="";val=getObj("range_text_"+e).value,arr=val.split("."),arr1=arr[1].split(":");var m=-1,E=-1,O=-1,w=-1;if(2==arr1.length){if(""==arr1[0]||""==arr1[1])return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);st=CellUtils.getCellPosByLabel(arr1[0]),m=st.col,E=st.row,en=CellUtils.getCellPosByLabel(arr1[1]),O=en.col,w=en.row}else if(1==arr1.length){if(""==arr1[0])return void showAlertDialog(jsMsg.SpecifyValidRangeToUpdate);st=CellUtils.getCellPosByLabel(arr1[0]),m=st.col,E=st.row,O=m,w=E}if(arr[0]==CURRSHEETNAME){var P=0,_=0;for(P+=getRowTop(w)+getRowHeight(w)-getRowTop(E),b=m;O>=b;b++)_+=getColWidth(b);var y="";y=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(y+=":"+SERVERPORT),y+=ctxpath,y+="org"==callFrom?"publishrange.org?id="+l:"publishrange.do?id="+l,y="<iframe src='"+y+"' frameborder='0' style='height:"+P+"px;width:"+_+"px' scrolling='auto' marginwidth='0' marginheight='0'>&nbsp;</iframe>",getObj("picPublishURL_"+e).value=y}else{var y="";y=SERVERSCHEME+SERVERNAME,"80"!=SERVERPORT&&"443"!=SERVERPORT&&(y+=":"+SERVERPORT),y+=ctxpath,y+="org"==callFrom?"publishrange.org?id="+l:"publishrange.do?id="+l,y="<iframe src='"+y+"' frameborder='0' style='height:100%;width:100%' scrolling='auto' marginwidth='0' marginheight='0'>&nbsp;</iframe>",getObj("picPublishURL_"+e).value=y}getObj("SnippetRow_"+e).style.display="",getObj("picPublishURL_"+e).focus(),getObj("hide_snippet_"+e).style.display="",getObj("show_snippet_"+e).style.display="none"}else"HideSnippet"==t&&(getObj("SnippetRow_"+e).style.display="none",getObj("hide_snippet_"+e).style.display="none",getObj("show_snippet_"+e).style.display="")}function updateRangeEnter(e,t){var l;if(window.event?l=window.event.keyCode:t&&(l=t.which),13==l){var s=e.id.split("_");rangePublishActions(s[2],"Update",rangeEditURL,"","","","",callFrom)}else{if(27==l){var s=e.id.split("_");return rangePublishActions(s[2],"Cancel_Edit",rangeEditURL,"","","","",callFrom),!1}if(0==l)return!1}}function callpublic(e,t){if("Made Public"==e)publicURL=t,null!=publicURL&&""!=publicURL&&(publishURL=-1==zoid?publicURL.replace("/public/","/publish/"):publicURL+"/embed",publishURL="<iframe src='"+publishURL+"' frameborder='0' scrolling='no' style='height:400px;width:500px'>&nbsp;</iframe>"),i=0;else if("Made Publish"==e){publicURL=t;var l="",s=publicURL.length,i=0;if(publicURL.length>50)for(;s>i;)l+=i+50>s?publicURL.substring(i,s):publicURL.substring(i,i+50),l+="<br>",i+=50;else l=t;publishURL="",null!=publicURL&&""!=publicURL&&(publishURL=-1==zoid?publicURL.replace("/public/","/publish/"):publicURL+"/embed",publishURL="<iframe src='"+publishURL+"' frameborder='0' scrolling='no' style='height:400px;width:500px'>&nbsp;</iframe>")}else"Cancel Public"==e&&(isDocumentPublic=!1,isDocumentSemiPublic=!1);getObj("PUBLICURL").value=publicURL}function showembedblog(){"none"==getObj("embedblog").style.display?(getObj("embedblog").style.display="",getObj("embedblog_btn_exp").style.display="",getObj("embedblog_btn_col").style.display="none"):(getObj("embedblog").style.display="none",getObj("embedblog_btn_exp").style.display="none",getObj("embedblog_btn_col").style.display="")}function changepublicOptions(e,t,l){var s=!0;null!=e&&("ALLOWEXPORT"!=t&&e.checked?s=!1:"ALLOWEXPORT"==t&&e.checked?s=!0:"ALLOWEXPORT"!=t||e.checked?"SHOWPUBLIC"==t&&(showPublic=e.checked?!0:!1):s=!1,"ALLOWORGEDIT"==t&&(s=e.checked?!0:!1));var i=new RequestParameters(ActionConstants.MANAGE_PUBLIC),a="Change Options";"SHOWPUBLIC"!=t||e.checked?"SHOWPUBLIC"==t&&e.checked&&(a="Add Public"):a="Remove Public",i.setParameters(l,DOCUMENT_ID,a,t,s);var r=new AjaxRequest;r.init("POST",i.getURL(),!0,i.getParametersAsString()),r.addEventListener("onComplete",function(e){var i=e.responseText;return"Unconfirmed user"===i?void showAlertDialog(replaceParams(jsMsg["IAMError.unconfirmeduser"],[user.permissions.unRegisteredUserEmail])):"Not Authorized"==i?void showAlertDialog(jsMsg.YouAreNotAuthorizedUser):void("org"==l?"ALLOWEXPORT"==t?allowExportOrg=s:"SHOWFORMULAS"==t?showFormulasOrg=s:"ALLOWORGEDIT"==t&&(allowOrgEdit=s):"ALLOWEXPORT"==t?(allowExportPublic=s,allowExportOrg=s):"SHOWFORMULAS"==t?(showFormulas=s,showFormulasOrg=s):"ALLOWORGEDIT"==t&&(allowOrgEdit=s))}),r.sendRequest()}var rangeEditText="",rangeCnt=0,rangeEditValue="",rangeEditURL="",callFrom="";
function resetUNDO(){UNDO=0,REDO=0,toggleREDO(),toggleUNDO()}function setREDO(e){REDO=parseInt(e),toggleREDO()}function setUNDO(e){UNDO=parseInt(e),toggleUNDO()}function getREDO(){return 0===REDO?(toggleREDO(),!1):(REDO-=1,0===REDO&&toggleREDO(),!0)}function getUNDO(){return 0===UNDO?(toggleUNDO(),!1):(UNDO-=1,0===UNDO&&toggleUNDO(),!0)}function redo(){if(getREDO()===!1)return void repeat.doAction(repeat.LASTACTIONJSON,!1);sheetdialog.isDialogOpen()&&sheetdialog.close(),ole&&ole.isActive()&&ole.getCurrObj()&&"chart"==ole.getCurrObj().type&&chartPreview.hideContextualToolbar(),setUNDO(UNDO+1);var e=new RequestParameters(ActionConstants.REDO);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t)}function undo(){if(getUNDO()!==!1){if(sheetdialog.isDialogOpen()&&sheetdialog.close(),ole&&ole.isActive()&&ole.getCurrObj()&&"chart"==ole.getCurrObj().type&&chartPreview.hideContextualToolbar(),isCellEdited())return void submitCell();setREDO(REDO+1);var e=new RequestParameters(ActionConstants.UNDO);e.setParameters(WorkSheets.getAssociatedActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t)}}function toggleUNDO(){jsGADGET_VIEW||jsTHROWAWAY_VIEW||undoCallback()}function toggleREDO(){jsGADGET_VIEW||jsTHROWAWAY_VIEW||redoCallback()}function undoCallback(){return 0===UNDO?void menutabListener.doAction(TOOLBAR.HOME,{id:"undo",action:"disable",callback:button_disable,args:["undo"]}):void menutabListener.doAction(TOOLBAR.HOME,{id:"undo",action:"enable",callback:button_enable,args:["undo"]})}function redoCallback(){return 0===REDO?void menutabListener.doAction(TOOLBAR.HOME,{id:"redo",action:"disable",callback:button_disable,args:["redo"]}):void menutabListener.doAction(TOOLBAR.HOME,{id:"redo",action:"enable",callback:button_enable,args:["redo"]})}var UNDO=0,REDO=0;
var WMSResponseProcessor={processMessage:function(e,s,a,t,n){var o;try{o=parseJSON(n)}catch(e){o=parseJSON(replaceSplChrs(n))}if(appEvent.trigger("wms.messageprocessed",[o,s,a,t]),void 0!=o[ResponseKey.EXECUTED]&&appEvent.trigger("xaid.returned",[o[ResponseKey.EXECUTED],t]),submitCallBack.action){var r=submitCallBack[ResponseKey.QUEUED],i=o[ResponseKey.EXECUTED];r?i>=r&&fireRegisteredEvent():setTimeout(function(){fireRegisteredEvent()},1e3)}if(1==o.DU)switch(o.a){case ActionConstants.USER_PRESENCE:o.user!=WebMessanger.getRawSid()&&setTimeout(function(){userPresence.show(o)},500);break;case ActionConstants.POST_DOC_LOAD:updateJson(o);break;case ActionConstants.MACRO_CONTENT_CHANGED:WebMessanger.getRawSid()!=o[JSONConstants.RSID]&&(ISMACROEDITOROPEN||ISMINDLG)&&pullMacroContent(o.mnA,o.ao);break;case ActionConstants.WEB_DATA:"WebdataPaste"==o.SUBACTION&&refreshWebData(o.WEBDATAID,o.sn,!0);break;case ActionConstants.USER_PRESENCE_REMOVE:userPresence.remove(o.rsid);break;case ActionConstants.SHOW_ERROR_MESSAGE:ErrorMsg.show(o);break;case ActionConstants.IMPORT_REPLACE_SPREADSHEET:if(appEvent.trigger("import.response"),$("#sharedialogdiv").is(":visible")&&$("#sharedialogdiv").dialog("close"),LOGINNAME!=o[JSONConstants.LOGIN_NAME]){var S=!0,l=jsMsg["Overwrite.dialog.newVersionUploaded"],E=replaceParams(jsMsg["Share.dialog.reloadMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("info",jsMsg["Overwrite.dialog.versionUploadTitle"],l,E),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}else loadDocument(DOCUMENT_ID,DOCUMENT_NAME);break;case ActionConstants.REVERT_VERSION:loadDocument(DOCUMENT_ID,DOCUMENT_NAME);break;case ActionConstants.RENAME_DOCUMENT:case ActionConstants.SAVE_DOCUMENT:o.dn&&updateDocName(o.dn);break;case ActionConstants.VERSION_UPLOAD_NOTIFICATION:if(DOCUMENT_ID==o[JSONConstants.DOC_ID]&&COLLAB_ID==o[JSONConstants.COLLAB_ID]){var S=!0,l=jsMsg["Overwrite.dialog.newVersionUploaded"],E=replaceParams(jsMsg["Share.dialog.reloadMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("info",jsMsg["Overwrite.dialog.versionUploadTitle"],l,E),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}break;case ActionConstants.CHECKIN_CHECKOUT:if((LOGINNAME==o[JSONConstants.RECEIVER]||"ALL"==o[JSONConstants.RECEIVER])&&DOCUMENT_ID==o[JSONConstants.DOC_ID]&&COLLAB_ID==o[JSONConstants.COLLAB_ID])if(void 0==o.locked_by){var S=!0,c=replaceParams(jsMsg["Checkin.dialog.CheckIn"],["<b>"+LOCKED_BY+"</b>"]),C=jsMsg["Share.dialog.permissionChanged"],d=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>")),g=jsMsg["Checkin.reloadButton"];$("#notifyDlgHeading").hide(),Share.showDialog(g,S),Share.setValues("info",C,c,d),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}else{LOCKED_BY=o.locked_by;var S=!0,c=replaceParams(jsMsg["Checkin.dialog.CheckOut"],["<b>"+o.locked_by+"</b>"]),g=jsMsg["Checkin.reloadButton"],C=jsMsg["Share.dialog.permissionChanged"],d=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>"));$("#notifyDlgHeading").hide(),Share.showDialog(g,S),Share.setValues("info",C,c,d),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}break;case ActionConstants.SHARE_PERMISSION_CHANGE:if(LOGINNAME!=o[JSONConstants.LOGIN_NAME]&&(LOGINNAME==o[JSONConstants.RECEIVER]||"ALL"==o[JSONConstants.RECEIVER])&&DOCUMENT_ID==o[JSONConstants.DOC_ID]&&COLLAB_ID==o[JSONConstants.COLLAB_ID]){var O=o[JSONConstants.PERMISSION_TO],R=o[JSONConstants.PERMISSION_FROM],S=!0;if(isSheetBasedShare){var c=replaceParams(jsMsg["SheetShare.dialog.ROtoRW"],new Array(o.SName)),g=jsMsg["SheetShare.dialog.reloadButMsg2"];return 1==R&&0==O&&(c=replaceParams(jsMsg["SheetShare.dialog.RWtoRO"],new Array(o.SName)),g=jsMsg["SheetShare.dialog.reloadButMsg1"],S=!0),Share.showDialog(g,S,O),void Share.setValues("info",jsMsg["Share.dialog.permissionChanged"],c)}var l=jsMsg["Share.dialog.ROtoRW"],D=jsMsg["Share.dialog.reloadButMsg2"];return 2!=R&&1!=R&&3!=R||0!=O?2==R&&1==O?(l=jsMsg["Share.dialog.COtoRW"],D=jsMsg["Share.dialog.reloadButMsg1"],S=!0):1==R&&2==O?(l=jsMsg["Share.dialog.RWtoCO"],D=jsMsg["Share.dialog.reloadButMsg1"],S=!0):0!=R&&3!=R||2!=O?3==R&&0==O?(l=jsMsg["Share.dialog.RCtoRO"],D=jsMsg["Share.dialog.reloadButMsg2"],S=!0):0==R&&3==O?(l=jsMsg["Share.dialog.ROtoRC"],D=jsMsg["Share.dialog.reloadButMsg2"],S=!0):2!=R&&1!=R||3!=O||(l=jsMsg["Share.dialog.RW_COtoRC"],D=jsMsg["Share.dialog.reloadButMsg2"],S=!0):(l=jsMsg["Share.dialog.ROtoCO"],D=jsMsg["Share.dialog.reloadButMsg2"],S=!0):(l=jsMsg["Share.dialog.CO_RWtoRO"],D=jsMsg["Share.dialog.reloadButMsg1"],S=!0),Share.showDialog(D,S,O),void Share.setValues("info",jsMsg["Share.dialog.permissionChanged"],l)}break;case ActionConstants.SHARE_REMOVE_BYOWNER:if(LOGINNAME!=CURR_DOC_OWNERNAME){if(!disableRemoveShareNotify)if(isSheetBasedShare){var c=replaceParams(jsMsg["SheetShare.dialog.removeShareMsg"],new Array(o.SName)),C=jsMsg["SheetShare.dialog.accessDenied"],d=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("error",C,c,d),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}else{var l=jsMsg["Share.dialog.removeShareMsg"],M=jsMsg["Share.dialog.accessDenied"],E=replaceParams(jsMsg["Share.dialog.closeMessage"],new Array("<b id='cntDwn'>15</b>"));Share.showDialog(jsMsg.OK,!0),Share.setValues("error",M,l,E),window.clearInterval(timer),timer=setInterval(function(){startCountDown()},1e3)}Collaboration.quit(COLLAB_ID)}break;case ActionConstants.DOCUMENT_TRASH:var S=!0,l=jsMsg["Trash.dialog.dlgMsg"],D=jsMsg.OK;return Trash.showDialog(D),void Trash.setValues("info",jsMsg["Trash.dialog.headMsg"],l);case ActionConstants.SHARE_REMOVE_BYUSER:if(o[JSONConstants.DOC_ID]==DOCUMENT_ID)if(o.sharedUser==LOGINNAME)document.location.href=location.href;else{for(var A=0;A<SHAREDUSERSLIST.length;A++){var I=SHAREDUSERSLIST[A],_=I.uname;if(a==_){SHAREDUSERSLIST.splice(A,1);break}}0!=SHAREDUSERSLIST.length&&updateSharedUserStatus()}if(respObjsender!=LOGINNAME){for(var A=0;A<SHAREDUSERSLIST.length;A++){var I=SHAREDUSERSLIST[A],_=I.uname;if(a==_){SHAREDUSERSLIST.splice(A,1);break}}0!=SHAREDUSERSLIST.length&&updateSharedUserStatus()}break;case ActionConstants.CHANGE_OWNER:loadDocument(o[JSONConstants.DOC_ID]);break;case ActionConstants.READ_FILTER_RANGE:Filter.updateFilterJson(o);break;case ActionConstants.DISCUSSION_ADD:case ActionConstants.DISCUSSION_DELETE:case ActionConstants.DISCUSSION_RESOLVE:case ActionConstants.DISCUSSION_REOPEN:case ActionConstants.DISCUSSION_ADD_REPLY:case ActionConstants.DISCUSSION_UPDATE_RANGE_CONTENT:case ActionConstants.DISCUSSION_DELETE_REPLY:case ActionConstants.DISCUSSION_UPDATE_REPLY:case ActionConstants.DISCUSSION_LIKE:case ActionConstants.DISCUSSION_LIKE_REPLY:case ActionConstants.DISCUSSION_UNLIKE:case ActionConstants.DISCUSSION_UNLIKE_REPLY:case ActionConstants.DISCUSSION_UPDATE_SHAREDUSERS:case ActionConstants.DISCUSSION_DELETE_ALL:Discussion.Wms.handle(o);break;case ActionConstants.WAKE_UP_CALL:stopGetStatus=!1,wakeUpTime=new Date,updateViewPort();break;case ActionConstants.EXTERNAL_REMOTE_SAVE:if(RMUSER===t){200===o.msg.statusCode&&(SAVED=!0,btn_disabled());var h=getObj("save_message_display");h&&(h.innerHTML=escapeSpecialCharacters(o.msg.statusValue)),setTimeout(function(){h.innerHTML=""},2e3)}break;default:updateJson(o)}else if(o.a&&o.a[ActionConstants.USER_PRESENCE]){var u=String(o.a[ActionConstants.USER_PRESENCE]).split(",");if(u[0]!=WebMessanger.getRawSid()){var N=u[9],p=parseInt(u[4]),L=parseInt(u[5]);"true"===N&&(p=parseInt(u[2]),L=parseInt(u[3]));var T={vcID:u[0],sheetName:u[1],row:parseInt(u[2]),col:parseInt(u[3]),erow:p,ecol:L,dname:u[6],zuid:u[7],colorCode:u[8]};userPresence.show(T),CollabPanel.setCollboratorStatus(u[0],u[1],u[2],u[3],p,L,u[7]),CollabPanel.updateUserEdit(u[0],u[1],u[2],u[3],N)}}else if(isUndefined(o.qaid)&&isUndefined(o.xaid)){if(o.a&&o.a[ActionConstants.COLLAB_USER_EDIT]){var u=String(o.a[ActionConstants.COLLAB_USER_EDIT]).split(",");if(u[0]!==WebMessanger.getRawSid()){var T={vcID:u[0],sheetName:u[1],row:parseInt(u[2]),col:parseInt(u[3]),erow:parseInt(u[2]),ecol:parseInt(u[3]),dname:u[6],zuid:u[7],colorCode:u[8]};userPresence.show(T),CollabPanel.setCollboratorStatus(u[0],u[1],u[2],u[3],u[2],u[3],u[7]),CollabPanel.updateUserEdit(u[0],u[1],u[2],u[3],"true")}}else if(!isUndefined(o[JSONConstants.STOP_GET_STATUS])&&1==o[JSONConstants.STOP_GET_STATUS]){var m=new Date;(!wakeUpTime||m-wakeUpTime>5e4)&&(stopGetStatus=!0,wakeUpTime=null)}}else if(responseManager.updateResponse(o),"undefined"!=typeof CollabPanel){var b=CollabPanel.getPanelPermissions();b.allowActionStream&&o[ActionConstants.ACTION_STREAM_UPDATE]&&(b.includeTabActionStream||o.rsid!==WebMessanger.getRawSid())&&CollabPanel.updateActionStream(o[ActionConstants.ACTION_STREAM_UPDATE][0])}},processCustomMessage:function(e){this.processMessage(void 0,void 0,void 0,void 0,e)},handleServerDown:function(){responseManager=new _ResponseManager(1e3,3e3,2500,9,5e3,allowSyncTimerGetStatus),documentBakeStatus.setCollabBake(!0),documentBakeStatus.isBaked()&grantRequest&&(grantRequest=!1),documentBakeStatus.setCollabBake(!0),unMaskSheet()},handleServerUp:function(){var e=new RequestParameters(ActionConstants.JOIN_COLLAB),s=Row.getVisibleRowsInViewPortAsJSONStr(!1),a='[{"sc": 0 ,"ec":'+totCols+"}]",t=COLLAB_INFO.RS_ID;e.setParameters(CURRSHEETNAME,t,WebMessanger.getSid(),s,a,totRows,totCols,FREEZED_ROW),COLLAB_INFO.RS_ID=WebMessanger.getRawSid();var n=new AjaxRequest;n.init("POST",e.getURL(),!0,e.getParametersAsString()),n.addEventListener("onComplete",function(e){documentBakeStatus.setCollabBake(!0),unMaskSheet(),jsPUBLIC_VIEW||setTimeout(WMSResponseProcessor.handleWMSJoinError,6e4);var s=e.responseText;if(s){var a=JSON.parse(s);if(a.a==ActionConstants.SHOW_ERROR_MESSAGE)return void ErrorMsg.show(a);if(1==a.IS_LOCKED&&(RESOURCE_LOCKED=!0,DOCUMENT_MAX_PERMISSION=a.maxPermission,"READ"==DOCUMENT_MAX_PERMISSION?$("#readonlyico").show():$("#readonlyico").hide(),a.LOCKED_BY==a.LOGIN_USER?(showLockedBy("you"),LOCKED_BY=a.LOGIN_USER,InfoBanner.showBanner(jsMsg["Checkin.CheckoutBannerOnReload"],!0,"info")):(showLockedBy(a.LOCKED_BY),LOCKED_BY=a.LOCKED_BY,InfoBanner.showBanner(replaceParams(jsMsg["Checkin.CheckoutBannerForSharedUser"],new Array(a.LOCKED_BY)),!1,"info"))),errorMsgShown){hideBannerMessage(),errorDocMenutab("enable"),a.ro||(READ_WRITE=!0,ALLOW_TO_WRITE=!0),errorMsgShown=!1,isErrorDoc=!1;var n=getObj("addSheetBtn");n&&(n.style.visibility="visible")}if(ole&&READ_WRITE&&(ole.setObjectProperties("button",{permissions:{isDraggable:!0,isResizable:!0,isEditable:!0}}),ole.setObjectProperties("chart",{permissions:{isDraggable:!0,isResizable:!0,isEditable:!0}}),ole.setObjectProperties("img",{permissions:{isDraggable:!0,isResizable:!0,isEditable:!0}})),JSON.parse(e.responseText).xaid!==responseManager.getLastExecutedActionId()&&reloadPage(),documentBakeStatus.setCollabBake(!0),isCollabJoined=!0,responseManager=new _ResponseManager(1e3,3e3,25e3,9,5e3,allowSyncTimerGetStatus),documentBakeStatus.isBaked()&grantRequest&&(grantRequest=!1,postDocumentLoader()),appEvent.trigger("collab.reconnect"),a.irc?responseManager.reInit(a):(responseManager.init(a),"undefined"!=typeof a.cid&&(COLLAB_ID=a.cid),a[JSONConstants.READ_ONLY]),t){var o={a:ActionConstants.USER_PRESENCE_REMOVE,DU:!0,rsid:t};WMSREQ_SEND_COUNT++,WebMessanger.sendMessage(COLLAB_ID,JSON.stringify(o))}}}),n.addEventListener("onError",function(e){var s=e.responseText;if(s){var a=JSON.parse(s);a&&"Error.Remote.Document.Not.Available"==a.mk&&(BLOCK_REMOVED_FILE_REQUEST=!0)}}),n.sendRequest()},handleWMSJoinError:function(){if(!isCollabJoined&&!errorMsgShown){restrictScroll=!1,documentBakeStatus.setCollabBake(!0),unMaskSheet(),postDocumentLoader();var e=new RequestParameters(ActionConstants.SYNC_CHECK);e.setParameters(DOCUMENT_ID,"failed");var s=new AjaxRequest;s.init("POST",e.getURL(),!0,e.getParametersAsString()),s.sendRequest(),errorMsgShown=!0}},handleWmsOffline:function(){if(READ_WRITE){var e=replaceParams(jsMsg["Error.WMS.Connection.Lost"],new Array("<a onclick='javascript:loadDocument(\""+DOCUMENT_ID+"\");' href='#'>","</a>"));handleServerError("ERROR",e,!0,!0)}}};
var insertImage=function(e){function t(e,t){ole.isSelected(e)?t._setSelectLayer().positionActionBar():ole.isFocussed(e)&&t.setFocusLayer()}function n(e,t,n){e.sCol=findColInXPos(t),e.sRow=findRowInYPos(n),e.sRowDiff=n-getRowTop(e.sRow),e.sColDiff=t-getColLeft(e.sCol)}function o(){var e=new RequestParameters(ActionConstants.LOAD_IMAGE);e.setParameters(WorkSheets.getActiveSheetName());var t=new AjaxRequest;t.init("POST",e.getURL(),!1,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText),n=t.imageDetails;void 0!==n&&a(void 0,n)}),t.sendRequest()}function a(e,o,a,l){var c=o.length;switch(e){case ActionConstants.IMAGE_MOVE:case ActionConstants.INSERT_ROW:case ActionConstants.INSERT_COL:case ActionConstants.DELETE_ROW:case ActionConstants.DELETE_COL:case ActionConstants.INSERT_CELL_LEFT:case ActionConstants.INSERT_CELL_TOP:case ActionConstants.DELETE_CELL_BOTTOM:case ActionConstants.DELETE_CELL_RIGHT:for(var d=0;c>d;d++){if(o[d][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var m=o[d][CommandConstants.IMAGE_ZINDEX].toString(),g=parseInt(o[d][CommandConstants.IMAGE_ROW]),u=parseInt(o[d][CommandConstants.IMAGE_COLUMN]),C=parseInt(o[d][CommandConstants.IMAGE_ROW_DIFF]),I=parseInt(o[d][CommandConstants.IMAGE_COL_DIFF]),f=E(m),p=getRowTop(g)+C,A=getColLeft(u)+I,R=ole(f);R.moveTo(A,p),t(f,R),n(R,A,p),a&&e===ActionConstants.IMAGE_MOVE&&ole(f)._setSelectLayer()}break;case ActionConstants.IMAGE_RESIZE:for(var d=0;c>d;d++){if(o[d][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var m=o[d][CommandConstants.IMAGE_ZINDEX].toString(),g=parseInt(o[d][CommandConstants.IMAGE_ROW]),u=parseInt(o[d][CommandConstants.IMAGE_COLUMN]),C=parseInt(o[d][CommandConstants.IMAGE_ROW_DIFF]),I=parseInt(o[d][CommandConstants.IMAGE_COL_DIFF]),f=E(m),p=getRowTop(g)+C,A=getColLeft(u)+I,M=parseInt(o[d][CommandConstants.IMAGE_WIDTH]),_=parseInt(o[d][CommandConstants.IMAGE_HEIGHT]),R=ole(f);R.moveTo(A,p).resizeTo(M,_),t(f,R),n(R,A,p),a&&ole(f)._setSelectLayer()}break;case ActionConstants.IMAGE_REMOVE:if(l)i(o,a);else for(var d=0;c>d;d++){if(o[d][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var O=o[d][CommandConstants.IMAGE_ZINDEX].toString(),f=E(O);r.splice(O,1),delete s[f],ole.remove(f,!1),ole.conf.onblur()}break;case ActionConstants.IMAGE_NEW:case ActionConstants.IMAGE_CLONE:if(l){for(var d=0;c>d;d++){if(o[d][JSONConstants.SHEET_NAME]!=CURRSHEETNAME)return;var O=o[d][CommandConstants.IMAGE_ZINDEX].toString(),f=E(O);r.splice(O,1),delete s[f],ole.remove(f,!1),ole.conf.onblur()}break}default:i(o,a)}}var s={},r=[],i=function(e,t){for(var n=e,o=n.length,a=0;o>a;a++){var r=n[a],i=r.sn;if(i!=CURRSHEETNAME)break;var d=r[CommandConstants.IMAGE_URL],m=r[CommandConstants.IMAGE_ZINDEX].toString(),E=r[CommandConstants.IMAGE_NAME],g=parseInt(r[CommandConstants.IMAGE_WIDTH]),C=parseInt(r[CommandConstants.IMAGE_HEIGHT]),I=r[CommandConstants.IMAGE_ID],f=parseInt(r[CommandConstants.IMAGE_ROW]),p=parseInt(r[CommandConstants.IMAGE_COLUMN]),A=parseInt(r[CommandConstants.IMAGE_ROW_DIFF]),R=parseInt(r[CommandConstants.IMAGE_COL_DIFF]),M=getRowTop(f)+A,_=getColLeft(p)+R,O=document.createElement("img");-1!=d.indexOf("u_n=")&&(d=c(d)),O.src=decodeURIComponent(d),O.id="img_"+I,O.name=E,O.height=C,O.width=g,O.className="img",O.objType="img",O.setAttribute("imgid",O.id);var h=M,v=_;O.style.top=h+"px",isRTL?(O.style.right=v+"px",O.style.left=""):(O.style.left=v+"px",O.style.right=""),O.style.position="absolute",sheetObjectsPane.appendChild(O),u(O.id),insertImgorChartIsFreezed(O,v,h),ole.init(O.id,h,v,C,g),ole(O.id).sCol=p,ole(O.id).sColDiff=R,ole(O.id).sRow=f,ole(O.id).sRowDiff=A,O.style.cursor="default",t&&ole(O.id)._setSelectLayer(),s[O.id]=O,l(m,O.id)}},l=function(e,t){if(void 0==r[e])r[e]=t;else{var n=r.slice(0,e),o=r.splice(e,r.length);n[e]=t;var a=n.concat(o);r=a}},c=function(e){return e=ctxpath+e+"&doc="+REMOTE_ENC_DOC_ID},d=function(){var e=!1,t=!1,n=!1;switch(getViewType()){case"SHARE_VIEW":if(!ALLOW_TO_WRITE)break;case"NEW_VIEW":case"OPEN_VIEW":ALLOW_TO_WRITE&&(e=!0,t=!0);break;case"REMOTE_VIEW":e=!1,t=!1,n=!1;break;case"REMOTE_SAVE_VIEW":case"PUBLIC_VIEW":isReadOnlyViewMode||(e=!0,t=!0,n=!0)}ole.setObjectProperties("img",{permissions:{isDraggable:e,isResizable:t,isEditable:n}})},m=function(e){return r.indexOf(e)},E=function(e){return r[e]},g=function(e,t,o){var a=getObj(e);if(null!==a&&READ_WRITE){var s=a.id,r=(a.name,s.substring(4,s.length),a.getAttribute("imgid")),i=m(r),l=ole(s);n(l,t,o);var c={row:ole(s).sRow,column:ole(s).sCol,sRowDiff:Math.round(ole(s).sRowDiff),sColDiff:Math.round(ole(s).sColDiff),zIndex:i},d=[c],E=new RequestParameters(ActionConstants.IMAGE_MOVE);E.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(d));var g=new AjaxRequest;g.init("POST",E.getURL(),!0,E.getParametersAsString()),actionManager.addRequest(g)}},u=function(t){jsVERSION_VIEW||e("#"+t).bind("contextmenu",function(n){ole(t)._setSelectLayer().positionActionBar();var o=getCursorPos(n),a=o.x,s=o.y,r=createImageContextMenu(),i={target:e(this),position:[a,s],clearcache:!0};sheetMenu.showMenu("imageRMenu",r,i),ole.contextMenuStatus=!0,e("#imageRMenu").show(),browser_ie&&(n=window.event),stopEvent(n)})},C=function(e,t,o){var a=getObj(e);if(null!==a&&READ_WRITE){{var s=a.getAttribute("imgid"),r=m(s),i=ole(a.id),l=parseInt(a.style[isRTL?"right":"left"]),c=parseInt(a.style.top),d=findColInXPos(l),E=findRowInYPos(c);c-getRowTop(E),l-getColLeft(d)}n(i,l,c);var g={row:i.sRow,column:i.sCol,sRowDiff:Math.round(i.sRowDiff),sColDiff:Math.round(i.sColDiff),zIndex:r,imgWd:parseInt(t),imgHt:parseInt(o)},u=[g],C=new RequestParameters(ActionConstants.IMAGE_RESIZE);C.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(u));var I=new AjaxRequest;I.init("POST",C.getURL(),!0,C.getParametersAsString()),actionManager.addRequest(I)}},I=function(){var e=ole.getCurrObj().el;if(null!==e&&READ_WRITE){var t=e.getAttribute("imgid"),n=m(t),o=e.width,a=e.height,s=ole(e.id),r=parseInt(e.style.left),i=parseInt(e.style.top),l=findColInXPos(r),c=findRowInYPos(i),d=(i-getRowTop(c),r-getColLeft(l),{row:s.sRow,column:s.sCol,sRowDiff:Math.round(s.sRowDiff),sColDiff:Math.round(s.sColDiff),zIndex:n,imgWd:parseInt(o),imgHt:parseInt(a)}),E=[d],g=new RequestParameters(ActionConstants.IMAGE_REMOVE);g.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(E));var u=new AjaxRequest;u.init("POST",g.getURL(),!0,g.getParametersAsString()),actionManager.addRequest(u)}},f=function(e){var t=document.getElementById(e),n=ole.getCurrObj(),o=t.naturalHeight,a=t.naturalWidth;n.resizeTo(a,o)._setSelectLayer(!0),C(e,a,o)},p=function(e){if("undefined"!=typeof e){var t=document.getElementById(e),n=document.createElement("canvas");if("undefined"==typeof n.getContext||!n.getContext)return!1;var o=n.getContext("2d"),a=t.width,s=t.height;n.width=a,n.height=s,n.style.width=a+"px",n.style.height=s+"px",o.drawImage(t,0,0,a,s);var r=t.getAttribute("src"),i=document.createElement("a"),l=-1!=r.indexOf("newimagedisplay")?!1:!0;if(l)c=r;else{var c=n.toDataURL("image/png;base64");c=c.replace("image/png","image/octet-stream")}var i=document.createElement("a");i.href=c,i.download=t.name,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},A=function(e){if("undefined"!=typeof e){var t=ole.getCurrObj().type,n=getObj(e),o=(n.src,new RequestParameters(ActionConstants.IMAGE_SAVE));if("chart"==t){var a=chartOnLoad.getInstance(e).co.options.title.text;o.setParameters(e,t,encodeURIComponent("ChartDisplay.do"),encodeURIComponent(a),WorkSheets.getActiveSheetName())}}try{isExportEvent=!0;var s=document.forms.utilFORM;s.method="post",s.action=o.getURL()+"?"+o.getParametersAsString(),s.zsreqcsr.value=readCookie(csrfCookieName),s.target="hid_imp_doc",getObj("utilFORMContainer").innerHTML="",s.submit()}catch(e){}},R=function(e){if(READ_WRITE){var t=getObj(e),n=parseInt(t.width)/2,o=parseInt(t.height)/2,a=parseInt(t.style.left)+n,s=parseInt(t.style.top)+o,r=findColInXPos(a),i=findRowInYPos(s),l=s-getRowTop(i),c=a-getColLeft(r),d=t.getAttribute("imgid"),E=m(d),g=new RequestParameters(ActionConstants.IMAGE_CLONE),u={row:i,column:r,sRowDiff:Math.round(l),sColDiff:Math.round(c),clonedZIndex:E},C=[u];g.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(C));var I=new AjaxRequest;I.init("POST",g.getURL(),!0,g.getParametersAsString()),actionManager.addRequest(I)}},M=function(){ole.getCurrObj()&&(getObj(ole.getCurrObj().id).style.background="")},_=function(e){var t=ole(e).el,n=t.width,o=t.height;C(t.id,n,o)},O=function(){var t=[],n=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.width+10),o=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.height+10);allowExport&&(t.push({data:"{label:'"+jsMsg["Image.SaveImageAs"]+"', appData:{dynamic:true, callback: 'insertImage.saveImage', arg:'"+ole.getCurrObj().id+"'}}"}),t.push({mtype:"separator"})),t.push({data:"{label:'"+jsMsg.Clone+"', appData:{dynamic:true, callback: 'ole.currObj.clone', arg: '1,"+n+","+o+"'}}"}),t.push({data:"{label:'"+jsMsg.Delete+"', appData:{dynamic:true, callback: 'ole.remove', arg:'"+ole.getCurrObj().id+",true'}}"});var a={target:e("#image_actionBar_moreActions"),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("imgMoreMenu",t,a)},h=function(e){ole(e).hideContextMenu()},v=function(e){var t=document.forms.frmUpload;"image_url"==e?(t.xfile.disabled=!0,t.urlfile.disabled=!1,t.image.checked=!1,getObj("loadtypeinput").style.display=""):"image"==e&&(t.urlfile.disabled=!0,t.xfile.disabled=!1,t.image_url.checked=!1,getObj("loadtypeinput").style.display="none")};return ole.createObjectProperties("img",{focusLayer:"OLEFocusLayer",selectLayer:"OLESelectLayer",minHeight:10,minWidth:10,hasOrdering:!1,contextMenu:"ImageConetextMenu",cloneOnCTRLDrag:!0,resizeCorners:"all",resizeCornersBehaviour:"Proportional",onResizeStart:v,onResizeEnd:C,onDragEnd:g,onRemove:I,onObjectSwitch:h,onEditLayerClick:appEvent.trigger("insertImageSelection"),onClone:R,onMove:h,onMoveEnd:g,onDeselect:M,onDocOpen:h,onSync:_,onMouseDownOutsideOLEElements:h}),appEvent.on("documentLoad",function(){d()}),appEvent.on("RTC",function(e,t){e[ActionConstants.UPDATE_IMAGE]&&a(e.a,e[ActionConstants.UPDATE_IMAGE],t,e.fromundo)}),{resizeToOriginalDim:f,saveImage:A,showMoreActionsMenu:O,image_check:v,updateImageJson:a,onClone:R,loadSheetImages:o,downloadImage:p}}(jQuery);
function initZohoDBService(){setZohoDBServiceDim()}function setZohoDBServiceDim(){if(browser_ie)var e=(document.body.clientWidth,document.body.clientHeight);else if(browser_nn4||browser_nn6)var e=(window.innerWidth,window.innerHeight);var i=e-findPosY(getObj("sheetdiv"))-getObj("bottomBand").offsetHeight;getObj("sheetdiv").style.height=i+"px"}function resetZohoDBServiceDim(){setZohoDBServiceDim()}var isZohoDBServiceOn;
function disableSaveButton(){isSaveButtonEnabled=!1,0==SAVED&&(btn_disabled(),isSaveButtonEnabled=!0)}function enableSaveButton(){(1==isSaveButtonEnabled||MACRO_DOC_SAVED&&!MACROSAVED)&&(READ_WRITE&&btn_enabled(),isSaveButtonEnabled=!1)}function closeScriptDialog(){ISMACROEDITOROPEN=!1,sheetdialog.allowToClose=!0,editAreaLoader.delete_instance("macrotextid"),enableSaveButton()}function closeEditorDialog(){if(ISMINDLG&&(dynele.style.display="none"),!MACRO_DOC_SAVED&&!jsVERSION_VIEW&&!jsPUBLIC_VIEW&&!jsGUEST_VIEW&&ALLOW_TO_WRITE){var e=showConfirmDialog(jsMsg.DoYouWantToSaveChanges);e?saveMacro():MACROSAVED=!0}clearErrorAndMsg(),MacroPanelState.tabs="",MACRO_DOC_SAVED=!0,ISMINDLG=!1,sheetdialog.close()}function showMacroEditorDialog(e,t,a,r){if(!jsPUBLIC_VIEW||READ_WRITE){VBAEDITORMODULENAME="",VBAEDITORLINENO="",VBAEDITORMODULETYPE="",VBAEDITORSHOW="";var n=getObj("macroPanel");if(n&&"none"!=n.style.display)return void hideMacroRecordPanel(function(){if(e){var r=t?t:"";showMacroEditorDialog(e,r,a)}else showMacroEditorDialog()});var o=findDocDim(),i=o.width-300;950>i&&(i=950);var s=(o.width-i)/2;if("undefined"!=typeof r&&""!=r?(MacroPanelState.tabs=r,MacroPanelState.lineNo=t):MacroPanelState.lineNo="",!ISMINDLG&&!ISMACROEDITOROPEN||ISMACRODOCCHANGE){if(sheetdialog.close(),ISMINDLG&&(dynele.style.display="none"),currentMdl={},ISMACRODOCCHANGE=!1,MacroPanelState.tabs=closetabs,callback_load="loadAllMacro",!isUndefined(t)&&null!=t&&""!=t&&isNaN(t))var l=t;else var d=t;var c=getCurrentSelectionRange(),m=new RequestParameters(ActionConstants.JSP_MACROEDITOR);m.setParameters(WorkSheets.getAssociatedActiveSheetName(),c.startRow,c.startCol,c.endRow,c.endCol,i,e,d,l,getViewType());var g=new AjaxRequest;g.init("POST",m.getURL(),!0,m.getParametersAsString()),g.addEventListener("onComplete",function(e){dlghtml=e.responseText,showDialog(dlghtml,"position=absolute,left="+s+",top=35, modal=yes, closeOnEscKey=no, closeButton=no, width="+i+" ,height="+(o.height-70),initEditArea,closeScriptDialog)}),g.sendRequest()}else ISMINDLG&&(dynele.style.display="none"),ISMACROEDITOROPEN?(toggleEditor(),"undefined"!=typeof e&&""!=e&&loadMacro(e,a,t)):(callback_load="loadOldMacro","undefined"!=typeof e&&""!=e&&(currentMdl.PREVIOUS=currentMdl.CURRENT,currentMdl.CURRENT=e,currentMdl.CTYPE=a,currentMdl.LINE=t,currentMdl.CURLINE=null),null!=macrodialog&&(dlghtml=UTIL.DOM.getOuterHTML(macrodialog)+UTIL.DOM.getOuterHTML(runMacroList),macrodialog=null),showDialog(dlghtml,"position=absolute,left="+s+",top=35, modal=yes, closeOnEscKey=no, closeButton=no, width="+i+" ,height="+(o.height-70),initEditArea,closeScriptDialog));ISMINDLG=!1,ISMACROEDITOROPEN=!0}}function runCodeMacro(e,t,a){if("true"!=getObj("run_td").getAttribute("iconDisabled")&&(t!=ActionConstants.MACRO_SAVE_RUN||!(jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW))){disableError(),disableMessage();var r=getObj("busydiv");r&&(r.innerHTML=jsMsg.Running+"...",r.style.display="");var n=(window.frames.frame_macrotextid.editArea,getModuleContent());checkMacroTriggerObj.isMacroTrigger=!0;var o=getCurrentSelectionRange(),i=new RequestParameters(t);i.setParameters(WorkSheets.getAssociatedActiveSheetName(),o.startRow,o.startCol,o.endRow,o.endCol,e,null,a,n);var s=new AjaxRequest;s.init("POST",i.getURL(),!0,i.getParametersAsString()),s.addEventListener("onComplete",callBack_runCodeMacro,t),enableSaveButtonForMacro&&READ_WRITE&&!ISMACROEDITOROPEN?(btn_enabled(),enableSaveButtonForMacro=!1):t!=ActionConstants.MACRO_SAVE_RUN||enableSaveButtonForMacro||btn_disabled(),s.sendRequest()}}function runmacro(e,t,a,r,n,o,i,s,l){if(ISMACROEDITOROPEN||sheetdialog.close(),!isSheetBasedShare||"true"==a.toString()){disableError(),disableMessage();var d,c=getObj("busydiv");if(c?(c.style.display="",l?(Button.visualiseMacroExecution(arguments[2]),d=arguments[2],arguments[2]=void 0):c.innerHTML=jsMsg.Running+" - '"+escapeSpecialCharacters(t)+"'"):l?(Button.visualiseMacroExecution(arguments[2]),d=arguments[2],arguments[2]=void 0):showProgressMessage(jsMsg.Running+" - '"+t+"'"),"undefined"==typeof a)a=!1;else if(r===ActionConstants.MACRO_RUN||r===ActionConstants.MACRO_SAVE_RUN){var m=replaceParams(jsMsg.UserhasModifiedTheModule,new Array(escapeSpecialCharacters(n),escapeSpecialCharacters(t)));SheetNotifier.open({type:"PopUp",content:m})}"undefined"==typeof r&&(r=ActionConstants.MACRO_RUN);var g=!0,u=getObj("MacroList");null!=u&&"none"!=u.style.display&&(closeMacroList(),g=!1);var M;M=i?i:getCurrentSelection(),"undefined"==typeof s&&(s=CURRSHEETNAME);var b=getCurrentSelectionRange();if(s=WorkSheets.getSheetCodeFromName(s),void 0!=s){var f=new RequestParameters(r);f.setParameters(s,b.startRow,b.startCol,b.endRow,b.endCol,e,t);var E=new AjaxRequest;E.init("POST",f.getURL(),!0,f.getParametersAsString()),g||E.addEventListener("onBeforeSend",function(){if(!ISMINDLG&&ISMACROEDITOROPEN){var e=window.frames.frame_macrotextid.editArea,t=editAreaLoader.getSelectionRange("macrotextid");e.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",t.start,t.end)}}),E.addEventListener("onComplete",callBack_runMacro,l,g,s,d),checkMacroTriggerObj.isMacroTrigger=!0,E.sendRequest()}}}function loadMacro(e,t,a){var r,n=window.frames.frame_macrotextid.editArea;"undefined"!=typeof currentMdl.PREVIOUS&&""!=currentMdl.PREVIOUS?(r=getObj("tr_"+currentMdl.PREVIOUS),currentMdl.PREVIOUS=""):"undefined"!=typeof currentMdl.CURRENT&&(r=getObj("tr_"+currentMdl.CURRENT)),r&&(r.cells[r.cells.length-1].getElementsByTagName("A")[0].className=""),clearModuleHiglight(),1==errorObj.ISERROR&&(enableError(),"undefined"!=typeof errorObj.MODULENAME&&""!=errorObj.MODULENAME&&"unknown"!=errorObj.MODULENAME&&(errorObj.MODULENAME==e?showMacroError():disableError())),currentMdl.CURRENT=e;var o=getObj("tr_"+e);if(null!=o){o.cells[o.cells.length-1].getElementsByTagName("A")[0].className="scriptExplrSeletedObject"}currentMdl.CTYPE=t,n.execCommand("switch_to_file",e),getObj("modulename").innerHTML=escapeSpecialCharacters(e),jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW||!ALLOW_TO_WRITE||(5==t?(getObj("events").style.display="none",getObj("arrow").style.display="none"):(getObj("arrow").style.display="",getObj("events").style.display=""),1==t?(getObj("sheetevents").style.display="",getObj("workbookevents").style.display="none"):2==t&&(getObj("sheetevents").style.display="none",getObj("workbookevents").style.display=""),"undefined"!=typeof a&&n.execCommand("go_to_line",a))}function saveMacro(){if(!(jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW||MACROSAVED)&&ALLOW_TO_WRITE){var e=DOCUMENT_NAME;if(""!=e&&null!=e){var t;if(window.frames.frame_macrotextid&&(t=window.frames.frame_macrotextid.editArea,null!=t.textarea&&"undefined"!=typeof t.textarea)){var a=editAreaLoader.getSelectionRange("macrotextid");t.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",a.start,a.end)}var r=getModuleContent(),n=getObj("busydiv");n&&(n.innerHTML=jsMsg.Saving,n.style.display="");var o=new RequestParameters(ActionConstants.MACRO_SAVE);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),r);var i=new AjaxRequest;i.init("POST",o.getURL(),!0,o.getParametersAsString()),checkMacroTriggerObj.isMacroTrigger=!0,i.sendRequest()}}}function prepare(e){if(window.frames.frame_macrotextid){var t=window.frames.frame_macrotextid.editArea;if(null!=t.textarea&&"undefined"!=typeof t.textarea){var a=editAreaLoader.getSelectionRange("macrotextid");t.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",a.start,a.end);var r=editAreaLoader.getCurrentFile("macrotextid").id;runCodeMacro(r,e,t.get_selection_infos().line_start)}}}function closeMacroList(){getObj("RunMacroList").style.display="none",ISMACROEDITOROPEN||sheetdialog.close()}function deleteMacro(e,t,a){if("undefined"==typeof a&&(a=!1),0==a)var r=showConfirmDialog(replaceParams(jsMsg.AreYouSureToDeleteMacro,new Array(t)));if(1==r||1==a){var n=new RequestParameters(ActionConstants.MACRO_DELETE);n.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,t);var o=new AjaxRequest;o.init("POST",n.getURL(),!0,n.getParametersAsString()),checkMacroTriggerObj.isMacroTrigger=!0,o.sendRequest()}}function sheetEvent(e){var t="\n";is_ie&&(t="\r\n");var a=e.options[e.selectedIndex].value;if("none"!=a){var r,n=editAreaLoader.getCurrentFile("macrotextid").text,o=new RegExp("Sub\\s+"+a,"i"),i=o.exec(n);if(null!=i)r=n.indexOf("\n",i.index)+1;else{var s="",l="";"\n"!=n.charAt(n.length-1)&&(s=t),s+=e[e.selectedIndex].getAttribute("param"),"Worksheet_Change"==a?(s+=t+"Application.EnableEvents = false",s+=t+"On Error Goto ENEV",s+=t+"REM add your code below",s+=t,l+=t+"ENEV:",l+=t+"Application.EnableEvents = true"):l+=t,l+=t+"End Sub"+t,window.frames.frame_macrotextid.editArea.textarea.value+=s+l,n=window.frames.frame_macrotextid.editArea.textarea.value,r=n.length-l.length}window.frames.frame_macrotextid.editArea.area_select(r,0),e.selectedIndex=0,MacroBtn_enabled()}}function initEditArea(){sheetdialog.allowToClose=!1;var e=getObj("mdlcontDIV");e.style.display="",null==macrodialog&&(macrodialog=e.cloneNode(!0));var t=e.getElementsByTagName("IFRAME")[0];null!=t&&t.parentNode.removeChild(t);var a=(findDocDim(),getObj("macroBrowser")),r=getObj("macrotextid"),n=e.offsetHeight,o=5;a&&(is_ie?a.style.height=getObj("objbrowser").offsetHeight+"px":(a.style.height=getObj("objbrowser").offsetHeight-o+"px",r.style.display="none")),r.style.height="100%",MACROSAVED&&macroBtn_disabled(),editAreaLoader.init({id:"macrotextid",syntax:"vb",start_highlight:!0,allow_resize:"no",allow_toggle:!1,font_size:10,font_family:"monospace",max_undo:20,EA_load_callback:callback_load,height:n,replace_tab_by_spaces:4})}function deleteMacroRow(e,t){var a=getObj(e+"."+t);if(a){var r=a.parentNode;if(r.removeChild(a),isSaveButtonEnabled=!0,"undefined"!=typeof r.rows&&1==r.rows.length){var n=getObj("nomacrotr");n.style.display=""}}}function toggleEditor(){if(!RECORDINGMACRO)if(ISMINDLG)ISMACROEDITOROPEN?ISMACRODOCCHANGE?(closeEditorDialog(),showMacroEditorDialog()):(ISMINDLG=!1,recallDialog(),window.frames.frame_macrotextid.editArea.textarea.focus(),"undefined"!=typeof currentMdl.CURLINE&&null!=currentMdl.CURLINE&&("undefined"!=typeof currentMdl.CURLINE.start?editAreaLoader.setSelectionRange("macrotextid",currentMdl.CURLINE.start,currentMdl.CURLINE.end):window.frames.frame_macrotextid.editArea.execCommand("go_to_line",currentMdl.CURLINE)),MACROSAVED&&macroBtn_disabled()):showMacroEditorDialog(),dynele.style.display="none";else{ISMINDLG=!0;var e=getObj("mdlcontDIV");for(null!=e&&(macrodialog=e.cloneNode(!0),runMacroList=getObj("RunMacroList").cloneNode(!0)),ISMACROEDITOROPEN=!0,currentMdl.CURLINE=editAreaLoader.getSelectionRange("macrotextid"),i=0;i<mdlnames.length;i++)module_content[i]=editAreaLoader.getFile("macrotextid",mdlnames[i]).text;var t=getObj("titlebar");t&&(minbarhtml=getObj("minimizediv").innerHTML,""==minbarhtml&&(minbarhtml='<table width="100%" height="25" border="0" cellspacing="0" cellpadding="0" class="scriptEditorDialog">',minbarhtml+='<tr><td class="scriptEditorDialogTitleBar">'+t.innerHTML+"</td></tr></table>"),document.getElementsByTagName("body")[0].appendChild(dynele),dynele.id="mindlg",dynele.innerHTML=getObj("minimizediv").innerHTML,dynele.style.position="absolute",dynele.style.zIndex="1001",dynele.style.left=findPosX(t)+"px",dynele.style.top=findPosY(t)+"px",dynele.style.display="",dynele.style.height="25px",dynele.style.width="150px"),minimizedlg(),sheetdialog.close(),hideDialog(),ole.isActive()?ole.conf.onfocus():setFocusInCellField()}}function minimizedlg(){$("#mindlg").animate({top:"0px"},500)}function showInsertMethod(){closeAllPopup(),$("#insertdiv").show(),$("#insertdiv").css({width:"23.5%",top:"20%",left:"40%"});var e=getObj("functionname");e.value="",e.focus()}function insertMethod(){var e="\n";is_ie&&(e="\r\n");var t=document.forms.insertform.functionname.value;if(t=t.trim(),0==t.length)return showAlertDialog(jsMsg.ProcedureNameCannotBeEmpty),document.forms.insertform.functionname.focus(),!1;var a=checkMacroName(t);if(a>0)return showAlertDialog(1==a?jsMsg.ProcedureNameCannotContainMsg:2==a?jsMsg.ProcedureNameStartWithMsg:jsMsg.ProcedureNameInEnglish),document.forms.insertform.functionname.select(),!1;getObj("insertdiv").style.display="none";var r=window.frames.frame_macrotextid.editArea.textarea.value,n="";"\n"!=r.charAt(r.length-1)&&(n=e),n+=document.forms.insertform.insertscope.value+" "+document.forms.insertform.methodtype.value+" "+t+"()"+e;var o=e+"End "+document.forms.insertform.methodtype.value+e;window.frames.frame_macrotextid.editArea.textarea.value+=n+o,r=window.frames.frame_macrotextid.editArea.textarea.value;var i=r.length-o.length;return window.frames.frame_macrotextid.editArea.area_select(i,0),MacroBtn_enabled(),window.frames.frame_macrotextid.editArea.execCommand("check_undo",!0),!1}function closeInsertDiv(){getObj("insertdiv").style.display="none",window.frames.frame_macrotextid.editArea.textarea.focus()}function setScope(e){document.forms.insertform.insertscope.value=e.value}function editor_undo(){window.frames.frame_macrotextid.editArea.execCommand("undo")}function editor_redo(){window.frames.frame_macrotextid.editArea.execCommand("redo")}function editor_find(){window.frames.frame_macrotextid.editArea.execCommand("show_search")}function editor_goto(){var e=parseInt($("#lineNo").text());if(isNaN(e)){var t=getObj("lineNo"),e=t.value;if(isNaN(e)||""===e)return showAlertDialog(jsMsg.PleaseEnterAnInteger),setTimeout(function(){$(".ui-dialog").filter(":visible").zIndex(100002)},200),$("#lineNo").select(),!1}return closeGotoDiv(),window.frames.frame_macrotextid.editArea.execCommand("go_to_line",e+""),!1}function closeGotoDiv(){$("#lineNo").text(""),getObj("gotodiv").style.display="none",window.frames.frame_macrotextid.editArea.textarea.focus()}function showGoto(){$("#gotodiv").css({position:"absolute",left:"45%",top:"30%"}),$("#gotodiv").show(),$("#lineNo").focus(),$("#lineNo").select()}function expandObjectExplorer(e){var t,a=getObj(e),r=a.parentNode,n=a.getAttribute("expand"),o=o=r.rows.length;if("ObjectExplore"==e?(t=1,0!=custommdlcnt&&(o=o-custommdlcnt-1)):t=r.rows.length-custommdlcnt,"true"==n){for(var i=t;o>i;i++)r.rows[i].style.display="";a.setAttribute("expand","false"),a.cells[0].getElementsByTagName("img")[0].className="mainBgImg macroItemCol",a.cells[1].getElementsByTagName("IMG")[0].className="ObjectExplore"==e?"mainBgImg scriptExplrObjectOpenFolder":"mainBgImg scriptExplrModuleOpenFolder"}else{for(var i=t;o>i;i++)r.rows[i].style.display="none";a.setAttribute("expand","true"),a.cells[0].getElementsByTagName("img")[0].className="mainBgImg macroItemExp",a.cells[1].getElementsByTagName("IMG")[0].className="ObjectExplore"==e?"mainBgImg scriptExplrObjectFolder":"mainBgImg scriptExplrModuleFolder"}}function macroBtn_disabled(){if(MACROSAVED=!0,MACRO_DOC_SAVED=!0,null!=getObj("save_img")&&null!=getObj("save_td")){getObj("save_img").src=IMAGE_PATH+"save_disabled.png","false"==getObj("saverun_td").getAttribute("iconDisabled")&&(getObj("saverun_img").src=IMAGE_PATH+"saveRun_disabled.png"),getObj("save_td").setAttribute("displayState","disabled");var e=getIconText(getObj("save_td"));""!=e&&(e.className="disabled")}(jsREMOTE_SAVE_VIEW||isEdit)&&null!=getObj("save_img")&&(getObj("save_img").src=IMAGE_PATH+"save_disabled.png")}function MacroBtn_enabled(){if(MACROSAVED){if(null!=getObj("save_img")&&null!=getObj("save_td")){getObj("save_img").src=IMAGE_PATH+"save.png","false"==getObj("saverun_td").getAttribute("iconDisabled")&&(getObj("saverun_img").src=IMAGE_PATH+"saveRun.png"),getObj("save_td").setAttribute("displayState","enabled");var e=getIconText(getObj("save_td"));""!=e&&(e.className="")}(jsREMOTE_SAVE_VIEW||isEdit)&&null!=getObj("save_img")&&(getObj("save_img").src=IMAGE_PATH+"save.png")}MACROSAVED=!1,MACRO_DOC_SAVED=!1}function loadOldMacro(){jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW||!ALLOW_TO_WRITE||disableRun();var e=MacroPanelState.tabs;(is_ie&&browser_ie6||!is_ie)&&(document.getElementById("frame_macrotextid").style.width="100%");var t=getObj("scriptEditorToolbar");if(registerIconEvents(t.getElementsByTagName("TD")),0==MacroPanelState.explorer){var a=getObj("objbrowser");a.style.display="",hideObjectExplorer()}for(var r=0;r<mdlnames.length;r++){var n={id:mdlnames[r],text:module_content[r],syntax:"vb"};editAreaLoader.openFile("macrotextid",n)}if(0!=sheetOperations.length){for(var o in sheetOperations)"undefined"!=typeof sheetOperations[o].a&&updateSheetChangesInEditor(sheetOperations[o]);sheetOperations=[]}handleMacroErrorAndMsg(errorObj,null,!0),"undefined"!=typeof e&&""!=e&&(window[e],""!=MacroPanelState.lineNo&&window.frames.frame_macrotextid.editArea.execCommand("go_to_line",MacroPanelState.lineNo)),"undefined"!=typeof currentMdl.CURRENT&&null!=currentMdl.CURRENT?"undefined"!=typeof currentMdl.CURLINE&&null!=currentMdl.CURLINE?(loadMacro(currentMdl.CURRENT,currentMdl.CTYPE),window.frames.frame_macrotextid.editArea.textarea.focus(),editAreaLoader.setSelectionRange("macrotextid",currentMdl.CURLINE.start,currentMdl.CURLINE.end)):loadMacro(currentMdl.CURRENT,currentMdl.CTYPE,currentMdl.LINE):loadMacro("Macros",5)}function updateSheetOperations(e){sheetOperations.push(e)}function getModuleIndex(e){var t;for(t=0;t<mdlnames.length;t++)if(mdlnames[t]==e)return t;return null}function showObjectExplorer(){getObj("frame_macrotextid").style.width="1px";var e=getObj("hideimg"),t=getObj("expandimg"),a=getObj("objbrowser");MacroPanelState.explorer=!0,t.style.display="none",a.style.display="",e.style.display="",e.parentNode.parentNode.className="scriptObjExporerShow",window.frames.frame_macrotextid.editArea.manage_width()}function hideObjectExplorer(){var e=getObj("objbrowser");if("none"==e.style.display)return void showObjectExplorer();var t=getObj("hideimg"),a=getObj("expandimg");a.style.display="",e.style.display="none",t.style.display="none",t.parentNode.parentNode.className="scriptObjExporerHide",MacroPanelState.explorer=!1,window.frames.frame_macrotextid.editArea.manage_width()}function closetabs(){MacroPanelState.tabs="",window.frames.frame_macrotextid.editArea.execCommand("hidden_tabs")}function showWarning(){var e=getObj("warningtd");e&&(window.frames.frame_macrotextid.editArea.execCommand("show_tabs","warningtab"),MacroPanelState.tabs=showWarning)}function enableWarning(){var e=getObj("warningtd");e&&(e.setAttribute("displayState","enabled"),window.frames.frame_macrotextid.editArea.execCommand("close_empty","warn"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+".png",e.title=replaceParams(jsMsg.nWarning,new Array("1")),showWarning())}function disableWarning(){var e=getObj("warningtd");e&&(e.setAttribute("displayState","disabled"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+"_disabled.png",window.frames.frame_macrotextid.editArea.execCommand("show_empty","warn"),e.title=jsMsg.ZeroWarnings)}function enableError(){var e=getObj("errortd");e&&(e.setAttribute("displayState","enabled"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+".png",window.frames.frame_macrotextid.editArea.execCommand("close_empty","error"),e.title=replaceParams(jsMsg.nError,new Array("1")))}function showMacroError(){var e=getObj("errortd");e&&(window.frames.frame_macrotextid.editArea.execCommand("show_tabs","errortab"),MacroPanelState.tabs=showMacroError)}function disableError(){var e=getObj("errortd");e&&(e.setAttribute("displayState","disabled"),window.frames.frame_macrotextid.editArea.execCommand("show_empty","error"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+"_disabled.png",e.title=jsMsg.ZeroErrors)}function showMessage(){var e=getObj("msgboxtd");e&&(window.frames.frame_macrotextid.editArea.execCommand("show_tabs","msgboxtab"),MacroPanelState.tabs=showMessage)}function enableMessage(){var e=getObj("msgboxtd");e&&(e.setAttribute("displayState","enabled"),window.frames.frame_macrotextid.editArea.execCommand("close_empty","msg"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+".png",e.title=1==errorObj.MSGCNT?replaceParams(jsMsg.nMessage,new Array(""+errorObj.MSGCNT)):replaceParams(jsMsg.nMessages,new Array(""+errorObj.MSGCNT)))}function disableMessage(){var e=getObj("msgboxtd");e&&(e.setAttribute("displayState","disabled"),window.frames.frame_macrotextid.editArea.execCommand("show_empty","msg"),e.firstChild.src=IMAGE_PATH+e.getAttribute("imgName")+"_disabled.png",e.title=jsMsg.ZeroMessages)}function enableEvents(){var e=getObj("busydiv");e.innerHTML=jsMsg.EnableEvents,e.style.display="";var t=new RequestParameters(ActionConstants.ENABLE_EVENTS),a=new AjaxRequest;a.init("POST",t.getURL(),!0,t.getParametersAsString()),a.addEventListener("onComplete",callBack_enableEvents),checkMacroTriggerObj.isMacroTrigger=!0,a.sendRequest()}function showMsgBox(e){var t=getObj("msgboxtr");"none"==t.style.display?(t.style.display="",document.getElementById("msgBoxInd").style.paddingBottom="10px",e.value=jsMsg.HideMessages):(t.style.display="none",e.value=jsMsg.ShowMessages)}function insertMessage(e){"undefined"==typeof errorObj.MSGCNT?errorObj.MSGCNT=1:errorObj.MSGCNT++,!ISMINDLG&&ISMACROEDITOROPEN&&window.frames.frame_macrotextid.editArea.execCommand("insert_msg",e)}function clearMessage(){"undefined"!=typeof errorObj.MSGCNT&&(errorObj.MSGCNT=0),!ISMINDLG&&ISMACROEDITOROPEN&&window.frames.frame_macrotextid.editArea.execCommand("clear_msg")}function insertError(e){!ISMINDLG&&ISMACROEDITOROPEN&&window.frames.frame_macrotextid.editArea.execCommand("insert_error",e)}function higlightModule(e){clearModuleHiglight(),e.className="scriptExplrSeletedObject","true"==e.parentNode.parentNode.getAttribute("expand")&&expandObjectExplorer(e.parentNode.parentNode.id);var t=getObj("tr_"+currentMdl.CURRENT);t&&(t.cells[t.cells.length-1].getElementsByTagName("A")[0].className="scriptExplrPrevSeletedObject")}function clearModuleHiglight(){var e=getObj("ObjectExplore"),t=getObj("ModuleExplore");e&&(e.cells[e.cells.length-1].getElementsByTagName("A")[0].className=""),t&&(t.cells[t.cells.length-1].getElementsByTagName("A")[0].className="")}function checkMacroName(e){var t=new RegExp("[\\u00A1-\\uFFFF]+");if(t.test(e))return 3;if(t=new RegExp("^[a-zA-Z0-9_]+$"),t.test(e)){var t=new RegExp("^[a-zA-Z][a-zA-Z0-9_]*$");return t.test(e)?0:2}return 1}function closeAllPopup(){getObj("RunMacroList").style.display="none",getObj("insertdiv").style.display="none",getObj("gotodiv").style.display="none"}function cancelError(){clearErrorAndMsg(),sheetdialog.close()}function clearErrorAndMsg(){errorObj={},"undefined"!=typeof msgboxArray&&(msgboxArray=[]),errorObj.ISERROR=!1}function showHelpMenu(){var e=[];HIDE_MACRO_HELP_LINK?e.push({data:"{label:'"+jsMsg.VBAObjectExplorer+"', appData:{dynamic:true, callback: 'showHelp', arg:'vbaobjectexplorer.do'}}"}):(e.push({data:"{label:'"+jsMsg.VBAProgramming+"', appData:{dynamic:true, callback: 'showHelp'}}"}),e.push({data:"{label:'"+jsMsg.VBAObjectExplorer+"', appData:{dynamic:true, callback: 'showHelp', arg:'vbaobjectexplorer.do'}}"}),e.push({mtype:"separator"}),e.push({data:"{label:'"+jsMsg.WhatIsMacro+"', appData:{dynamic:true, callback: 'showHelp'}}"}),e.push({data:"{label:'"+jsMsg.SampleMacros+"', appData:{dynamic:true, callback: 'showHelp', arg:'SampleMacros'}}"}),e.push({data:"{label:'"+jsMsg.UserContributedMacros+"', appData:{dynamic:true, callback: 'showHelp', arg:'UserMacros'}}"}));var t={target:$("#macro_help"),clearcache:!1,menuoptions:{type:"text_only"}};sheetMenu.showMenu("vbaeditorHelpMenu",e,t),$("#vbaeditorHelpMenu").css("z-index","999999")}function showHelp(e){var t;t="undefined"!=typeof e?"SampleMacros"==e?jsMsg["Macros.Help.WikiURL"]+"Sample-Macros.html":"UserMacros"==e?jsMsg["Macros.Help.WikiURL"]+"User-Contributed-Macros.html":ctxpath+e:jsMsg["Macros.Help.WikiURL"],window.open(t)}function disableRun(){var e=getObj("run_td");if(null!==e)if(isSSActive){e.setAttribute("iconDisabled","false"),e.getElementsByTagName("IMG")[0].className="runMacro",getObj("saverun_td").setAttribute("iconDisabled","false"),getObj("saverun_img").src=MACROSAVED?IMAGE_PATH+"saveRun_disabled.png":IMAGE_PATH+"saveRun.png";var t=getIconText(getObj("saverun_td"));""!=t&&(t.className=""),t=getIconText(getObj("run_td")),""!=t&&(t.className="")}else{e.setAttribute("iconDisabled","true"),e.getElementsByTagName("IMG")[0].className="runMacroDisabled",getObj("saverun_td").setAttribute("iconDisabled","true"),getObj("saverun_img").src=IMAGE_PATH+"saveAndRunDisabled.png";var t=getIconText(getObj("saverun_td"));""!=t&&(t.className="disabled"),t=getIconText(getObj("run_td")),""!=t&&(t.className="disabled")}}function callBack_runCodeMacro(e,t){var a=e.responseText;checkMacroTriggerObj.isMacroTrigger=!1,t==ActionConstants.MACRO_SAVE_RUN?(macroBtn_disabled(),isSaveButtonEnabled=!1):(MACRO_DOC_SAVED=!0,isSaveButtonEnabled=!0);var r=getObj("busydiv");if(r.style.display="none",a.trim().length>0){var n=parseJSON(a);t==ActionConstants.MACRO_SAVE_RUN&&"doc_id"==DOCUMENT_ID&&(getObj("docNameSpan").innerHTML=docname),"undefined"!=typeof n.MACROTABLE?"NOMACROS"==n.MACROTABLE?(disableError(),disableMessage(),showAlertDialog(jsMsg.NoMacrosFound)):(closeAllPopup(),updateMacros(n),getObj("RunMacroList").style.display=""):updateJson(n)}}function callBack_runMacro(e,t,a,r,n){checkMacroTriggerObj.isMacroTrigger=!1;var o=getObj("RunMacroList");t&&(Button.removeVisuals(n),n=void 0),o&&(o.style.display="none");enableSaveButtonForMacro&&READ_WRITE&&(btn_enabled(),enableSaveButtonForMacro=!1);var i=getObj("busydiv");i?(i.style.display="none",setTimeout(function(){i.innerHTML="Updating"},5)):t||hideProgressMessage()}function callBack_saveMacro(e){checkMacroTriggerObj.isMacroTrigger=!1,macroBtn_disabled(),isSaveButtonEnabled=!1,!enableSaveButtonForMacro&&READ_WRITE&&btn_disabled();var t=getObj("busydiv");t&&(t.style.display="none");if(ISMACROEDITOROPEN){var a=window.frames.frame_macrotextid.editArea;for(i=0;i<mdlnames.length;i++)a.files[mdlnames[i]].compare_edited_text=editAreaLoader.getFile("macrotextid",mdlnames[i]).text}}function callBack_deleteMacro(e){if(checkMacroTriggerObj.isMacroTrigger=!1,enableSaveButtonForMacro&&READ_WRITE&&(btn_enabled(),enableSaveButtonForMacro=!1),deleteMacroRow(e.modN,e.macN),ISMINDLG&&!ISMACROEDITOROPEN){var t=getModuleIndex(e.modN);module_content[t]=e.mc}}function callBack_enableEvents(){checkMacroTriggerObj.isMacroTrigger=!1,enableSaveButtonForMacro&&READ_WRITE&&(btn_enabled(),enableSaveButtonForMacro=!1);var e=getObj("busydiv");e.style.display="none",disableWarning()}function pullMacroContent(e,t){var a=new RequestParameters(ActionConstants.MACRO_CONTENT_CHANGED);a.setParameters(JSON.stringify(e),t);var r=new AjaxRequest;r.init("POST",a.getURL(),!0,a.getParametersAsString()),r.addEventListener("onComplete",updateMacroContent),r.sendRequest()}function updateMacroContent(e){for(var t=parseJSON(e.responseText),a=t.mc,r=a.length,n=0;r>n;n++)if(ISMINDLG){var o=getModuleIndex(a[n].n);if(null!=o&&(module_content[o]=a[n].c),ISMACROEDITOROPEN){var i=window.frames.frame_macrotextid.editArea;editAreaLoader.getFile("macrotextid",a[n].n).text=a[n].c,i.files[a[n].n].compare_edited_text=a[n].c,a[n].n==editAreaLoader.getCurrentFile("macrotextid").id&&(i.textarea.value=a[n].c)}}else if(ISMACROEDITOROPEN){var i=window.frames.frame_macrotextid.editArea;if(editAreaLoader.getFile("macrotextid",a[n].n).text=a[n].c,i.files[a[n].n].compare_edited_text=a[n].c,a[n].n==editAreaLoader.getCurrentFile("macrotextid").id){i.textarea.value=a[n].c;var s=showConfirmDialog(replaceParams(jsMsg.UserhasModifiedTheModule,new Array(t.ao,a[n].n))+"\n"+jsMsg.DoYouWantToReloadIt);if(s){var l=editAreaLoader.getSelectionRange("macrotextid");i.textarea.focus(),i.display_file(editAreaLoader.getCurrentFile("macrotextid").id),editAreaLoader.setSelectionRange("macrotextid",l.start,l.end)}}}}function viewSheetCode(){showMacroEditorDialog(currSheetOnRightClick,1,1)}function getModuleContent(){var e,t=[],a=!1;if(!MACRO_DOC_SAVED)if(ISMACROEDITOROPEN)for(e=0;e<mdlnames.length;e++){var r=editAreaLoader.getFile("macrotextid",mdlnames[e]).text,n=window.frames.frame_macrotextid.editArea;if(n.files[mdlnames[e]].compare_edited_text!=r){var o={};o.mname=mdlnames[e],o.mcontent=encodeURIComponent(r),t.push(o),a=!0}}else for(e=0;e<mdlnames.length;e++){var o={};o.mname=mdlnames[e],o.mcontent=encodeURIComponent(module_content[e]),t.push(o),a=!0}return t=a?JSON.stringify(t):null}var isSaveButtonEnabled=!1,mdlnames=[],minbarhtml="",dynele=document.createElement("DIV"),macrodialog=null,runMacroList,xMinVal=0,yMinVal=0,minWidth=0,dlghtml="",module_content=[],callback_load="loadAllMacro",sheetOperations=[],custommdlcnt=0,currentMdl={},macroActionsMenuStatus=!1,errorObj={};errorObj.ISERROR=!1;var MacroPanelState={};MacroPanelState.explorer=!0,MacroPanelState.tabs="",MacroPanelState.find=!1;var gotoform=$("#gotoform"),checkMacroTriggerObj={isMacroTrigger:!1,isAutoSaveForMacro:!1},previousMdl="";
function handleError(e,r,a){if(0==e.ISERROR&&0==msgboxArray.length)return disableError(),void disableMessage();0==e.ISERROR&&disableError(),0==msgboxArray.length&&disableMessage(),"undefined"==typeof r&&(r=!1);var n="";if(0!=msgboxArray.length){clearMessage(),n="[";for(x in msgboxArray)"undefined"!=typeof msgboxArray[x].M&&(1==r?(n+='{"M":"'+encodeURIComponent(escapeSpecialCharacters(msgboxArray[x].M))+'",',n+='"L":"'+msgboxArray[x].L+'",',n+='"MT":"'+msgboxArray[x].MT+'",',n+='"MN":"'+msgboxArray[x].MN+'"},'):insertMessage(msgboxArray[x]));n+="]"}if(1==r){var s="";if(1==e.ISERROR&&(s="error="+encodeURIComponent(e.MESSAGE)+"&moduleName="+e.MODULENAME+"&lineNo="+e.LINE+"&modType="+e.MODULETYPE),""!=n||""!=s){var o=new RequestParameters(ActionConstants.JSP_MACROERROR);o.setParameters(encodeURIComponent(n));var t=new AjaxRequest;t.init("POST",o.getURL(),!0,o.getParametersAsString()),t.addEventListener("onComplete",function(r){var a=jsMsg.Error;e.ISERROR||(a=jsMsg.MessageBox);var n={width:450,title:a};sheetdialog.open(r.responseText,n)}),t.sendRequest()}else 0!=msgboxArray.length&&enableMessage(),"undefined"==typeof a&&(a=!1),1==e.ISERROR?(insertError(e),"undefined"!=typeof e.MODULENAME&&"unknown"!=e.MODULENAME&&loadMacro(e.MODULENAME,e.MODULETYPE,""+e.LINE),enableError(),a&&""==MacroPanelState.tabs||showMacroError()):0!=msgboxArray.length&&(a&&""==MacroPanelState.tabs||showMessage())}}function handleWarningTab(e){var r=getObj("warningtd");r&&(0==e?enableWarning():"none"!=r.style.display&&disableWarning())}var othersheetChanges={},sheetName={},selectedRange=null,chartList,msgboxArray=[],refreshSheet=!1,tileReloaded=!1,enableSaveButtonForMacro=!1;
function recordMacro(e,t,o){isMacroButtonsInitialised||(isMacroButtonsInitialised=!0,$.ui.utils.initDeferredComponents({zbutton:"#stopmacros,#cancelMacroRecord, #viewMacrosList, #viewRecordedMacro"},10));var a=getCurrentSelectionRange(),s=new RequestParameters(ActionConstants.MACRO_START_RECORDING);s.setParameters(CURRSHEETNAME,currRow,currCol,a.startRow,a.startCol,a.endRow,a.endCol,e,o,encodeURIComponent(t));var r=new AjaxRequest;r.init("POST",s.getURL(),!0,s.getParametersAsString()),r.addEventListener("onComplete",function(t){var o=t.responseText.trim();if("new"==o){sheetdialog.close(),RECORDINGMACRO=!0,widgetmenu.initmacroswidgets("disable"),CURRENTLYRECORDEDMACRO=e;var a=getObj("macroRecordedPanel");a.style.opacity="1",a.style.display="none",a.style.filter="alpha(opacity=100)";var s=getObj("macroRecordingPanel");s.style.opacity="1",s.style.display="",$("#stoprecordmacro").is("hidden")?menutabListener.doAction(TOOLBAR.MACROS,{id:"macroBuildPort",action:"enable",callback:applyStyle_zbutton,args:["macroBuildPort","show","stoprecordmacro"]}):menutabListener.doAction(TOOLBAR.MACROS,{id:"macroBuildPort",action:"disable",callback:applyStyle_zbutton,args:["macroBuildPort","hide","stoprecordmacro"]}),s.style.filter="alpha(opacity=100)",(""==dottedEleId||null==getObj(dottedEleId))&&(dottedEleId=addDottedProgress(getObj("recordmsg"))),showDottedProgress(dottedEleId),blindDown("macroPanel",resetPageDim),isMacroRecordPanelOpened=!0}else showAlertDialog(jsMsg.MacroNameAlreadyExists),getObj("macroname").select()}),r.sendRequest()}function showRecordedMsg(){fadeOut("macroRecordingPanel",50),$("#stopmacros").enable(),fadeIn("macroRecordedPanel",50)}function cancelRecording(e,t){if(e===ActionConstants.MACRO_CANCEL_RECORDING){var o={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){widgetmenu.initmacroswidgets("enable"),stopRecording(e,t),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};sheetdialog.showConfirmDialog(jsMsg.RecordMacroConfirmCancel,o)}}function stopRecording(e){var t=!1;(isCellEdited()||isFormulaCell())&&submitCell(),void 0===e&&(e=ActionConstants.MACRO_STOP_RECORDING),e=1*e,e===ActionConstants.MACRO_STOP_RECORDING&&($("#stopmacros").disable(),stopDottedProgress(dottedEleId),widgetmenu.initmacroswidgets("enable"),Button.isMacroToBeAssigned&&null!=CURRENTLYRECORDEDMACRO&&RECORDINGMACRO&&(Button.isMacroToBeAssigned=!1,Button(Button.detailsToBeAssigned).sendAssignedMacro("Macros."+CURRENTLYRECORDEDMACRO),Button.detailsToBeAssigned=null));var o=new RequestParameters(e),a=new AjaxRequest;return a.init("POST",o.getURL(),!0,o.getParametersAsString()),a.addEventListener("onComplete",function(t){if(e==ActionConstants.MACRO_CANCEL_RECORDING)$("#stoprecordmacro").is("hidden")||menutabListener.doAction(TOOLBAR.MACROS,{id:"macroBuildPort",action:"disable",callback:applyStyle_zbutton,args:["macroBuildPort","hide","stoprecordmacro"]}),hideMacroRecordPanel();else if(e==ActionConstants.MACRO_STOP_RECORDING){$("#stoprecordmacro").is("hidden")||menutabListener.doAction(TOOLBAR.MACROS,{id:"macroBuildPort",action:"disable",callback:applyStyle_zbutton,args:["macroBuildPort","hide","stoprecordmacro"]}),setTimeout(showRecordedMsg,500);var o=getObj("stopButtons"),a=t.responseText.trim();recordedMacroLineNo=isNaN(a)?"1":a,o.style.display="",ISMINDLG&&(ISMACRODOCCHANGE=!0)}}),a.sendRequest(),RECORDINGMACRO=!1,t?void 0:!1}function showRecordedMacro(){isNaN(recordedMacroLineNo)?showMacroEditorDialog("Macros","1",5):showMacroEditorDialog("Macros",recordedMacroLineNo,5),recordedMacroLineNo=""}function showManageMacros(e){var t=getObj("macroPanel");if(t&&"none"!==t.style.display)return void hideMacroRecordPanel(function(){showManageMacros(e)});disableSaveButton();var o="",a=resizeMacrosList;"run"==e?o=jsMsg.RunMacro:"show"==e?(o=jsMsg.Macros,a=showMacrosListTab):("create"==e||"record"==e)&&(o=jsMsg.CreateMacro,a={init:function(){focusModuleName()}});var s=getCurrentSelectionRange(),r=new RequestParameters(ActionConstants.JSP_MANAGE_MACROS);r.setParameters(WorkSheets.getAssociatedActiveSheetName(),s.startRow,s.startCol,s.endRow,s.endCol,e,getViewType());var n=r.getURL()+"?"+r.getParametersAsString(),i={title:o};"run"!=e&&(i.width=500,i.modal=!0,i.close=function(){enableSaveButton()}),sheetdialog.close(),sheetdialog.open("managemacroDialog",i,a,void 0,n)}function insertMacro(e,t,o,a){"undefined"==typeof e&&(e=!1);var s,r="";if(e)s=t;else{var n=getObj("macroname");if(s=n.value.trim(),0==s.length)return showAlertDialog(jsMsg.MacroNameCannotBeEmpty),n.focus(),!1;var i=checkMacroName(s);if(i>0)return showAlertDialog(1==i?jsMsg.MacroNameCannotContainMsg:2==i?jsMsg.MacroNameStartWithMsg:jsMsg.MacroNameInEnglish),n.select(),!1;r=getObj("description").value.trim()}if(0==e){var c=!1;if($("#use_rel_ref").is(":checked")&&(c=!0),"record"==$("#inserttype").val())return recordMacro(s,r,c),!1}var d=new RequestParameters(ActionConstants.MACRO_INSERT);d.setParameters(s,encodeURIComponent(r));var l=new AjaxRequest;if(l.init("POST",d.getURL(),!0,d.getParametersAsString()),l.addEventListener("onComplete",function(){sheetdialog.close()}),actionManager.addRequest(l),e){if(ISMACROEDITOROPEN){var u=window.frames.frame_macrotextid.editArea;if(editAreaLoader.getFile("macrotextid","Macros").text=o,u.files.Macros.compare_edited_text=o,"Macros"==editAreaLoader.getCurrentFile("macrotextid").id&&(u.textarea.value=o,!ISMINDLG)){var g=showConfirmDialog(replaceParams(jsMsg.UserHasBeenInsertedNewMacro,new Array(a,t))+"\n"+jsMsg.DoYouWantToReloadIt);if(g){var M=editAreaLoader.getSelectionRange("macrotextid");u.textarea.focus(),u.display_file(editAreaLoader.getCurrentFile("macrotextid").id),editAreaLoader.setSelectionRange("macrotextid",M.start,M.end)}}}if(ISMINDLG){var m=getModuleIndex("Macros");module_content[m]=o}}return!1}function resizeMacrosList(){getObj("modulsttable").offsetHeight<70&&(getObj("macrosListWithActions").style.height="75px"),positionDialog()}function focusModuleName(e){e||($("#macroContiner .ui-tabs-inner-panel").hide(),$("#macroContiner .ui-tabs-panel").css("border","none")),setTimeout(function(){getObj("macroname").focus()},10),positionDialog()}function showCreateMacroTab(e){e||$("#CreateMacroTab").click(),$("#createmacChld").width($("#createmacCnt").width()),jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW?($("#createMacroDiv").hide(),$("#information").show(),$("#CreateButton").disable(),$("#closemacro").disable()):focusModuleName(!0)}function showMacrosListTab(e){e||setTimeout(function(){$("#ShowMacroTab").click()},100),(jsVERSION_VIEW||jsPUBLIC_VIEW||jsGUEST_VIEW)&&$("#information").hide()}function showRecordBtn(){var e=getObj("RecordButton");"none"==e.style.display&&(e.style.display="",getObj("CreateButton").style.display="none",getObj("use_rel_ref_tr").style.display=""),$("#inserttype").val("record"),$("#macroname").focus()}function showWriteBtn(){var e=getObj("CreateButton");"none"==e.style.display&&(e.style.display="",getObj("RecordButton").style.display="none",getObj("use_rel_ref_tr").style.display="none"),$("#inserttype").val("create"),$("#macroname").focus()}function blindupcallback(){resetPageDim(),""!=showAferBlind&&setTimeout(evalfunction,10),$("#recordmacro").is(":enabled")||menutabListener.doAction(TOOLBAR.MACROS,{id:"macroBuildPort",action:"enable",callback:applyStyle_zbutton,args:["macroBuildPort","show","stoprecordmacro"]})}function evalfunction(){showAferBlind&&showAferBlind(),showAferBlind=""}function hideMacroRecordPanel(e){showAferBlind="undefined"!=typeof e?e:"",blindUp("macroPanel",blindupcallback),isMacroRecordPanelOpened=!1}function showMacros(){var e=getCurrentSelectionRange(),t=new RequestParameters(ActionConstants.JSP_RUN_MACROS);t.setParameters(WorkSheets.getAssociatedActiveSheetName(),e.startRow,e.startCol,e.endRow,e.endCol);var o={width:300,title:jsMsg.RunMacroListTitle},a=t.getURL()+"?"+t.getParametersAsString();sheetdialog.open("showmacrodialog",o,checkFunctionList,void 0,a)}function checkFunctionList(){if("undefined"!=typeof noofmacros&&0==noofmacros)sheetdialog.close();else{var e=getObj("macrolisttable");if(e.offsetHeight>150){var t=getObj("MacroList1");t.style.maxHeight="200px",t.style.height="200px"}positionDialog()}}function updateMacros(e){for(var t=getObj("MacroList1"),o=t.getElementsByTagName("table")[0];o.rows.length>=1;)o.deleteRow(0);for(var a in e.MACROTABLE)if("undefined"!=typeof e.MACROTABLE[a].MODULENAME){var s=o.insertRow(o.rows.length),r=document.createElement("TD");r.className="macroListView";var n=escapeSpecialCharacters(e.MACROTABLE[a].MACRONAME);r.innerHTML="<a href=\"javascript:runmacro('"+escapeSpecialCharacters(e.MACROTABLE[a].MODULENAME)+"','"+n+"');\" style='width:100%;' title='"+replaceParams(jsMsg.RunMacroName,new Array(n))+"'>"+n+"</a>",s.appendChild(r)}}function callBack_insertMacro(e,t){var o=e;if(o.indexOf("Failed")<0){var a=JSON.parse(o);if("OLD"!=a.ISMACRO&&Button.isMacroToBeAssigned&&(Button.isMacroToBeAssigned=!1,Button(Button.detailsToBeAssigned).sendAssignedMacro("Macros."+t),Button.detailsToBeAssigned=null),escpeMacroName=escapeSpecialCharacters(t),"OLD"==a.ISMACRO)return showAlertDialog(jsMsg.MacroNameAlreadyExists),"undefined"!=typeof txtmname&&txtmname.select(),!1;if(ISMINDLG&&!ISMACROEDITOROPEN){var s=getModuleIndex("Macros");null!=s&&(module_content[s]+="\nSub "+escpeMacroName+"()\n \nEnd Sub\n")}showMacroEditorDialog("Macros",a.LINENO,5),isSaveButtonEnabled=!0}}function assignMacroCallback(){Button[Button.detailsToBeAssigned].isMacroAssigned?($("#assignMacroOptions").parent().hide(),$("#changeMacroOptions").parent().show(),$("#macroAssignedMsgHolder").parent().show(),$("#changeMacroMsgHolder").parent().show(),$("#chooseAMacroMsgHolder").parent().hide(),$("#feButtonAssignedMacroNameHolder").children("b").html(Button[Button.detailsToBeAssigned].macroName),$("#feButtonEditMacroLink").bind("click",function(){showMacroEditorDialog(Button[Button.detailsToBeAssigned].moduleName,Button[Button.detailsToBeAssigned].macroName)})):($("#assignMacroOptions").parent().show(),$("#changeMacroOptions").parent().hide(),$("#macroAssignedMsgHolder").parent().hide(),$("#changeMacroMsgHolder").parent().hide(),$("#chooseAMacroMsgHolder").parent().show());var e=getObj("macroListId").getElementsByTagName("option");Button.isAMacrosListOptionSelected=!1;for(var t=0;t<e.length;t++)Button[Button.detailsToBeAssigned].moduleName+"."+Button[Button.detailsToBeAssigned].macroName==e[t].value&&(e[t].selected=!0,Button.isAMacrosListOptionSelected=!0,getObj("macroAssignedMsgHolder").style.display=""),Button.isAMacrosListOptionSelected||(getObj("macroAssignedMsgHolder").style.display="none");Button.macroListOnLoad()}var showAferBlind="",recordedMacroLineNo="",dottedEleId="",isMacroRecordPanelOpened=!1,CURRENTLYRECORDEDMACRO,isMacroButtonsInitialised=!1;
function _Button(e,t){if(getObj(e)&&arguments[2]){var o=getObj(e).parentNode;o&&o.removeChild(getObj(e))}return this.el=getObj("BUTTON").cloneNode(!0),this.el.id=this.id=e,this.el.objType="button",this.isMacroAssigned=!1,this.macroName,this.moduleName,this.isMacroAssigned,this.isInEditMode,sheetObjectsPane.appendChild(this.el),isUndefined(t)||Button.setProps(e,t),this.Label=this.el.getElementsByTagName("TD")[4],this.editableLabel=this.el.getElementsByTagName("TD")[5],this.textElement=this.el.getElementsByTagName("input")[0],this.textElement.onkeydown=function(t){Button(e).setCaption(t)},this}Button=function(){return"undefined"==typeof arguments[0]||null==Button[arguments[0]]?Button.init(arguments[0]):null!=Button[arguments[0]]?Button[arguments[0]]:void 0},Button.dateObj,Button.tempLeft,Button.tempWidth,Button.isMacroToBeAssigned=!1,Button.detailsToBeAssigned,Button.tempEl,Button.menuData,Button.diffX=20,Button.emptySpaceCount,Button.prevObjId,Button.isOnInitialEdit,Button.isInitialSizeChangedOnEdit,Button.isExecuting,Button.elementInEditMode,Button.menuData="<menu id='OLEButtonContextMenu' forElement='OLESelectLayer'><item onclick='Button.editLabel(ole.getCurrObj().id, false);return false;'><![CDATA["+jsMsg["Button.EditLabel"]+"]]></item> <sep></sep><item onclick='ole.currObj.clone(1,parseInt((10 * ole.currObj.cloneCountSinceLastDragOrResize) + ole.currObj.width + 10) ,parseInt((10 * ole.currObj.cloneCountSinceLastDragOrResize) + ole.currObj.height + 10));return false;'><![CDATA["+jsMsg.Clone+"]]></item><item onclick='ole.remove(ole.currObj.id,true);ole.conf.onblur();return false;'><![CDATA["+jsMsg.Delete+"]]></item></menu>",Button.init=function(e,t){Button[e]=new _Button(e,t,arguments[2]),Button[e].setText(t.cap),getObj(e).objType="button",ole.init(e,t.top,t.left,t.ht,t.wd).bringToFront(),ole(e).sCol=findColInXPos(ole(e).left),ole(e).sRow=findRowInYPos(t.top),ole(e).sColDiff=isRTL?ole(e).right-getColLeft(ole(e).sCol):ole(e).left-getColLeft(ole(e).sCol),ole(e).sRowDiff=t.top-getRowTop(ole(e).sRow),Button.setPermission(),Button.setRightClickContextMenu(e)},Button.assignMacroId=null,Button.duplicateid=null,Button.elementBelowCursor=null,Button.tempCursor=null,Button.onCtrlKeyDown=function(){var e=getObj(Button.elementBelowCursor);if(void 0!=e&&null!=e&&!Button[e.id].isInEditMode){var t=ole.getObjectPermissions(e.id,["isDraggable","isResizable"]);ole(e.id).isEnabled&&(t.isDraggable||t.isResizable)&&(e.className+=" feButtonCtrlKeyDown")}},Button.onCtrlKeyUp=function(){var e=getObj(Button.elementBelowCursor);void 0==e||null==e||Button[e.id].isInEditMode||(e.className="feButton")},Button.onBeforeDrag=function(){isUndefined(Button.tempEl)||(Button.tempEl.className="feButton",Button.tempEl=void 0)},Button.onObjectSwitch=function(e){ole(e).hideContextMenu(),Button.closeActionBarMenus(e)},Button.onBeforeLoadActionBar=function(e){Button[e].switchState(Button[e].isMacroAssigned)},Button.onFocusLayerMouseDown=function(){null==Button.elementInEditMode||isUndefined(Button.elementInEditMode)||(ole(Button.elementInEditMode.id).resetActionBarState(),Button.elementInEditMode.switchModes(!1))},Button.ondoubleclick=function(e){var t=getObj("feButtonWidthCalculator");t.innerHTML=escapeSpecialCharacters(Button[e].textElement.value),ole(e).setWidth(t.offsetWidth+20)._setSelectLayer(),Button.resize(e,ole(e).width,ole(e).height)},Button.onClick=function(e,t){var e,o,n=!1;if(Button[t.id].isInEditMode)Button[t.id].isInEditMode&&(browser_ie?(e=window.event,mouseEventVal=e.button,o=e.srcElement):browser_nn6&&(mouseEventVal=e.which,o=e.target),"INPUT"!=o.tagName&&Button[t.id].switchModes(!0));else if("undefined"!=typeof Button[t.id]&&null!=Button[t.id]){n=window.event?window.event.ctrlKey:e.ctrlKey||2==e.modifiers||3==e.modifiers||e.modifiers>5;var s=!1;!READ_WRITE||isReadOnlyViewMode||"undefined"==typeof Button[t.id].moduleName||""==Button[t.id].moduleName||"null"==Button[t.id].moduleName||!OLE[t.id].isEnabled||jsTRASH_VIEW||isErrorDoc||(runmacro(Button[t.id].moduleName,Button[t.id].macroName,Button[t.id].id,void 0,void 0,void 0,void 0,void 0,!0),s=!0);var i=ole.getObjectPermissions(t.id,["isDraggable","isResizable"]);s||i.isDraggable||i.isResizable||(t.className="feButton")}stopEvt(e)},Button.onMouseDown=function(e,t){var o,e,n;o=window.event?window.event.ctrlKey:e.ctrlKey||2==e.modifiers||3==e.modifiers||e.modifiers>5;var s;browser_ie?(e=window.event,s=e.button,n=e.srcElement):browser_nn6&&(s=e.which,n=e.target);var i=e.metaKey;if(!ole(t.id).isExposed&&((o||i)&&(ole(t.id)._setSelectLayer().positionActionBar(!0),Button.tempEl=t,ole.startDrag(e,!0),t.className="feButton",stopEvt(e)),!o&&1==s)){var a=ole.getObjectPermissions(t.id,["isDraggable","isResizable"]);(Button[t.id].isMacroAssigned||!a.isDraggable&&!a.isResizable)&&(t.className="feButtonMouseDown")}},Button.removeVisuals=function(e){OLE[e]&&(ole(e).isEnabled||(ole(e).el.getElementsByTagName("span")[0].style.display="none",ole(e).el.getElementsByTagName("span")[1].style.opacity=1,browser_ie&&(ole(e).el.getElementsByTagName("span")[1].style.filter="alpha(opacity=100)"),ole(e).setWidth(ole(e).width-16).enable().el.style.cursor="",ole(e).el.className="feButton",Button[e].isExecuting=!1))},Button.visualiseMacroExecution=function(e){ole(e).isEnabled&&(ole(e).el.getElementsByTagName("span")[0].style.display="",browser_ie&&(ole(e).el.getElementsByTagName("span")[1].style.filter="alpha(opacity=20)"),ole(e).disable().setWidth(ole(e).width+16).el.style.cursor="default",Button[e].isExecuting=!0)},Button.onObjMouseOver=function(e){Button.elementBelowCursor=e,Button[e].isMacroAssigned&&!Button[e].isInEditMode&&OLE[e].isEnabled&&(ole(e).el.className="feButton feButtonMouseOver",ole(e).el.style.direction="ltr")},Button.onMouseOut=function(e){var t=Button[e];t.isMacroAssigned&&!t.isExecuting&&(ole(e).el.className="feButton"),Button.elementBelowCursor=null},Button.editMacro=function(e){showMacroEditorDialog(Button(e).moduleName,Button(e).macroName),ole(e).resetActionBarState()},Button.prevKeyCode,Button.sendInfoToServer=function(e){var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.sendRequest()},Button.handleSelectedObjects=function(e){ole.currObj==OLE[e]?ole(e)._setSelectLayer().positionActionBar(!0):ole.currFocusObj==OLE[e]&&ole(e).setFocusLayer()},Button.addButton=function(e,t){var o=85,n=25,s=Math.round((sheet.offsetHeight-n)/2+getSheetScrollTop()),i=Math.round((sheet.offsetWidth-o)/2+getNormalizedScrollLeft()),a=ole.getObjectsByPositionXYRange("button",i,s,i+50,s+20),l=a?a.length:0;l>0&&(i+=5*l,l%2&&(s+=12));var a=ole.getObjectsByPositionXYRange("button",i,s,i+50,s+20),l=a?a.length:0;l>0&&(i+=5*l,l%2&&(s+=12)),e||(e=!1),t||(t=CURRSHEETNAME),t=WorkSheets.getSheetCodeFromName(t);var r=new RequestParameters(ActionConstants.CTRL_COMP_ADD);r.setParameters(t,i,s,25,85,"dummy1",null,null,null,null),Button.sendInfoToServer(r)},Button.setProps=function(e,t){var o=getObj(e);o.className="feButton feButtonCtrlKeyDown",o.style.display="",o.style.position="absolute",o.style.height=t.ht+"px",o.style[isRTL?"right":"left"]=t.left+"px",o.style.width=t.wd+"px",o.style.top=t.top+"px",o.style.direction="ltr"},Button.onSync=function(e,t){Button[e]=Button[t],Button[e].id=Button[e].el.id=e,Button[e].Label=getObj(e).getElementsByTagName("TD")[4],Button[e].editableLabel=getObj(e).getElementsByTagName("TD")[5],Button[e].textElement=ole(e).el.getElementsByTagName("input")[0],Button[e].textElement.onkeydown=function(t){Button(e).setCaption(t)},Button[e].setContextMenu(),Button[t]=null;var o=CURRSHEETNAME,n=ole(Button[e].id);Button.resize(Button[e].id,n.width,n.height,!1,o)},Button.create=function(e){var t=e.id;Button.init(t,e,!0),Button(t).switchModes(!1).checkMacroAssigned(e)},Button.remove=function(e,t,o){Button.closeActionBarMenus(e),t||(t=!1),o||(o=CURRSHEETNAME),o=WorkSheets.getSheetCodeFromName(o);var n=new RequestParameters(ActionConstants.CTRL_COMP_DELETE);n.setParameters(o,e),Button.sendInfoToServer(n)},Button.clone=function(e,t,o,n,s,i,a,l,r){l||(l=!1),r||(r=CURRSHEETNAME);var u="ACTION=clone&NAME="+this.id+"&CAPTION="+encodeURIComponent(Button(a).caption)+"&HEIGHT="+i+"&WIDTH="+s+"&dummyId="+t+"&afterRTC="+l+"&CLONETYPE="+e+"&SHEETNAME="+encodeURIComponent(r);3==e&&(getObj(t).className=Button[a].isMacroAssigned?"feButton":"feButton feButtonCtrlKeyDown"),Button(a).isMacroAssigned&&(u+="&FUNCTION="+Button(a).moduleName+"."+Button(a).macroName),2!=e&&(u+="&LEFT="+o+"&TOP="+n),Button[t]=new _Button(t),Button(a).isMacroAssigned&&(Button[t].isMacroAssigned=!0,Button[t].setMacroName(Button(a).moduleName,Button(a).macroName),ole(t).setDesignMode(!1)),Button[t].caption=Button(a).caption,ole(Button[t].setContextMenu().id)._setSelectLayer().positionActionBar(),r=WorkSheets.getSheetCodeFromName(r);var c=new RequestParameters(ActionConstants.CTRL_COMP_CLONE);"undefined"!=typeof Button(a).moduleName?c.setParameters(r,o,n,i,s,t,this.id,Button(a).caption,Button(a).moduleName+"."+Button(a).macroName,e):c.setParameters(r,o,n,i,s,t,this.id,Button(a).caption,".",e),Button.sendInfoToServer(c)},Button.move=function(e,t,o,n,s){n||(n=!1),s||(s=CURRSHEETNAME),OLE[e]&&(ole(e).sCol=findColInXPos(t),ole(e).sRow=findRowInYPos(o),ole(e).sRowDiff=o-getRowTop(ole(e).sRow),ole(e).sColDiff=t-getColLeft(ole(e).sCol));var i="ACTION=move&TOP="+o+"&LEFT="+t+"&NAME="+e;n||(i+="&HEIGHT="+ole(e).height+"&WIDTH="+ole(e).width),s=WorkSheets.getSheetCodeFromName(s);var a=new RequestParameters(ActionConstants.CTRL_COMP_MOVE);a.setParameters(s,t,o,ole(e).height,ole(e).width,null,e,null,null,null),Button.sendInfoToServer(a)},Button.resize=function(e,t,o,n,s){n||(n=!1),s||(s=CURRSHEETNAME),OLE[e]&&(ole(e).sCol=findColInXPos(ole(e)[isRTL?"right":"left"]),ole(e).sRow=findRowInYPos(ole(e).top),ole(e).sRowDiff=ole(e).top-getRowTop(ole(e).sRow),ole(e).sColDiff=ole(e)[isRTL?"right":"left"]-getColLeft(ole(e).sCol)),s=WorkSheets.getSheetCodeFromName(s);var i=new RequestParameters(ActionConstants.CTRL_COMP_RESIZE);i.setParameters(s,ole(e)[isRTL?"right":"left"],ole(e).top,o,t,null,e,null,null,null),Button.sendInfoToServer(i)},Button.sendAssignedMacro=function(e,t,o,n){o||(o=!1),n||(n=CURRSHEETNAME),n=WorkSheets.getSheetCodeFromName(n);var s=new RequestParameters(ActionConstants.CTRL_COMP_ASSIGNMACRO);s.setParameters(n,e,t),Button.sendInfoToServer(s)},Button.onmousedownOutside=function(e){Button(e).switchModes(!1).setTextInLabel(),ole(e).resetActionBarState(),Button.assignMacroId=e,Button.prevObjId=e},Button.onSelectLayerMouseDown=function(e,t){if(browser_ie){t=window.event;var o=t.srcElement}else if(browser_nn6)var o=t.target;"textCursor"==o.className?Button.editLabel(e,!1):(Button(e).switchModes(!1).setTextInLabel(),ole(e).resetActionBarState())},Button.closeActionBarMenus=function(e){OLE[e]&&ole(e).hideContextMenu()},Button.onBeforeResize=function(e){return Button(e).switchModes(!1).setTextInLabel(),ole(e).resetActionBarState(),Button.closeActionBarMenus(e),this},Button.getOffsetOnClone=function(e){var t=10*e.cloneCountSinceLastDragOrResize;return t},Button.showMoreActionsMenu=function(){var e=[],t=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.width+10),o=parseInt(10*ole.currObj.cloneCountSinceLastDragOrResize+ole.currObj.height+10);e.push({data:"{label:'"+jsMsg.Clone+"', appData:{dynamic:true, callback:'ole.currObj.clone', arg: '1,"+t+","+o+"'}}"}),e.push({data:"{label:'"+jsMsg.Delete+"', appData:{dynamic:true, callback: 'ole.remove', arg:'"+ole.getCurrObj().id+",true'}}"});var n={target:$("#button_actionBar_moreActions"),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("buttonMoreMenu",e,n)},Button.showManageMacros=function(e){Button.isMacroToBeAssigned=!0,Button.detailsToBeAssigned=ole.currObj.id,showManageMacros(e)},Button.clearMacroAllocationDetails=function(){Button.isMacroToBeAssigned=!1,Button.detailsToBeAssigned=null},Button.editLabel=function(e,t){if(Button.closeActionBarMenus(e),t){var o=85,n=25;ole.setAsCurrObj(e).setWidth(o).setHeight(n)}sheetMenu.hideOpenedMenu(),Button[e].switchModes(!0,t)},Button.showAssignMacroMenu=function(){Button(ole.currObj.id).switchModes(!1);var e=[];e.push({id:"macroAssingext",data:"{label:'"+jsMsg["Button.AssignExistingMacro"]+"...', appData:{dynamic:true, callback: 'Button.showMacroList', arg:'"+ole.getCurrObj().id+"'}}"}),e.push({id:"macroAssignnew",data:"{submenu : '#assignmacrooptions', label:'"+jsMsg["Button.AssignNewMacro"]+"', appData:{ type : 'change'}}"});var t={target:$("#button_actionBar_assignMacro"),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("assignMacroMenu",e,t),$("#macroAssingext").enable(),$("#macroAssignnew").enable(),$("#macrowritebt").enable(),$("#macrorecordbt").enable(),RECORDINGMACRO&&($("#macroAssingext").disable(),$("#macroAssignnew").disable(),$("#macrowritebt").disable(),$("#macrorecordbt").disable())},Button.showChangeMacroMenu=function(){Button(ole.currObj.id).switchModes(!1);var e=[];e.push({id:"macroChangeext",data:"{label:'"+jsMsg["Button.AssignExistingMacro"]+"...', appData:{dynamic:true, callback: 'Button.showMacroList', arg:'"+ole.getCurrObj().id+"'}}"}),e.push({id:"macroChangenew",data:"{submenu : '#assignmacrooptions', label:'"+jsMsg["Button.AssignNewMacro"]+"', appData:{ type : 'change'}}"});var t={target:$("#button_actionBar_changeMacro"),clearcache:!0,menuoptions:{type:"text_only"}};sheetMenu.showMenu("changeMacroMenu",e,t),$("#macroChangeext").enable(),$("#macroChangenew").enable(),$("#macrowritebt").enable(),$("#macrorecordbt").enable(),RECORDINGMACRO&&($("#macroChangeext").disable(),$("#macroChangenew").disable(),$("#macrowritebt").disable(),$("#macrorecordbt").disable())},Button.showMacroList=function(e){var t=getCurrentSelectionRange();Button.detailsToBeAssigned=e,Button.isMacroToBeAssigned=!0;var o=new RequestParameters(ActionConstants.JSP_ASSIGN_MACRO);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),t.startRow,t.startCol,t.endRow,t.endCol);var n={width:400,title:jsMsg["Button.ActionBar.AssignMacro"],close:function(){Button.macroListOnLoad()}},s=o.getURL()+"?"+o.getParametersAsString();sheetdialog.open("assignMacroDialog",n,assignMacroCallback,void 0,s)},Button.macroListOnLoad=function(){positionDialog(),"undefined"!=typeof noofmacros&&0==noofmacros?getObj("noMacrosDiv")&&(getObj("noMacrosDiv").style.display="",getObj("macroExistDiv").style.display="none",getObj("assignMacroOkButton").style.display="none",getObj("feButtonDlgBoxHsep").style.display="none"):getObj("noMacrosDiv")&&(getObj("noMacrosDiv").style.display="none",getObj("macroExistDiv").style.display="",getObj("assignMacroOkButton").style.display="")},Button.assignMacro=function(e){var t=getObj("macroListId");return t.options.selectedIndex<0?void showAlertDialog(jsMsg["Button.Alert.AssignMacro"]):(Button(e).sendAssignedMacro(t.options[t.options.selectedIndex].value),void sheetdialog.close())},Button.setPermission=function(){var e=!1,t=!1,o=!1;switch(getViewType()){case"SHARE_VIEW":if(!IS_WHOLE_DOCUMENT_SHARED_IN_READ_WRITE)break;case"NEW_VIEW":case"OPEN_VIEW":ALLOW_TO_WRITE&&(e=!0,t=!0)}ole.setObjectProperties("button",{permissions:{isDraggable:e,isResizable:t,isEditable:o}})},Button.setRightClickContextMenu=function(e){jsVERSION_VIEW||$("#"+e).bind("contextmenu",function(t){ole(e)._setSelectLayer().positionActionBar();var o=getCursorPos(t),n=o.x,s=o.y,i=createButtonContextMenu(),a={target:$(this),position:[n,s],clearcache:!0};sheetMenu.showMenu("buttonRMenu",i,a),ole.contextMenuStatus=!0,$("#buttonRMenu").show(),browser_ie&&(t=window.event),stopEvent(t)})},_Button.prototype={checkMacroAssigned:function(e){this.isMacroAssigned="undefined"!=typeof e.macroName&&""!=e.macroName&&"null"!=e.macroName?!0:!1;var t=ole.getObjectPermissions(this.id,["isDraggable","isResizable"]);return this.isMacroAssigned||!t.isDraggable&&!t.isResizable?(ole(this.setMacroName(e.moduleName,e.macroName).id).setDesignMode(!1),Button(this.id).setContextMenu(),ole(this.id).el.className="feButton"):ole(this.id).el.className="feButton feButtonCtrlKeyDown",this},setMacroName:function(e,t){return this.macroName=t,this.moduleName=e,this},setText:function(e){getObj(this.id);return this.caption=e,this.textElement.value=e,this.Label.childNodes[1].innerHTML=escapeSpecialCharacters(e),this},insert:function(e){var t=e.id;return Button.init(t,e),this},runMacro:function(){return this.id.isExposed&&""!=this.modulename&&"null"!=this.modulename&&runmacro(this.modulename,this.macroname),this},setCaption:function(e){var t,o,n,s,i,a,l,r,u,c,d;if(browser_ie)var e=window.event;if(a=getObj("feButtonWidthCalculator"),c=e.ctrlKey,d=e.altKey,t=0,o=!1,-1!=getPrintableCharacterKeyCodes().indexOf(e.keyCode)&&(8!=e.keyCode||46!=e.keyCode)&&(n=String.fromCharCode(e.keyCode),a.innerHTML=escapeSpecialCharacters(this.textElement.value)+n),32==e.keyCode?Button.emptySpaceCount++:(8==e.keyCode||46==e.keyCode)&&(a.innerHTML=escapeSpecialCharacters(this.textElement.value)),8==e.keyCode){var h=this.textElement.value;" "==h.charAt(getCaretPos(this.textElement)-1)&&Button.emptySpaceCount--}if(46==e.keyCode){var h=this.textElement.value;" "==h.charAt(getCaretPos(this.textElement))&&Button.emptySpaceCount--}l=ole(this.id).width,r=l-Button.diffX,u=a.offsetWidth+4*Button.emptySpaceCount,s=getSelectedText(this.textElement),s.length>0&&(c||d||-1!=getPrintableCharacterKeyCodes().indexOf(e.keyCode)&&(a.innerHTML=escapeSpecialCharacters(s),i=a.offsetWidth,u-=i),o=!0);var B=parseInt(isRTL?ole(this.id).right:ole(this.id).left);return 27==e.keyCode?(this.setText(this.caption).switchModes(!1),ole(this.id).resetActionBarState().displayAssociativeElements("block","none")._setSelectLayer().positionActionBar(),activateCellField(),this):(13==e.keyCode||ole(this.id).isResizedOnce||(u>=r?(ole(this.id).setWidth(l+6+t).setLeft(B-3-t/2),Button.isInitialSizeChangedOnEdit=!0):r-20>u&&ole(this.id).width>85&&Button.isInitialSizeChangedOnEdit&&-1!=getPrintableCharacterKeyCodes().indexOf(e.keyCode)&&(o?ole(this.id).setWidth(u+20+Button.diffX).setLeft(B+parseInt((l-(u+20+Button.diffX))/2)):ole(this.id).setWidth(l-20).setLeft(B+10))),13==e.keyCode||9==e.keyCode?(this.switchModes(!1).setTextInLabel(),ole(this.id).resetActionBarState().displayAssociativeElements("block","none")._setSelectLayer().positionActionBar(),ole.focus(),this):void(a.innerHTML=""))},setTextInLabel:function(e,t){var o=this.textElement,n=o.value;n=n.trim(),e||(e=!1),t||(t=CURRSHEETNAME),this.caption=n,this.Label.childNodes[1].innerHTML=escapeSpecialCharacters(n),t=WorkSheets.getSheetCodeFromName(t);var s=new RequestParameters(ActionConstants.CTRL_COMP_SETCAPTION);return s.setParameters(t,ole(this.id)[isRTL?"right":"left"],ole(this.id).top,ole(this.id).height,ole(this.id).width,null,this.id,n,null,null),Button.sendInfoToServer(s),this},switchModes:function(e,t){var o=this.textElement;if(e){if(e){t&&(Button.isOnInitialEdit=!0,Button.isInitialSizeChangedOnEdit=!1),Button.elementInEditMode=this,Button.closeActionBarMenus(this.id),Button.emptySpaceCount=0,this.isInEditMode=!0,this.Label.style.display="none",this.editableLabel.style.display="";var n=o.value.length;ole(this.id).expose(),ole(this.id).displayAssociativeElements("none","none","none"),ole(this.id).el.className+=" feButtonEdit";var s=getObj("feButtonWidthCalculator");s.innerHTML=escapeSpecialCharacters(o.value),ole(this.id).isResizedOnce||(ole(this.id).width>=85&&ole(this.id).width<s.offsetWidth?ole(this.id).setWidth(s.offsetWidth+30):ole(this.id).width<85&&ole(this.id).setWidth(85));var i=ole(this.id),a=findThirdPaneYPos(),l=findSecondPaneXPos();i.top-a<getSheetScrollTop()?setScrollTop(i.top-a):i.top>getSheetScrollTop()+getSheetHeight()&&setScrollTop(i.top+i.height-getSheetHeight()),i[isRTL?"right":"left"]-l<getNormalizedScrollLeft()?setScrollLeft(i[isRTL?"right":"left"]-l):i[isRTL?"right":"left"]>getNormalizedScrollLeft()+getSheetWidth()&&setScrollLeft(i[isRTL?"right":"left"]+i.width-getSheetWidth()),browser_safari||browser_opera||o.focus(),browser_safari||!browser_ie||browser_opera?setCaretPos(o,n):browser_ie&&setCaretPos(o,n)}}else this.Label.style.display="",this.editableLabel.style.display="none",ole(this.id).mask().el.className="feButton",this.isMacroAssigned||(ole(this.id).el.className+=" feButtonCtrlKeyDown"),this.isInEditMode=!1,Button.emptySpaceCount=0,Button.elementInEditMode=null,Button.isOnInitialEdit&&(ole(this.id).setHeight(parseInt(ole(this.id).height)),Button.isOnInitialEdit=!1),Button.isInitialSizeChangedOnEdit=!0;return this},assignMacro:function(e){return""==e.modulename?(this.isMacroAssigned=!1,this.moduleName="",this.macroName="",this):(ole(e.id).setDesignMode(!1).el.className="feButton",this.moduleName=e.modulename,this.macroName=e.macroname,this.isMacroAssigned=!0,this.switchState(!0),this)},switchState:function(e){var t=ole(this.id).getActionBar();return e?t&&(t.getElementsByTagName("TD")[2].style.display="none",t.getElementsByTagName("TD")[3].style.display="",t.getElementsByTagName("TD")[5].style.display="",t.getElementsByTagName("TD")[6].style.display=""):(t.getElementsByTagName("TD")[2].style.display="",t.getElementsByTagName("TD")[3].style.display="none",t.getElementsByTagName("TD")[5].style.display="none",t.getElementsByTagName("TD")[6].style.display="none"),this},sendAssignedMacro:function(e,t,o){t||(t=!1),o||(o=CURRSHEETNAME),o=WorkSheets.getSheetCodeFromName(o);var n=new RequestParameters(ActionConstants.CTRL_COMP_ASSIGNMACRO);return n.setParameters(o,this.id,e),Button.sendInfoToServer(n),this},assignNewMacro:function(e){return""!=e&&(e="Macros."+e),this.sendAssignedMacro(e)},showContextMenu:function(e){if(browser_ie)var e=window.event;return this.isInEditMode||(ole(this.id)._setSelectLayer().showContextMenu(e).positionActionBar(!0).el.className="feButton"),this},setContextMenu:function(){return is_ie?ole(this.id).el.oncontextmenu=function(){Button(this.id).showContextMenu(event)}:ole(this.id).el.setAttribute("oncontextmenu",'Button("'+this.id+'").showContextMenu(event);'),this}},ole.createObjectProperties("button",{focusLayer:"OLEFocusLayer",selectLayer:"OLESelectLayer",menuData:Button.menuData,minHeight:10,minWidth:10,hasOrdering:!1,contextMenu:"OLEButtonContextMenu",cloneOnCTRLDrag:!0,resizeCorners:["E","S","SE"],onResizeStart:Button.onBeforeResize,onResizeEnd:Button.resize,onDragStart:Button.onBeforeDrag,onDragEnd:Button.move,onRemove:Button.remove,onClone:Button.clone,onSync:Button.onSync,onCtrlKeyDown:Button.onCtrlKeyDown,onCtrlKeyUp:Button.onCtrlKeyUp,onmouseover:Button.onObjMouseOver,onmouseout:Button.onMouseOut,onEditLayerClick:Button.onEditLayerClick,onObjectSwitch:Button.onObjectSwitch,ondoubleclick:Button.ondoubleclick,onMove:Button.closeActionBarMenus,onMoveEnd:Button.move,onedit:Button.editLabel,onDocOpen:Button.closeActionBarMenus,onMouseDownOutsideOLEElements:Button.onmousedownOutside,onBeforeLoadActionBar:Button.onBeforeLoadActionBar,onFocusLayerMouseDown:Button.onFocusLayerMouseDown});
function resetSheetPanesDim(){var e=parseInt(sheet.style.width,10)-secondPaneLeft+"px",t=parseInt(sheet.style.height,10)-thirdPaneTop+"px",s=SHEET.dom.freeze;isColsOnlyFreezed?(colHead.style.width=e,s.setSheetPanesDim("COLS")):isRowsOnlyFreezed?(rowHead.style.height=t,s.setSheetPanesDim("ROWS")):isColsAndRowsFreezed&&(colHead.style.width=e,rowHead.style.height=t,s.setSheetPanesDim("ROWS/COLS")),s.setHCueWidth(),s.setVCueHeight()}function findSecondPaneXPos(){return secondPaneLeft}function findThirdPaneYPos(){return thirdPaneTop}function insertImgorChartIsFreezed(e,t,s){e.style.left=parseInt(t,10)+"px",e.style.top=parseInt(s,10)+"px",sheetObjectsPane.appendChild(e)}function getSheetPaneIds(e,t,s,l){var i=[];return s++,l++,FREEZED_ROW>e&&(FREEZED_COL>t&&i.push(1),l>FREEZED_COL&&i.push(2)),s>FREEZED_ROW&&(FREEZED_COL>t&&i.push(3),l>FREEZED_COL&&i.push(0)),i}var ISFREEZED=!1,FREEZED_ROW=0,FREEZED_COL=0,FREEZE_TYPE="",isRowsOnlyFreezed=!1,isColsOnlyFreezed=!1,isColsAndRowsFreezed=!1,firstPaneLeft=0,firstPaneTop=0,secondPaneLeft=0,secondPaneTop=0,thirdPaneLeft=0,thirdPaneTop=0,fourthPaneLeft=0,fourthPaneTop=0,freezedRowsHeight=0,freezedColsWidth=0,vFreezeCue,hFreezeCue,freezeStatus={},submitBeforeFreeze="",visibleRowsInFrozenRange=[],sheetPane1,sheetPane2,sheetPane3,sheetTable1,sheetTable2,sheetTable3,colHead1,colHeadTable1,rowHead1,rowHeadTable1,currTableId,currTableObj,focusDIV1,focusDIV2,focusDIV3,transSPAN1,transSPAN2,transSPAN3,cellRangeFillDIV1,cellRangeFillDIV2,cellRangeFillDIV3,cellRangeFillSPAN1,cellRangeFillSPAN2,cellRangeFillSPAN3,fillSeriesDIV1,fillSeriesDIV2,fillSeriesDIV3,fillSeriesSPAN1,fillSeriesSPAN2,fillSeriesSPAN3,filterIconsPane,filterIconsPane1,filterIconsPane2,filterIconsPane3,dvListIconsPane,dvListIconsPane1,dvListIconsPane2,dvListIconsPane3,availableStartRowAfterFreeze,sheetPaneId="sP",sheetPane1Id="sP1",sheetPane2Id="sP2",sheetPane3Id="sP3",rowHeadId="rH",rowHead1Id="rH1",colHeadId="cH",colHead1Id="cH1",mCCId="mCC",mCC1Id="mCC1",mCC2Id="mCC2",mCC3Id="mCC3",SHEET={};SHEET.dom={},SHEET.freeze=function(e,t,s,l){SHEET.FREEZE.init(e,t,s,l)},SHEET.freezeTopRow=function(){SHEET.FREEZE._freeze(1,0)},SHEET.freezeFirstColumn=function(){SHEET.FREEZE._freeze(0,1)},SHEET.unFreeze=function(e,t){SHEET.FREEZE.release(e,t)},SHEET.FREEZE={init:function(e,t,s,l){if(ISFREEZED)return void SHEET.unFreeze();if(!(isWholeSheetSelected()||0===e&&0===t)){var i=ActiveCellInfo;return e=isUndefined(e)?isRowSelected()?i.getActiveRow():i.getStartRow():e,t=isUndefined(t)?isColSelected()?i.getActiveCol():i.getStartCol():t,e=isColSelected()?0:e,e>5||t>5?void showAlertDialog(jsMsg["FreezePanes.limitedupto5rowsand5columns"]):void((e!=FREEZED_ROW||t!=FREEZED_COL)&&this._freeze(e,t,s,l))}},_freeze:function(e,t,s,l){"undefined"==typeof l&&(l=!1);var i=function(){$("#freezePanes").zbutton("show","#unfreeze")},n=function(){$("#freezePanes").zbutton("hide","#freeze, #freezetoprow, #freezefirstcol")};return menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"show",callback:i}),menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"hide",callback:n}),isCellEdited()&&(submitBeforeFreeze="FREEZE",0!==cellField.value.indexOf("=")&&submitCell()),isRowInAvailableRowRange(e)?((SAVED||!ALLOW_TO_WRITE||jsREMOTE_SAVE_VIEW)&&(!jsREMOTE_SAVE_VIEW&&!jsREMOTE_VIEW||isDocSaved())||fromOpenFreeze||(freezeStatus.saveBeforeFreeze=!0,freezeStatus.ROW=e,freezeStatus.COL=t,SAVED=!1),void(jsEMBED_VIEW?0===getSheetScrollTop()&&(SHEET.dom.freeze.setCues(e,t),SHEET.FREEZE.react(!0,fromOpenFreeze||l,s,e,t)):(SHEET.dom.freeze.setCues(e,t),SHEET.FREEZE.react(!0,fromOpenFreeze||l,s,e,t)))):(updateTileCallbackInfo.isCallbackAvailable=!0,updateTileCallbackInfo.actionDetails={action:"FREEZE",callbackMethod:SHEET.FREEZE._freeze,freezeeRow:e,freezeeCol:t,afterRTC:s,jsOnly:l},scrollRowIntoView(0),!1)},release:function(e,t,s){if(0!==FREEZED_ROW||0!==FREEZED_COL){"undefined"==typeof t&&(t=!1),isCellEdited()&&(submitBeforeFreeze="true"==e?"AFTERRTCUNFREEZE":"UNFREEZE",submitCell());var l=function(){$("#freezePanes").zbutton("hide","#unfreeze")},i=function(){$("#freezePanes").zbutton("show","#freeze, #freezetoprow, #freezefirstcol")};menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"hide",callback:l}),menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"show",callback:i}),this.react(!1,t,e,void 0,void 0,s)}},react:function(e,t,s,l,i,n){if("undefined"==typeof s&&(s="false"),t)this.customizeDom(l,i,e,!0),this.callBack(e,l,i,!0,n),fromOpenFreeze=!1;else{var o,a=new AjaxRequest;e?(o=new RequestParameters(ActionConstants.FREEZE_PANES),o.setParameters(WorkSheets.getAssociatedActiveSheetName(),l,i)):(o=new RequestParameters(ActionConstants.UNFREEZE_PANES),o.setParameters(WorkSheets.getAssociatedActiveSheetName())),a.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(a)}},customizeDom:function(e,t,s,l){var i=SHEET.dom.freeze;if(s){var n="";n=0==e?"COLS":0==t?"ROWS":"ROWS/COLS",e>0&&i.splitRowHead(e),t>0&&i.splitColHead(t),userPresence.handleFreeze(n,e,t),i.splitSheetPanes(n,e,t),l&&i.constructTilesInSheetTables(e,t),i.setSheetPanesDim(n),i.showSheetPanes(n)}else i.moveCellsToTableTiles(),i.mergeSheetPanes(),i.hideSheetPanes(),i.resetSheetPaneDim()},callBack:function(e,t,s,l,i){if(e)this.setVars(t,s),restrictTextSelection(sheetTable1),restrictTextSelection(sheetTable2),restrictTextSelection(sheetTable3),ProtectedRanges.getObject().onFreeze(),isCellRange()&&showTransSpan();else{this.resetVariables(),ProtectedRanges.getObject().onUnfreeze();var n=getAvailableStartRow();n>ROWS_PER_TILE-1||getSheetScrollTop()>0||(void 0!=i&&1==i||void 0==i)&&focusCell(currRow,currCol)}appEvent.trigger("cmtHgltAfterFreeze")},resetVariables:function(){ISFREEZED=!1,FREEZED_ROW=0,FREEZED_COL=0,isRowsOnlyFreezed=!1,isColsOnlyFreezed=!1,isColsAndRowsFreezed=!1,firstPaneLeft=0,firstPaneTop=0,secondPaneLeft=0,secondPaneTop=0,thirdPaneLeft=0,thirdPaneTop=0,fourthPaneLeft=0,fourthPaneTop=0,freezedRowsHeight=0,freezedColsWidth=0,hideElement(vFreezeCue),hideElement(hFreezeCue),isSheetFreezed=!1,persistedFreezedRow=0,persistedFreezedCol=0,frozenRows=[],TOOLBARS.initViewToolbar()},setVars:function(e,t){ISFREEZED=!0,FREEZED_ROW=e,FREEZED_COL=t,0===e?isColsOnlyFreezed=!0:0===t?isRowsOnlyFreezed=!0:isColsAndRowsFreezed=!0;var s=freezedRowsHeight=getRowTop(e),l=freezedColsWidth=getColLeft(t);firstPaneLeft=firstPaneTop=secondPaneTop=thirdPaneLeft=0,secondPaneLeft=fourthPaneLeft=l,thirdPaneTop=fourthPaneTop=s,setScrollTop(sheetScrollInfo.scrollTop),setScrollLeft(sheetScrollInfo.scrollLeft)},getType:function(){return 0===FREEZED_ROW?"COLS":0===FREEZED_COL?"ROWS":"ROWS/COLS"},getFreezedRowsHeight:function(){return isRowsOnlyFreezed||isColsAndRowsFreezed?freezedRowsHeight=parseInt(sheetPane1.style.height,10):0},getFreezedColsWidth:function(){return isColsOnlyFreezed||isColsAndRowsFreezed?freezedColsWidth=parseInt(sheetPane1.style.width,10):0},reloadSheetPanes:function(){var e=SHEET.FREEZE;e.setVars(FREEZED_ROW,FREEZED_COL);var t=e.getType(),s=SHEET.dom.freeze;s.splitSheetPanes(t),s.setSheetPanesDim(t),s.setRowHeadAndTableForReload()}},SHEET.dom.freeze={constructTilesInSheetTables:function(e,t){for(var s,l=(getDocFragment(),getDocFragment()),i=getDocFragment(),n=getDocFragment(),o=TileUtil.getMarkup(),a=Row.getAvailableRows(),r=Row.dom.getCellsInRows(a),h=o.cloneNode("false"),d=o.cloneNode("false"),p=a.length,f=Row.getAvailableRowsInFrozenRange(e),c=f.length,g=f[c-1],y=a[c],T=getRowTop(0),P=0;P<f.length;P++)sheetTable.removeChild(sheetTable.childNodes[0]);for(var I=0;p>I;I++){var R=a[I],E=isTiledRow(R),L=r[I],u=L.length,w=getRowTop(R),C=w-T;if(g>=R){var h=o.cloneNode("false"),d=o.cloneNode("false");t&&(h.style.top=C+"px",h.style.height=getRowHeight(R)+"px"),d.style.top=C+"px",d.style.height=getRowHeight(R)+"px"}for(var m=0;u>m;m++){var H=L[m],D=getColLeft(m);if(g>=R)t>m?(C=0,h.appendChild(H),H.style[isRTL?"right":"left"]=D+"px",g>=R&&m===t-1&&l.appendChild(h)):(m==t&&0!==t&&(h.style.width=D+"px"),d.appendChild(H),C=0,H.style.top=C+"px",H.style[isRTL?"right":"left"]=D+"px",g>=R&&m==u-1&&i.appendChild(d),m==u-1&&(d.style.width=D+getColWidth(u-1)+"px"));else if(t>m)0!==m||R!=y&&!E||(T=w,s=TileUtil.getMarkup(),s.style.top=T+"px",s.style.height=getRowHeight(R)+"px",n.appendChild(s)),s.appendChild(H),H.style[isRTL?"right":"left"]=D+"px";else if(m==t&&0!==t&&(s.style.width=D+"px"),m==t&&R==y){T=w;var b=getTile(0,"sT");b.style.top=w+"px"}}}sheetTable1.appendChild(l),sheetTable2.appendChild(i),sheetTable3.appendChild(n)},moveCellsToTableTiles:function(){{var e,t,s=FREEZED_COL,l=ROWS_PER_TILE,i=Row.getAvailableRows(),n=Row.dom.getCellsInRows(i),o=(getDocFragment(),i.length),a=sheetTable.childNodes,r=0,h=getDocFragment(),d=Row.getAvailableRowsInFrozenRange(),p=0,f=0,c=0;i[l-1]}d&&d.length?p=d.length:c=f=i[0];var g=0;i[0]<p&&(g=p);for(var y=0;o>y;y++){var T=i[y],P=n[y],I=P.length,R=getRowTop(T),E=TileUtil.getMarkup(),L=E.cloneNode("false");0==getAvailableStartRow()&&y==p&&(sheetTable.insertBefore(h,sheetTable.childNodes[0]),a=sheetTable.childNodes),i[y]>=FREEZED_ROW&&(e=a[g],r=R,e.style.top=r+"px",e.style[isRTL?"right":"left"]="0px",g++),T>=FREEZED_ROW&&(t=getDocFragment()),r=R;for(var u=0;I>u;u++){var w=P[u],C=getColLeft(u),m=w.style;m.dir=C+"px",i[y]<FREEZED_ROW?(0===u&&(L.style.top=getRowTop(T)+"px",L.style.height=getRowHeight(T)+"px",L.style[isRTL?"right":"left"]="0px",L.style.width=getColLeft(I)+"px",h.appendChild(L)),L.appendChild(w)):s>u?t.appendChild(w):u==s&&e.insertBefore(t,e.childNodes[0])}}},splitSheetPanes:function(e,t,s){var l=secondPaneLeft,i=l+"px",n=-1*l+"px",o=thirdPaneTop,a=o+"px",r=-1*o+"px",h=sheetTable.style,d=sheetTable1.style,p=sheetTable2.style,f=sheetTable3.style,c=sheetPane.style,g=sheetPane1.style,y=sheetPane2.style,T=sheetPane3.style,P=getObj(mCCId),I=focusDIV.style;switch(appEvent.trigger("Sheet.Freeze",[{type:e,row:t,col:s,top:o,left:l}]),e){case"ROWS":getObj(mCC2Id).innerHTML=P.innerHTML,Merge.bindDOMObjcts(sheetPane2Id),h.top=r,p.width=h.width,p.height=h.height,isRTL?(y.right=y.top="0px",c.right="0px",c.top=a,focusDIV.style.marginTop=r,focusDIV2.style.top=I.top,focusDIV2.style.right=I.right,focusDIV2.style.height=I.height,focusDIV2.style.width=I.width,fillSeriesDIV.style.marginTop=r,cellRangeFillDIV.style.marginTop=r,P.style.marginTop=r,sheetObjectsPane.style.top=r,filterIconsPane.style.top=r,filterIconsPane2.style.right=n,dvListIconsPane.style.top=r,dvListIconsPane2.style.right=n):(y.left=y.top="0px",c.left="0px",c.top=a,focusDIV.style.marginTop=r,focusDIV2.style.top=I.top,focusDIV2.style.left=I.left,focusDIV2.style.height=I.height,focusDIV2.style.width=I.width,fillSeriesDIV.style.marginTop=r,cellRangeFillDIV.style.marginTop=r,P.style.marginTop=r,sheetObjectsPane.style.top=r,filterIconsPane.style.top=r,filterIconsPane2.style.left=n,dvListIconsPane.style.top=r,dvListIconsPane2.style.left=n);break;case"COLS":getObj(mCC3Id).innerHTML=P.innerHTML,Merge.bindDOMObjcts(sheetPane3Id),h[isRTL?"right":"left"]=n,f.width=h.width,f.height=h.height,T[isRTL?"right":"left"]=T.top="0px",c[isRTL?"right":"left"]=i,c.top="0px",isRTL?(focusDIV.style.marginRight=n,fillSeriesDIV.style.marginRight=n,cellRangeFillDIV.style.marginRight=n,P.style.marginRight=n):(focusDIV.style.marginLeft=n,fillSeriesDIV.style.marginLeft=n,cellRangeFillDIV.style.marginLeft=n,P.style.marginLeft=n),focusDIV3.style.top=I.top,focusDIV3.style[isRTL?"right":"left"]=I[isRTL?"right":"left"],focusDIV3.style.height=I.height,focusDIV3.style.width=I.width,sheetObjectsPane.style[isRTL?"right":"left"]=n,filterIconsPane.style[isRTL?"right":"left"]=n,filterIconsPane3.style.top=r,dvListIconsPane.style[isRTL?"right":"left"]=n,dvListIconsPane3.style.top=r;break;case"ROWS/COLS":var R=P.innerHTML;if(getObj(mCC1Id).innerHTML=R,getObj(mCC2Id).innerHTML=R,getObj(mCC3Id).innerHTML=R,Merge.bindDOMObjcts(sheetPane1Id),Merge.bindDOMObjcts(sheetPane2Id),Merge.bindDOMObjcts(sheetPane3Id),isRTL){p.right=h.right=n,d.right=f.right="0px",d.width=p.width=f.width=h.width,f.height=h.height,d.height=p.height=f.top=h.top=r,g.right=g.top="0px",y.right=i,y.top="0px",T.right="0px",T.top=a,c.right=i,c.top=a;var E=fillSeriesDIV.style,L=cellRangeFillDIV.style;focusDIV2.style.marginRight=I.marginRight=n,focusDIV3.style.marginTop=I.marginTop=r,focusDIV1.style.top=focusDIV3.style.top=focusDIV2.style.top=I.top,focusDIV1.style.right=focusDIV2.style.right=focusDIV3.style.right=I.right,focusDIV1.style.height=focusDIV2.style.height=focusDIV3.style.height=I.height,focusDIV1.style.width=focusDIV2.style.width=focusDIV3.style.width=I.width,fillSeriesDIV2.style.marginRight=E.marginRight=n,fillSeriesDIV3.style.marginTop=E.marginTop=r,cellRangeFillDIV2.style.marginRight=L.marginRight=n,cellRangeFillDIV3.style.marginTop=L.marginTop=r,getObj(mCC2Id).style.marginRight=n,getObj(mCC3Id).style.marginTop=r;var u=P.style;u.marginRight=n,u.marginTop=r;var w=filterIconsPane.style;w.right=n,w.top=r,filterIconsPane1.style.right=filterIconsPane1.style.top="0px",filterIconsPane2.style.right=n,filterIconsPane3.style.top=r;var C=dvListIconsPane.style;C.right=n,C.top=r,dvListIconsPane1.style.right=dvListIconsPane1.style.top="0px",dvListIconsPane2.style.right=n,dvListIconsPane3.style.top=r;var m=sheetObjectsPane.style;m.right=n,m.top=r}else{p.left=h.left=n,d.left=f.left="0px",d.width=p.width=f.width=h.width,f.height=h.height,d.height=p.height=f.top=h.top=r,g.left=g.top="0px",y.left=i,y.top="0px",T.left="0px",T.top=a,c.left=i,c.top=a;var E=fillSeriesDIV.style,L=cellRangeFillDIV.style;focusDIV2.style.marginLeft=I.marginLeft=n,focusDIV3.style.marginTop=I.marginTop=r,focusDIV1.style.top=focusDIV3.style.top=focusDIV2.style.top=I.top,focusDIV1.style.left=focusDIV2.style.left=focusDIV3.style.left=I.left,focusDIV1.style.height=focusDIV2.style.height=focusDIV3.style.height=I.height,focusDIV1.style.width=focusDIV2.style.width=focusDIV3.style.width=I.width,fillSeriesDIV2.style.marginLeft=E.marginLeft=n,fillSeriesDIV3.style.marginTop=E.marginTop=r,cellRangeFillDIV2.style.marginLeft=L.marginLeft=n,cellRangeFillDIV3.style.marginTop=L.marginTop=r,getObj(mCC2Id).style.marginLeft=n,getObj(mCC3Id).style.marginTop=r;var u=P.style;u.marginLeft=n,u.marginTop=r;var w=filterIconsPane.style;w.left=n,w.top=r,filterIconsPane1.style.left=filterIconsPane1.style.top="0px",filterIconsPane2.style.left=n,filterIconsPane3.style.top=r;var C=dvListIconsPane.style;C.left=n,C.top=r,dvListIconsPane1.style.left=dvListIconsPane1.style.top="0px",dvListIconsPane2.style.left=n,dvListIconsPane3.style.top=r;var m=sheetObjectsPane.style;m.left=n,m.top=r}}(Filter.hasFilter||Filter.isPivotFilter)&&Filter.replicateInAllPanes(!0)},setCues:function(e,t){e-1>=0&&(hFreezeCue.style.left="0px",this.setHCuePos(getRowTop(e)-1),this.setHCueWidth()),t-1>=0&&(this.setVCuePos(getColLeft(t)-1),this.setVCueHeight(),vFreezeCue.style.top="0px")},setHCuePos:function(e){hFreezeCue.style.top=e-1+"px"},setVCuePos:function(e){vFreezeCue.style[isRTL?"right":"left"]=e-1+"px"},setHCueWidth:function(){hFreezeCue.style.width=getSheetTableWidth()+"px"},setVCueHeight:function(){vFreezeCue.style.height=getSheetTableHeight()+"px"},splitColHead:function(e){colHeadTable1.innerHTML="";for(var t=0;e>t;t++)colHeadTable1.appendChild(colHeadTable.childNodes[t].cloneNode(!0));var s=getColLeft(e);colHead1.style.width=s+"px",colHeadTable1.style.width=colHeadTable.style.width,colHead.style[isRTL?"right":"left"]=s+"px",colHead.style.width=parseInt(colHead.style.width,10)-s+"px",colHeadTable.style[isRTL?"right":"left"]=-1*s+"px",secondPaneLeft=fourthPaneLeft=s,colHeadTable1.style.width=""},splitRowHead:function(e){rowHeadTable1.innerHTML=rowHeadTable.innerHTML;var t=getRowTop(e);rowHead1.style.height=t+"px",rowHeadTable1.style.height=rowHeadTable.style.height,rowHead.style.top=t+"px",rowHead.style.height=parseInt(rowHead.style.height,10)-t+"px",rowHeadTable.style.top=-1*t+"px",thirdPaneTop=fourthPaneTop=t},mergeSheetPanes:function(){if(isRTL){appEvent.trigger("Sheet.Unfreeze"),(isColsOnlyFreezed||isColsAndRowsFreezed)&&this.mergeColHeads(),(isRowsOnlyFreezed||isColsAndRowsFreezed)&&this.mergeRowHeads(),sheetTable1.innerHTML=sheetTable2.innerHTML=sheetTable3.innerHTML="",sheetTable.style.top=sheetTable.style.right="0px",sheetTable1.style.top=sheetTable1.style.right="0px",sheetTable2.style.top=sheetTable2.style.right="0px",sheetTable3.style.top=sheetTable3.style.right="0px",colHead.style.right=sheetPane.style.right=sheetPane2.style.right=sheetPane3.style.right="0px",rowHead.style.top=sheetPane.style.top=sheetPane2.style.top=sheetPane3.style.top="0px",sheetPane2.scrollLeft=0,sheetPane3.scrollTop=0,colHead.style.width=parseInt(colHead.style.width,10)+secondPaneLeft+"px",rowHead.style.height=parseInt(rowHead.style.height,10)+thirdPaneTop+"px",focusDIV.style.marginRight=fillSeriesDIV.style.marginRight=cellRangeFillDIV.style.marginRight="0px",focusDIV2.style.marginRight=fillSeriesDIV2.style.marginRight=cellRangeFillDIV2.style.marginRight="0px",focusDIV.style.marginTop=fillSeriesDIV.style.marginTop=cellRangeFillDIV.style.marginTop="0px",focusDIV3.style.marginTop=fillSeriesDIV3.style.marginTop=cellRangeFillDIV3.style.marginTop="0px";var e=getObj(mCC1Id),t=getObj(mCC2Id),s=getObj(mCC3Id);mCC.style.marginRight=t.style.marginRight="0px",mCC.style.marginTop=s.style.marginTop="0px",e.innerHTML=t.innerHTML=mCC3Id.innerHTML="",Merge.unBindDOMObjcts(),sheetObjectsPane.style.right=sheetObjectsPane.style.top="",filterIconsPane.style.right=filterIconsPane.style.top="",filterIconsPane1.style.right=filterIconsPane1.style.top="",filterIconsPane2.style.right=filterIconsPane2.style.top="",filterIconsPane3.style.right=filterIconsPane3.style.top="",filterIconsPane2.innerHTML=filterIconsPane3.innerHTML=filterIconsPane1.innerHTML="",dvListIconsPane.style.right=dvListIconsPane.style.top="",dvListIconsPane1.style.right=dvListIconsPane1.style.top="",dvListIconsPane2.style.right=dvListIconsPane2.style.top="",dvListIconsPane3.style.right=dvListIconsPane3.style.top="",dvListIconsPane2.innerHTML=dvListIconsPane3.innerHTML=dvListIconsPane1.innerHTML=""}else{appEvent.trigger("Sheet.Unfreeze"),(isColsOnlyFreezed||isColsAndRowsFreezed)&&this.mergeColHeads(),(isRowsOnlyFreezed||isColsAndRowsFreezed)&&this.mergeRowHeads(),sheetTable1.innerHTML=sheetTable2.innerHTML=sheetTable3.innerHTML="",sheetTable.style.top=sheetTable.style.left="0px",sheetTable1.style.top=sheetTable1.style.left="0px",sheetTable2.style.top=sheetTable2.style.left="0px",sheetTable3.style.top=sheetTable3.style.left="0px",colHead.style.left=sheetPane.style.left=sheetPane2.style.left=sheetPane3.style.left="0px",rowHead.style.top=sheetPane.style.top=sheetPane2.style.top=sheetPane3.style.top="0px",sheetPane2.scrollLeft=0,sheetPane3.scrollTop=0,colHead.style.width=parseInt(colHead.style.width,10)+secondPaneLeft+"px",rowHead.style.height=parseInt(rowHead.style.height,10)+thirdPaneTop+"px",focusDIV.style.marginLeft=fillSeriesDIV.style.marginLeft=cellRangeFillDIV.style.marginLeft="0px",focusDIV2.style.marginLeft=fillSeriesDIV2.style.marginLeft=cellRangeFillDIV2.style.marginLeft="0px",focusDIV.style.marginTop=fillSeriesDIV.style.marginTop=cellRangeFillDIV.style.marginTop="0px",focusDIV3.style.marginTop=fillSeriesDIV3.style.marginTop=cellRangeFillDIV3.style.marginTop="0px";var e=getObj(mCC1Id),t=getObj(mCC2Id),s=getObj(mCC3Id);mCC.style.marginLeft=t.style.marginLeft="0px",mCC.style.marginTop=s.style.marginTop="0px",e.innerHTML=t.innerHTML=mCC3Id.innerHTML="",Merge.unBindDOMObjcts(),sheetObjectsPane.style.left=sheetObjectsPane.style.top="",filterIconsPane.style.left=filterIconsPane.style.top="",filterIconsPane1.style.left=filterIconsPane1.style.top="",filterIconsPane2.style.left=filterIconsPane2.style.top="",filterIconsPane3.style.left=filterIconsPane3.style.top="",filterIconsPane2.innerHTML=filterIconsPane3.innerHTML=filterIconsPane1.innerHTML="",dvListIconsPane.style.left=dvListIconsPane.style.top="",dvListIconsPane1.style.left=dvListIconsPane1.style.top="",dvListIconsPane2.style.left=dvListIconsPane2.style.top="",dvListIconsPane3.style.left=dvListIconsPane3.style.top="",dvListIconsPane2.innerHTML=dvListIconsPane3.innerHTML=dvListIconsPane1.innerHTML=""}userPresence.handleUnFreeze()},mergeColHeads:function(){var e=getColLeft(FREEZED_COL);colHeadTable1.innerHTML="",colHead1.style.width="0px",colHeadTable1.style.width="0px",colHead.style.width=parseInt(colHead.style.width,10)+e+"px",isRTL?(colHead.style.right="0px",colHeadTable.style.right="0px"):(colHead.style.left="0px",colHeadTable.style.left="0px")},mergeRowHeads:function(){var e=getRowTop(FREEZED_ROW);rowHeadTable1.innerHTML="",rowHead1.style.height="0px",rowHeadTable1.style.height="0px",rowHead.style.top="0px",rowHead.style.height=parseInt(rowHead.style.height,10)+e+"px",rowHeadTable.style.top="0px"},setSheetPanesDim:function(e){switch(e){case"ROWS":sheetPane2.style.width=sheet.style.width,sheetPane2.style.height=thirdPaneTop+"px",sheetPane.style.height=parseInt(sheet.style.height,10)-thirdPaneTop+"px";break;case"COLS":sheetPane3.style.width=secondPaneLeft+"px",sheetPane3.style.height=sheetPane.style.height,sheetPane.style.width=parseInt(sheet.style.width,10)-secondPaneLeft+"px";break;case"ROWS/COLS":var t=parseInt(sheet.style.width,10)-secondPaneLeft+"px",s=parseInt(sheet.style.height,10)-thirdPaneTop+"px";sheetPane1.style.width=secondPaneLeft+"px",sheetPane1.style.height=thirdPaneTop+"px",sheetPane2.style.width=t,sheetPane2.style.height=thirdPaneTop+"px",sheetPane3.style.width=secondPaneLeft+"px",sheetPane3.style.height=s,sheetPane.style.width=t,sheetPane.style.height=s}},resetSheetPaneDim:function(){colHead.style.width=sheetPane.style.width=parseInt(sheetPane.style.width,10)+secondPaneLeft+"px",rowHead.style.height=sheetPane.style.height=parseInt(sheetPane.style.height,10)+thirdPaneTop+"px"},setRowHeadAndTableForReload:function(){var e=getRowTop(FREEZED_ROW),t=getSheetHeight();rowHead1.style.height=rowHead.style.top=e+"px",rowHeadTable1.style.height=e+"px",rowHeadTable.style.top=-e+"px",rowHead.style.height=t-e+"px"},showSheetPanes:function(e){"COLS"==e?(colHead1.style.display="",sheetPane3.style.display=""):"ROWS"==e?(rowHead1.style.display="",sheetPane2.style.display=""):(colHead1.style.display="",rowHead1.style.display="",sheetPane1.style.display="",sheetPane2.style.display="",sheetPane3.style.display="")},hideSheetPanes:function(){rowHead1.style.display="none",colHead1.style.display="none",sheetPane1.style.display="none",sheetPane2.style.display="none",sheetPane3.style.display="none"}};
function checkCookieSettings(){var e=new Date;e.setTime(e.getTime()-1),document.cookie="testcookie; expires="+e.toGMTString(),cookieEnabled=navigator.cookieEnabled,document.cookie="testcookie=testcookie",cookieEnabled=-1!=document.cookie.indexOf("testcookie")?!0:!1,cookieEnabled||(handleServerError("ERROR",replaceParams(jsMsg["Banner.Cookie.Disabled.Message"],new Array("<a target='_blank' href='"+jsMsg.ZohoHomeURL+"zoho_faq.html#13'>","</a>")),!0,!1),cookieStatusShown=!0)}function checkGuestViewSettings(){if(jsGUEST_VIEW){var e=iamurlWithServiceURL+encodeURIComponent("?guestId="+encodeURIComponent(guestEncStr)),i="";IS_WHOLE_DOCUMENT_SHARED_IN_READ_WRITE&&(i=replaceParams(jsMsg["GuestView.Banner.SignUp.Info.ForReadWritePermission"],new Array(CURR_DOC_OWNERNAME+"'s","<span class=''>","<a target='_self' href='"+e+"'>","</a>",guestId,"</span>","<strong>","</strong>"))),handleServerError("INFORMATION",i,!0,!0),guestStatusShown=!0}}function checkTrashViewSettings(){jsTRASH_VIEW&&(READ_WRITE=!1,allowSheetSwitch=!0)}function checkPublicViewSettings(){if(jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE){var e=getObj("pubEditBtn");if(e&&(e.disabled=!1),READ_WRITE=!1,ALLOW_TO_WRITE=!1,exprField.readOnly=!0,allowSheetSwitch=!0,(isPublished||jsEMBED_VIEW)&&editPublicDoc(!0,!0),!isPublished&&!jsEMBED_VIEW){var i="";if(i=isPublicEditDoc?"PublicView.Banner.OrgEditDocument.Info":"PublicView.Banner.ReadOnly.Info",!isPublicViewDoc){var t=replaceParams(jsMsg[i],new Array("<strong>","</strong>"));showBannerMessage("INFO",t),publicMsgShown=!0}editPublicDoc(!0,!0)}}}function setReadOnlyViewSettings(){jsREMOTE_VIEW||jsTHROWAWAY_VIEW||jsPUBLIC_VIEW||(READ_WRITE=!1,ALLOW_TO_WRITE=!1,exprField.readOnly=!0,allowSheetSwitch=!0,isReadOnlyViewMode=!0,hideBannerMessage())}function documentUtilities(){cookieStatusShown||checkCookieSettings(),guestStatusShown||checkGuestViewSettings(),checkTrashViewSettings(),publicMsgShown||checkPublicViewSettings(),!ALLOW_TO_WRITE&&READ_ONLY_VIEW_MODE&&setReadOnlyViewSettings(),READ_WRITE||$("#fSC").hide(),"true"!=wmsCommErrorStatus||wmsErrorMsgShown||(wmsErrorMsgShown=!0)}function isServerComponentLoaded(){return documentBakeStatus.isBaked()?!0:!1}function initServerCompLoadingActivities(e){e||(TEMP_READ_WRITE=READ_WRITE,READ_WRITE=!1),exprField.readOnly=!0}function serverCompLoadedActivities(e){documentBakeStatus.setRenderBake(!0),e||(READ_WRITE=TEMP_READ_WRITE),unMaskSheet();var i=getObj("waitmsg");null!=i&&(i.style.display="none"),"true"!=wmsCommErrorStatus&&fileToolbarMask&&(fileToolbarMask.style.display="none"),READ_WRITE&&(exprField.readOnly=!1),(jsPUBLIC_VIEW&&!PUBLIC_EDIT_MODE&&!jsEMBED_VIEW||!REMOTE.ISEDITABLE)&&(READ_WRITE=!1)}function editPublicDoc(e,i){if(e&&!PUBLIC_EDIT_MODE)if(i){PUBLIC_EDIT_MODE=!0,READ_WRITE=!0,ALLOW_TO_WRITE=!1,exprField.readOnly=!1,isReadOnlyViewMode=!1,appEvent.trigger("setImagePermission"),setChartPermission();var t=getObj("pubEditBtn");if(t&&(t.disabled=!0,t.className="button-disabled"),!isPublished&&!jsEMBED_VIEW)if(isPublicEditDoc);else{if(allowExport)var s=replaceParams(jsMsg["PublicView.Banner.Interactive.Info.SaveToMyAccount.Enabled"],new Array("<strong>","</strong>"));else var s=replaceParams(jsMsg["PublicView.Banner.Interactive.Info.SaveToMyAccount.Disabled"],new Array("<strong>","</strong>"));showBannerMessage("INFO",s)}showSaveMessage("disable")}else isInOOMode?editPublicDoc(!0,!0):loadDocumentObject(DOCUMENT_ID,DOCUMENT_NAME,CURRENTTIME,CURR_DOC_OWNERNAME,void 0,!0);isPublished||resetWorkSheetDim()}var cookieStatusShown=!1,cookieEnabled=!0,guestStatusShown=!1,publicMsgShown=!1,TEMP_READ_WRITE=!0;
function updateResponseJson(e){var t=parseJSON(e);updateJson(t)}function updateJson(e){var t,n=null,s=!1;if(isUndefined(e.rsid)||(s=e.rsid==WebMessanger.getRawSid()),!isUndefined(e.macroresponse)&&s&&(e.macroresponse.a==ActionConstants.MACRO_INSERT?callBack_insertMacro(JSON.stringify(e.macroresponse),e.macroresponse.macN):e.macroresponse.a==ActionConstants.MACRO_DELETE?callBack_deleteMacro(e.macroresponse):e.macroresponse.a==ActionConstants.MACRO_SAVE&&callBack_saveMacro(e.macroresponse)),!isUndefined(e.webdatadeleted)&&s&&showWebDataDetails(),s&&!isUndefined(e[JSONConstants.DATAVALIDATION_ERROR])&&e[JSONConstants.DATAVALIDATION_ERROR][JSONConstants.DATAVALIDATION_ISSTOPEDIT]===!0)return void appEvent.trigger("datavalidation.stopError",[e]);if(hideProgressMessage(),!isUpdateClientFirst||!s||isUndefined(e[JSONConstants.CLIENT_ACTION])){if(1!=s||isUndefined(e[ActionConstants.UNDOREDOCOUNT])||(setUNDO(e[ActionConstants.UNDOREDOCOUNT].u),setREDO(e[ActionConstants.UNDOREDOCOUNT].r)),!isUndefined(e[JSONConstants.WORKBOOK_LEVEL_ACTION]))for(t=0;t<e[JSONConstants.WORKBOOK_LEVEL_ACTION].length;t++)updateWorkbookLevelAction(e[JSONConstants.WORKBOOK_LEVEL_ACTION][t],s,!isUndefined(e[ActionConstants.SELECT]));if(!isUndefined(e.a)&&(e.a==ActionConstants.IMPORT_INSERT_AS_NEW_SHEETS||e.a==ActionConstants.IMPORT_REPLACE_CURRENTSHEET||e.a==ActionConstants.IMPORT_APPEND_ROWS_TO_CURRENTSHEET||e.a==ActionConstants.IMPORT_REPLACE_DATA_STARTING_AT_CELL)){if(e.a==ActionConstants.IMPORT_APPEND_ROWS_TO_CURRENTSHEET){var o=e[JSONConstants.WORKBOOK_LEVEL_ACTION][0],a=o[JSONConstants.START_ROW];focusCell(a,0)}appEvent.trigger("import.response")}if(!isUndefined(e[ActionConstants.NAMED_RANGE])){var r=e[ActionConstants.NAMED_RANGE];appEvent.trigger("namedrangechanged",[ActionConstants.NAMED_RANGE,r])}if(!isUndefined(e[ActionConstants.WORKBOOK_ACTION]))for(t=0;t<e[ActionConstants.WORKBOOK_ACTION].length;t++)updateWorkbookActionJson(e[ActionConstants.WORKBOOK_ACTION][t]);if(isUndefined(e[JSONConstants.PROTECTED_RANGES])&&isUndefined(e[JSONConstants.PROTECTED_SHEETS])||ProtectedRanges.getObject().updateResponse(e),1==s&&!isUndefined(e[ActionConstants.DEBUG_MSG]))for(n=[],t=0;t<e[ActionConstants.DEBUG_MSG].length;t++)n.push(e[ActionConstants.DEBUG_MSG][t]);if(1!=s||isUndefined(e[ActionConstants.ENABLE_EVENTS])||handleWarningTab(e[ActionConstants.ENABLE_EVENTS]),1==e.rt&&(isUndefined(e[ActionConstants.SELECT])||e[ActionConstants.SELECT].sn==CURRSHEETNAME)&&(isUndefined(e[ActionConstants.FILTER_JSON])||!isUndefined(e.a)&&(e.a==ActionConstants.INSERT_COPY_COLUMN||e.a==ActionConstants.INSERT_CUT_COLUMN))){e.a==ActionConstants.INSERT_COPY_COLUMN?appEvent.trigger("UpdateDiscussionRanges",[e.sn,!1,!1,e.wla[0].sc,e.wla[0].count]):e.a==ActionConstants.INSERT_COPY_ROW&&appEvent.trigger("UpdateDiscussionRanges",[e.sn,!0,!1,e.wla[0].sr,e.wla[0].count]);var i={};i.isExecuteActionIdNeeded=!0,reloadPage(void 0,!0,i)}if(!isUndefined(e[ActionConstants.CHART])){var c=e[ActionConstants.CHART];appEvent.trigger("chart.onLoad",[c,s])}if(!isUndefined(e[ActionConstants.RANGE])){for(t=0;t<e[ActionConstants.RANGE].length;t++){var l=e[ActionConstants.RANGE][t];l.a===ActionConstants.INSERT_ROW&&(l.rHt=e[ActionConstants.HEIGHT][CURRSHEETNAME][0].v),updateRangeJson(l,s)}appEvent.trigger("range.update",[e[ActionConstants.RANGE],[e.sn]])}if(e.a==ActionConstants.CHART_COPY_STYLE&&appEvent.trigger("chart.insert.server.copystyles",[e]),e.a==ActionConstants.SERVERCLIP_PASTE_SHEET||e.a==ActionConstants.IMPORT_INSERT_AS_NEW_SHEETS){appEvent.trigger("copysheet.insert",[e.psn,e.scsasn,s]);var C=e[JSONConstants.PIVOT_DETAILS];if(C)for(var E=0;E<C.length;E++)PivotUtil.createPivotObject(C[E]);if(e.nor){var d=e.nor;for(t=0;t<d.length;t++)appEvent.trigger("namedrangechanged",[ActionConstants.NAMEDRANGE_ADD,d[t]])}}if((!isUndefined(e.ur)||!isUndefined(e.sn)&&CURRSHEETNAME==e.sn||!isUndefined(e.s)&&WorkSheets.getAssociatedActiveSheetName()==e.s)&&1==s&&!isCellEdited()&&!isUndefined(e[ActionConstants.SELECT])){if(CURRSHEETNAME==e[ActionConstants.SELECT].sn){var A=e[ActionConstants.SELECT],S=A[JSONConstants.ACTION],O=A[JSONConstants.START_ROW],T=A[JSONConstants.START_COLUMN],R=A[JSONConstants.END_ROW],g=A[JSONConstants.END_COLUMN];if(!S||S!=ActionConstants.COPY_PASTE||S!=ActionConstants.CUT_PASTE||O==getCellRange().startRow&&T==getCellRange().startCol){var N=A[JSONConstants.FOCUS_TYPE];isSelectionAfterPaste?isSelectionAfterPaste=!1:"cell"==N?focusCell(O,T):"cellRange"==N?(focusCellRange(O,T,R,g,void 0,!0),scrollCellIntoView(R,g)):"cols"==N?focusCol(T,g):"rows"==N?focusRow(O,R):"sheet"==N&&focusAllCells()}e[ActionConstants.FILLSERIES]&&(R>usedCursRow&&(usedCursRow=R),g>usedCursCol&&(usedCursCol=g))}else Goto.doGoto(e[ActionConstants.SELECT].sn,e[ActionConstants.SELECT].sr,e[ActionConstants.SELECT].er,e[ActionConstants.SELECT].sc,e[ActionConstants.SELECT].ec,!0);FIND.dialogOpen&&moveDialogBox(e[ActionConstants.SELECT].sr,e[ActionConstants.SELECT].sc)}if(!isUndefined(e.sn)&&CURRSHEETNAME==e.sn||!isUndefined(e.s)&&WorkSheets.getAssociatedActiveSheetName()==e.s){if(appEvent.trigger("RTC",[e,s]),e.a===ActionConstants.READ_FILTER_RANGE&&Filter.updateFilterJson(e),isUndefined(e[ActionConstants.READ_FILTER_RANGE])||Filter.updateFilterJson(e[ActionConstants.READ_FILTER_RANGE]),isUndefined(e[ActionConstants.FILTER_JSON])||Filter.updateFilterJson(e[ActionConstants.FILTER_JSON],s),!isUndefined(e[ActionConstants.CLEARALL])){var f=currCell.className;for(f=replace(f," cC",""),currCell.className=f,t=0;t<e[ActionConstants.CLEARALL].length;t++){var v=e[ActionConstants.CLEARALL][t];isUndefined(v.sr)||(clearAll(v.sr,v.sc,v.er,v.ec,v.ws,v.wd),appEvent.trigger("range.clearAll",[v.sr,v.sc,v.er,v.ec]),updateRangeJson(v,s))}init_format(currCell)}if(isUndefined(e[ActionConstants.DATA_VALIDATION_CLEAR])||appEvent.trigger("cell.datavalidationClear",[e[ActionConstants.DATA_VALIDATION_CLEAR]]),!isUndefined(e[ActionConstants.CLEARSTYLES])){for(t=0;t<e[ActionConstants.CLEARSTYLES].length;t++){var u=e[ActionConstants.CLEARSTYLES][t];if(!isUndefined(u.sr)){var I={doNotSkipCoveredCells:!0};isUndefined(e[ActionConstants.RANGE])||e[ActionConstants.RANGE][0].a!=ActionConstants.INSERT_ROW&&e[ActionConstants.RANGE][0].a!=ActionConstants.DELETE_ROW||(I.doNotSkipCoveredCells=!1),isUndefined(e[ActionConstants.SELECT])||e[ActionConstants.SELECT].a!=ActionConstants.COPY_PASTE||(I.doNotSkipCoveredCells=!1),clearFormatting(u.sr,u.sc,u.er,u.ec,I)}}init_format(currCell)}if(!isUndefined(e[ActionConstants.CELL])&&0!==e[ActionConstants.CELL].length){var p=FadeCell.elemsarrIndex;for(FadeCell.elemsarrIndex++,FadeCell.elemsarr[p]=[],t=0;t<e[ActionConstants.CELL].length;t++)(isUndefined(e[ActionConstants.CELL][t].sn)||CURRSHEETNAME===e[ActionConstants.CELL][t].sn)&&(isUndefined(e[ActionConstants.CELL][t].r)?updateRangeDataJson(e[ActionConstants.CELL][t],p):updateCellData(e[ActionConstants.CELL][t].r,e[ActionConstants.CELL][t].c,e[ActionConstants.CELL][t],p));if(appEvent.trigger("range.updatedata"),0!==FadeCell.elemsarr[p].length){var _=7;FadeCell.fadeCells(_,p)}else FadeCell.elemsarr[p]=null,p<FadeCell.elemsarrIndex&&(FadeCell.elemsarrIndex=p)}if(!isUndefined(e[ActionConstants.RANGE_STYLE])){for(t=0;t<e[ActionConstants.RANGE_STYLE].length;t++)isUndefined(e[ActionConstants.RANGE_STYLE][t].r)?updateRangeStyleJson(e[ActionConstants.RANGE_STYLE][t]):updateCellStyle(e[ActionConstants.RANGE_STYLE][t].r,e[ActionConstants.RANGE_STYLE][t].c,e[ActionConstants.RANGE_STYLE][t]);init_format(currCell)}if(!isUndefined(e[ActionConstants.RANGE_STYLE])){for(t=0;t<e[ActionConstants.RANGE_STYLE].length;t++)isUndefined(e[ActionConstants.RANGE_STYLE][t].r)?updateRangeStyleJson(e[ActionConstants.RANGE_STYLE][t]):updateCellStyle(e[ActionConstants.RANGE_STYLE][t].r,e[ActionConstants.RANGE_STYLE][t].c,e[ActionConstants.RANGE_STYLE][t]);init_format(currCell)}if(!isUndefined(e[ActionConstants.BORDERS])){var h=!0,m=!isUndefined(e.a)&&e.a===ActionConstants.BORDERS;if(m){var I={doNotSkipCoveredCells:!0};clearBorder(e.sr,e.sc,e.er,e.ec,I)}for(t=0;t<e[ActionConstants.BORDERS].length;t++)isUndefined(e[ActionConstants.BORDERS][t].r)?updateRangeBorderJson(e[ActionConstants.BORDERS][t],h):updateCellBorder(e[ActionConstants.BORDERS][t].r,e[ActionConstants.BORDERS][t].c,e[ActionConstants.BORDERS][t],h)}if(isUndefined(e[ActionConstants.WIDTH])||(updateWidthJson(e[ActionConstants.WIDTH]),focusSheet()),!isUndefined(e.ARRAYDETAILS)){var L=e.ARRAYDETAILS;arrayDetails="string"==typeof L&&"EMPTY"===L?[]:L}if(e[ActionConstants.CTRL_COMP]&&loadControlComponent(e[ActionConstants.CTRL_COMP]),!isUndefined(e.frange)){var b=e.frange,D=WorkSheets.getSheetCodeFromName(e.sn);setTimeout(function(){FormObj.create(D,b)},1e3)}}if(appEvent.trigger("datavalidation.infoForCollobarators",[e,s]),(!isUndefined(e.sn)&&CURRSHEETNAME===e.sn||!isUndefined(e.s)&&WorkSheets.getAssociatedActiveSheetName()===e.s)&&(isUndefined(e[ActionConstants.DATA_VALIDATION_READRANGE])||appEvent.trigger("cell.datavalidationApply",[e[ActionConstants.DATA_VALIDATION_READRANGE]])),isUndefined(e[JSONConstants.DATAVALIDATION_ERROR])||Boolean(e[JSONConstants.DATAVALIDATION_ERROR][JSONConstants.DATAVALIDATION_ISSTOPEDIT])!==!1||appEvent.trigger("datavalidation.infoError",[e]),isUndefined(e.invalidCells)||DataValidation.highlightCells(e.invalidCells),!isUndefined(e[ActionConstants.HEIGHT])&&!isUndefined(e[ActionConstants.HEIGHT][CURRSHEETNAME])){var M=null,U=!0,P=!0;e.rt&&(M={},M.isExecuteActionIdNeeded=!0),isUndefined(e[ActionConstants.RANGE])&&ole.getObjects("button").length>0&&(P=!1,ole.getObjects("button").length>0&&(U=!1)),setRowsHeightAndModifyDOM(e[ActionConstants.HEIGHT][CURRSHEETNAME],e.rt,M,s,U,P),focusSheet()}if(1==s&&!isUndefined(e[ActionConstants.DEBUG_MSG]))for(t=0;t<e[ActionConstants.DEBUG_MSG].length;t++)msgboxArray.push(e[ActionConstants.DEBUG_MSG]);if(1==s&&e[ActionConstants.REPEAT_ACTION]&&repeat.setLastAction(e[ActionConstants.REPEAT_ACTION]),e[JSONConstants.VIEW_PORT]){var k=e[JSONConstants.VIEW_PORT],H=Math.max(getAvailableStartRow(),FREEZED_ROW),J=getAvailableEndRow(),y=k[JSONConstants.MODIFIED_RANGE_START_ROW],F=k[JSONConstants.MODIFIED_RANGE_END_ROW],x=k[JSONConstants.START_ROW],B=k[JSONConstants.END_ROW];(x>H&&x>y||J>B&&F>B&&k[JSONConstants.ASSOCIATED_SHEET_NAME]==WorkSheets.getAssociatedActiveSheetName())&&reloadPage(void 0,!0)}if(!isUndefined(e[ActionConstants.LOCK_MULTIPLE]))for(t=0;t<e[ActionConstants.LOCK_MULTIPLE].length;t++){var l=e[ActionConstants.LOCK_MULTIPLE][t];(CURRSHEETNAME===l.sn||l.a===ActionConstants.LOCK_SHEET||l.a===ActionConstants.UNLOCK_SHEET)&&ProtectedRanges.getObject().updateResponse(l)}if(1==s){var w=e[JSONConstants.INFO_MESSAGE];w&&(w[ActionConstants.REPLACE]?searchCallBack():w[ActionConstants.REPLACE_ALL]&&searchCallBack(w[ActionConstants.REPLACE_ALL]));var W=null;isUndefined(e.me)&&null==n||(W=e.me,handleMacroErrorAndMsg(W,n))}if((!isUndefined(e.sn)&&CURRSHEETNAME==e.sn||!isUndefined(e.s)&&WorkSheets.getAssociatedActiveSheetName()==e.s)&&!isUndefined(e[JSONConstants.CONDITION_FORMAT])){var G=e[JSONConstants.CONDITION_FORMAT]&&e[JSONConstants.CONDITION_FORMAT][0]===!0?!0:!1;for(t=0;t<e[JSONConstants.CONDITION_FORMAT].length;t++)updateRangeStyleJson(e[JSONConstants.CONDITION_FORMAT][t],G,!1,!0);init_format(currCell)}if(!isUndefined(e[JSONConstants.COLORSCALE_COLOR]))for(var O,T,R,g,V=e[JSONConstants.COLORSCALE_COLOR],j=0;j<V.length;j++){var Y=V[j];for(var t in Y){var K=Y[t];for(E=0;E<K.length;E++)if(K[E].hasOwnProperty("sr")?(O=K[E].sr,T=K[E].sc,R=K[E].er,g=K[E].ec):K[E].hasOwnProperty("R")&&(O=K[E].R,T=K[E].C,R=O,g=T),K[E].hasOwnProperty("csHexColor")){var Z=K[E].csHexColor;Z="#"==Z.charAt(0)?Z:"#"+Z,updateRangeFormat(O,T,R,g,"backgroundColor",Z)}else removeStyle("backgroundColor",O,T,R,g)}}e.xaid&&appEvent.trigger("response.updatedInClient",[e.xaid,e.serverActionExecutionTime,e.responseGeneratedTime])}}function split_merge(e){var t=e.v,n=parseInt(e.sr),s=parseInt(e.sc),o=parseInt(e.er),a=parseInt(e.ec);if(t)mergeCells(n,s,o,a,!0,!1,!0);else{var r=!0;ActiveCellInfo.isMerged()&&n>=ActiveCellInfo.getStartRow()&&s>=ActiveCellInfo.getStartCol()&&o<=ActiveCellInfo.getEndRow()&&a<=ActiveCellInfo.getEndCol()&&(r=!1,n=ActiveCellInfo.getStartRow(),s=ActiveCellInfo.getStartCol(),o=ActiveCellInfo.getEndRow(),a=ActiveCellInfo.getEndCol()),splitCells(n,s,o,a,r,!0)}}function updateRangeJson(e,t){var n=parseInt(e.a);if("undefined"==typeof e.sn||CURRSHEETNAME==e.sn||n===ActionConstants.UNLOCK_RANGE){var s={doNotSkipFirstCoveredCell:!0};switch(n){case ActionConstants.ITALIC:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"fontStyle",e.v,s);break;case ActionConstants.UNDERLINE:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"textDecoration",e.v,s);break;case ActionConstants.FONTFAMILY:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"fontFamily",e.v,s);break;case ActionConstants.FONTSIZE:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"fontSize",e.v,s);break;case ActionConstants.VALIGN:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"verticalAlign",e.v,s);break;case ActionConstants.HALIGN:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"textAlign",e.v,s);break;case ActionConstants.COLOR:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"backgroundColor",e.v,s);break;case ActionConstants.TEXTCOLOR:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"color",e.v,s);break;case ActionConstants.WRAP:setWrapPropertyForCellRange(e.sr,e.er,e.sc,e.ec,e.v);break;case ActionConstants.HEIGHT:setRowsHeightAndModifyDOM([e]),focusSheet();break;case ActionConstants.CLEARSTYLES:clearFormatting(e.sr,e.sc,e.er,e.ec);break;case ActionConstants.CLEARCONTENTS:isUndefined(e.sr)?clearContents(e.r,e.c,e.r,e.c,t,!0):clearContents(e.sr,e.sc,e.er,e.ec,t,!0);break;case ActionConstants.BORDERS:isRTL&&(13==e.v?e.v=14:14==e.v&&(e.v=13)),applyBorder(e.v,e.bs,e.bc,e.sr,e.sc,e.er,e.ec);break;case ActionConstants.MERGE_AND_CENTER:mergeAndCenter(e.sr,e.sc,e.er,e.ec);break;case ActionConstants.MERGE_RANGE:mergeRange(e.sr,e.sc,e.er,e.ec,t);break;case ActionConstants.MERGE_ACROSS:mergeAcross(e.sr,e.sc,e.er,e.ec,e.atc);break;case ActionConstants.MERGE_DOWN:mergeDown(e.sr,e.sc,e.er,e.ec);break;case ActionConstants.MERGE_SPLIT:break;case ActionConstants.BOLD:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"fontWeight",e.v,s);break;case ActionConstants.WIDTH:setSheetColumnsWidth(e.sc,e.ec,e.v),focusSheet();break;case ActionConstants.HIDE_GRID:gridFunctionality("hide");break;case ActionConstants.SHOW_GRID:gridFunctionality("show");break;case ActionConstants.INSERT_ROW:case ActionConstants.ADD_ROW_IN_NAMEDRANGE:Range.executeShiftOperationCallback("INSERT","ROW",e,t);break;case ActionConstants.INSERT_COL:Range.executeShiftOperationCallback("INSERT","COLUMN",e,t);break;case ActionConstants.DELETE_ROW:Range.executeShiftOperationCallback("DELETE","ROW",e,t);break;case ActionConstants.DELETE_COL:Range.executeShiftOperationCallback("DELETE","COLUMN",e,t);break;case ActionConstants.CELL_STYLENAME:setDefaultFormatForCell(getCell(e.r,e.c));break;case ActionConstants.CELL_COMMENT:appEvent.trigger("annot.handleResponse",[e]);break;case ActionConstants.CLEARALL:split_merge(e),clearAll(e.sr,e.sc,e.er,e.ec,e.ws,e.wd);break;case ActionConstants.SWITCH_SHEET:Goto.doGoto(e.sn,e.sr,e.er,e.sc,e.ec);break;case ActionConstants.UNDO_MESSAGE:showAlertDialog(jsMsg[e.v]);break;case ActionConstants.STRIKETHROUGH:updateRangeFormat(e.sr,e.sc,e.er,e.ec,"strikeThrough",e.v,s);break;case ActionConstants.DELETE_RANGE:deleteCells();break;case ActionConstants.INSERT_RANGE:insertCells();break;case ActionConstants.SELECT:selectedRange=e;break;case ActionConstants.DEBUG_MSG:msgboxArray.push(e);break;case ActionConstants.CLEAR_ANNOTATION:removeRangeComments(e.sr,e.sc,e.er,e.ec);break;case ActionConstants.FREEZE_PANES:SHEET.FREEZE._freeze(e.sr,e.sc,"true",!0),updateViewPort();break;case ActionConstants.UNFREEZE_PANES:SHEET.unFreeze("true",!0,t),updateViewPort();break;case ActionConstants.CTRL_COMP_ADD:Button.init(e.id,e),t?Button.editLabel(e.id,!0):(Button[e.id].switchModes(!1),Button.handleSelectedObjects(e.id));break;case ActionConstants.CTRL_COMP_ASSIGNMACRO:t?(Button(e.id).assignMacro(e),ole(e.id).deSelect(),Button(e.id).setContextMenu()):Button(e.id).assignMacro(e).setContextMenu();break;case ActionConstants.CTRL_COMP_CLONE:t?ole(e.dmid).synchronizeClones(e.ct,e.dmid,e.id):(Button.init(e.id,e,!0),Button(e.id).assignMacro(e),Button[e.id].switchModes(!1).setContextMenu(),ole(e.id).setHeight(e.ht).setWidth(e.wd).setLeft(e.left).setTop(e.top),Button.handleSelectedObjects(e.id));break;case ActionConstants.CTRL_COMP_DELETE:Button[e.id]&&(Button[e.id]=null),getObj(e.id)&&(ole.currObj&&ole.currObj.id==e.id&&getObj("OLETextarea").blur(),ole.remove(e.id,!1),activateCellField());break;case ActionConstants.CTRL_COMP_MOVE:if(!t){var o=ole(e.id);o.sCol=findColInXPos(e.left),o.sRow=findRowInYPos(e.top),o.sRowDiff=e.top-getRowTop(o.sRow),o.sColDiff=e.left-getColLeft(o.sCol),o.moveTo(e.left,e.top),Button.handleSelectedObjects(e.id)}break;case ActionConstants.CTRL_COMP_RESIZE:t||(ole(e.id).resizeTo(e.wd,e.ht),Button.handleSelectedObjects(e.id));case ActionConstants.CTRL_COMP_SETCAPTION:!t&&getObj(e.id)&&(Button(e.id).setText(e.cap),ole(e.id).setLeft(e.left).setWidth(e.wd),Button.handleSelectedObjects(e.id));break;case ActionConstants.IMPORT_REPLACE_DATA_STARTING_AT_CELL:case ActionConstants.IMPORT_APPEND_ROWS_TO_CURRENTSHEET:case ActionConstants.IMPORT_REPLACE_CURRENTSHEET:case ActionConstants.INSERT_COPY_ROW:break;case ActionConstants.INSERT_CUT_ROW:break;case ActionConstants.INSERT_COPY_COLUMN:break;case ActionConstants.INSERT_CUT_COLUMN:break;case ActionConstants.DELETE_PIVOT:PivotUtil.deletePivotInClient(e.id),PivotUtil.hideAndDisplayPivotTab(!0);break;case ActionConstants.FORM_FIELD_DELETED:e[JSONConstants.FORM_COL_DELETED]&&Range.executeShiftOperationCallback("DELETE","COLUMN",e,!0);break;case ActionConstants.FORM_LIVE_SUBMIT:Range.executeShiftOperationCallback("INSERT","ROW",e,!0);break;case ActionConstants.FORM_FIELD_ADDED:Range.executeShiftOperationCallback("INSERT","COLUMN",e,!0);break;case ActionConstants.INSERT_CELL_LEFT:ProtectedRanges.getObject().getRanges().shiftCells(e.sr,e.sc,e.er,e.ec,!1,!1),appEvent.trigger("ShiftDiscussionRanges",[e.sn,e.sr,e.sc,e.er-e.sr+1,e.ec-e.sc+1,!1,!1]);break;case ActionConstants.INSERT_CELL_TOP:ProtectedRanges.getObject().getRanges().shiftCells(e.sr,e.sc,e.er,e.ec,!0,!1),appEvent.trigger("ShiftDiscussionRanges",[e.sn,e.sr,e.sc,e.er-e.sr+1,e.ec-e.sc+1,!0,!1]);break;case ActionConstants.DELETE_CELL_RIGHT:ProtectedRanges.getObject().getRanges().shiftCells(e.sr,e.sc,e.er,e.ec,!1,!0),appEvent.trigger("ShiftDiscussionRanges",[e.sn,e.sr,e.sc,e.er-e.sr+1,e.ec-e.sc+1,!1,!0]);break;case ActionConstants.DELETE_CELL_BOTTOM:ProtectedRanges.getObject().getRanges().shiftCells(e.sr,e.sc,e.er,e.ec,!0,!0),appEvent.trigger("ShiftDiscussionRanges",[e.sn,e.sr,e.sc,e.er-e.sr+1,e.ec-e.sc+1,!0,!0]);break;case ActionConstants.LOCK_RANGE:case ActionConstants.UNLOCK_RANGE:CURRSHEETNAME===e.sn&&ProtectedRanges.getObject().updateResponse(e),protectionDialog.handleDeletionInManage(e)}}}function updateRangeDataJson(e,t){for(var n=e.sr;n<=e.er;n++)if(isRowAvailable(n,e.rs)||ISFREEZED&&FREEZED_ROW>n)for(var s=e.sc;s<=e.ec;s++)updateCellData(n,s,e,t)}function updateCellData(e,t,n,s){var o=!isUndefined(n.cs),a=!isUndefined(n.rs);if(o||a){var r=o?parseInt(n.cs):1,i=a?parseInt(n.rs):1,c=Merge.getCellInfo(e,t),l=!!c,C=!1,E=1,d=1;l&&(C=e!=c.startRow||t!=c.startCol,E=c.getColSpan(),d=c.getRowSpan()),C||(1==r&&1==i&&l?splitCells(e,t,e,t,!0,!0):((r>1||i>1)&&!l||r!=E||i!=d)&&mergeCells(e,t,e+i-1,t+r-1,!0,!0,!0))}var A=!1;if(isUndefined(n.m)||(A=n.m),t>usedCursCol&&(usedCursCol=t),e>usedCursRow&&(usedCursRow=e),!Merge.isCovered(e,t)){var S=new Cell(e,t);S.executeMethod(function(o){updateCellDataJson(o,n,e,t),A&&FadeCell.elemsarr[s].push(o)})}appEvent.trigger("cell.dataUpdate",[e,t,CURRSHEETNAME,n.isValidContent])}function updateCellDataJson(e,t,n,s){if(e){var o=e.className;if(isUndefined(t[ActionConstants.COMMENT]))Annot.removeAll(n,s,n,s);else{var a=t[ActionConstants.COMMENT];Annot.addComment(e,a,n,s),-1==o.indexOf(" cC")&&(o+=" cC")}var r="";if(isUndefined(t.f))e.removeAttribute("fn");else{var i=t.f.substring(1,t.f.length-1);e.setAttribute("fn",i),r=i}if(e==currCell&&(exprField.value=r),isUndefined(t.v))e.removeAttribute("cV");else{var c=t.v.substring(1,t.v.length-1);appEvent.trigger("cell.setcontent",[e,n,s,totCols,c]),e.setAttribute("cV",c)}if(!isUndefined(t.ev)){var l=t.ev.substring(1,t.ev.length-1);null==t.ev?l="Null":-1!=t.ev.constructor.toString().indexOf("Array")&&(l="["+t.ev+"]");var C=t.l;C||t.hl?C&&t.hl?appEvent.trigger("addlink",[e,l,C]):appEvent.trigger("addlink",[e,l]):isUndefined(t.fab)?(isUndefined(t.v)&&appEvent.trigger("cell.setcontent",[e,n,s,totCols,l]),setCellContent(e,l)):"checkbox"===t.fab&&(checkbox.add(e,l),o=e.className)}if(!checkbox.isPresent(e)&&"checkbox"!==t.fab){e.style.textAlign="";var E=getCSSStyleRegex("textAlign"),o=o.replace(E,""),d=getCSSStyleRegex("utextAlign");d.test(o)||t.ft&&"STRING"!==t.ft&&"0"!==t.ft&&(o+=" tar",addFlexBoxDiv(e,getCellInnerHTML(e)))}o=o.replace(getCSSStyleRegex("nFormat"),""),isUndefined(t.ptc)||"none"===t.ptc||(o+=" nFT"+t.ptc),e.className=o,isUndefined(t.ft)||("0"==t.ft?e.removeAttribute("format"):(e.setAttribute("format",t.ft),"PERCENT"==t.ft&&ActiveCellInfo.resetFormat(ActiveCellInfo._getFormat(e))),"FLOAT"==t.ft&&l&&-1!=l.indexOf(thousandSeparator)||menutabListener.doAction(TOOLBAR.FORMAT,{id:"formatCellsNumber",action:"uncheck",callback:applyStyle_zbutton,args:["formatCellsNumber","uncheck","comma"]}))}}function updateRangeStyleJson(e,t,n,s){isUndefined(n)&&(n=!0);for(var o=e.sr;o<=e.er;o++)if(isRowAvailable(o,e.rs)||ISFREEZED&&FREEZED_ROW>o)for(var a=e.sc;a<=e.ec;a++)updateCellStyle(o,a,e,t,n,s)}function updateCellStyle(e,t,n,s,o,a){isUndefined(s)&&(s=!1),Merge.isCovered(e,t)||new Cell(e,t).executeMethod(updateCellStyleJson,n,e,t,void 0,s,o,a)}function updateCellStyleJson(e,t,n,s,o,a,r,i){if(e){var c=e.className,l=checkbox.isPresent(e)?"cD tac vam":"cD";if(i&&!isUndefined(t.isIconClear)&&($(e).find("[class*='iS-']").remove(),l=l.replace(" iconWrap",""),5==Object.keys(t).length))return;if(l+=(isUndefined(t[ActionConstants.WRAP])||1!=t[ActionConstants.WRAP])&&c.indexOf("nW")>-1?" nW":" W",isUndefined(t[ActionConstants.BOLD])||1!=t[ActionConstants.BOLD]?a&&-1!==c.indexOf("fwb")&&(l+=" fwb"):l+=" fwb",isUndefined(t[ActionConstants.ITALIC])||1!=t[ActionConstants.ITALIC]?a&&-1!==c.indexOf("fsi")&&(l+=" fsi"):l+=" fsi",isUndefined(t[ActionConstants.UNDERLINE])||1!=t[ActionConstants.UNDERLINE]||!isUndefined(t[ActionConstants.STRIKETHROUGH])&&1===t[ActionConstants.STRIKETHROUGH]?a&&-1!==c.indexOf("tdu")&&(l+=" tdu"):l+=" tdu",isUndefined(t[ActionConstants.STRIKETHROUGH])||1!=t[ActionConstants.STRIKETHROUGH]||!isUndefined(t[ActionConstants.UNDERLINE])&&1===t[ActionConstants.UNDERLINE]?a&&-1!==c.indexOf("tdst")&&(l+=" tdst"):l+=" tdst",isUndefined(t[ActionConstants.UNDERLINE])||1!=t[ActionConstants.UNDERLINE]||isUndefined(t[ActionConstants.STRIKETHROUGH])||1!=t[ActionConstants.STRIKETHROUGH]?a&&-1!==c.indexOf("tdsu")&&(l+=" tdsu"):(l=l.replace(" tdst",""),l=l.replace(" tdu",""),l+=" tdsu"),isUndefined(t[ActionConstants.FONTFAMILY]))if(a){if(null!=c){var C=getCSSStyleRegex("fontFamily").exec(c);null!=C&&(l=l+=C[0])}}else e.style.fontFamily="";else if(cssStyle=getMatchedCSSFontStyle(t[ActionConstants.FONTFAMILY]),""==cssStyle)e.style.fontFamily=t[ActionConstants.FONTFAMILY];else if(a){if(null!=c){var C=getCSSStyleRegex("fontFamily").exec(c);null!=C&&(l=l+=C[0])}}else" fnal"!==cssStyle&&(l+=cssStyle),e.style.fontFamily="";if(isUndefined(t[ActionConstants.FONTSIZE]))if(a){if(null!=c){var C=getCSSStyleRegex("fontSize").exec(c);null!=C&&(l=l+=C[0])}}else e.style.fontSize="";else if(cssStyle=getCssFontSize(t[ActionConstants.FONTSIZE]),""==cssStyle){var E=t[ActionConstants.FONTSIZE].replace("pt","");E&&(l=l+" f"+E),e.style.fontSize=t[ActionConstants.FONTSIZE]}else if(a){if(null!=c){var C=getCSSStyleRegex("fontSize").exec(c);null!=C&&(l=l+=C[0])}}else l+=cssStyle,e.style.fontSize="";if(isUndefined(t[ActionConstants.HALIGN])||checkbox.isPresent(e)){if(null!=c){var C=getCSSStyleRegex("utextAlign").exec(c);if(null==C)var C=getCSSStyleRegex("textAlign").exec(c);a?null!=C&&(l=l+=C[0]):null===e.getAttribute("format")||"STRING"===e.getAttribute("format")||checkbox.isPresent(e)||(l+=" tar")}}else{var d="";switch(t[ActionConstants.HALIGN]){case 0:d=" fal";break;case 1:d=" fac";break;case 2:d=" far"}l+=d}if(-1!=c.indexOf(" cC")&&(l+=" cC"),isUndefined(t[ActionConstants.VALIGN])||checkbox.isPresent(e)){if(a&&null!=c){var C=getCSSStyleRegex("verticalAlign").exec(c);null!=C&&(l=l+=C[0])}}else{var d="";switch(t[ActionConstants.VALIGN]){case 0:d="";break;case 1:d=" vam";break;case 2:d=" vab"}l+=d}if(!r&&null!=c){var C=getCSSStyleRegex("borderRight").exec(c);null!=C&&(l=l+=C[0]);var C=getCSSStyleRegex("borderBottom").exec(c);null!=C&&(l=l+=C[0])}if(isUndefined(t[ActionConstants.COLOR]))a||(e.style.backgroundColor="",setBorderValue(n,s,n,s,"remove"));else if("transparent"!=t[ActionConstants.COLOR]){if(e.style.backgroundColor=t[ActionConstants.COLOR],Merge.getCellInfo(n,s)&&!Merge.isCovered(n,s)){var A=Merge.getCellInfo(n,s),S=new Range(A.startRow,A.startCol-1,A.endRow,A.startCol-1),O=S.getIterator();O.iterate(function(e,t){var n=new Cell(e,t);n.executeMethod(function(e){e.style.borderRight||(e.style.borderRight="1px solid transparent")})});var S=new Range(A.startRow-1,A.startCol,A.startRow-1,A.endCol),O=S.getIterator();O.iterate(function(e,t){var n=new Cell(e,t);n.executeMethod(function(e){e.style.borderBottom||(e.style.borderBottom="1px solid transparent")})})}setBorderValue(n,s,n,s,"add"),"rgb(0, 0, 0)"!==e.style.borderBottomColor&&e.style.backgroundColor&&(e.style.borderBottom="1px solid transparent"),"rgb(0, 0, 0)"!=e.style.borderRightColor&&e.style.backgroundColor&&(e.style.borderRight="1px solid transparent")}else e.style.backgroundColor="",setBorderValue(n,s,n,s,"remove");if(-1!==c.indexOf("highlightInvalid")&&(l+=" highlightInvalid"),null!=c){var C=getCSSStyleRegex("nFormat").exec(c);null!=C&&(l=l+=C[0])}if(isUndefined(t.icon_name)||isUndefined(t.icon_id))!i||a||isUndefined(t.isIconClear)||(l=l.replace(" iconWrap",""),$(e).find("[class*='iS-']").remove());else{-1!==e.className.indexOf(" W")&&(l+=" iconWrap");var T=iconsets.createSPAN(t.icon_name,parseInt(t.icon_id),t.dis);$(e).find("[class*='iS-']").remove(),hasFlexBoxDiv(e)?$(e.querySelector(".w100")).prepend(T):e.prepend(T)}var R=isRTL?/( (fa|ta)[rc])(\b)/i:/( (fa|ta)[rc])(\b)/i,g=getCellInnerHTML(e);(R.test(l)||-1!=l.indexOf(" W")||isRTL)&&addFlexBoxDiv(e,g),isUndefined(t[ActionConstants.TEXTCOLOR])?a||(e.style.color=""):i?e.style.setProperty("color",t[ActionConstants.TEXTCOLOR],"important"):e.style.color=t[ActionConstants.TEXTCOLOR],t.hcc?(l+=" hcc",e.style.setProperty("color","transparent","important")):!isUndefined(t[ActionConstants.TEXTCOLOR])||a&&t.hcc||e.style.setProperty("color","",""),e.className=l}}function isOutsideActionRange(e,t,n,s,o,a){return(n>e||e>o)&&(s>t||t>a)}function updateRangeBorderJson(e,t){for(var n=e.sr;n<=e.er;n++)if(isRowAvailable(n,e.rs)||ISFREEZED&&FREEZED_ROW>n)for(var s=e.sc;s<=e.ec;s++)updateCellBorder(n,s,e,t)}function updateCellBorder(e,t,n,s){Merge.isCovered(e,t)||new Cell(e,t).executeMethod(updateCellBorderJson,n,s)}function updateCellBorderJson(e,t,n){if(e){var s,o=e.className,a=o,r=t[ActionConstants.BORDER_RIGHT];if(isUndefined(r)?1==n&&(a=a.replace(getCSSStyleRegex("borderRight"),""),$(e).css("border-right","")):(isRTL&&(e=getCell(ActiveCellInfo.getActiveRow(),ActiveCellInfo.getActiveCol()+1)),s=getBorderStyleName(r,14),""!=s?-1==a.indexOf(s)&&(1==n&&(a=a.replace(getCSSStyleRegex("borderRight"),"")),a+=s):(isRTL&&(e=getCell(getCell(ActiveCellInfo.getActiveRow(),ActiveCellInfo.getActiveCol()))),null!=e&&(e.style.borderRight=r))),isRTL&&(e=getCell(getCell(ActiveCellInfo.getActiveRow(),ActiveCellInfo.getActiveCol()))),isUndefined(t[ActionConstants.BORDER_BOTTOM]))1==n&&(a=a.replace(getCSSStyleRegex("borderBottom"),""),$(e).css("border-bottom",""));else{var i=t[ActionConstants.BORDER_BOTTOM];s=getBorderStyleName(i,17),""!=s?-1==a.indexOf(s)&&(1==n&&(a=a.replace(getCSSStyleRegex("borderBottom"),"")),a+=s):null!=e&&(e.style.borderBottom=i)}o!=a&&(e.className=a)}}function getBorderStyleName(e,t){if("1"==e||"2"==e||"d"==e)switch(t){case 13:return" bl"+e;case 14:return" br"+e;case 16:return" bt"+e;case 17:return" bb"+e}return""}function getCssFontSize(e){var t="";switch(e){case"6pt":t=" f6";break;case"8pt":t=" f8";break;case"9pt":t=" f9";break;case"10pt":t=" f10";break;case"11pt":t=" f11";break;case"12pt":t=" f12";break;case"14pt":t=" f14";break;case"16pt":t=" f16";break;case"18pt":t=" f18";break;case"20pt":t=" f20";break;case"22pt":t=" f22";break;case"24pt":t=" f24";break;case"26pt":t=" f26";break;case"28pt":t=" f28";break;case"32pt":t=" f32";break;case"40pt":t=" f40";break;case"48pt":t=" f48";break;case"56pt":t=" f56";break;case"64pt":t=" f64";break;case"72pt":t=" f72"}return t}function updateRangeFormat(e,t,n,s,o,a,r,i,c){var l,C=e,E=!1,d=FREEZED_ROW>0&&getAvailableStartRow()>=ROWS_PER_TILE&&FREEZED_ROW>=e;if(d&&(l=FREEZED_ROW-1>=n?n:FREEZED_ROW-1),n>=getAvailableStartRow()&&e<=getAvailableEndRow()&&(n=n>getAvailableEndRow()?getAvailableEndRow():n,e=e<getAvailableStartRow()?getAvailableStartRow():e,E=!0),s>getAvailableEndCol()&&(s=getAvailableEndCol()),E||d||c){var A="",S=!1;switch(o){case"backgroundColor":if("transparent"==a||"-1"==a)return E&&removeStyle("backgroundColor",e,t,n,s),void(d&&removeStyle("backgroundColor",C,t,l,s));break;case"color":if("-1"==a||"rgb(0, 0, 0)"==a||"rgb(0,0,0)"==a||"#000000"==a)return E&&removeStyle("color",e,t,n,s),void(d&&removeStyle("color",C,t,l,s));break;case"fontWeight":1==a?A=" fwb":S=!0;break;case"fontStyle":1==a?A=" fsi":S=!0;break;case"textDecoration":1==a?A=" tdu":S=!0;break;case"strikeThrough":1==a?A=" tdst":S=!0;break;case"fontFamily":if(A=getMatchedCSSFontStyle(a),""==A){var O=$("#fontFace");getDDIndex(O,a)}break;case"fontSize":if(A=getCssFontSize(a),""==A){var O=$("#fontSize");getDDIndex(O,a)}break;case"verticalAlign":switch(a){case"top":A=" vat";break;case"middle":A=" vam";break;case"bottom":A=" vab";break;default:A=" vat"}break;case"textAlign":switch(a){case"start":A=" fal";break;case"center":A=" fac";break;case"end":A=" far";break;case"right":A=" tar";break;case"left":A="left"}}var T=getCSSStyleRegex(o);S?(d&&removeStyleValue(C,t,l,s,o,T),E&&removeStyleValue(e,t,n,s,o,T,r)):""!=A?(d&&addCssStyleValue(C,t,l,s,o,A,T),(E||c)&&addCssStyleValue(e,t,n,s,o,A,T,r)):(d&&addStyleValue(C,t,l,s,o,a,T),(E||c)&&addStyleValue(e,t,n,s,o,a,T,r)),i||appEvent.trigger("update.rangeformat",[currCell])}}function removeStyleValue(e,t,n,s,o,a,r){var i=new Range(e,t,n,s),c=i.getIterator(r);c.iterate(function(e,t){new Cell(e,t).executeMethod(removeStyleValueForCell,o,a)})}function removeStyleValueForCell(e,t,n){if(e){if(checkbox.isPresent(e)&&"textAlign"===t)return;isUndefined(n)&&(n=getCSSStyleRegex(t)),e.className=e.className.replace(n,""),e.style[t]="",("fontSize"==t||"fontFamily"==t)&&appEvent.trigger("setlinkstyle",[e]),-1!=e.className.indexOf(" tdsu")&&"strikeThrough"==t&&(e.className=e.className.replace(" tdsu"," tdu")),-1!=e.className.indexOf(" tdsu")&&"textDecoration"==t&&(e.className=e.className.replace(" tdsu"," tdst"))}}function addStyleValue(e,t,n,s,o,a,r,i){var c=new Range(e,t,n,s),l=c.getIterator(i);l.iterate(function(e,t){new Cell(e,t).executeMethod(addStyleValueForCell,o,a,r)}),"backgroundColor"==o&&setBorderValue(e,t,n,s,"add")}function setBorderValue(e,t,n,s,o){if(0!=t)for(var a=e;n>=a;a++){var r=isRTL?getCell(a,s+1):getCell(a,t-1);r&&("add"==o?r.style.borderRightColor||(r.style.borderRight="1px solid transparent"):Merge.isCovered(a,t)||r.style.backgroundColor||"transparent"==r.style.borderRightColor&&(r.style.borderRight=""))}if(0!=e)for(var i=t;s>=i;i++){var r=getCell(e-1,i);r&&("add"==o?r.style.borderBottomColor||(r.style.borderBottom="1px solid transparent"):Merge.isCovered(e,i)||r.style.backgroundColor||("transparent"==r.style.borderBottomColor&&(r.style.borderBottom=""),"transparent"==r.style.borderRightColor&&(r.style.borderRight="")))}}function addStyleValueForCell(e,t,n,s){e&&(isUndefined(s)&&(checkbox.isPresent(e)&&(n="textAlign"===t?" tac":"verticalAlign"===t?" vam":n),s=getCSSStyleRegex(t),e.className=e.className.replace(s,"")),e.style[t]=n,("fontSize"==t||"fontFamily"==t||"color"==t)&&appEvent.trigger("setlinkstyle",[e]),"backgroundColor"==t&&(e.style.borderBottomColor||(e.style.borderBottom="1px solid transparent"),e.style.borderRightColor||(e.style.borderRight="1px solid transparent")))}function addCssStyleValue(e,t,n,s,o,a,r,i){var c=new Range(e,t,n,s),l=c.getIterator(i);l.iterate(function(e,t){new Cell(e,t).executeMethod(addCssStyleValueForCell,o,a,r)})}function addCssStyleValueForCell(e,t,n,s){if(e){var o=e.className;if(-1==o.indexOf(n)){if(checkbox.isPresent(e)&&(n="textAlign"===t?" fac":"verticalAlign"===t?" vam":n),isUndefined(s)||(o=o.replace(s,"")),"textAlign"===t){"left"===n&&(e.style.textAlign="left",n=""),(-1!=o.indexOf(" fal")||-1!=o.indexOf(" fac")||-1!=o.indexOf(" far"))&&(o=o.replace(" fac",""),o=o.replace(" far",""),o=o.replace(" fal",""));var a=e.querySelector("span");if(" fal"!=n||-1!=o.indexOf(" W")){var r=getCellInnerHTML(e);addFlexBoxDiv(e,r)}else if(" fal"==n&&isRTL){var r=getCellInnerHTML(e);addFlexBoxDiv(e,r)}else{var i=e.getAttribute("hyper");"multi"==i||a||removeFlexBoxDiv(e)}}"strikeThrough"==t||"textDecoration"==t?-1!=o.indexOf(" tdu")?o=o.replace(" tdu"," tdsu"):-1!=o.indexOf(" tdst")?o=o.replace(" tdst"," tdsu"):-1==o.indexOf(" tdsu")&&(o+=n):o+=n,""!=t&&(e.style[t]=""),e.className=o,("fontSize"==t||"fontFamily"==t)&&appEvent.trigger("setlinkstyle",[e])}}}function updateChartJson(e,t){switch(e.a){case ActionConstants.CHART_DATACHANGE:if(t)for(var n=0;n<e.id.length;n++)regenerateChart(e.id[n]);break;case ActionConstants.CHART_NEW:var s={CP_DOCUMENTID:e.did,CP_DOCUMENTSHEET_NAME:e.sn,CP_CHART_DBID:e.id};setChartProps(s,e);var o=ExcelGraph.createInstance(s);createChart(o,"REGENERATE");break;case ActionConstants.CHART_REGENERATE:var o=ExcelGraph.getInstance(getChartImgId(e.id));o&&(setChartProps(o,e),createChart(o,"REGENERATE"));break;case ActionConstants.CHART_DELETE:for(var n=0;n<e.id.length;n++){var a=getChartImgId(e.id[n]);sheetObjectsPane.removeChild(getObj(a)),ExcelGraph.removeInstance(a)}break;case ActionConstants.CHART_MOVE:var a=getChartImgId(e.id);""!=a&&("undefined"!=typeof e.x&&OLE[a].setLeft(e.x),"undefined"!=typeof e.y&&OLE[a].setTop(e.y));break;default:var r=e.SUBMODE;t||drawChart(e,r,void 0,!0)}}function setChartProps(e,t){isUndefined(t.r)||(e.CP_DATARANGE=t.r),isUndefined(t.d)||(e.CP_DATAIN=t.d),isUndefined(t.h)||(""!=getChartImgId(t.id)&&OLE[getChartImgId(t.id)].setHeight(t.h),e.CP_HEIGHT=t.h),isUndefined(t.w)||(""!=getChartImgId(t.id)&&OLE[getChartImgId(t.id)].setWidth(t.w),e.CP_WIDTH=t.w),isUndefined(t.t)||(e.CP_GRAPHTYPE=t.t),isUndefined(t.hl)||(e.CP_SHOW_LEGEND=t.hl),isUndefined(t.tl)||(e.CP_CHART_TITLE=t.tl),isUndefined(t.lf)||(e.CP_LABEL_FORMAT=t.lf),isUndefined(t.o)||(e.CP_PLOT_ORIENTATION=t.o),isUndefined(t.x)||(""!=getChartImgId(t.id)&&OLE[getChartImgId(t.id)].setLeft(t.x),e.CP_LEFT=t.x),isUndefined(t.y)||(""!=getChartImgId(t.id)&&OLE[getChartImgId(t.id)].setTop(t.y),e.CP_TOP=t.y),isUndefined(t.xt)||(e.CP_CHART_X_LABEL=t.xt),isUndefined(t.yt)||(e.CP_CHART_Y_LABEL=t.yt)}function updateWorkbookActionJson(e){switch(e.a){case ActionConstants.SAVE_WORKBOOK:isSaveButtonEnabled=!1,READ_WRITE&&btn_disabled(),ISMACROEDITOROPEN&&macroBtn_disabled();break;case ActionConstants.NEW_WORKBOOK:SAVED=!0,MACROSAVED=!0;var t=e.i;loadDocument(t)}}function updateSheetChangesInEditor(e){var t=getObj("sheetobject");if(t||ISMINDLG)switch(e.a){case ActionConstants.SHEET_INSERT:case ActionConstants.SHEET_COPY:if(ISMINDLG&&!ISMACROEDITOROPEN)return void updateSheetOperations(e);var n=document.createElement("TD"),s=document.createElement("TD"),o=document.createElement("TD"),a=document.createElement("TR");a.id="tr_"+e.cn,o.innerHTML='<img src="../images/spacer.gif" class="mainBgImg scriptExplrSheet"/>&nbsp;',o.innerHTML+="<a href=\"javascript:loadMacro('"+e.cn+"','1')\">"+e.cn+"("+e.sn+")</a>",s.innerHTML="<img class='mainBgImg scriptExplrTreeBottomEnd' src='../images/spacer.gif'>",a.appendChild(n),a.appendChild(s),a.appendChild(o);var r=t.getElementsByTagName("tr")[t.rows.length-custommdlcnt-2];if(r.cells[1].getElementsByTagName("IMG")[0].className="mainBgImg scriptExplrTree",t.getElementsByTagName("TBODY")[0].insertBefore(a,t.getElementsByTagName("tr")[t.rows.length-custommdlcnt-1]),e.a==ActionConstants.SHEET_INSERT)newmodule={id:e.cn,text:"REM Sheet Module",syntax:"vb"},module_content.push("REM Sheet Module");else{var i;if(ISMACROEDITOROPEN)i=editAreaLoader.getFile("macrotextid",e.oscn).text;else{var c=getModuleIndex(e.oscn);null!=c&&(i=module_content[c])}mdlnames.push(e.cn),module_content.push(i),newmodule={id:e.sn,text:i,syntax:"vb"}}editAreaLoader.openFile("macrotextid",newmodule);break;case ActionConstants.SHEET_REMOVE:if(ISMINDLG&&!ISMACROEDITOROPEN)return void updateSheetOperations(e);ISMACROEDITOROPEN&&editAreaLoader.closeFile("macrotextid",e.cn),e.c==currentMdl.CURRENT&&(currentMdl={});var l=getObj("tr_"+e.cn);if(l){"mainBgImg scriptExplrTreeBottomEnd"==l.cells[1].firstChild.className&&(l.parentNode.rows[l.parentNode.rows.length-custommdlcnt-3].cells[1].firstChild.className="mainBgImg scriptExplrTreeBottomEnd"),l.parentNode.removeChild(l);var c=0,C=mdlnames,E=module_content;mdlnames=[],module_content=[];var d=0;for(c=0;c<C.length;c++)C[c]!=e.cn&&(mdlnames[d]=C[c],module_content[d]=E[c],d++)}break;case ActionConstants.SHEET_RENAME:if(ISMINDLG&&!ISMACROEDITOROPEN)return void updateSheetOperations(e);var A=getObj("tr_"+e.cn);if(null!=A){var o=A.cells[A.cells.length-1];o.innerHTML='<img src="../images/spacer.gif" class="mainBgImg scriptExplrSheet"/>&nbsp;',o.innerHTML+="<a href=\"javascript:loadMacro('"+e.cn+"','1')\">"+e.cn+"("+e.sn+")</a>"}}if(t=getObj("modulsttable")){var S,c=0,O=t.rows.length;if(e.a==ActionConstants.SHEET_COPY){var T,R,g,N=O;for(c=0;O>c;c++)if(S=t.rows[c].id,0==S.indexOf(e.oscn+".")){R=t.insertRow(t.rows.length),R.className=N%2==0?"trEven":"trOdd",R.id=S.replace(e.oscn+".",e.cn+".");var f;for(f=0;f<t.rows[c].cells.length;f++)g=document.createElement("TD"),T=replace(t.rows[c].cells[f].innerHTML,e.oscn+".",e.cn+"."),T=replace(T,"'"+e.oscn+"'","'"+e.cn+"'"),g.innerHTML=T,R.appendChild(g);N+=1}}else if(e.a==ActionConstants.SHEET_REMOVE)for(c=0;c<t.rows.length;c++)S=t.rows[c].id,0==S.indexOf(e.cn+".")&&(t.rows[c].parentNode.removeChild(t.rows[c]),c-=1)}}function handleMacroErrorAndMsg(e,t,n){if(null!=e&&0!=e.e||null!=t&&0!=t.length){var s;if(null!=t&&0!=t.length){clearMessage(),s="[";for(var o=t.length,a=0;o>a;a++)"undefined"!=typeof t[a].M&&(!ISMINDLG&&ISMACROEDITOROPEN?insertMessage(t[a]):(s+='{"M":"'+encodeURIComponent(t[a].M)+'",',s+='"L":"'+t[a].L+'",',s+='"MT":"'+t[a].MT+'",',s+='"MN":"'+t[a].MN+'"},'));s+="]"}if(!ISMINDLG&&ISMACROEDITOROPEN)null!=t&&0!=t.length&&enableMessage(),"undefined"==typeof n&&(n=!1),null!=e&&1==e.e?(e.ISERROR=e.e,e.MESSAGE=e.m,e.LINE=e.l,e.COLUMN=e.c,insertError(e),"undefined"!=typeof e.mn&&"unknown"!=e.mn&&loadMacro(e.mn,e.mt,""+e.l),enableError(),n&&""==MacroPanelState.tabs||showMacroError()):null!=t&&0!=t.length&&(n&&""==MacroPanelState.tabs||showMessage());else{var r=new RequestParameters(ActionConstants.JSP_MACROERROR);r.setParameters(s),null!=e&&1==e.e&&r.setParameters(s,e.m,e.mn,e.l,e.mt);var i=new AjaxRequest;i.init("POST",r.getURL(),!0,r.getParametersAsString()),i.addEventListener("onComplete",function(e){var n=jsMsg.Error;null!=t&&(n=jsMsg.MessageBox);var s={width:450,title:n};sheetdialog.open(e.responseText,s)}),i.sendRequest()}}}function mergeAndCenter(e,t,n,s){mergeRange(e,t,n,s),updateRangeFormat(e,t,e,t,"textAlign","center")}function mergeRange(e,t,n,s,o){o||(Merge.remove(e,t,n,s),Merge.add(e,t,n,s))}function mergeAcross(e,t,n,s,o){var a=getAvailableStartRow(),r=getAvailableEndRow(),i=a>e?a:e,c=n>r?r:n;o&&(n=usedCursRow);for(var l=i;c>=l;l++)Merge.remove(l,t,l,s),Merge.add(l,t,l,s)}function mergeDown(e,t,n,s){for(var o=getAvailableStartRow(),a=getAvailableEndRow(),r=o>e?o:e,i=n>a?a:n,c=t;s>=c;c++)Merge.remove(r,c,i,c),Merge.add(r,c,i,c)}function updateWorkbookLevelAction(e,t,n){var s=e[JSONConstants.ACTION];switch(s){case ActionConstants.SHEET_INSERT:insertNewSheetInClient(e,t,n),appEvent.trigger("DiscussionSheets",["SHEET_INSERT",e]);break;case ActionConstants.SHEET_DUPLICATE:case ActionConstants.SHEET_COPY:if(isSheetBasedShare)return;e.SHEETNAMES&&WorkSheets.updateSheetNamesList(e.SHEETNAMES);var o=e.sn,a=e.pos+1,r=document.createElement("TD");r.setAttribute("sheetname",o),r.setAttribute("context","sheettabrmenu"),r.id="sheetdiv-"+WorkSheets.getSheetCodeFromName(o),r.title=o;var i="",c=e.stbc;r.innerHTML="<div class='tabItem'><div id='sheetnames_"+a+"'>"+i+o+"</div></div>",r.onmousedown=function(e){return reorderSheet(e,this)};var l=getObj("sheetdiv-"+WorkSheets.getAssociatedActiveSheetName());if(l){var C=l.parentNode;if(a==parseInt(TOTALSHEETS)+1)C.insertBefore(r,getObj("dummySheetTab"));else{var E=getObj("sheetsTab").getElementsByTagName("TD");C.insertBefore(r,E[a-1])}toggleSheetsTabNavBar(),TOTALSHEETS=parseInt(TOTALSHEETS)+1,IS_UNSAVED_SHEET=!0,e.SHEETNAMES&&WorkSheets.updateSheetNamesList(e.SHEETNAMES),sheetTabBgColor.updateSheetTabColors({SHEETNAME:o,TYPE:"BACKGROUND",COLOR:c}),t&&(!ISMACROEDITOROPEN||ISMACROEDITOROPEN&&ISMINDLG)&&showsheet(r,"new"),workbookData.copySheet=!0,workbookData.copiedSheet=CURRSHEETNAME}null==workbooksheets?focusRemembering.constructClientJson():focusRemembering.addSheetInJson(o,TOTALSHEETS),updateSheetChangesInEditor(e),t&&documentBakeStatus.setRenderBake(!0);var d=e[JSONConstants.PIVOT_DETAILS];if(d)for(var A=0;A<d.length;A++)PivotUtil.createPivotObject(d[A]);unMaskSheet(),appEvent.trigger("DiscussionSheets",["SHEET_COPY",e]);break;case ActionConstants.SHEET_REMOVE:pivot.Collection.deleteSheetOperation(e[JSONConstants.ASSOCIATED_SHEET_NAME]);var o=e.sn;ProtectedRanges.getObject().onSheetDelete(o),chartOnLoad.removeSheetCharts(e.asn),chartOnLoad.removeSheetAffectCharts(e.asn);var S=WorkSheets.getSheetCodeFromName(o),l=getObj("sheetdiv-"+S);if(appEvent.trigger("sheet.removed",[o,S]),e.SHEETNAMES&&WorkSheets.updateSheetNamesList(e.SHEETNAMES),l){null==workbooksheets?(workbooksheets=focusRemembering.constructClientJson(),focusRemembering.deleteSheetInJson(o)):(focusRemembering.deleteSheetInJson(o),workbookData.preActiveRow=0,workbookData.preActiveCol=0,workbookData.posBtm=0,workbookData.posLft=0);var C=l.parentNode;C.removeChild(l),TOTALSHEETS=parseInt(TOTALSHEETS)-1,toggleSheetsTabNavBar(),removeSheets(o),CURRSHEETNAME==o&&showsheet(getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(e.os)),"open"),updateSheetChangesInEditor(e)}FormObj.instances[S]&&WebForm.resetFormInfo(),sheetTabBgColor.removeFromCache(S),t&&documentBakeStatus.setRenderBake(!0),unMaskSheet(),Discussion.shRemove(o),appEvent.trigger("DiscussionSheets",["SHEET_REMOVE",e]);break;case ActionConstants.SHEET_RENAME:appEvent.trigger("sheet.onnamechanged",[e.sn,e.osn]);var O=e.asn,T=WorkSheets.getSheetNameFromCode(O);T||(T=e.osn),e.SHEETNAMES&&WorkSheets.updateSheetNamesList(e.SHEETNAMES);var R=e.sn,l=getObj("sheetdiv-"+O);if(l){var C=l.parentNode,i="";FormObj.instances[O]&&(i="<img src='"+IMAGE_PATH+"spacer.gif'class='formIcon'/>");var g=$(l).children(".tabItem").children()[0];$(g).html(i+R),T==CURRSHEETNAME&&(CURRSHEETNAME=R,WorkSheets.updateAscActiveSheetName(),cellPrevState&&(cellPrevState.sourceSheet=CURRSHEETNAME)),l.setAttribute("sheetname",R),l.id="sheetdiv-"+O,l.title=R,toggleSheetsTabNavBar(),renameSheets(T,R);var c=e.stbc,N=WorkSheets.getSheetObjByName(R);R==CURRSHEETNAME?(N.css("backgroundColor",c),sheetTabBgColor.updateSheetTabColors({SHEETNAME:R,TYPE:"BORDER"})):(N.css("borderBottomColor",c),sheetTabBgColor.updateSheetTabColors({SHEETNAME:R,TYPE:"BACKGROUND"})),null==workbooksheets?(workbooksheets=focusRemembering.constructClientJson(),focusRemembering.renameSheetInJson(T,R)):focusRemembering.renameSheetInJson(T,R),ProtectedRanges.getObject().onSheetRename(T,R)}Discussion.shRename(R,T),updateSheetChangesInEditor(e),appEvent.trigger("DiscussionSheets",["SHEET_RENAME",e]);break;case ActionConstants.SHEET_MOVE:var o=e.sn,a=e.pos+1;e.SHEETNAMES&&WorkSheets.updateSheetNamesList(e.SHEETNAMES);var l=getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(o));if(l){var C=l.parentNode;if(C.removeChild(l),a==parseInt(TOTALSHEETS)+1)C.insertBefore(l,getObj("dummySheetTab"));else{var E=getObj("sheetsTab").getElementsByTagName("TD");C.insertBefore(l,E[a-1])}toggleSheetsTabNavBar()}break;case ActionConstants.SHEET_ACTIVATE:var l=getObj("sheetdiv-"+WorkSheets.getSheetCodeFromName(e.sn));l&&showsheet(l,"open","false",!0);break;case ActionConstants.NAMEDRANGE_ADD:appEvent.trigger("namedrangechanged",[ActionConstants.NAMEDRANGE_ADD,e]);break;case ActionConstants.NAMEDRANGE_MODIFY:appEvent.trigger("namedrangechanged",[ActionConstants.NAMEDRANGE_MODIFY,e]);break;case ActionConstants.NAMEDRANGE_DELETE:appEvent.trigger("namedrangechanged",[ActionConstants.NAMEDRANGE_DELETE,e]);break;case ActionConstants.IMAGE_DELETE:t||appEvent.trigger("removeImageFromClient",[e.IMAGE_ID]);break;case ActionConstants.CHART_DELETE:if(LOGINNAME==e.un){var f=getChartImgId(e.id),v=getObj(f);v&&(ole.remove(f,!1),ole.conf.onblur())}break;case ActionConstants.DOCUMENT_SETTING:isRTL!=JSON.parse(e.sheetDirection)&&showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(CURRSHEETNAME),"open",void 0,void 0,!0),chartOnLoad.setLocaleOptions(46===e.decimalSeparator?".":",",e.thousandSeparator),appEvent.trigger("updateServerResponse",[e]),functionDescription=void 0,reloadPage();break;case ActionConstants.FORM_CREATE:if(isSheetBasedShare)return;var u=e.webform;if(t&&u&&!u[JSONConstants.IS_SUCCESS])return void showAlertDialog(jsMsg["Form.NetworkProblemMessageWhileCreating"]);var I="<img src='"+IMAGE_PATH+"spacer.gif'class='formIcon'/>",o=e.sn,a=e.pos+1,p=WorkSheets.getNewSheetId(),r=document.createElement("TD");r.setAttribute("sheetname",o),r.setAttribute("context","sheettabrmenu"),r.title=o,r.innerHTML="<div class='tabItem'><div id='"+p+"'>"+I+o+"</div></div>",r.onmousedown=function(e){return reorderSheet(e,this)};var l=getObj("sheetdiv-"+WorkSheets.getAssociatedActiveSheetName());if(l){WorkSheets.updateSheetNamesList(e.SHEETNAMES),r.id="sheetdiv-"+WorkSheets.getSheetCodeFromName(o);var C=l.parentNode;if(a==parseInt(TOTALSHEETS)+1)C.insertBefore(r,getObj("dummySheetTab"));else{var E=getObj("sheetsTab").getElementsByTagName("TD");C.insertBefore(r,E[a-1])}if(toggleSheetsTabNavBar(),TOTALSHEETS=parseInt(TOTALSHEETS)+1,IS_UNSAVED_SHEET=!0,t){WebForm.formRid=u.form_rid;var _=u[JSONConstants.FORM_URLS];WebForm.formEditUrl=_.formEditURL,WebForm.liveFormUrl=_.liveFormUrl,WebForm.isFormAvailable=!0,window.open(WebForm.formEditUrl,"_blank"),WebForm.updateFormMenuTab(),WebForm.formCreateInfo()}WebForm.formVersionId=u.frmversionid,WebForm.isFormAvailable=!0,t&&!n&&(!ISMACROEDITOROPEN||ISMACROEDITOROPEN&&ISMINDLG)&&showsheet(r,"new"),null==workbooksheets?focusRemembering.constructClientJson():focusRemembering.addSheetInJson(o,TOTALSHEETS)}updateSheetChangesInEditor(e),t&&documentBakeStatus.setRenderBake(!0);break;case ActionConstants.FORM_DELETE:var h=e.isFormDeleted;h&&WebForm.resetFormInfo(t);break;case ActionConstants.SHEET_TABCOLOR:var m=e.sn,c=e.stbc,L={};L[m]=c,sheetTabBgColor.responseHandler(JSON.stringify(L));break;case ActionConstants.SAVE_RTL_SHEET:prevSheetStyle!=isRTL&&(showsheet("sheetdiv-"+e.asn,"open",void 0,void 0,!0),prevSheetStyle=isRTL);break;case ActionConstants.LOCK_SHEET:case ActionConstants.UNLOCK_SHEET:ProtectedRanges.getObject().updateResponse(e),protectionDialog.handleDeletionInManage(e);break;case ActionConstants.CHANGE_PIVOT_SOURCE:P=pivot.Collection.get(e[JSONConstants.ID]),PivotUtil.clearPivotDestination(P),P.set(JSONConstants.ASSOCIATED_SOURCE_SHEET_NAME,e[JSONConstants.ASSOCIATED_SOURCE_SHEET_NAME]),P.set(JSONConstants.SOURCE_START_ROW,e[JSONConstants.SOURCE_START_ROW]),P.set(JSONConstants.SOURCE_START_COLUMN,e[JSONConstants.SOURCE_START_COLUMN]),P.set(JSONConstants.SOURCE_END_ROW,e[JSONConstants.SOURCE_END_ROW]),P.set(JSONConstants.SOURCE_END_COLUMN,e[JSONConstants.SOURCE_END_COLUMN]),P.set(JSONConstants.END_ROW,e[JSONConstants.END_ROW]),P.set(JSONConstants.END_COLUMN,e[JSONConstants.END_COLUMN]);var b=e[JSONConstants.ALL_FIELDS];b&&P.set(JSONConstants.ALL_FIELDS,b),t&&PivotUtil.goToDestination(e[JSONConstants.ID]);break;case ActionConstants.CHANGE_PIVOT_THEME:P=pivot.Collection.get(e[JSONConstants.ID]);var D=e[JSONConstants.PIVOTTEMPLATE_ID]+"tc"+e[JSONConstants.PIVOTTEMPLATE_COLOR];P.set(JSONConstants.PIVOTTEMPLATE_ID,D);break;case ActionConstants.MOVE_PIVOT:P=pivot.Collection.get(e[JSONConstants.ID]),P.set(JSONConstants.START_ROW,e[JSONConstants.START_ROW]),P.set(JSONConstants.START_COLUMN,e[JSONConstants.START_COLUMN]),P.set(JSONConstants.END_ROW,e[JSONConstants.END_ROW]),P.set(JSONConstants.END_COLUMN,e[JSONConstants.END_COLUMN]),P.set(JSONConstants.ASSOCIATED_SHEET_NAME,e[JSONConstants.ASSOCIATED_SHEET_NAME]),P.set(JSONConstants.PIVOT_BUTTONS,e[JSONConstants.PIVOT_BUTTONS]);case ActionConstants.CREATE_PIVOT:case ActionConstants.EDIT_PIVOT:if(e[ActionConstants.SHEET_INSERT]&&(insertNewSheetInClient(e[ActionConstants.SHEET_INSERT],t,n),delete e[ActionConstants.SHEET_INSERT]),s===ActionConstants.MOVE_PIVOT&&PivotUtil.reconstructFilterIcon(P),t&&(isCellEdited()||(WorkSheets.getAssociatedActiveSheetName()==e[JSONConstants.ASSOCIATED_SHEET_NAME]?focusCell(e[JSONConstants.START_ROW],e[JSONConstants.START_COLUMN]):Goto.doGoto(WorkSheets.getSheetNameFromCode(e[JSONConstants.ASSOCIATED_SHEET_NAME]),e[JSONConstants.START_ROW],e[JSONConstants.START_ROW],e[JSONConstants.START_COLUMN],e[JSONConstants.START_COLUMN],!1)),e[JSONConstants.END_COLUMN]>=totCols)){var M=e[JSONConstants.END_COLUMN]-totCols+1;insertCol("append",totCols,M,!0,!0,!0,void 0,void 0,void 0,void 0,!0)}if(s===ActionConstants.CREATE_PIVOT){if(t){var U=pivot.Collection.get("temp");U&&!e.old_aid&&(e[JSONConstants.ALL_FIELDS]=JSON.parse(JSON.stringify(U.get(JSONConstants.ALL_FIELDS))),pivot.Collection.remove("temp"),pivotId=e[JSONConstants.ID]),PivotUtil.changeCreatePivotBt(!0,!0)}PivotUtil.createPivotObject(e)}s===ActionConstants.EDIT_PIVOT&&(U=pivot.Collection.get(e[JSONConstants.ID]),e[JSONConstants.ALL_FIELDS]=U.get(JSONConstants.ALL_FIELDS),e[JSONConstants.PIVOTTEMPLATE_ID]=U.get(JSONConstants.PIVOTTEMPLATE_ID),e[JSONConstants.SUBTOTALOPTION]=U.get(JSONConstants.SUBTOTALOPTION),e[JSONConstants.ROWGRANDTOTALOPTION]=U.get(JSONConstants.ROWGRANDTOTALOPTION),e[JSONConstants.COLGRANDTOTALOPTION]=U.get(JSONConstants.COLGRANDTOTALOPTION),t&&PivotUtil.changeCreatePivotBt(!0,!0),PivotUtil.deletePivotInClient(e[JSONConstants.ID]),PivotUtil.createPivotObject(e)),s===ActionConstants.MOVE_PIVOT&&PivotUtil.clearPivotDestination(P?P:pivot.Collection.get(e[JSONConstants.ID])),PivotUtil.hideAndDisplayPivotTab(!0),PivotUtil.updateVerticalScroll(e[JSONConstants.END_ROW]);break;case ActionConstants.APPLYFILTER_PIVOT:PivotUtil.changeFilterIcon(e[JSONConstants.ID],e[JSONConstants.HEADER_INDEX],e[JSONConstants.PIVOT_FIELD_TYPE],e[JSONConstants.SELECT_ALL]);case ActionConstants.REFRESH_PIVOT:var P=pivot.Collection.get(e[JSONConstants.ID]);PivotUtil.clearPivotDestination(P),PivotUtil.resetPivotProps(P,e[JSONConstants.PIVOT_DETAILS]),PivotUtil.hideAndDisplayPivotTab(!0),PivotUtil.reconstructFilterIcon(P);break;case ActionConstants.SORT_PIVOT:PivotUtil.changeSortIcon(e),P=pivot.Collection.get(e[JSONConstants.ID]),PivotUtil.clearPivotDestination(P),PivotUtil.resetPivotProps(P,e[JSONConstants.PIVOT_DETAILS]),PivotUtil.reconstructFilterIcon(P);break;case ActionConstants.REFRESH_ALL_PIVOT:if(d=e[JSONConstants.PIVOT_DETAILS])for(var A=0;A<d.length;A++){var k=d[A];P=pivot.Collection.get(k[JSONConstants.ID]),P.set(JSONConstants.END_ROW,k[JSONConstants.END_ROW]),P.set(JSONConstants.END_COLUMN,k[JSONConstants.END_COLUMN])}break;case ActionConstants.CHANGE_PIVOT_SUBTOTALOPTION:P=pivot.Collection.get(e[JSONConstants.ID]),PivotUtil.clearPivotDestination(P),P.set(JSONConstants.SUBTOTALOPTION,e[JSONConstants.SUBTOTALOPTION]),P.set(JSONConstants.END_ROW,e[JSONConstants.END_ROW]),P.set(JSONConstants.END_COLUMN,e[JSONConstants.END_COLUMN]);break;case ActionConstants.CHANGE_PIVOT_GRANDTOTALROWOPTION:P=pivot.Collection.get(e[JSONConstants.ID]),PivotUtil.clearPivotDestination(P),P.set(JSONConstants.ROWGRANDTOTALOPTION,e[JSONConstants.ROWGRANDTOTALOPTION]),P.set(JSONConstants.END_ROW,e[JSONConstants.END_ROW]),P.set(JSONConstants.END_COLUMN,e[JSONConstants.END_COLUMN]);break;case ActionConstants.CHANGE_PIVOT_GRANDTOTALCOLOPTION:P=pivot.Collection.get(e[JSONConstants.ID]),PivotUtil.clearPivotDestination(P),P.set(JSONConstants.COLGRANDTOTALOPTION,e[JSONConstants.COLGRANDTOTALOPTION]),P.set(JSONConstants.END_ROW,e[JSONConstants.END_ROW]),P.set(JSONConstants.END_COLUMN,e[JSONConstants.END_COLUMN])}var l=e;appEvent.trigger("server.response.workbookLevelAction",[l])}function insertNewSheetInClient(e,t,n){if(!isSheetBasedShare){var s=e.sn,o=e.pos+1,a=WorkSheets.getNewSheetId(),r=document.createElement("TD");r.setAttribute("sheetname",s),r.setAttribute("context","sheettabrmenu"),r.title=s,r.innerHTML="<div class='tabItem'><div id='"+a+"'>"+s+"</div></div>",r.onmousedown=function(e){return reorderSheet(e,this)};var i=getObj("sheetdiv-"+WorkSheets.getAssociatedActiveSheetName());if(i){WorkSheets.updateSheetNamesList(e.SHEETNAMES),r.id="sheetdiv-"+WorkSheets.getSheetCodeFromName(s);var c=i.parentNode;if(o==parseInt(TOTALSHEETS)+1)c.insertBefore(r,getObj("dummySheetTab"));else{var l=getObj("sheetsTab").getElementsByTagName("TD");c.insertBefore(r,l[o-1])}toggleSheetsTabNavBar(),TOTALSHEETS=parseInt(TOTALSHEETS)+1,IS_UNSAVED_SHEET=!0,t&&!n&&(!ISMACROEDITOROPEN||ISMACROEDITOROPEN&&ISMINDLG)&&showsheet(r,"new"),null==workbooksheets?focusRemembering.constructClientJson():focusRemembering.addSheetInJson(s,TOTALSHEETS)}if(updateSheetChangesInEditor(e),t){documentBakeStatus.setRenderBake(!0);var C=e[JSONConstants.IS_PIVOT_SHEET];if(C){var E=pivot.Collection.get("temp");E&&!PivotUtil.isPivotBuilderOpen()?(E.set(JSONConstants.ASSOCIATED_SHEET_NAME,WorkSheets.getAssociatedActiveSheetName()),PivotUtil.openBuilder(!0)):pivot.fua&&setTimeout(function(){PivotUtil.sendFollowUpAction(s)},500)}}}}
var Hyperlink=function(e){var t="Web",l=!1,n=!1,a=!1,r=!1,s="",o="",d=!0,g=function(){var e=getCellRange();if(!ProtectedRanges.isRangeLocked(e.startRow,e.startCol,e.endRow,e.endCol)){var t=currCellValue?currCellValue:"";s=t,l=t.trim()?!0:!1;var n={width:474,title:jsMsg.Hyperlink,sheetswitch:!0,close:function(){c()},buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){k()}},{text:jsMsg.Cancel,click:function(){c()}}]},i={init:function(){if(f(),h(),u(),$("#InternalUrl").focus(function(){var e=this;RangeSelector.on({el:e,isAbsoluteRef:d,appendSheetName:!0,allowSheetSwitch:!0,callback:function(){$("#InternalUrl").is(":visible")&&I(e)}})}),RTLlang)for(var e=$(".hyperlinkHeader").children(),t=0;t<e.length;t++)$(e[t]).css("display","inline-block")},destroy:function(){RangeSelector.off()}};sheetdialog.open("hyperlinkdialog",n,i)}},c=function(){r=!1,o=".A1",sheetdialog.close(),resetCellRangeFill("linkDialog"),clearCellRangeFill()},f=function(){var t=CellUtils.getRequiredSheetNames().sheetNames,l="";for(i=0;i<t.length;i++)l+=t[i]==CURRSHEETNAME?"<option value='"+t[i]+"' selected >"+t[i]+"</option>":"<option value='"+t[i]+"' >"+t[i]+"</option>";e("#SheetNames").append(l);var n=CellUtils.getRequiredRangeNames().rangeNames;if(0!=n.length){for(e("#rangeList").append("<select id = 'RangeNames' multiple='multiple' size='5' class='textArea' style='padding:3px 0px 3px 1px;width:100%;*width:90%;'></select>"),l="",i=0;i<n.length;i++)l+="<option value='"+n[i]+"'>"+n[i]+"</option>";e("#RangeNames").append(l)}else{var a="<div style='height:80px; padding:3px 0 3px 1px; text-align:center;' class='textArea'> 0 "+jsMsg.NamesDefined+"</div>";a+="<select id = 'RangeNames' style='display:none;'><option></option></select>",e("#rangeList").append(a)}},h=function(){var l,i="",r="http://",s="mailto:";getHyperLinkInCell(currCell).childTag&&(l=getHyperLinkInCell(currCell).childTag.href,l||(l=getHyperLinkInCell(currCell).childTag.title)),l&&(0==l.indexOf("#")?(i=l.substring(1,l.length),i.indexOf("'")>-1&&(i=i.replace(/\'/g,"")),t="Internal"):0==l.indexOf("mailto")?(s=l,t="Email"):(r=l,t="Web")),"Internal"==t&&a&&(p(),n&&(b("rangeNameTab"),e("#RangeNames").val(i))),e("#WebUrl").val(r),e("#InternalUrl").val(CellUtils.addApostrophe(i)),e("#EmailUrl").val(s),m(t),positionDialog()},u=function(){e("#hyperlinkDialog :input").bind("keydown",function(e){var t=e.which;return 13==t?void k():void 0}),e("#showHideArrow").bind("click",function(){p()}),e("#Web, #Internal, #Email").bind("click",function(){m(this.id)}),e("#WebUrl, #InternalUrl, #EmailUrl").bind("keyup",function(e){C(e,this)}),e("#WebText, #InternalText, #EmailText").bind("keyup",function(e){v(e,this)}),e("#sheetNameTab, #rangeNameTab").bind("click",function(){b(this.id)}),e("#SheetNames, #RangeNames").bind("change",function(){N(this)})},C=function(e,l){"Internal"==t?I(l):S(l.value)},v=function(e,t){var l=e.which;return 13==l?void k():(w(t.value),void(s=t.value))},m=function(n){RangeSelector.off();var a=["Web","Internal","Email"];for(e("#"+n).attr("checked",!0),e("#"+n.toLowerCase()+"Link").show(),i=0;i<a.length;i++)n!=a[i]&&e("#"+a[i].toLowerCase()+"Link").hide();t=n,"Internal"==t?(""==e("#InternalUrl").val()&&R(),r=!0):(clearCellRangeFill(),r=!1),l&&S(),setTimeout(function(){var e=getObj(t+"Url");e&&setCaretPos(e,"END")},100)},p=function(){var t=e("#showHideArrow").attr("class");e("#tabView").toggle(),"hyperlinkDownArrow"==t?(e("#showHideArrow").removeClass().addClass("hyperlinkUpArrow"),a=!0):(e("#showHideArrow").removeClass().addClass("hyperlinkDownArrow"),a=!1)},b=function(t){"sheetNameTab"==t?(e("#sheetList").show(),e("#rangeList").hide(),e("sheetNameTab").hasClass("selected")||(e("#sheetNameTab").addClass("selected"),e("#rangeNameTab").removeClass("selected")),I(e("#InternalUrl")),""!=e("#SheetNames").val()&&N(e("#SheetNames"),"sheet"),n=!1):(e("#rangeList").show(),e("#sheetList").hide(),e("rangeNameTab").hasClass("selected")||(e("#rangeNameTab").addClass("selected"),e("#sheetNameTab").removeClass("selected")),""!=e("#RangeNames").val()&&N(e("#RangeNames"),"range"),n=!0),setCaretPos(getObj("InternalUrl"),"END"),r=!0},R=function(t){if(t){var l=getObj("InternalUrl");l.value=CellUtils.addApostrophe("$"+CURRSHEETNAME+"."+t),I(l);try{setCaretPos(l,"END")}catch(e){}}else{var n=jsGADGET_VIEW?"Sheet1":e("#SheetNames").val();if(isCellRange()){if(!rangeFill){var i=getCellRange(),a=i.startRow,r=i.startCol,s=i.endRow,g=i.endCol;o="."+CellUtils.constructCellName(a,r,s,g,d),e("#InternalUrl").val(CellUtils.addApostrophe("$"+n+o))}}else o="."+CellUtils.constructCellName(currRow,currCol,void 0,void 0,d),e("#InternalUrl").val(CellUtils.addApostrophe("$"+n+o))}},x=function(e){var t=e.getAttribute("ilink");t&&Goto.gotoCellInit(t)},N=function(t){var l,n,i,a=t.value,r=t.id,s=0;if("RangeNames"==r&&0!=NamedRange.getNamedRangesList().length){var d=NamedRange.getRange(a),g=d.sheetName;l=d.startRow,n=d.startCol,i=d.endRow,s=d.endCol,O(!1,g,l,n,i,s)||clearCellRangeFill(),getObj("SheetNames").selectedIndex>-1&&(getObj("SheetNames").selectedIndex=-1)}else if("SheetNames"==r){var c=e("#InternalUrl").val();""!=c&&c.indexOf(".")>0&&(o=c.substring(c.indexOf("."),c.length)),O(!0,a)||clearCellRangeFill(),getObj("RangeNames").selectedIndex>-1&&(getObj("RangeNames").selectedIndex=-1),a+=o}e("#InternalUrl").val(a),S(a)},O=function(e,t,l,n,i,a){if(e&&""!=o){a=0;-1!=o.indexOf(":")?(lbl1=o.substring(1,o.indexOf(":")),lbl2=o.substring(o.indexOf(":")+1,o.length),CellUtils.isCellLabel(lbl1)&&(ref1Obj=CellUtils.getCellPosByLabel(lbl1),l=ref1Obj.row,n=ref1Obj.col,CellUtils.isCellLabel(lbl2)?(ref2Obj=CellUtils.getCellPosByLabel(lbl2),i=ref2Obj.row,a=ref2Obj.col):(i=ref1Obj.row,a=ref1Obj.col))):(lbl1=o.substring(1,o.length),CellUtils.isCellLabel(lbl1)&&(ref1Obj=CellUtils.getCellPosByLabel(lbl1),l=ref1Obj.row,n=ref1Obj.col,i=ref1Obj.row,a=ref1Obj.col))}if(t==CURRSHEETNAME&&"undefined"!=typeof l){var r=getCellRangeDIM(parseInt(l),parseInt(n),parseInt(i),parseInt(a));return setCellRangeFillDIVPos(r.left,r.top),setCellRangeFillDIVDim(r.width,r.height),showCellRangeFillDIV(),!0}return!1},S=function(n){l?(e("#WebText").val(s),e("#InternalText").val(s),e("#EmailText").val(s)):e("#"+t+"Text").val(n),""==n?e("#CreateButton").disable():e("#CreateButton").enable()},w=function(e){l=""==e?!1:!0},I=function(t){if(t){var l=t.value;if(l){if(l=l.replace(".","!"),-1!=l.indexOf("!")){var n=l.substring(l.indexOf("!"),l.length);o=n.replace("!","."),l=l.substring(0,l.indexOf("!"))}var i=CellUtils.getRequiredSheetNames(l).sheetName,a=CellUtils.getRequiredRangeNames(l).rangeName;i?(e("#SheetNames").val(i),O(!0,i)||clearCellRangeFill()):""!=a?e("#RangeNames").val(a):(getObj("SheetNames").selectedIndex=-1,getObj("RangeNames").selectedIndex=-1)}S(t.value)}},U=function(e,t,l,n,i){var a=!0;"undefined"==typeof n&&(n="");var r=revertSplChrs(n);if(null!=e){var s=e.substring(0,e.indexOf(":")).toLowerCase()+e.substring(e.indexOf(":"),e.length);s=s.trim();var o,d,g=document.createElement("a");if(g.setAttribute("rel","noreferrer"),g.setAttribute("idx","link"),g.setAttribute("style","text-decoration:underline;cursor:pointer;font:inherit;pointer-events:all"),g.setAttribute("target","_blank"),g.innerHTML=t,0==s.indexOf("http://",0)&&e.length>7||0==s.indexOf("https://",0)&&e.length>8||0==s.indexOf("ftp://",0)&&e.length>6||0==s.indexOf("telnet://",0)&&e.length>9||0==s.indexOf("nntp://",0)&&e.length>7||0==s.indexOf("rlogin://",0)&&e.length>9||0==s.indexOf("gopher://",0)&&e.length>9||0==s.indexOf("url://",0)&&e.length>6)o=s,d=s;else if(0==e.indexOf("www.",0)&&e.length>4)o="http://"+e,d=o;else if(0==s.indexOf("#")&&i){s=e.substring(1,e.length);var c=s.substring(0,s.indexOf("."));d="#"+s,s.indexOf("'")>-1&&(s=s.replace(/\'/g,"")),-1!=c.indexOf(" ")&&-1==c.indexOf("'")&&(d="#'"+c+"'"+s.substring(s.indexOf("."),s.length)),g.setAttribute("ilink",s),g.setAttribute("onclick","Hyperlink.callGotoMethod(this)")}else{var f=0==s.indexOf("mailto:",0)?s.replace("mailto:",""):e,h=getInvalidEmailError(f,!1);null==h&&e.length>5?(o="mailto:"+f,d=jsMsg.mailto+":"+f):l?(a=!1,r+=t):(o="http://"+e,d=o)}a&&(o&&(g.href=o),g.title=d?d:"",r+=UTIL.DOM.getOuterHTML(g))}return{linkString:r,isLink:a}},y=function(e,t,l,n){if(e){if(null!=t&&""!=t){var a=/(;|\|<|>)/g,r="",s="";r=t;var o="";s=t.replace(a," "),r="";for(var d="",g=0,c=0,f=[],h=s.split("\n"),u=[],C=0,v=h.length,m=e.style.color,p=0;v>p;p+=1){u=h[p].split(" "),C=u.length;for(var b=0;C>b;b+=1)f=f.concat(u[b])}for(i=0;i<f.length;i++){i>0&&(d=t.charAt(o.length));var R=U(f[i],escapeSpecialCharacters(f[i]),!0,d,"",m);R.isLink?(r+=R.linkString,c+=1):(r+=R.linkString,g+=1),o+=d+f[i]}setCellInnerHTML(e,encodeBlankSpaces(r.replace(/\n/g,"<br>"),!0)),E(e,l,n)}if(0==g&&1==c)e.setAttribute("hyper","full");else if(g>=0&&c>0){e.setAttribute("hyper","multi");var x=getCellInnerHTML(e);addFlexBoxDiv(e,x)}else{e.removeAttribute("hyper");var N=e.className,O=isRTL?/( (fa|ta)[lc])(\b)/i:/( (fa|ta)[rc])(\b)/i;O.test(N)||-1!=N.indexOf(" W")||isRTL||removeFlexBoxDiv(e)}}},k=function(l,n,i,a,r,s,o,d,g){if(l=l?l:"add",n=n?n:"",i=i?i:"false",d||(d=g=""),a?(startR=a,startC=r,endR=s,endC=o):(startR=getCellRange().startRow,startC=getCellRange().startCol,"remove"!=l?(endR=getCellRange().startRow,endC=getCellRange().startCol):(endR=getCellRange().endRow,endC=getCellRange().endCol)),!ProtectedRanges.isRangeLocked(startR,startC,endR,endC)){cellPrevState.sourceSheet!==CURRSHEETNAME&&(showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(cellPrevState.sourceSheet),"open",!1,!1),startR=cellPrevState.row,startC=cellPrevState.col,endR=cellPrevState.row,endC=cellPrevState.col);var c=new RequestParameters(ActionConstants.HYPERLINK),f=getCellContent();if(f=encodeURIComponent(f),"remove"!=l){var h="";if("true"!=i)if("Web"==t){d=e("#WebText").val(),g=e("#WebUrl").val();var u=g.toLowerCase(),C=u.length;if(!(0===u.indexOf("http://")&&C>7||0===u.indexOf("https://")&&C>8||0===u.indexOf("ftp://")&&C>6||0===u.indexOf("telnet://")&&C>9||0===u.indexOf("gopher://")&&C>9||0===u.indexOf("rlogin://")&&C>9||0===u.indexOf("nntp://")&&C>7||0===u.indexOf("url://")&&C>6||0===u.indexOf("www.")&&C>4||0===u.indexOf("#")))return showAlertDialog(jsMsg["Error.Hyperlink.Invalid.Url"]),setCaretPos(getObj("WebUrl"),"END"),!1;d=""==d.trim()?g:d,h=g}else if("Internal"==t){d=e("#InternalText").val();var v=e("#InternalUrl").val();if(v){var m=tempRefName=refLoc="",p=CURRSHEETNAME;if(CellUtils.isDefinedName(v)||CellUtils.isDefinedSheet(v))CellUtils.isDefinedSheet(v)?p=v:CellUtils.isDefinedName(v)&&(m=v,tempRefName=v,p="");else{if(v=v.replace(/\$/g,"").replace(".","!"),!CellUtils.checkCellLbl(v))return setCaretPos(getObj("InternalUrl"),"END"),e("#InternalUrl").select(),!1;p=v.substring(0,v.indexOf("!")),p=""==p?CURRSHEETNAME:CellUtils.getRequiredSheetNames(p).sheetName,refLoc=v.substring(v.indexOf("!")+1,v.length)}if(""!=p){var b=p;-1!=p.indexOf(" ")&&(b="'"+p+"'"),m=""!=refLoc?p+"."+refLoc:p,tempRefName=""!=refLoc?b+"."+refLoc:b}d=""==d.trim()?m:d,g="#"+m,h="#"+tempRefName}}else if("Email"==t){if(d=e("#EmailText").val(),g=e("#EmailUrl").val(),mailId=-1!=g.indexOf(":")&&"mailto"==g.substring(0,g.indexOf(":"))?g.substring(7,g.length).trim():g,""!=mailId){var R=getInvalidEmailError(mailId.trim());if(null!=R)return showAlertDialog(R),setCaretPos(getObj("EmailUrl"),"END"),!1}d=""==d.trim()?g:d,h=g}if(""==g.trim()||"mailto:"==g.trim()||"http://"==g.trim())return S(""),!1;if(""==n&&c.setParameters(WorkSheets.getSheetCodeFromName(cellPrevState.sourceSheet),startR,startC,endR,endC,l,encodeURIComponent(d),encodeURIComponent(h)),d&&g){var x=new AjaxRequest;x.init("POST",c.getURL(),!0,c.getParametersAsString()),actionManager.addRequest(x)}sheetdialog.close()}if("remove"==l){""==n&&c.setParameters(WorkSheets.getAssociatedActiveSheetName(),startR,startC,endR,endC,"remove");var x=new AjaxRequest;x.init("POST",c.getURL(),!0,c.getParametersAsString()),actionManager.addRequest(x);var N=getCell(startR,startC),O=getCellContent();L(N,l,O)}}},L=function(e,t,l,n){if(null!=e)if("remove"==t)setCellInnerHTML(e,""),e.setAttribute("hyper","null"),setCellContent(e,l);else{setCellContent(e,l),setCellInnerHTML(e,revertQuote(n)),e.setAttribute("hyper","full");var i=e.style.color;E(e,i)}},E=function(e,t,l){if(null!=e){var n=getHyperLinkInCell(e).childTag,i=e.style.color,a="",r="",s=e.style.backgroundColor,a=t?t:i?i:a,r=l?l:s?s:r;("rgb(0, 0, 0)"==a||"rgb(0,0,0)"==a||"#000000"==a)&&(r?"rgb(255,255,255)"!=r&&(a="inherit"):a="","rgb(255,255,255)"===r&&(a=""));var o=e,o=(e.className,getCellContentNode(e));if(A(o))for(var d=(getChildNodesLength(o),o.childNodes),g=d.length,c=0;g>c;c++)if(n=d[c],null!=n&&"A"==n.nodeName){var f=a?"inherit":"blue";if(n.style.color=f,browser_ie){var h=e.className,u="",C=getCSSStyleRegex("fontSize").exec(h);null!=C&&(u=C[0]);var v=getCSSStyleRegex("fontFamily").exec(h);null!=v&&(u+=v[0]),""!=u&&(n.className=u),n.style.fontSize=getCurrentStyle(e,"fontSize"),n.style.fontFamily=getCurrentStyle(e,"fontFamily"),n.style.display="inline-block"}else n.style.font="inherit"}}},A=function(e){var t=0;if(e){var l=e.childNodes;if(l)for(var n=l.length,i=0;n>i;i++){var a=l[i];if(isHyperLink(a)){t=1;break}}}return t},T=function(e,t,l,n){if(l){var i=n?l:U(l,escapeSpecialCharacters(t),!0,"",!0).linkString;L(e,"add",t,i)}else y(e,t)},j=function(e){"remove"==e&&k("remove")},D=function(){return r};return appEvent.on("changelink",function(e){R(e)}),appEvent.on("addlink",function(e,t,l,n){T(e,t,l,n)}),appEvent.on("setlink",function(e,t,l){j(e,t,l)}),appEvent.on("setlinkstyle",function(e){E(e)}),appEvent.on("showLinkDialog",function(){Hyperlink.showDialog()}),{showDialog:g,isRangeFocused:D,responseHandler:j,callGotoMethod:x}}(jQuery);
function split(e){return e.split(/,\s*/)}function extractLast(e){return split(e).pop()}var functionDescription=void 0,autocomplete={types:{FORMULA:"formula",TEXT:"text"},options:{helpTip:!1,syntaxTip:!1},defaultFormulaEls:"#cF,#Tv",init:function(e,t){e||(e=this.defaultFormulaEls);var a={},r=this.types,n=t.type;$.extend(a,t),$(e).autocomplete({minLength:1,autoFocus:!0,delay:100,position:{my:"left top",at:"left bottom",collision:"fit flip",offset:"5 5"},create:function(){var e,t=$(this),a=t.data("autocomplete");t.unbind("keydown.autocomplete").unbind("keypress.autocomplete").unbind("blur.autocomplete").bind("keydown.autocomplete",function(t){if(!a.options.disabled&&!a.element.attr("readonly")){e=!1;var r=$.ui.keyCode,i=t.keyCode;switch(i){case r.PAGE_UP:a._move("previousPage",t);break;case r.PAGE_DOWN:a._move("nextPage",t);break;case r.UP:break;case r.DOWN:break;case r.ENTER:case r.NUMPAD_ENTER:a.menu.active&&(e=!0,t.preventDefault());case r.TAB:if(!a.menu.active)return;formulaMenuUtil.isFMenuOpened&&a.menu.select(t);break;case r.HOME:case r.ESCAPE:case r.END:formulaMenuUtil.isFMenuOpened&&a.close(t),27==i&&formulaSyntaxTip.hideMe();break;default:clearTimeout(a.searching),a.searching=setTimeout(function(){a.term!=a.element.val()&&(a.selectedItem=null,a.search(null,t))},a.options.delay)}}}).bind("keypress.autocomplete",function(t){e&&(e=!1,t.preventDefault())}).bind("blur.autocomplete",function(){a.options.disabled||clearTimeout(a.searching)})},search:function(){var e=$(this),t=e.val();if(0==t.indexOf("=")){if(void 0===functionDescription)return autocomplete.getFormulasInfo(),!1;this===cellField&&removeCSSStyle("textAlign",cellField);var r=getFieldValByCaretPos("before"),i=r.split('"').length-1,n=r.length,o=t.trim().length,l=0,s=formulaMenuUtil.itemsMatched(r);if(s&&(l=s.length),n>o||i%2!=0||!l)return e.autocomplete("close"),!1;var u=e.autocomplete("widget");l>=12?u.css("overflow-y","scroll"):u.css("overflow-y","auto");var c=getLastIndexOfRegex(r.trim());if(-1!=c){var f,d=r.substr(0,c+1),p=/\n/g,m=r.match(p);if(m){var h=r.lastIndexOf("\n"),g=r.substr(h);g&&(f=getCellValueWidth(g))}else f=getCellValueWidth(d);if(a.syntaxTip){var v=formulaSyntaxTip.getObj();if(v.is(":visible")){var x=v.outerHeight();x+=5,f=f+" "+x}else f+=" 6"}else f+=" 6";var y=isEditingInExprField&&RTLlang?"right top":"left top",T=isEditingInExprField&&RTLlang?"right bottom":"left bottom";e.autocomplete("option","position",{my:y,at:T,collision:"fit flip",offset:f})}}},source:function(e,t){var a=getFieldValByCaretPos("before");if(0==a.indexOf("=")){var r=formulaMenuUtil.getMatchedItems(a),n=0;if(r&&(n=r.length),!(n>0))return void $(this).autocomplete("close");t(r)}else if(null!=intAutoComplete){var o=e.term;o=o.replace(/[ ]*/,"");var l=o.lastIndexOf(",");for(-1!=l&&(o=o.substring(l+1).replace(/[ ]*/,"")),i=0;i<intAutoComplete.length;i++){var s=getCellContent(getCell(currRow,intAutoComplete[i].PKColNo));currCol==intAutoComplete[i].autocompleteColNo&&""!=s&&t($.ui.autocomplete.filter(intAutoComplete[i].autocompleteDisplay,extractLast(o)))}}},focus:function(e,t){var i=getFieldValByCaretPos("before");if(n==r.FORMULA&&a.helpTip&&0==i.indexOf("=")){var o=t.item.description;o=decodeURIComponent(o);var l=$(".ui-menu-item .ui-state-hover"),s=l.parent(),u=s.parent(),c=s.offset(),f=c.top,d=u.offset(),p=d.left,m=u.width();formulaHelper.showHelp(o,p,f,m)}return!1},open:function(){formulaMenuUtil.isFMenuOpened=!0},select:function(e,t){var i=getFieldValByCaretPos("before");if(n==r.FORMULA&&0==i.indexOf("=")){if(!e.ctrlKey&&!e.altKey){var o=e.which,l=getFieldValByCaretPos("before"),s=l.length,u=this.value,c=u.length,f=u.substr(s,c-1);l=l.trim();var d=getLastIndexOfRegex(l);l=l.substr(0,d+1);var p=t.item.label;l+=p;var m=(getFieldValByCaretPos("After"),f.charAt(0)),h=t.item.type.trim();"NAMEDRANGE"!=h&&"("!=m&&(l+="(");var g=l.trim()+f,v=document.activeElement;if(this.value=g,(this===cellField||this===exprField)&&(cellField.value=g,exprField.value=g,setCellFieldWidth(),appEvent.trigger("formulaSuggest.ValueChanged",[v.id,!0])),setCaretPos(v,l.length),a.syntaxTip&&"FUNCTION"==h){var x=$(this);x.autocomplete("widget").is(":visible")&&formulaSyntaxTip.showTip(l,x,o)}}}else if(null!=intAutoComplete){var y=cellField.value,T=cellField.value.lastIndexOf(",");if(-1!=T){{var F=y.substring(0,T+1);F+t.item.value}cellField.value=F+t.item.value}else cellField.value=t.item.value}return!1},close:function(){formulaMenuUtil.hideMenu()},change:function(){formulaMenuUtil.isFMenuOpened=!1,$("#fHelpDiv").hide()}}),this.overrideDefaults()},getFormulasInfo:function(){var e=new RequestParameters(ActionConstants.GET_FORMULA_SUGGEST_INFO),t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){functionDescription=JSON.parse(e.responseText)[JSONConstants.FORMULA_SUGGEST_INFO]}),t.sendRequest()},destroy:function(e){$(e).autocomplete().autocomplete("destroy")},overrideDefaults:function(){$.ui.autocomplete.prototype._renderItem=function(e,t){if("FUNCTION"===t.type||"NAMEDRANGE"===t.type){var a=$("<span></span>").text(t.label).css("left",6).css("position","relative"),r=$("<span></span>");r.addClass("FUNCTION"==t.type?"functionicon":"namerangeicon");var i=$("<li></li>").data("item.autocomplete",t).append($("<a></a>").append(r).append(a)).appendTo(e);return i}return $("<li>").data("item.autocomplete",t).append("<a>"+t.label+"</a>").appendTo(e)},$.ui.autocomplete.prototype._move=function(e,t){var a=document.activeElement;(formulaMenuUtil.isFMenuOpened||a!=cellField&&a!=exprField)&&(this.menu[e](t),t.preventDefault())},$.ui.autocomplete.prototype._resizeMenu=function(){},$.ui.menu.prototype._scrollIntoView=function(e){if(this.deactivate(),this.hasScroll()){var t=e.offset().top-this.element.offset().top,a=this.element.scrollTop(),r=this.element.height();0>t?this.element.scrollTop(a+t):t>=r&&this.element.scrollTop(a+t-r+e.height())}this.active=e.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",null,{item:e})},$.ui.menu.prototype.deactivate=function(){var e=$(".ui-menu-item .ui-state-hover");e&&($(e).removeClass("ui-state-hover"),this._trigger("blur",null,{item:e}))},$.ui.menu.prototype.hasScroll=function(){return this.element.height()<this.element[$.fn.prop?"prop":"attr"]("scrollHeight")},$(".ui-autocomplete").mouseout(function(){var e=$(".ui-menu-item .ui-state-hover"),t=e.parent().hasClass("ui-menu-item");t||formulaHelper.hideMe()}),$("#fHelpDiv").hide()}};appEvent.on("book.onbeforesheetswitch",function(){autocomplete.destroy(autocomplete.defaultFormulaEls)});var AutocompleteItem=function(e,t,a,r){this.label=e,this.value=t,this.description=a,this.type=r},formulaMenuUtil={input:function(e){document.getElementById("cF").style.direction="ltr",document.getElementById("Tv").style.direction="ltr";var t=e.substr(1).trim(),a=getLastIndexOfRegex(t.trim());return-1!=a&&(t=t.substr(a+1)),t},functionsMatched:function(e){var t=[];t=functionDescription[JSONConstants.FUNCTION_LOCALIZED_NAMES];var a=matchString(e,t);return a},matchedNameRanges:function(e){for(var t=NamedRange.getRangeandExpression(),a=[],r=t.length,i=0;r>i;i++)a[i]=t[i]+"!";var n=[];return n=matchString(e,a),n?n:void 0},sheets:function(e){for(var t=[],a=($("#sheetsTab"),getObj("sheetsTab").getElementsByTagName("TD")),r=a.length,i=0;r-1>i;i++)t[i]=a[i].getAttribute("sheetname");matchString(e,t);return t},ignoreCaseSort:function(e,t){var a=e.toLowerCase(),r=t.toLowerCase();return r>a?-1:a>r?1:0},itemsMatched:function(e){var t=this.input(e),a=this.functionsMatched(t),r=this.matchedNameRanges(t),i=a;return r&&(i=a.concat(r).sort(this.ignoreCaseSort)),i},getMatchedItems:function(e){for(var t=this.itemsMatched(e),a=t.length,r=[],i=NamedRange,n=0;a>n;n++){var o=t[n],l=o.length;if("!"==t[n].charAt(l-1)){o=o.substring(0,l-1);var s=i.getDefinedNameProperty(o,"CONTENT");s=jsMsg.Refersto+" "+s,r[n]=new AutocompleteItem(o,o,s,"NAMEDRANGE")}else{var u=functionDescription[JSONConstants.FUNCTION_LOCALIZED_NAMES].indexOf(o),c=functionDescription[JSONConstants.FUNCTION_TIPS][u];r[n]=new AutocompleteItem(o,o,c,"FUNCTION")}}return r},hideMenu:function(){this.isFMenuOpened=!1;for(var e=["cF","Tv"],t=e.length,a=0;t>a;a++){var r=e[a],i=$("#"+r).autocomplete("widget"),n=i.is(":visible");n&&(i.hide(),i.html(""))}$("#fHelpDiv").hide()},isFMenuOpened:!1,disableAutoComplete:function(e){var t=$(".cF,#Tv"),a=t.autocomplete("option","disabled");a?(t.autocomplete("enable"),$("#"+e).autocomplete("search")):(t.autocomplete("close"),t.autocomplete("disable"))}},$formulaSyntaxDiv,formulaSyntaxTip={options:{id:"aFSyntax",clas:"formulaSyntax",appendTo:"body",position:{my:"left top",at:"left bottom",collision:"none"}},isVisible:function(){var e=this.getObj(),t=e.is(":visible");return t},getObj:function(){var e=this.options.id;e="#"+e;var t=$(e);return t},hideMe:function(){var e=this.getObj();e.is(":visible")&&e.css("display","none")},showTip:function(e,t,a,r,i){return 36!=a&&27!=a&&functionDescription?void formulaParser.getCurrFormulaDetails(e,a,r,i,t):void this.hideMe()},_construct:function(e,t,a,r,i,n,o){e=e.toUpperCase();var l=functionDescription[JSONConstants.FUNCTION_LOCALIZED_NAMES].indexOf(e),s=functionDescription[JSONConstants.FUNCTION_MAX_ARGS][l],u=["en","es","de","fr","pl"];if(-1!=l){var c=functionDescription[JSONConstants.FUNCTION_SYNTAX][l];if(c){if(!$formulaSyntaxDiv){var f=this.options;$formulaSyntaxDiv=$("<div>").attr("id",f.id).addClass(f.clas).appendTo(f.appendTo)}this._removeChilds();var d=r;$formulaSyntaxDiv.data("formulaData")&&$formulaSyntaxDiv.removeData("formulaData");var p={indx:d,name:e};$formulaSyntaxDiv.data("formulaData",p);var m,h,g;return m=$("<a>").addClass("formulaHelpLink").text(e).bind("click",function(){var t,a;-1!=u.indexOf(funcLangCode)?(t=funcLangCode,a=functionDescription[JSONConstants.FUNCTION_NAMES][l]):(t="en",a=e);var r=ctxpath+"html/functions/"+t+"/"+a+".html",i={width:600,title:jsMsg.FunctionReference,dontSubmit:!0};sheetdialog.open("functionhelpdialog",i,void 0,void 0,r)}).appendTo($formulaSyntaxDiv),h=$("<span>").text("(").addClass("openBrace").appendTo($formulaSyntaxDiv),this._addArguments(c,t,a,s),g=$("<span>").text(")").addClass("closedBrace").appendTo($formulaSyntaxDiv),this._removeAndAddBold(t),this.setLeftAndTop(d,o,e),void this._dragMe()}}},_addArguments:function(e,t,a,r){var i,n=e.substr(1,e.length-2),o=n.split(";"),l=o.length;if(r>=30){var s=o[0];s+=";";{var u,c=o[1],f=/[a-z]+/i,d=c.match(f),p=d[0],m=$("<span>").addClass("fParams");m.clone().text(s).appendTo($formulaSyntaxDiv)}if(r>30){u=p+"1;";{m.clone().text(u).appendTo($formulaSyntaxDiv)}}for(var n,h=a+2,g=1;h>g;g++)u="["+p+(g+1)+"];",n=m.clone().text(u).appendTo($formulaSyntaxDiv);{m.clone().text("...").appendTo($formulaSyntaxDiv)}m.remove()}else for(var g=0;l>g;g++){var v=o[g].trim();i=$("<span>").addClass("fParams").appendTo($formulaSyntaxDiv),i.text(g==l-1?v:v+";")}this._attachMouseEvents(a)},_highlightNextArg:function(e,t,a){var r=$("#aFSyntax").find("span.fParams"),i=r.last(),n=i.prev();if(44==a||59==a){var o=n.text(),l=/[a-z]+/gi,s=o.match(l),u=s[0];u+=t+2,u="["+u+"];";{$("<span>").addClass("fParams").text(u).insertBefore(i)}}8==a&&n.remove(),r.removeClass("fParamBold"),$(r[e]).addClass("fParamBold")},_attachMouseEvents:function(e){e+=1;var t=$("#aFSyntax").find("span.fParams:lt("+e+")");t.mousedown(function(){if(!browser_ie){var t=this;formulaSyntaxTip._selectArgTxtInField(t,e)}}).mouseup(function(){if(browser_ie){var t=this;formulaSyntaxTip._selectArgTxtInField(t,e)}}).css("cursor","pointer")},_functionHelpWindow:function(e){window.open("/html/functions/"+funcLangCode+"/"+e+".html","myWindow","status = 1, height = 250, width = 720, resizable = 0, scrollbars=yes, location = yes ")},_selectArgTxtInField:function(e,t){var a=$("#aFSyntax").find("span.fParams"),r=a.index(e);formulaSyntaxTip._removeAndAddBold(r),formulaParser.selectArgText(r,t)},_removeChilds:function(){var e=$formulaSyntaxDiv;if(e){var t=e.children();t.length>0&&e.empty()}},setLeftAndTop:function(e,t){var a,r,i=formulaParser.getFieldValueWidthByCaretPos(e);if(isEditingInExprField){var n=$("#cHC").position();a=isRTL?i+getOffsetRight(exprField):i+findPosX(exprField),r=n.top}else{$formulaSyntaxDiv.css("left",0);var o=$formulaSyntaxDiv.outerWidth(),l=getColLeft(currCol)+rowHeadWidth-getNormalizedScrollLeft();total=o+l,pageWidth=$(window).width(),total+=i;var s=$("#ssVScrollbar"),u=s.offset(),c=u.left,f=s.outerWidth(),d=c+f;a=isRTL?d>=total?pageWidth-o:i+getColLeft(currCol)+rowHeadWidth-getNormalizedScrollLeft():total>=d?pageWidth-o:i+getColLeft(currCol)+sheetLeft-getSheetScrollLeft(),r=getRowTop(currRow)+sheetTop-getSheetScrollTop()+t.outerHeight()}if(isRTL){document.getElementById("aFSyntax").style.left="";var p={right:a,top:r,display:"block"}}else{document.getElementById("aFSyntax").style.right="";var p={left:a,top:r,display:"block"}}if(isEditingInExprField)if(RTLlang){document.getElementById("aFSyntax").style.left="";var p={right:a,top:r,display:"block"}}else{document.getElementById("aFSyntax").style.right="";var p={left:a,top:r,display:"block"}}$formulaSyntaxDiv.css(p)},_removeAndAddBold:function(e){var t=$("#aFSyntax").find("span.fParams");t.removeClass("fParamBold"),$(t[e]).addClass("fParamBold")},_dragMe:function(){var e=this.getObj();e.draggable({containment:"parent"})}},formulaParser={regexOptions:{formulaRegex:/[\/\-()-+=,~@%^*"|;<>'&}{\n ]/g,openRound:/\(/g,closedRound:/\)/g,roundPair:/\(([^\(])*?\)/g,openFlower:/{/g,closedFlower:/}/g,flowerPair:/{([^{])*?}/g,openSquare:/\[/g,closedSquare:/\]/g,squarePair:/\[([^\[])*?\]/g,doubleQuotes:/"/g,doubleQtStrings:/".*?"/g,separators:/[,;]/g,newLine:/\n/g},getCurrFormulaDetails:function(e,t,a,r,i){if(0==e.indexOf("=")){if(37==t||44==t||59==t){var n=e.split('"').length-1;if(n%2!=0)return}var o=e,l=getFieldValByCaretPos("after",t),s=o.length,u=l.length,c=o.charAt(s-1);switch(t){case 57:r&&(o+="(");break;case 8:a||(o=o.substr(0,s-1));break;case 48:r&&(o+=")");break;case 222:o+='"';break;case 46:l=l.substr(1)}if(8==t||r&&57==t||r&&48==t){var n=o.split('"').length-1;if(n%2!=0)return}var f=o+l;s=o.length,u=l.length;var d=o,p=this;d=p.escDblQtStrings(d);var m=[];if(m=p.getFnameAndIndx(d),!m)return void formulaSyntaxTip.hideMe();var h=m[0],g=m[1],v=m[2];v=p.getCurrentFormulaText(v);var x=g.length,y=h+x,T=f.substr(y);T=p.escapeStrings(T),T=p.filterIncompleteArg(T)[0],T=p.getCurrentFormulaText(T);var F=p.separators(v),b=p.separators(T);g=g.substr(0,x-1);var C=[];C[0]=g,C[1]=F,C[2]=b,C[3]=h,C[4]=c,formulaSyntaxTip._construct(g,F,b,h,t,c,i)}},getFnameAndIndx:function(e){var t=e.length,a=/[a-z\u00c0-\u00d6\u00d8-\u00f6\u0100-\u017F]([_.a-z0-9\u00c0-\u00d6\u00d8-\u00f6\u0100-\u017F])*\(/gi,r=e.match(a),i=[];if(r)for(var n=r.length,o=t,l=n-1;l>=0;l--){var s=r[l],u=s.length;if(o=e.substr(0,o).lastIndexOf(s),-1==o);else{var c=e.charAt(o-1),f=/[-()+=,~@%^*"|;:<>'&}{\n ]/g,d=f.test(c);if(!d)continue;var p=o;p+=u;var m=e.substr(p);m=this.filterIncompleteArg(m)[0],i[0]=o,i[1]=s,i[2]=m;var h=this.isThisAFormula(s);if(h){var g=this.isThisCurrentFormula(m);if(g){if(0==l)return null;continue}return i}}}},getCurrentFormulaText:function(e){e=this.escapeBrackets(e,"round");var t=e.split("(").length-1,a=e.split(")").length-1;if(a){var r=e.indexOf(")");-1!=r&&(e=e.substr(0,r))}else if(t){var r=e.indexOf("(");-1!=r&&(e=e.substr(0,r))}else e=e;return e},isThisCurrentFormula:function(e){e=this.escapeRoundBrkts(e);var t,a=(e.split("(").length-1,e.split(")").length-1);return t=a?!0:!1},selectArgText:function(e){var t=$formulaSyntaxDiv.data("formulaData"),a=t.indx,r=t.name,i=a+r.length+1,n=getValByField(),o=formulaParser.filterIncompleteArg(n),l=o[0],s=o[1],u=l.substr(i);u=this.getCurrentFormulaText(u);var c=this.separators(u),f=0,d=0;u=u.replace(/;/g,",");for(var p=0;e>p;p++){var m=",",h=0;h=u.indexOf(m,f),f=h+m.length,d=h}0!=e&&(d+=1);var g=u.substr(d),v=r.length+1,x=a+v+d,y=(u.length,g.length),T=/[,;]/g,F=g.match(T);if(F&&(y=g.indexOf(F[0])),0==e&&(x=a+v),e==c){var b=s.length;y+=b}y=x+y,isEditingInExprField?selectText(exprField,x,y):selectText(cellField,x,y)},bracketType:{round:"round",flower:"flower",square:"square"},fieldValue:function(){var e;return e=isEditingInExprField?exprField.value:cellField.value},separators:function(e){var t=/[,;]/g,a=0,r=e.match(t);return r&&(a=r.length),a},getMatchCount:function(e,t){var a=0,r=e.match(t);return r&&(a=r.length),a},escDblQtStrings:function(e){var t=this.regexOptions.doubleQtStrings,a=this.replaceBy,r=e.match(t);return r&&(e=e.replace(t,a)),e},escapeRoundBrkts:function(e){for(var t=this.regexOptions.roundPair,a=e.split("(").length-1,r=e.split(")").length-1,i=Math.min(a,r),n=this.replaceBy,o=0;i>o;o++){var l=e.search(t);-1!=l&&(e=e.replace(t,n))}return e},replaceBy:function(e){var t=formulaParser.replaceWith(e);return t},replaceWith:function(e){var t="",a=e.length,r=a+1;return t=new Array(r).join("~")},isThisAFormula:function(e){var t,a=e.substr(0,e.length-1);return a&&(a=a.toUpperCase(),t=functionDescription[JSONConstants.FUNCTION_LOCALIZED_NAMES].indexOf(a)),-1!=t?1:0},escapeStrings:function(e){var t=this.regexOptions.doubleQtStrings,a=e.match(t);if(a){var r=this.replaceBy;e=e.replace(t,r)}return e},filterIncompleteArg:function(e){var t;t=e,t=this.escapeStrings(t),t=this.escapeBrackets(t,"flower"),t=this.escapeBrackets(t,"square");var a=/"/g,r=/{/g,i=/\[/g,n=Number.POSITIVE_INFINITY,o=n,l=n,s=n,u=t.match(a),c=t.match(r),f=t.match(i);u&&(o=t.indexOf(u[0])),c&&(l=t.indexOf(c[0])),f&&(s=t.indexOf(f[0]));var d=Math.min(o,l,s),p="",m=[];return-1!=d&&n>d&&(p=t.substr(d),t=t.substr(0,d)),m[0]=t,m[1]=p,m},escapeBrackets:function(e,t){var a,r,i,n=this;if(t==n.bracketType.round)a=n.regexOptions.openRound,r=n.regexOptions.closedRound,i=n.regexOptions.roundPair;else if(t==n.bracketType.flower)a=n.regexOptions.openFlower,r=n.regexOptions.closedFlower,i=n.regexOptions.flowerPair;else{if(t!=n.bracketType.square)return;a=n.regexOptions.openSquare,r=n.regexOptions.closedSquare,i=n.regexOptions.squarePair}var o=0,l=0;o=n.getMatchCount(e,a),l=n.getMatchCount(e,r);var s=o+l,u=Math.floor(s/2);if(u)for(var c=n.replaceBy,f=0;u>f;f++){var d=e.search(i);-1!=d&&(e=e.replace(i,c))}return e},getFieldValueWidthByCaretPos:function(e){var t=this.fieldValue();e&&(t=t.substr(0,e));var a=this.regexOptions.newLine,r=t.match(a);if(r){var i=t.lastIndexOf("\n");-1!=i&&(t=t.substr(i))}return getCellValueWidth(t)}},getFieldValByCaretPos=function(e,t){var a,r,i,n,o=!1,l="",s=document.activeElement;if(i=s===cellField?cellField:s===exprField?exprField:s,a=getCaretPos(i),r=i.value,o=isTextSelected(i),o&&t&&(l=getSelectedText(i)),a<r.length){var u=r.substr(a,r.length);u=u.split(formulaParser.regexOptions.formulaRegex)[0],a+=u.length}if("before"==e)n=r.substr(0,a);else{var c=l.length;c&&(a+=c),n=r.substr(a)}return n},getValByField=function(){var e;return e=isEditingInExprField?exprField.value:cellField.value},getLastIndexOfRegex=function(e){var t=e.match(formulaParser.regexOptions.formulaRegex);if(!t)return-1;var a=t.length;if(a>0){var r=t[a-1],i=e.lastIndexOf(r);return i}},$formulaHelpTip,formulaHelper={_construct:function(e,t,a,r){$formulaHelpTip||($formulaHelpTip=$("<div>").attr("id","fHelpDiv").addClass("fHelper").appendTo("body")),$formulaHelpTip.text(e),$formulaHelpTip.css("left",0);var i=7,n=$formulaHelpTip.width(),o=r+t+i,l=$(window).width(),s=o+n;if(s>=l){var u=1.6;o=t-(n+i+u)}$formulaHelpTip.css("left",o),$formulaHelpTip.css("top",a),$formulaHelpTip.show(),this._dragMe()},showHelp:function(e,t,a,r){this._construct(e,t,a,r)},hideMe:function(){$("#fHelpDiv").hide()},_dragMe:function(){$formulaHelpTip.draggable({containment:"parent"})}};
function FormObj(e,o){this.id=e,this.range=o||{}}WebForm={isFormAvailable:!1,formBuilderUrl:void 0,formEditUrl:void 0,formDeleteUrl:void 0,liveFormUrl:void 0,formPublishUrl:void 0,formLinkName:void 0,formRid:void 0,isPublished:!1,publishType:void 0,formVersionId:-1,createForm:function(){var e=$("#formName").val();if(e=e.trim(),""==e||e.length>40)return void showAlertDialog(jsMsg["Form.InvalidNameMessage"]);e=replaceDisallowedCharsInDocName(e.trim());var o=$("#formDescription").val(),r=new RequestParameters(ActionConstants.FORM_CREATE);r.setParameters(WorkSheets.getAssociatedActiveSheetName(),!0,e,o);var i=new AjaxRequest;i.init("POST",r.getURL(),!0,r.getParametersAsString()),actionManager.addRequest(i),sheetdialog.close()},createFormDialog:function(){var e={width:550,title:jsMsg["DataTab.CreateForm"],close:function(){}};sheetdialog.open("createFormDialog",e,WebForm.createFormCallback("formName"))},editForm:function(){WebForm.formEditUrl&&window.open(WebForm.formEditUrl,"_blank")},validateDeleteForm:function(){var e={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){WebForm.deleteForm(),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};sheetdialog.showConfirmDialog(jsMsg["Form.DeleteMessage"],e)},deleteForm:function(){var e=new RequestParameters(ActionConstants.FORM_DELETE);e.setParameters(WebForm.formRid,WorkSheets.getSheetCodeFromName(CURRSHEETNAME));var o=new AjaxRequest;o.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(o)},publishFormDialog:function(e){var o=new RequestParameters(ActionConstants.JSP_PUBLISH_FORM);o.setParameters(WebForm.formRid,e,orgDisplayName);var r={width:520,modal:!0,title:jsMsg["Share.MakePublic"]},i=o.getURL()+"?"+o.getParametersAsString();sheetdialog.open("publicformdialog",r,void 0,void 0,i)},publishForm:function(e){if(WebForm.formRid){var o=new getXmlhttp;o.open("POST",ctxpath+"publishform.do",!0),o.onreadystatechange=function(){4==o.readyState&&200==o.status&&(sheetdialog.close(),responseText=o.responseText,"success"==responseText&&(WebForm.isPublished=!0,WebForm.publishType=e,WebForm.showPublishFormUrl(e)))},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),o.send("rid="+WebForm.formRid+"&action=publish&type="+e+"&"+csrfParamName+"="+readCookie(csrfCookieName))}else sheetdialog.close()},removePublish:function(){if(WebForm.isPublished){var e=new getXmlhttp;e.open("POST",ctxpath+"removeformpublish.do",!0),e.onreadystatechange=function(){4==e.readyState&&(sheetdialog.close(),200==e.status&&(responseText=e.responseText,"success"==responseText&&(WebForm.isPublished=!1,WebForm.publishType=void 0)))},e.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),e.send("rid="+WebForm.formRid+"&action=unpublish&type="+WebForm.publishType+"&"+csrfParamName+"="+readCookie(csrfCookieName))}else sheetdialog.close()},showPublishFormUrl:function(){var e=new RequestParameters(ActionConstants.JSP_PUBLISH_FORM_URL);e.setParameters(WebForm.formRid,WebForm.publishType,orgDisplayName);var o={width:520,modal:!0,title:jsMsg["Share.ViewPublicURL"]},r=e.getURL()+"?"+e.getParametersAsString();sheetdialog.open("viewpublicformurldialog",o,void 0,void 0,r)},cancelFormPublicDialog:function(e){sheetdialog.close(),cancelFromPubliccallback=void 0!=e&&"publicurl"==e?!0:!1;var o=new RequestParameters(ActionConstants.JSP_CANCEL_PUBLISH_FORM);o.setParameters(WebForm.publishType);var r=o.getURL()+"?"+o.getParametersAsString(),i={width:450,modal:!0,title:jsMsg.RemovePublic};sheetdialog.open("cancelformpublicdialog",i,void 0,void 0,r)},cancelFormCallBack:function(){cancelFromPubliccallback?(cancelFromPubliccallback=!1,sheetdialog.close(),WebForm.showPublishFormUrl(WebForm.publishType)):sheetdialog.close()},viewLiveForm:function(){WebForm.liveFormUrl&&window.open(WebForm.liveFormUrl,"_blank")},createFormCallback:function(e){var o=DOCUMENT_NAME;o&&o.length>40&&(o=o.substring(0,40)),setTimeout(function(){$("#"+e).val(o).focus().select()},100)},formCreateInfo:function(){var e="New form created. To add fields, <a id='formTitleLink' target='_blank' href='"+WebForm.formEditUrl+"'>Click here.</a>";InfoBanner.showBanner(e,!1,"success"),setTimeout(function(){InfoBanner.hideBanner()},6e4)},updateFormInfo:function(e,o){if(WebForm.isFormAvailable=e,e){var r=o[JSONConstants.FORM_URLS];r&&(WebForm.formLinkName=o[JSONConstants.FORM_LINK_NAME],WebForm.formVersionId=o.frmversionid,WebForm.formRid=WebForm.formLinkName,WebForm.formEditUrl=r.formEditURL,isUndefined(o[JSONConstants.IS_FORM_PUBLISHED])||(WebForm.isPublished=o[JSONConstants.IS_FORM_PUBLISHED],WebForm.publishType=o[JSONConstants.FORM_PUBLISH_TYPE]),WebForm.liveFormUrl=r.liveFormUrl)}WebForm.updateFormMenuTab()},updateOrgName:function(){var e=orgDisplayName?orgDisplayName:orgName,o=replaceParams(jsMsg["Share.Public.MakePublicWithin"],new Array(e));setTimeout(function(){$("#formpublishmenu").zmenu("changeLabel","makeFromPublishOrg",o)},10)},resetFormInfo:function(e){WebForm.isFormAvailable=!1,WebForm.formBuilderUrl=void 0,WebForm.formEditUrl=void 0,WebForm.formDeleteUrl=void 0,WebForm.liveFormUrl=void 0,WebForm.formPublishUrl=void 0,WebForm.formLinkName=void 0,WebForm.formVersionId=-1,FormObj.instances={},e&&WebForm.updateFormMenuTab()},updateFormMenuTab:function(){WebForm.isFormAvailable?($("#editForm").enable(),$("#deleteForm").enable(),$("#liveForm").enable(),$("#publishForm").enable()):($("#editForm").disable(),$("#deleteForm").disable(),$("#publishForm").disable(),$("#liveForm").disable())},updateFormPublishMenu:function(){WebForm.updateOrgName(),WebForm.isPublished?"org"==WebForm.publishType?($("#makeFromPublishOrg").hide(),$("#viewpubFormURL").show(),$("#makeFromPublishExtn").show(),$("#removefrompublish").show()):($("#viewpubFormURL").show(),$("#removefrompublish").show(),$("#makeFromPublishOrg").hide(),$("#makeFromPublishExtn").hide()):($("#viewpubFormURL").hide(),$("#removefrompublish").hide(),$("#makeFromPublishExtn").show(),-1!=zoid?$("#makeFromPublishOrg").show():$("#makeFromPublishOrg").hide())}},appEvent.on("WebForm.updateFormInfo",function(e,o){WebForm.updateFormInfo(e,o)}),appEvent.on("Webform.formDeleteUrl",function(){return WebForm.formDeleteUrl}),FormObj.instances={},FormObj.create=function(e,o){FormObj.instances[e]=new FormObj(e,o)},FormObj.validateRowOperations=function(){var e=formobj.range;if(!isUndefined(e)){e.sr,e.er}},FormObj.isValidColumnOperations=function(e,o,r){void 0==o&&(o=WorkSheets.getAssociatedActiveSheetName());var i=FormObj.instances[o];if(i){var t=i.range;if(!isUndefined(t)){var a=getCellRange(),s=(a.startCol,a.endCol),n=t.sc,m=t.ec;if(r==ActionConstants.DELETE_COL&&(e>=n&&m>=e||s>=n&&m>=s)||r==ActionConstants.INSERT_COL&&e>n&&m>=e){var l=showConfirmDialog(jsMsg["Form.RangeOperationMessage"]);return!l}}}return!1},FormObj.isValidRowOperations=function(e,o){void 0==o&&(o=WorkSheets.getAssociatedActiveSheetName());var r=FormObj.instances[o];if(r){var i=r.range;if(!isUndefined(i)){var t=i.sr,a=getCellRange(),s=a.startRow,n=a.endRow;if(s==t||n==t){var m=showConfirmDialog(jsMsg["Form.RangeOperationMessage"]);return!m}}}return!1};
!function(e){function n(e,n){return!e&&(e=""),new RegExp(e,n)}function r(e){var n="";return e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),new RegExp("^"+e.source+"$",n)}function i(e){return e+"*"}function t(e){return u(e)+"?"}function u(e){return"(?:"+e+")"}function g(e){return"("+e+")"}function o(e){return e=e.replace(/-/g,"\\-"),"["+e+"]"}function l(e){return o("^"+e)+"+"}var c={},a=l("'\\n"),f="'"+a+"'",R="[.!]",s=f+"|"+a,x="6553[0-6]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}",p="[I][A-V]|[A-H]?[A-Z]",v=t("\\$"),C=u(p),d=i("0")+u(x),m=v+C+v+d,A=m+i(u(":"+m)),h=g(u(m+t(":"+m))+"|"+u(v+d+":"+v+d)+"|"+u(v+C+":"+v+C)),w=t(v+g(s)+R)+h,E=r(n(w,"i")),I=v+C+t(v+d),$=i(u(I+":"))+v+C+i(u(":"+I))+":"+v+C+i(u(":"+I)),b=t(v+C)+v+d,y=i(u(b+":"))+v+d+i(u(":"+b))+":"+v+d+i(u(":"+b));m=u(u(m)+"|"+u(v+C)+"|"+u(v+d)),A=g(u(u(y)+"|"+u($)+"|"+u(A)));var B=t(v+g(s)+R)+A,D=r(n(B,"i")),F=g(v)+g(t(C))+g(v)+g(t(d)),H=m,Q="();,=+-/*<>&^\\s\\n",T='"'+t(l('"'))+'"?',V=n(u(T)+"|"+u(u(o(Q))+"|"+u(t(f+R)+l('"'+Q))),"gi");c.matchRegex=V,c.rangeRegex=D,c.enclosedByQuotes=r(n(T)),c.seperatorRegex=r(n(o(Q))),c.validCell=r(n(m,"i")),c.cellRangeForReferenceToggling=r(n(F,"i")),c.splitCellReferencesInRange=n(H,"gi"),c.valid2DRange=E,e.regexCollection=c}(this);
function getCurrentReferencingMode(e){var t=regexCollection.cellRangeForReferenceToggling.exec(e),s=!!t[1],r=!!t[3],n=!!t[2]&&!!t[4];return n?s?r?1:3:r?2:0:t[1]?5:4}var funcParser=function(){this.origStr="",this.selStart=0,this.selEnd=0,this.subRanges=[],this.wholeRanges=[],this.objectArray=[],this.objectsSelected=[],this.subFormulaArray=[]};funcParser.prototype={funcType:{unknown:"UNKNOWN",string:"STRING",func:"FUNCTION",seperator:"SEPERATOR",subRange:"SUBRANGE",range:"RANGE",sheet:"SHEET",namedRange:"NAMEDRANGE",rangeColon:"COLON_WITHIN_RANGE"},get:function(){return{origStr:this.origStr,rangeObjects:this.subRanges,wholeRanges:this.wholeRanges,selectedObjects:this.objectsSelected,allObjects:this.objectArray,currRange:this.currRange,focusedObject:this.currentFocusedObject}},set:function(e,t,s){this.origStr=e,s="undefined"==typeof s?t:s,t>s&&(s=t+s,t=s-t,s-=t),this.selStart=t,this.selEnd=s,this.check()},check:function(){this.resetObjs(),this.parseString(),this.formObj()},resetObjs:function(){this.subRanges=[],this.objectArray=[],this.objectsSelected=[],this.subFormulaArray=[],this.wholeRanges=[],this.currentFocusedObject=[]},isDifferentObject:function(e,t,s){return this.origStr!=e||this.selStart!=t||this.selEnd!=s},parseString:function(){var e=this.origStr.match(regexCollection.matchRegex);this.subFormulaArray=e?e:[],this.parentRange=[];for(var t=0,s=0,r=0;r<this.subFormulaArray.length;){var n=this.subFormulaArray[r];if(!regexCollection.enclosedByQuotes.test(n)&&regexCollection.rangeRegex.test(n)){var a=[],i=this.subFormulaArray.indexOf(n);a=n.match(/(?:([:.!])|([^:.!]+))/g),this.subFormulaArray.splice(i,1);for(var h={content:n,start:t,end:t+n.length,index:s++},o=0;o<a.length;o++)this.subFormulaArray.splice(i+o,0,a[o]),this.parentRange.push({range:!0,data:n,info:h});this.wholeRanges.push(h),r+=a.length}else r++,this.parentRange.push({range:!1});t+=n.length}},getType:function(e){var t=this.subFormulaArray[e],s=this.funcType.unknown;return regexCollection.enclosedByQuotes.test(t)?this.funcType.string:this.parentRange[e].range&&regexCollection.validCell.test(t)?this.funcType.subRange:t.match(regexCollection.seperatorRegex)?this.funcType.seperator:":"==t?this.funcType.rangeColon:s},formObj:function(){delete this.currRange;for(var e,t=0;t<this.subFormulaArray.length;t++){var s=this.subFormulaArray[t],r=this.getType(t),n=0==t?0:this.objectArray[t-1].end,a=n+s.length;if(""!=s){var i={content:s,type:r,start:n,end:a};this.parentRange[t].range&&(i.rangeData=this.parentRange[t].info),r==this.funcType.subRange&&(i.mode=getCurrentReferencingMode(s),this.subRanges.push(i),(n<=this.selStart&&this.selStart<=a||n<this.selEnd&&this.selEnd<a||n>=this.selStart&&a<=this.selEnd)&&this.objectsSelected.push(i)),i.rangeData&&i.rangeData.start<=this.selStart&&this.selEnd<=i.rangeData.end&&(this.currRange=i.rangeData),(n<=this.selStart&&this.selStart<=a||n<this.selEnd&&this.selEnd<a||n>=this.selStart&&a<=this.selEnd)&&this.currentFocusedObject.push(i),t>0&&(i.prev=e," "!==s&&(e.next=i,e=i))," "!==s&&(e=i),this.objectArray.push(i)}}}};
function toggleRef(e,t){if(e.length>0){var n=e[0],r=e[e.length-1],o=e[0].mode<4?4:2,i=(e[0].mode+(t?3:1))%o;return e.forEach(function(e){e.content=convertReferencing(e.content,i)}),{reconstruct:!0,startObj:n,endObj:r}}return{}}function convertReferencing(e,t){var n=regexCollection.cellRangeForReferenceToggling.exec(e),r=n[2]?(1===t||3===t?"$":"")+n[2]:"";return r+=n[4]?(1===t||2===t?"$":"")+n[4]:""}function selectRange(e,t){return 0>t?void 0:e.length>t?{reconstruct:!1,startObj:e[t],endObj:e[t]}:void 0}function selectCurrentRange(e){return e?{reconstruct:!1,startObj:e,endObj:e}:void 0}function getNearRange(e,t,n){for(var r=-1,o=0;o<e.length;o++)if(elem=e[o],n){if(!(elem.start<t))break;r=o}else if(-1===r&&elem.start>t){r=o;break}return-1===r&&(r=n?e.length-1:0),selectRange(e,r)}function enableFormulaControl(e){e.el.id!==gridFormulaEditController.getTarget()&&appEvent.trigger("formulaEditController.register",[e.el.id,!0,e])}var formulaEditController=function(e){function t(){return"DIV"===y.nodeName}function n(){return y===cellField||y===exprField}function r(){if(K.origStr!==x){var e=y.selectionStart,n=y.selectionEnd;t()?formulaDecorator.constructSpansAndHighlightRanges(K,y):y.value=K.origStr,x=K.origStr,y.setSelectionRange(e,n)}}function o(){D||(y.addEventListener("keydown",s),y.addEventListener("paste",l),y.addEventListener("input",l),y.addEventListener("mousedown",l),y.addEventListener("mouseup",a),D=!0)}function i(){D&&(y.resetUndoRedoStacks&&y.resetUndoRedoStacks(),y.removeEventListener("keydown",s),y.removeEventListener("paste",l),y.removeEventListener("input",l),y.removeEventListener("mousedown",l),y.removeEventListener("mouseup",a),D=!1)}function l(){RangeSelector.isActive()&&(RangeSelector.off(),RangeSelector.allowToUpdateRange(!1)),j="="===y.value.charAt(0),V(j),j&&(R(),c(),g())}function a(){j="="===y.value.charAt(0),j&&(R(),c(),g())}function c(){if(y.selectionStart===y.selectionEnd&&j){var e=K.focusedObject[0];if(e.end===y.selectionStart){var n=" "===e.content?e.prev:e,r=isUndefined(n.next)?" ":n.next.content,o=n.content,i=o.substr(o.length-1),l=r.substring(0,1),a=""!=i&&-1!=="(;,.!=+-/*<>&^".indexOf(i),c=-1!==");,=+-/*<>&^ ".indexOf(l),g=/^("[^"]+)$/.test(o);a&&c&&!g?(RangeSelector.on(O()),RangeSelector.allowToUpdateRange(!0),RangeHighlighter.removeActiveStatetoColorSelection(),t()&&formulaDecorator.addRangeSelectorCue()):RangeSelector.isActive()&&(RangeSelector.off(),RangeSelector.allowToUpdateRange(!1))}else RangeSelector.isActive&&(RangeSelector.off(),RangeSelector.allowToUpdateRange(!1))}}function g(){j&&!RangeSelector.isActive()&&(K.currRange?t()?RangeHighlighter.setActiveStatetoColorSelection(formulaDecorator.getStyleForRange(K.currRange.content).color):RangeHighlighter.drawDashedSelectionWithRangeName(K.currRange.content):(RangeHighlighter.removeActiveStatetoColorSelection(),RangeHighlighter.clearDashedSelection()))}function u(){return K.currRange}function s(e){var t=y.value;if("="===t.charAt(0)){var n=e.keyCode?e.keyCode:e.which;if(-1===U.indexOf(n)){var r=y.selectionStart!==y.selectionEnd&&-1!==L.indexOf(n);if(!r&&!RangeSelector.isActive()&&(R(),(38===n||40===n)&&(c(),RangeSelector.isActive()))){e.preventDefault();var o=38===n?currRow-1:currRow+1;RangeSelector.setRange(o,currCol)}}switch(!0){case 35===n:case 36===n:case 37===n:case 38===n:case 39===n:case 40===n:clearTimeout(i);var i=setTimeout(function(){R(),g()},0)}if(115==n||84==n&&e.altKey&&e.metaKey){R();var l=toggleRef(K.selectedObjects,e.shiftKey,y.selectionStart!==y.selectionEnd);d(l),e.preventDefault(),e.stopPropagation()}if(9===n&&(os_windows?e.ctrlKey:e.altKey)){R();var l=getNearRange(K.wholeRanges,e.shiftKey?y.selectionStart:y.selectionEnd,e.shiftKey?!0:!1);d(l),e.preventDefault(),R(),g()}if(68===n&&(os_windows?e.ctrlKey:e.metaKey)){R();var l=selectCurrentRange(K.currRange);d(l),e.preventDefault()}if(n>=48&&57>=n&&(os_windows?e.ctrlKey:e.metaKey||e.ctrlkey)){R();var a=n-48;k=10*k+a,K.wholeRanges.length<k&&(k=a);var l=selectRange(K.wholeRanges,k-1);d(l),clearTimeout(T),T=setTimeout(function(){k=0},300),e.preventDefault(),R(),g()}}}function d(e){e&&(e.reconstruct&&(S(),y.undoRedoRecord&&y.undoRedoRecord(),r()),(e.startObj||e.endObj)&&m(e.startObj.start,e.endObj.end),RangeSelector.isActive()&&RangeSelector.off())}function f(e){getObj(e)!==y&&(E(),y=getObj(e),h())}function v(){return H.isDifferentObject(y.value,y.selectionStart,y.selectionEnd)}function R(){v()&&(H.set(y.value,y.selectionStart,y.selectionEnd),K=H.get(),r())}function h(){y&&setTimeout(function(){j="="===y.value.charAt(0),o(),j&&(R(),g())},0)}function S(){var e="";K.allObjects.forEach(function(t,n,r){e+=t.content,t.start=0==n?0:r[n-1].end,t.end=t.start+t.content.length}),K.origStr=e}function m(e,t){y.setSelectionRange(e,t)}function E(){y&&(i(),H.set("",0,0),N=void 0,y=void 0,x=void 0,j=!1,RangeSelector.isActive()&&RangeSelector.off(),RangeHighlighter.clearAllColorSelection())}function p(e){var t=K.wholeRanges[e],n=y.value;RangeHighlighter.removeActiveStatetoColorSelection(),RangeSelector.isActive()||RangeSelector.on(O(),!0),RangeSelector.setText(n,t.start,t.end)}function C(){var e=y.selectionStart,t=y.selectionEnd;y.focus(),y.setSelectionRange(e,t),R(),g()}function F(){t()&&formulaDecorator.highlightRanges(K)}function b(){return y?y.id:null}function w(){return j}function A(e){N=e,N.el=y}function O(){var e;return e=n()?{directInput:!0,multiRangeSelection:!0,removeSourceSheetName:!0,skipReregisterCheck:!0,onupdate:function(e){setCellFieldWidth(),updateCellFieldAndExprField(y),setCellFieldValue(e)}}:N,e.el=y,e}var T,x,y=getObj(e),j=!1,D=!1,k=0,H=new funcParser,K=H.get(),U=[16,17,18,19,20,91,93],L=[37,38,39,40],N=void 0,V=function(){function e(e){if(e=!!e,e!==t){var r=y.selectionStart,o=y.selectionEnd,i=y.value;y.value=i,y.setSelectionRange(r,o),t=e,t?F():(hideFlashDIV(),RangeHighlighter.clearAllColorSelection()),n()&&!isCellFieldSPANHided()&&(initCellFieldStyles(i),setCellFieldWidth())}}var t=!1;return e}();return{on:h,off:E,getTarget:b,isDiv:t,changeTarget:f,setRangeSelectionInindex:p,setRangeSelectionOptions:A,checkAndEnableRangeSelector:c,isFormula:w,parseText:R,setFocus:C,rehighlightRanges:F,getCurrentRange:u,previewCurrRange:g}},gridFormulaEditController=formulaEditController("cF"),convertFormulaReferencing=function(){function e(e,o){r.set(e,0,e.length);var i=r.get();return t(i,o),n(i),i.origStr}function t(e,t){var n=e.selectedObjects;n.length>0&&n.forEach(function(e){e.content=convertReferencing(e.content,t)})}function n(e){var t="";e.allObjects.forEach(function(e){t+=e.content}),e.origStr=t}var r=new funcParser;return e}();appEvent.on("cellField.MouseUp exprField.MouseUp cellField.focus exprField.focus formula.insertFunction formulaEditController.register",function(e){gridFormulaEditController.changeTarget(e),gridFormulaEditController.isFormula()&&gridFormulaEditController.previewCurrRange()}),appEvent.on("formulaSuggest.ValueChanged RangeSelector.ValueChanged undoRedo.ValueChanged cellField.focus formula.insertFunction formulaEditController.register",function(e,t,n){isUndefined(e)||e!=gridFormulaEditController.getTarget()||(gridFormulaEditController.on(),n&&gridFormulaEditController.setRangeSelectionOptions(n),t&&setTimeout(function(){gridFormulaEditController.checkAndEnableRangeSelector()},0))}),appEvent.on("book.onaftersheetswitch",function(){isCellFieldSPANHided()||gridFormulaEditController.rehighlightRanges()}),appEvent.on("RangeSelector.onValueChange",function(){if(gridFormulaEditController.isFormula()&&gridFormulaEditController.isDiv()&&RangeSelector.isActive()){gridFormulaEditController.parseText();var e=gridFormulaEditController.getCurrentRange();if(e){var t,n=getDataFromRangeText(e.content);RangeHighlighter.addColorDataEntry("RS","index",e.index),CURRSHEETNAME===n.sheetName&&(t=formulaDecorator.getStyleForRange(e.content).color),appEvent.trigger("FormulaHighlightRangeSelector.colorChange",[t])}}}),appEvent.on("cell.onBeforeSubmit cell.escapeEdit exprField.escapeEdit",function(){gridFormulaEditController.off()}),appEvent.on("cell.focus",function(){exprField.id==gridFormulaEditController.getTarget()&&gridFormulaEditController.off()});
var undoManager=function(e,t){this.undoStack=[],this.redoStack=[],this.Timer={KeyPress:void 0,Delete:void 0},this.el=e,this.el.undoRedoRecord=this.record.bind(this),this.el.resetUndoRedoStacks=this.resetStacks.bind(this),this.props=t,this.recordForKeyPress=!0,this.recordForDelete=!0,this.el.addEventListener("keydown",this.key.down.bind(this)),this.el.addEventListener("keypress",this.key.press.bind(this)),this.el.addEventListener("keyup",this.key.up.bind(this))};undoManager.prototype={record:function(){var e=this.get();""!==e.value&&(this.undoStack.push(e),this.redoStack=[])},undo:function(){this.undoStack.length>0&&(this.redoStack.push(this.get()),this.set(this.undoStack.pop()),this.callBack())},redo:function(){this.redoStack.length>0&&(this.undoStack.push(this.get()),this.set(this.redoStack.pop()),this.callBack())},resetStacks:function(e){this.undoStack=[],this.redoStack=[],e&&this.record()},callBack:function(){appEvent.trigger("undoRedo.ValueChanged",[this.el.id,!0])},get:function(){var e=this.el,t={};return this.props.forEach(function(s){t[s]=e[s]}),t},set:function(e){if(!e)return!1;var t=this.el;return this.props.forEach(function(s){t[s]=e[s]}),!0},key:{down:function(e){var t=e.keyCode?e.keyCode:e.which;if(e.metaKey||e.ctrlkey)switch(t){case 89:e.preventDefault(),this.redo();break;case 90:e.preventDefault(),e.shiftKey?this.redo():this.undo();break;case 86:case 88:this.record()}8!==t&&46!==t||!this.recordForDelete||(this.record(),this.recordForDelete=!1)},press:function(){this.recordForKeyPress&&(this.record(),this.recordForKeyPress=!1),setTimeout(function(){clearTimeout(this.Timer.KeyPress),this.Timer.KeyPress=setTimeout(function(){this.recordForKeyPress=!0}.bind(this),300)}.bind(this),0)},up:function(){this.recordForDelete||(clearTimeout(this.Timer.Delete),this.Timer.Delete=setTimeout(function(){this.recordForDelete=!0}.bind(this),300))}}};
var TextAreaShims=function(e){function t(e){for(var t,n=[e],o="";t=n.pop();)if("BR"==t.nodeName)o+=String.fromCharCode(10);else if(3==t.nodeType)o+=t.textContent;else for(var i=t.childNodes.length;i--;)n.push(t.childNodes[i]);return o}function n(e){var n=t(e);return n.replace(/(\n)$/,"")}function o(e,t){e.innerHTML="";for(var n=t.split("\n"),o=0;o<n.length;o++){var i=n[o];e.appendChild(document.createTextNode(i)),o<n.length-1&&(e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("")))}}function i(e,t){o(e,t),e.appendChild(document.createElement("br"))}function a(e){setTimeout(function(){e.lastChild&&"br"===e.lastChild.nodeName.toLowerCase()||e.appendChild(document.createElement("br"))},T)}function c(e){a(e.target)}function r(e){Object.defineProperty(e,"value",{get:function(){return n(this)},set:function(t){"="!==t.charAt(0)?i(e,t):formulaDecorator.setInDiv(t,this)}})}function d(e){var t=window.getSelection(),n=t.getRangeAt(0),o=n.cloneRange();return o.selectNodeContents(e),o}function s(e){var n=e.cloneContents();return t(n).length}function l(e){var t=window.getSelection(),n=d(e);return n.setEnd(t.anchorNode,t.anchorOffset),s(n)}function f(e){var t=window.getSelection(),n=d(e);return n.setEnd(t.focusNode,t.focusOffset),s(n)}function u(e){Object.defineProperty(e,"selectionStart",{get:function(){var e=window.getSelection();return e.rangeCount>0&&(this.cachedSelectionStart=l(this)),this.cachedSelectionStart},set:function(e){this.cachedSelectionStart=e,this.setSelectionRange(e,this.selectionEnd)}})}function h(e){Object.defineProperty(e,"selectionEnd",{get:function(){var e=window.getSelection();return e.rangeCount>0&&(this.cachedSelectionEnd=f(this)),this.cachedSelectionEnd},set:function(e){this.cachedSelectionEnd=e,this.setSelectionRange(this.selectionStart,e)}})}function g(e){e.setSelectionRange=function(e,t){p(this,e,t)},e.select=function(){e.setSelectionRange(0,this.value.length)},u(e),h(e)}function p(e,t,n){var o=t>n;o&&(n=t+n,t=n-t,n-=t);var i=e.value,a=i.length;n=n>a?a:n;var c=S(e,t,n),r=window.getSelection();if(r.extend)o?v(c.focus,c.anchor):v(c.anchor,c.focus);else{var d=document.createRange();d.setStart(c.anchor.node,c.anchor.offset),d.setEnd(c.focus.node,c.focus.offset),r.removeAllRanges(),r.addRange(d)}}function v(e,t){var n=window.getSelection();e&&n.collapse(e.node,e.offset),t&&n.extend(t.node,t.offset)}function S(e,t,n){for(var o,i=0,a=[e],c=!1,r=!1,d={};!r&&(o=a.pop());)if("BR"===o.nodeName&&i++,3===o.nodeType){var s=i+o.length;!c&&t>=i&&s>=t&&(d.anchor={node:o,offset:t-i},c=!0),c&&n>=i&&s>=n&&(d.focus={node:o,offset:n-i},r=!0),i=s}else for(var l=o.childNodes.length;l--;)a.push(o.childNodes[l]);return d}function m(e){e.preventDefault();var t="";t=window.clipboardData?window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData.getData("text/plain"),C(document.createTextNode(t))}function w(e){new undoManager(e,["value","selectionStart","selectionEnd"])}function E(e){r(e),e.value="",g(e),e.addEventListener("keypress",c,!1),e.addEventListener("paste",m,!1),w(e)}function C(e){var t=window.getSelection(),n=t.getRangeAt(0);n.deleteContents(),n.collapse(!0),n.insertNode(e),n.setStartAfter(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}function N(){C(document.createElement("br")),C(document.createTextNode(""))}var T=10;e.addTextAreaProperties=E,e.setTextForElement=o,e.insertElementAtSelection=C,e.insertLineBreakAtSelection=N}(window);addTextAreaProperties(getObj("cF")),addTextAreaProperties(getObj("Tv"));
var colorChoser=function(t){function n(t){return u[t]||u.push(Math.floor(16777215*Math.random()).toString(16).toUpperCase()),u[t]}function r(t){return t?(o[t]={color:n(e++)},o[t]):{color:"000000"}}var o={},e=0,u=t||[];this.getIndex=function(){return e},this.get=function(t){return o[t]?o[t]:r(t)},this.reset=function(){o={},e=0}};
var formulaDecorator=function(){function e(e){var t=getDataFromRangeText(e);if(WorkSheets.isNameExists(t.sheetName))return(t.sheetName+"."+getCellLabel(t.sR,t.sC)+":"+getCellLabel(t.eR,t.eC)).toUpperCase()}function t(t){return t=e(t),t?s.get(t):{}}function n(e,t){o(e.origStr,t),"="===e.origStr.charAt(0)&&c(e)}function o(e,t){s.reset(),t.innerHTML="";var n=document.createDocumentFragment();"="===e.charAt(0)?r(n,e):setTextForElement(n,e),n.appendChild(document.createElement("br")),t.appendChild(n)}function r(e,t){var n=t.match(regexCollection.matchRegex)||[],o="";return n.forEach(function(t){regexCollection.rangeRegex.test(t)||regexCollection.enclosedByQuotes.test(t)?(a(e,o),l(e,t),o=""):o+=t}),""!==o&&a(e,o),e}function a(e,t){var n=document.createElement("span");return setTextForElement(n,t),e.appendChild(n),n}function l(e,n){var o=a(e,n),r=regexCollection.enclosedByQuotes.test(n);r?(o.style.color="#005713",o.style.fontStyle="italic"):o.style.color="#"+t(n).color}function c(e){e.wholeRanges.forEach(function(e){var n=t(e.content).color;RangeHighlighter.drawColorSelectionWithRangeName(e.content,n),RangeHighlighter.addColorDataEntry(n,"index",e.index)}),RangeHighlighter.clearAllColorSelection(s.getIndex())}function i(e,t){o(e,t)}function g(){if(!getObj("RSCue")){var e=window.getSelection(),t=e.getRangeAt(0);t.deleteContents();var n=document.createElement("span");n.id="RSCue",t.insertNode(n),t=t.cloneRange(),t.setStartBefore(n),t.setEndBefore(n),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}}{var s=new colorChoser(["5883DA","E5575B","A43FBC","5B9C27","11A9CC","F7900C","BD4F90","2B799C","AC3135","5F5F5F","0D6856","9B8C2B","3FD0B4","F2B405","4B10AC","65765A","9258F1","795011","584A71","EF3964"]);new funcParser}return{getStyleForRange:t,setInDiv:i,addRangeSelectorCue:g,highlightRanges:c,constructSpansAndHighlightRanges:n}}();
window.onblur=function(){unsetStatus()};var clientDim=findClientDim(),clientWidth=clientDim.width,clientHeight=clientDim.height,resizeTimeout;window.onresize=function(){clientDim=findClientDim(),clientWidth=clientDim.width,clientHeight=clientDim.height,clearTimeout(resizeTimeout),resizeTimeout=setTimeout(function(){getObj("mainOuterDiv")&&(getObj("mainOuterDiv").style.width=clientWidth+"px"),resetPageDim("WIN_RESIZE")},250)},$(document.body).bind("focus",function(i){if(browser_nn6){if(jsEMBED_VIEW)return;var e=i.target;(e==document||e==window)&&"undefined"!=typeof ole&&ole.currObj&&ole.conf.onfocus()}}),window.onerror=function(i,e,t,n,o){appEvent.trigger("window.error",[i,e,t,n,o])};
var Thread=function(){this.holders=[]};Thread.prototype={wait:function(a){var r={};r.method=a,r.params=Array.prototype.slice.call(arguments,1),this.holders.push(r)},notifyAll:function(){for(var a=this.holders.length,r=0;a>r;)this.holders[r].method.apply(void 0,this.holders[r].params),r+=1;this.flush()},flush:function(){this.holders=[]}};var globalThreads={};globalThreads.init=function(){var a=new Thread;globalThreads.scroll=a},globalThreads.init(),Thread.getThread=function(a){switch(a){case"scroll":break;default:showAlertDialog("Give me Valid Thread Name")}return globalThreads[a]};
var documentSettings=function(e){var t,n,a,o,r,i=function(){var t=new AjaxRequest,n=new RequestParameters(ActionConstants.JSP_DOCUMENT_SETTING);t.init("POST",n.getURL(),!0,n.getParametersAsString()),t.addEventListener("onComplete",function(t){var n={width:500,modal:!0,title:jsMsg["File.DocumentSettings"],maxHeight:e(window).height()/2};sheetdialog.open(t.responseText,n),BLOCK_RTL||(document.getElementById("dispDir").value="true"==writingDirection?jsMsg.Rtl:jsMsg.Ltr)}),t.sendRequest()},s=function(){var e=(getAvailableStartRow(),getAvailableEndRow(),getCellRange());ftnLocaleLang=document.getElementById("langList").value;var t=ftnLocaleLang+"_"+document.getElementById("countrylist").value,n=document.getElementById("timezone").value,a=document.getElementById("setAsDefault"),o=!1;if(a.checked&&(o=a.value),ClipObject.removeClipInServer(),v(),BLOCK_RTL&&(r=!1),t!=workBookLocale||n!=workBookTimeZone||a.checked||JSON.parse(r)!=JSON.parse(writingDirection)&&!BLOCK_RTL){var i=new RequestParameters(ActionConstants.DOCUMENT_SETTING);i.setParameters(WorkSheets.getAssociatedActiveSheetName(),e.startRow,e.startCol,e.endRow,e.endCol,t,n,o,r);var s=new AjaxRequest;s.init("POST",i.getURL(),!0,i.getParametersAsString()),actionManager.addRequest(s)}sheetdialog.close()},c=function(o){var r=(getObj("currency"),getObj("comma"),o.clientUpdateJson,o.USERCURRENCY,o.thousandSeparator),i=o.currencySymbol;decSymbol=o.decimalSeparator,n=o.currencyCode,a=jsMsg["CURRENCYNAME."+n],t=o.dateSeparator,userDateFormatType=o.dateFormatType,46==t?userDateSeparator=".":47==t?userDateSeparator="/":45==t&&(userDateSeparator="-");{var s=o.newCustomizedLocale,c=o.newLocaleCountryName,u=o.newTimeZone,m=o.previousTimeZone,p=o.previousLocale;e("#currency").children().first().text(),e("#currencymenu"),new Object}docLocale=s,l(r),"undefined"==typeof a&&(a=n),(p!=s||m!=u)&&(d(i,s,c,a,n),userCurrencySymbol=i)},u=function(){sheetdialog.close()},l=function(t){thousandSeparator=t;var n=e("#comma").children().first();e("#comma").find("span").first().text("( "+t+" )"),n.hasClass("ui-icon-zcomma")?n.removeClass("ui-icon-zcomma"):n.hasClass("ui-icon-zdot")?n.removeClass("ui-icon-zdot"):n.hasClass("ui-icon-zsinglequote")?n.removeClass("ui-icon-zsinglequote"):n.hasClass("ui-icon-zspac")&&n.removeClass("ui-icon-zspac"),44==t.charCodeAt()?n.addClass("ui-icon-zcomma"):46==t.charCodeAt()?n.addClass("ui-icon-zdot"):39==t.charCodeAt()?n.addClass("ui-icon-zsinglequote"):160==t.charCodeAt()&&n.addClass("ui-icon-zspac"),t=t},d=function(t,n,a,o,r){var i=getObj("currency");if(i){{new Object}i.setAttribute("currencyType",n),e(i).find("span").first().text(t),e(i).attr("title",e(i).find("span").first().text()),e(i).metadata().appData.dynamic=!0,changetooltip(i,o),m(t,a,n,!1,o,r)}},m=function(t,n,a,o,r){var i=0,s=new Object;"Rs."==t&&(t="Rs"),e(s).attr("id",a),e(s).attr("data","{icon:'bold',iconText:'"+t+"',label:'"+r+"', appData:{dynamic:true,callback: 'format_new',arg: '168,"+a+",this'}}"),e("#currencymenu li").each(function(){t==e(this).find("span").first().text()&&(t=e(this).find("span").first().text(),i=1)});{var c=e("#currencymenu").children().first();c.clone()}e("#currencymenu").children().length>8&&e("ul#currencymenu li:first").remove();var u=e("#currencymenu");if(0==i){e("#menuitem_currency").children().first().html(t);var l=function(){u.zmenu("addMenuItem",s,1)};menutabListener.doAction(TOOLBAR.FORMAT,{id:"currencymenu",action:"addmenuItem",callback:l}),e(u).prepend(e("#"+a)),o=!1}p(t)},p=function(t){e("#currencymenu li").removeClass("menuActive");var n=null;"$"==t?n="DOLLAR":t==unescape("%u20AC")?n="EURO":t==decodeURIComponent("%C2%A3")?n="POUND":""==t?n="YEN":8377===t.charCodeAt(0)?n="RUPEE":"&#xFFE5;"==t&&(n="YUAN"),null==n&&(n=docLocale);var a="#"+n;e(a).addClass("menuActive")},g=function(){var t=new RequestParameters(ActionConstants.JSP_DATETIMEMENU),n=(t.getURL()+"?"+t.getParametersAsString(),new AjaxRequest);n.init("POST",t.getURL(),!0,t.getParametersAsString()),n.addEventListener("onComplete",function(t){if(t.responseText){var n=getObj("datetimemenu"),a=n.parentNode;a.removeChild(n);var o=t.responseText;e("#dtcontent").html(o),e.ZToolbarHandler.init(["#datetimemenu"])}}),n.sendRequest()},C=function(t){e("#datetimemenu").hide(),appEvent.trigger("showFormatCellsDialog",["",t])};appEvent.on("documentLoad",function(e){var r=e;localizedFunctionName=JSON.parse(r.workbook.localeFunctionName),docLocale=r.workbook.docLocale,t=r.workbook.dateSeparator,userThousandSeparator=r.workbook.thousandSeparator,userDateFormatType=r.workbook.dateFormatType,userCurrencySymbol=r.workbook.currencySymbol,n=r.workbook.currencyCode,a=jsMsg["CURRENCYNAME."+n],o=r.workbook.userLocaleCountry,decSymbol=r.workbook.decimalSeparator,timeFormat=JSON.parse(r.workbook.timeFormat),userDateSeparator=46==t?".":47==t?"/":"-","undefined"==typeof a&&(a=n),p(userCurrencySymbol)}),appEvent.on("setCurrencyFormat",function(e){p(e)}),appEvent.on("setUserThousandSep",function(e){l(e)}),appEvent.on("updateServerResponse",function(e){g(),c(e),localizedFunctionName=e.localeFunctionName,timeFormat=e.timeFormat,v()});var v=function(){null!=document.getElementById("dispDir")&&(r=document.getElementById("dispDir").value,r==jsMsg.Rtl?r=!0:r==jsMsg.Ltr&&(r=!1))};return{init:i,submitSettings:s,cancelSettings:u,userCurrencySymbolSettings:d,showMoreFormat:C,translateDispDir:v}}(jQuery);
function VisualCueCellsInfo(){this.cellsJson=[]}function VisualCue(){this.cellsInfo=new VisualCueCellsInfo}VisualCueCellsInfo.prototype={add:function(e,t,s,r,o,n,i,l,a,c){for(var u=!1,h=this.cellsJson.length-1;h>=0;h--){var v=this.cellsJson[h];if(v.vcID===e){u=!0,v.sheetName=t?t:v.sheetName,v.row=null!==s?s:v.row,v.col=null!==r?r:v.col,v.erow=null!==o?o:v.erow,v.ecol=null!==n?n:v.ecol,v.colorCode=i?i:v.colorCode,v.pane=""===l||l?l:v.pane,v.zuid=a?a:v.zuid,v.dname=c?c:v.dname;break}}u||this.cellsJson.push({vcID:e,sheetName:t,row:s,col:r,erow:o,ecol:n,colorCode:i,pane:l,zuid:a,dname:c})},remove:function(e){for(var t=this.cellsJson.length-1;t>=0;t--)if(this.cellsJson[t].vcID==e){this.cellsJson.splice(t,1);break}},removeAll:function(){this.cellsJson=[]},get:function(e){for(var t=this.cellsJson.length-1;t>=0;t--)if(this.cellsJson[t].vcID==e)return this.cellsJson[t]},getByZuid:function(e){for(var t=[],s=this.cellsJson.length-1;s>=0;s--)this.cellsJson[s].zuid==e&&t.push(this.cellsJson[s]);return t}},VisualCue.prototype={show:function(e,t){if(WMSREQ_RECEIVE_COUNT++,e&&e.vcID){var s=e.vcID,r=e.zuid,o=e.sheetName,n=e.row,i=e.col,l=e.erow,a=e.ecol,c="null"!==e.colorCode?e.colorCode:getColorCode(e.zuid),u=e.dname;"undefined"!=typeof r&&(userColorCode[r]=c),o==CURRSHEETNAME?this.isPresent(s)?this.change(e):this.create(e):this.remove(s),isUndefined(o)||t||this.cellsInfo.add(s,o.trim(),n,i,l,a,c,null,r,u)}},showAll:function(){for(var e=this.getCellsJson(),t=e.length,s=0;t>s;s++)this.show(e[s])},create:function(e){var t=this.getVisualCueDivFragment(e),s=this.getProperty(e);this.setAllProperty(t,s),this.registerEvent(t,e.vcID),this.append(t,s,e.vcID)},append:function(e,t,s,r){e&&(isUndefined(r)&&(r=getSheetPane(t.row,t.col),r=4==r?"":r),this.cellsInfo.add(s,null,null,null,null,null,null,r),this.getParentDiv(r).appendChild(e),this.handleFreezePanesTopLeft(e,r))},handleFreezePanesTopLeft:function(e,t){if(thirdPaneTop||secondPaneLeft){var s=-1*thirdPaneTop+"px",r=-1*secondPaneLeft+"px";switch(t){case 1:e.style.marginLeft=0,e.style.marginTop=s=0;break;case 2:e.style.marginTop=s=0,e.style.marginLeft=r;break;case 3:e.style.marginLeft=0,e.style.marginTop=s;break;default:e.style.marginLeft=r,e.style.marginTop=s}}},setNameDIVTop:function(e){var t=$(e).children()[0];if(t){var s=parseInt($(e).css("marginTop")),r=parseInt($(e).css("top")),o=jsVERSION_VIEW?"-12px":"-10px";$(t).css("top",r+s>0?o:"0px")}},changeCursor:function(e,t,s){if(e){var r=getRowPosInMouseEvent(e),o=getColPosInMouseEvent(e),n=getCursorPos(e),i=n.x,l=n.y,a=getCell(r,o),c=getHyperLinkInCell(a),u=c.childTag;if(u&&isObject(u)&&u.tagName&&"A"==u.tagName.toUpperCase())if(CellUtils.checkBoundaryForTextInDiv(i,l,a)){s.style.cursor="pointer";var h=c.title;s.title=h}else s.style.cursor="",s.title=""}},change:function(e){var t=e.vcID,s=this.getVisualCueDiv(t),r=this.getProperty(e);this.setAllProperty(s,r),this.setNameDIVTop(s);var o=this.cellsInfo.get(t).pane,n=getSheetPane(r.row,r.col);if(n=4==n?"":n,o!=n){var s=this.getVisualCueDiv(t);this.switchPane(s,o,n,t)}},switchPane:function(e,t,s,r){this.getParentDiv(t).removeChild(e),this.append(e,null,r,s)},handleFreeze:function(e,t,s){var r=this.getCellsJson(),o=r.length;switch(e){case"ROWS":for(var n=0;o>n;n++){var i=this.getVisualCueDiv(r[n].vcID);i&&(r[n].row<t?this.switchPane(i,"",2,r[n].vcID):this.handleFreezePanesTopLeft(i,""))}break;case"COLS":for(var n=0;o>n;n++){var i=this.getVisualCueDiv(r[n].vcID);i&&(r[n].col<s?this.switchPane(i,"",3,r[n].vcID):this.handleFreezePanesTopLeft(i,""))}break;case"ROWS/COLS":for(var n=0;o>n;n++){var i=this.getVisualCueDiv(r[n].vcID);i&&(r[n].row<t&&r[n].col<s?this.switchPane(i,"",1,r[n].vcID):r[n].row<t?this.switchPane(i,"",2,r[n].vcID):r[n].col<s?this.switchPane(i,"",3,r[n].vcID):this.handleFreezePanesTopLeft(i,"",r[n].vcID))}}},handleUnFreeze:function(){for(var e=this.getCellsJson(),t=e.length-1;t>=0;t--)if(e[t].sheetName==CURRSHEETNAME){var s=e[t].vcID,r=this.getVisualCueDiv(s);""!=e[t].pane&&(this.getParentDiv(e[t].pane).removeChild(r),this.cellsInfo.add(s,null,null,null,null,null,null,""),this.getParentDiv("").appendChild(r)),isRTL?r.style.marginRight=0:r.style.marginLeft=0,r.style.marginTop=0}},remove:function(e){if(this.isPresent(e)){var t=this.getVisualCueDiv(e),s=this.cellsInfo.get(e).pane;this.getParentDiv(s).removeChild(t),this.cellsInfo.remove(e)}},removeByZuid:function(e){for(var t=this.cellsInfo.getByZuid(e),s=0,r=t.length;r>s;s++)this.remove(t[s].vcID)},removeAll:function(){for(var e=1;4>=e;e++){var t=4==e?"":e;$(userPresence.getParentDiv(t)).empty()}this.cellsInfo.removeAll()},getVisualCueDivFragment:function(e){var t=e.vcID,s="#"+userColorCode[e.zuid],r=$("<div/>",{class:"vcD",id:t+"_vcD",style:"border-color:"+s+";z-index: 260;"});return $("<div/>",{class:"vcND",id:t+"_vcND",style:"border-color:"+s+";background:"+s+";display:none;",text:e.dname}).appendTo(r),r.get(0)},isOwnDiv:function(e){return"vcD"==e.className||"vcND"==e.className},isPresent:function(e){var t=this.getVisualCueDiv(e);return t?!0:!1},getVisualCueDiv:function(e){return getObj(e+"_vcD")},getParentDiv:function(e){var t;switch(e){case 1:t=userPresencePane1;break;case 2:t=userPresencePane2;break;case 3:t=userPresencePane3;break;default:t=userPresencePane}return t},getProperty:function(e){if(e){var t=e.row,s=e.col,r=e.erow,o=e.ecol;r||o||(r=t,o=s);var n=Merge.getCellInfo(t,s);n&&(r=n.endRow,o=n.endCol);var i=getCellRangeDIM(parseInt(t),parseInt(s),parseInt(r),parseInt(o)),l=i.height+1,a=i.width+1,c=i.left-1,u=i.top-1,h={row:t,col:s,erow:r,ecol:o,left:c,top:u,width:a,height:l};return h}},setProperty:function(e,t,s){e.style[t]=s},setAllProperty:function(e,t){e&&(e.style[isRTL?"right":"left"]=t.left+"px",e.style.top=t.top+"px",e.style.width=t.width+"px",e.style.height=t.height+"px")},tuneDivsHeight:function(e){for(var t=this.getCellsJson(),s=t.length-1;s>=0;s--)if(t[s].row>=e){var r=this.getVisualCueDiv(t[s].vcID);if(r){var o=this.getProperty(t[s]);this.setProperty(r,"height",o.height+"px"),this.setProperty(r,"top",o.top+"px")}}},tuneDivsWidth:function(e){for(var t=this.getCellsJson(),s=t.length-1;s>=0;s--)if(t[s].col>=e){var r=this.getVisualCueDiv(t[s].vcID);if(r){var o=this.getProperty(t[s]);this.setProperty(r,"width",o.width+"px"),this.setProperty(r,"left",o.left+"px")}}},handleMerge:function(e,t){for(var s=this.getCellsJson(),r=s.length-1;r>=0;r--)if(s[r].row===e&&s[r].col===t){var o=this.getVisualCueDiv(s[r].vcID);if(o){var n=this.getProperty(s[r]);this.setAllProperty(o,n)}}},registerEvent:function(e,t){var s=getChildNode(e,0);e.onmouseover=function(){var r=$("#fD").css("zIndex");r&&(clearTimeout($(s).stop().data("timer")),$(s).css("opacity","1")),VisualCue.prototype.setNameDIVTop(e),VisualCue.prototype.showVisualCueNameDIV(s);var o=userPresence.cellsInfo,n=o.get(t);n&&Annot.show(n.row,n.col)},e.onmouseout=function(){VisualCue.prototype.hideVisualCueNameDIV(s),Annot.hide()},e.onmousemove=function(t){VisualCue.prototype.changeCursor(t,s,e)},e.onmousedown=function(){}},showVisualCueNameDIV:function(e){e&&(e.style.display="")},hideVisualCueNameDIV:function(e){e&&$(e).fadeOut()},getCellsJson:function(){return this.cellsInfo.cellsJson}},VisualCue.prototype.constructor=VisualCue;var userPresence=new VisualCue;userPresence.row=-1,userPresence.col=-1,userPresence.HOLD_ON_TIME=1e3,userPresence.send=function(e){var t=getCellRange();if(READ_WRITE&&WebMessanger.getRawSid()&&""!=COLLAB_ID&&"null"!=COLLAB_ID&&(e||userPresence.row!=t.startRow||userPresence.col!=t.startCol)&&!isErrorDoc){var s={},r=zuid,o=LOGIN_FULL_NAME;(REMOTE.ISRMVIEW||-1==zuid||""==zuid)&&(r=RMUSER,o=WebMessanger.getNickName()),s[ActionConstants.USER_PRESENCE]=[WebMessanger.getRawSid(),CURRSHEETNAME,t.startRow,t.startCol,t.endRow,t.endCol,o,r,currUserColor,isCellEdited()],userPresence.row=t.startRow,userPresence.col=t.startCol;var n={a:s};WMSREQ_SEND_COUNT++,WebMessanger.sendMessage(COLLAB_ID,JSON.stringify(n))}},userPresence.create=function(e){VisualCue.prototype.create.call(this,e),appEvent.trigger("visualcue.createAndShow",[e.row,e.col,e.vcID])},userPresence.show=function(e){CollabPanel.isAllowed()&&(VisualCue.prototype.show.call(this,e),appEvent.trigger("visualcue.show",[e.row,e.col,e.vcID]))};var auditTrail=new VisualCue;auditTrail.rangeJson=[],auditTrail.getVisualCueDivFragment=function(e){var t=e.vcID,s="#"+e.colorCode,r=$("<div/>",{class:"atD",id:t+"_vcD",style:"border-color:"+s+";"});return $("<div/>",{class:"atND",id:t+"_vcND",style:"border-color:"+s+";background:"+s+";display:none;",text:e.dname}).appendTo(r),$("<div/>",{class:"atIND",style:"border-top-color:"+s}).appendTo(r),r.get(0)},auditTrail.change=function(e){var t=e.vcID,s=this.getVisualCueDiv(t),r="#"+e.colorCode;s.style.borderColor=r;var o=s.getElementsByClassName("atND")[0];o.style.borderColor=r,o.style.background=r,o.textContent=e.dname,s.getElementsByClassName("atIND")[0].style.borderTopColor=r},auditTrail.getProperty=function(e){if(e){var t=e.row,s=e.col,r=getCellDIM(parseInt(t),parseInt(s)),o={row:t,col:s,left:r.left,top:r.top-1,width:r.width-1,height:r.height};return o}},auditTrail.isOwnDiv=function(e){return"atD"==e.className};
var cellIndicator=function(e){var t=void 0,l=function(){t=e("#Trc"),t.on("keyup",function(e){i(e)}).on("keydown",function(e){n(e)}).on("focus",function(e){r(e)}).on("blur",function(){o()})},n=function(e){var t=e.which;if(9===t)return!1;if(13===t){isCellEdited()&&submitCell();var l=currCellIndicator.value.trim();l=l.replace(".","!"),currCellIndicator.blur();var n=l,i=CURRSHEETNAME;if(-1!==l.indexOf("!")&&(i=n.substring(0,n.indexOf("!")),n=n.substring(n.indexOf("!")+1,n.length)),CellUtils.checkCellRef(n))return Goto.gotoCellInit(n,"PARAM"),!1;if(-1!==l.indexOf("!")&&i.trim().toUpperCase()===CURRSHEETNAME.toUpperCase()&&(l=n),CellUtils.isSupportedName(l,"DEFINE_NAME")||!isNaN(l.charAt(0))){var r=jsMsg.InvalidName+"\n";return r+="	",r+="- "+jsMsg.CellNamecannotstartwithnumbers,r+="\n	",r+="- "+jsMsg.CellNamecannotbeassameasZohoOfficedefinedcelllabels,showAlertDialog(r),void currCellIndicator.focus()}var a=CURRSHEETNAME,o="";if(isCellRange()){var s=getCellRange();o=CellUtils.constructCellName(s.startRow,s.startCol,s.endRow,s.endCol,!0),focusCellRange(s.startRow,s.startCol,s.endRow,s.endCol,void 0,!0)}else{var c=ActiveCellInfo,d=c.getStartRow(),u=c.getStartCol();o=CellUtils.constructCellName(d,u,void 0,void 0,!0),focusCell(currRow,currCol)}-1!==a.indexOf(" ")&&(a="'"+a+"'"),cellLoc="$"+a+"."+o;var f={SUBMODE:"ADD",CELLNAME:l,CONTENT:cellLoc};appEvent.trigger("namedrangechanged",["DEFINENAME",f])}else 27===t&&(currCellIndicator.blur(),focusCell(currRow,currCol))},i=function(e){var t=e.which;return e.shiftKey&&e.ctrlKey&&78===t||16===t||17===t?!1:void Goto.suggestNamedRanges("Trc")},r=function(){setTimeout(function(){t.select()},50),a()},a=function(){isEditingInExprField&&submitCell();var t=NamedRange.getNamedRangesList();if(0!==t.length){t=t.sort();for(var l="<table id='definedNamerangesTBL'  width='100%' cellspacing='0' cellpadding='0' >",n=0;n<t.length;n++){var i="'"+escapeSpecialCharacters(t[n])+"'";l+="<tr id='defNameTR_"+n+"'>",l+='<td id="defNameTD_'+n+'" onClick="Goto.gotoCellInit('+i+', \'NAME\');"><a href="javaScript:;"><span>'+escapeSpecialCharacters(t[n])+"</span></a></td></tr>"}l+="</table>";var r=e("#eL").offset().top+e("#eL").height(),a=e("#definedNameListDIV");a.css("top",r),a.html(l),RTLlang&&(a.css("position","absolute"),a.css("right","0px")),a.show()}},o=function(){setTimeout(function(){e("#definedNameListDIV").hide()},200)};return l(),{initCellIndicator:l}}(jQuery);
var RangeSelector=function(e){function t(){appEvent.on("grid.mousedown",D),appEvent.on("colHead.mousedown rowHead.mousedown",B),appEvent.on("grid.rangeselect.end",W),appEvent.on("grid.rangeselect.update",Q),appEvent.on("book.onaftersheetswitch",q)}function n(){e(w).unbind("keypress.setmultirange"),e(w).unbind("keydown.RangeSelectorArrowCheck"),appEvent.off("grid.mousedown",D),appEvent.off("colHead.mousedown rowHead.mousedown",B),appEvent.off("grid.rangeselect.end",W),appEvent.off("grid.rangeselect.update",Q),appEvent.off("book.onaftersheetswitch",q)}function o(e){var t=getCaretPos(w),n=w.value;w=e,w.value=n,setCaretPos(w,t),w.focus()}function a(e){var t=getCaretPos(w);w=I,w&&(w.value=e,setCaretPos(w,t),setTimeout(function(){I.focus()},100))}function i(e){w.value=e,v&&(w.selectionStart=formulaEIdxTemp,w.selectionEnd=formulaEIdxTemp),c&&c(e)}function r(t){window.event;e(t).bind("keypress.setmultirange",function(e){var t=e.keyCode?e.keyCode:e.which;s(t)})}function l(e){var t=e.keyCode?e.keyCode:e.which;if(isRTL&&(39==t?t=37:37==t&&(t=39)),t>=37&&e.keyCode<=40&&!k)if(e.preventDefault(),e.shiftKey&&!p){var n,o=ActiveFormulaInfo.getActiveRow(),a=ActiveFormulaInfo.getActiveCol(),i=H.startRow,r=H.startCol,l=H.endRow,s=H.endCol,d=a===r,f=a===s,c=o===i,u=o===l;switch(t){case 37:case 39:var R=39===t?r:s;n=new Range(i,R,l,R);break;case 38:case 40:var g=40===t?i:l;n=new Range(g,r,g,s)}switch(Merge.extendRange(n),t){case 37:if(d){if(n.startCol-1<0)return;H.setRangeInfo(i,r,l,n.startCol-1)}else if(f){if(H.startCol-1<0)return;H.startCol-=1}break;case 39:if(f){if(n.endCol+1>=totCols)return;H.setRangeInfo(i,n.endCol+1,l,s)}else if(d){if(H.endCol+1>=totCols)return;H.endCol+=1}break;case 38:if(c){if(n.startRow-1<0)return;H.setRangeInfo(i,r,Row.findNextNonHiddenRow(n.startRow,!1),s)}else if(u){if(H.startRow-1<0)return;H.startRow=Row.findNextNonHiddenRow(H.startRow,!1)}break;case 40:if(u){if(n.endRow+1>=totRows)return;H.setRangeInfo(Row.findNextNonHiddenRow(n.endRow),r,l,s)}else if(c){if(H.endRow+1>=totRows)return;H.endRow=Row.findNextNonHiddenRow(H.endRow)}}if(37!==t&&39!==t||d||f){if(!(38!==t&&40!==t||c||u)){var v=new Range(o,r,o,s);Merge.extendRange(v);var w=v.startRow,C=v.endRow;if(38===t)if(w==i){var m=new Range(l,r,l,s);Merge.extendRange(m),H.setRangeInfo(i,r,Row.findNextNonHiddenRow(m.startRow,!1),s)}else C==l?H.setRangeInfo(l,r,Row.findNextNonHiddenRow(i,!1),s):H.setRangeInfo(i,r,Row.findNextNonHiddenRow(l,!1),s);else if(w==i)H.setRangeInfo(i,r,Row.findNextNonHiddenRow(l),s);else if(C==l){var m=new Range(i,r,i,s);Merge.extendRange(m),H.setRangeInfo(l,r,Row.findNextNonHiddenRow(m.endRow),s)}else H.setRangeInfo(l,r,Row.findNextNonHiddenRow(i),s)}}else{var h=new Range(i,a,l,a);Merge.extendRange(h);var S=h.startCol,I=h.endCol;if(37===t)if(S==r){var m=new Range(i,s,l,s);Merge.extendRange(m),H.setRangeInfo(i,r,l,m.startCol-1)}else I==s?H.setRangeInfo(i,s,l,r-1):H.setRangeInfo(i,r,l,s-1);else if(S==r)H.setRangeInfo(i,r,l,s+1);else if(I==s){var m=new Range(i,r,l,r);Merge.extendRange(m),H.setRangeInfo(i,s,l,m.endCol+1)}else H.setRangeInfo(i,s,l,r+1)}}else{var E=ActiveFormulaInfo;switch(t){case 37:if(e.altKey)return switchSheet.doSwitch(RTLlang?"next":"prev"),!1;var x=E.getActiveRow(),b=E.getStartCol()-1;b>=0&&(ActiveFormulaInfo.set(x,b),H.setRangeInfo(x,b,x,b));break;case 38:var b=E.getActiveCol(),x=Row.findNextNonHiddenRow(E.getStartRow(),!1);x>=0&&(ActiveFormulaInfo.set(x,b),H.setRangeInfo(x,b,x,b));break;case 39:if(e.altKey)return switchSheet.doSwitch(RTLlang?"prev":"next"),!1;var x=E.getActiveRow(),b=E.getEndCol()+1;totCols>b&&(ActiveFormulaInfo.set(x,b),H.setRangeInfo(x,b,x,b));break;case 40:var b=E.getActiveCol(),x=Row.findNextNonHiddenRow(E.getEndRow());totRows>x&&(ActiveFormulaInfo.set(x,b),H.setRangeInfo(x,b,x,b))}}}function s(e){if(clearCellRangeFill(),H.init(),v){var t=[",",";",":"];-1!==t.indexOf(String.fromCharCode(e))&&(A=!0)}}function d(e,t,n,o){q();var a=C?CURRSHEETNAME:void 0,i=CellUtils.constructCellName(e,t,n,o,b,a);if(v){var r=Math.max(formulaSIdxTemp,formulaEIdxTemp)>0;if(void 0===u||!r){formulaSIdxTemp=getSelectionStart(w),formulaEIdxTemp=getSelectionEnd(w);var l=w.value;u=l.substring(0,formulaSIdxTemp),R=l.substring(formulaEIdxTemp)}formulaEIdxTemp=formulaSIdxTemp+i.length,formulaCell||A||0===u.indexOf("=")?i=u+i+R:(i=i,A=!1)}return i}function f(e,t,n){S&&(w===cellField&&isCellFieldSPANHided()?(focusCellField(e),setCellFieldWidth()):w.value=e,formulaSIdxTemp=t,formulaEIdxTemp=n,u=e.substring(0,formulaSIdxTemp),R=e.substring(formulaEIdxTemp),w.selectionStart=n,w.selectionEnd=n)}var c,u,R,g,v,w,C,m,p=!1,h=!1,S=!1,I=void 0,E="",x="",b=!1,T=!1,N=!1,k=!1,A=!1,F=!1,H={data:{sR:-1,sC:-1,eR:-1,eC:-1},reset:function(){this.data={sR:-1,sC:-1,eR:-1,eC:-1}},drawFill:function(){var e=this.data;focusCellRangeFill(e.sR,e.sC,e.eR,e.eC)},setRangeInfo:function(e,t,n,o){if(n=isUndefined(n)?e:n,o=isUndefined(o)?t:o,this.data.sR!==e||this.data.sC!==t||this.data.eR!==n||this.data.eC!==o){var a=Math.min(e,n),i=Math.min(t,o),r=Math.max(e,n),l=Math.max(t,o);this.data={sR:a,sC:i,eR:r,eC:l},this.drawFill()}},init:function(){this.reset(),this.data={sR:currRow,sC:currCol,eR:currRow,eC:currCol},ActiveFormulaInfo.set(currRow,currCol)},set startRow(e){0>e||(this.data.sR=e,this.drawFill())},set startCol(e){0>e||(this.data.sC=e,this.drawFill())},set endRow(e){e>=totRows||(this.data.eR=e,this.drawFill())},set endCol(e){e>=totCols||(this.data.eC=e,this.drawFill())},get startRow(){return this.data.sR},get startCol(){return this.data.sC},get endRow(){return this.data.eR},get endCol(){return this.data.eC}},M=function(e,n){(!S||e.el!==I||e.skipReregisterCheck)&&(O(n),S=!0,w=I=e.el,T=e.allowSheetSwitch,k=!!e.disableArrowSupport,c=e.onupdate,p=e.single,b=e.isAbsoluteRef,g=e.directInput,v=e.multiRangeSelection,C=e.appendSheetName,m=e.callback,N=e.removeSourceSheetName,r(I),appEvent.trigger("rangeselector.on",[e]),t())},j=function(){O(),resetCellRangeFill(),S=!1,A=!1,F=!1,e(w).unbind("keypress.setmultirange"),e(w).unbind("keydown.RangeSelectorArrowCheck")},y=function(){return S},P=function(){if(w)var e=w.value;m&&m(e)},O=function(e){p=!1,k=!1,h=!1,S=!1,I=void 0,m=void 0,c=void 0,E="",x="",N=!1,F=!1,n(),clearCellRangeFill(),e||H.init(),b=!1,T=!1,v=void 0,C=void 0,A=!1},U=function(){return p},K=function(){return cellPrevState?cellPrevState.sourceSheet:void 0},V=function(){-1===sRange.value.indexOf("=")&&RangeSelector.goNormal()},D=function(e){return e.target!==w&&S?F?void sheetSwitchBeforeSubmit(!1):(L(),focusCellRangeInit(e),appEvent.preventDefault()):void 0},L=function(){if(v){var e=w,t=Math.max(formulaSIdxTemp,formulaEIdxTemp)>0;t||(formulaSIdxTemp=getSelectionStart(e),formulaEIdxTemp=getSelectionEnd(e));var n=e.value;u=n.substring(0,formulaSIdxTemp),R=n.substring(formulaEIdxTemp)}},B=function(){L()};appEvent.on("cell.focus",function(){S&&H.init()}),appEvent.on("RangeSelector.RowColSelect",function(e,t,n){switch(t>n&&(t+=n,n=t-n,t-=n),e){case"Row":H.setRangeInfo(t,0,n,getColMax()-1);break;case"Col":H.setRangeInfo(0,t,getRowMax()-1,n)}});var Q=function(e,t,n,o){H.setRangeInfo(e,t,n,o),i(d(e,t,n,o));var a=C?CURRSHEETNAME:void 0,r=CellUtils.constructCellName(e,t,n,o,b,a);appEvent.trigger("RangeSelector.onValueChange",[r]),appEvent.trigger("RangeSelector.ValueChanged",[w.id])},W=function(){if(S){var e=w.value,t=Math.max(formulaSIdxTemp,formulaEIdxTemp)>0,n=t?formulaEIdxTemp:e.length;setCaretPos(w,n)}},q=function(){RangeSelector.isActive()&&cellPrevState&&(C=!(N&&cellPrevState.sourceSheet===CURRSHEETNAME))},z=function(e){e||(F=!0)};return{on:M,off:j,setText:f,isActive:y,isRangeSelectionSupported:U,setTargetElement:o,revokeTargetElement:a,functionCallback:P,setMultiRange:s,returnsourceSheet:K,inputValidate:V,setRange:H.setRangeInfo.bind(H),arrowKeyDownCheck:l,allowToUpdateRange:z}}(jQuery);appEvent.on("book.onbeforesheetswitch book.sheetloaded cell.focus",function(){isCellEdited()||RangeSelector.isActive()||(cellPrevState={sourceSheet:CURRSHEETNAME,row:currRow,col:currCol,val:currCellValue})}),appEvent.on("book.onbeforesheetswitch",function(){isCellEdited()&&!RangeSelector.isActive()&&cellPrevState.sourceSheet===CURRSHEETNAME&&submitCell()});
var DataValidation=function(){function t(){Se.listview=!1,ne(Ne),O()}function e(t,e,n){var t=parseInt(t),e=parseInt(e),i=$(getCell(t,e));if(i){var o=i.hasClass("dvInfo");o?$("#"+n+"_vcD").addClass("dvInfo"):$("#"+n+"_vcD").removeClass("dvInfo")}}function n(t,e){var n=userPresence.cellsInfo.cellsJson;if(n)for(var t=parseInt(t),e=parseInt(e),i=0;i<n.length;i++)if(t===parseInt(n[i].row)&&e===parseInt(n[i].col))return n[i].vcID;return!1}function o(t){null===Le&&(Le=new Array),t&&Le.push(t)}function r(){return null!==Le?Le.shift():void 0}function l(){return null===Le||0===Le.length}function a(){Le&&(Le.length=0,Le=null)}function s(t,e,n){var i=n?n:CURRSHEETNAME,o=v(i);null===o&&(o=new Array),o[t]=e,u(n,o)}function d(t){var e=v(CURRSHEETNAME);return e.hasOwnProperty(t)?e[t]:null}function c(t,e){isUndefined(e)&&(e=CURRSHEETNAME);var n=v(e);return null===n?!1:n.hasOwnProperty(t)?(delete n[t],!0):!1}function u(t,e){null===me&&(me=new Array),me[t]=e}function v(t){return me&&me.hasOwnProperty(t)?me[t]:null}function f(t){return t&&me.hasOwnProperty(t)?(delete me[t],!0):!1}function p(t,e){var n=me;if(e&&t){var i=e;if(n&&n.hasOwnProperty(i)){var o=n[i];for(var r in o)if(o.hasOwnProperty(r)){var l=CellUtils.getCellPosByLabel(r);-1!==parseInt(l.row)&&-1!==parseInt(l.col)&&DataValidation.util.isIntersect(parseInt(l.row),parseInt(l.col),t)&&delete o[r]}}}}function g(){return null===me}function h(t,e,n){if(g()===!1){var i=v(CURRSHEETNAME);if(null===i)return;var o=getCellLabel(t,e);i.hasOwnProperty(o)&&R(t,e,d(o),n)}}function C(t){var e=t[JSONConstants.DATAVALIDATION_ERROR];if(t[ActionConstants.CELL]){var n=t[ActionConstants.CELL][0],i=(n[JSONConstants.VALUE],n.r),r=n.c,a=e[JSONConstants.DATAVALIDATION_ERRORMSG],s="DIALOG_RETRY_CANCEL";if(e[JSONConstants.DATAVALIDATION_ISSTOPEDIT]===!0)if(Ie.dvError||Ie.retry||"datavalerrordialog"===sheetdialog.getDialogName()&&sheetdialog.isDialogOpen()||!l())o(t);else{if(Ie.dvPending=!0,Ie.dvError=!0,Ie.dvfocusRow=i,Ie.dvfocusCol=r,t.sn!==CURRSHEETNAME)var d=replaceParams(jsMsg["DataVal.SheetSwitchResponseOnError"],["<b>"+t.sn+"."+getCellLabel(parseInt(i),parseInt(r))+"</b>"])+"</br>",c=!0;else focusCell(Ie.dvfocusRow,Ie.dvfocusCol),Ie.currRespObj=t;V(s,a,c,d)}}}function E(t){if(!isUndefined(t)){var e=t[JSONConstants.DATAVALIDATION_ERROR];if(t[ActionConstants.CELL]&&e){var n=t[ActionConstants.CELL][0],i=(n[JSONConstants.VALUE],n.r,n.c,e[JSONConstants.DATAVALIDATION_ERRORMSG]),o=getCellLabel(parseInt(n.r),parseInt(n.c));s(o,i,t.sn),t.sn===CURRSHEETNAME&&R(parseInt(n.r),parseInt(n.c),i)}}}function R(t,e,i,o,r){if(isUndefined(o))var l=getCell(t,e);else l=o;l&&null!==l.getAttribute("dv")&&($(l).addClass("dvInfo"),r||l.removeAttribute("emsg"),setTimeout(function(){var i=n(t,e);i&&$("#"+i+"_vcD").addClass("dvInfo")},100),!r&&i&&l.setAttribute("emsg",i))}function D(t,e){var i=getCell(t,e);if(i&&null!==i.getAttribute("dv")&&null!==i.getAttribute("emsg")){$(i).removeClass("dvInfo");var o=n(t,e);o&&$("#"+o+"_vcD").removeClass("dvInfo"),i.removeAttribute("emsg")}}function w(t,e){if(Ie.currRespObj){var n=Ie.currRespObj[ActionConstants.CELL][0];if((isUndefined(t)||isUndefined(e))&&(t=currRow,e=currCol),n&&n.r===t&&n.c===e){if(!isUndefined(Ie.currRespObj[JSONConstants.DATAVALIDATION_ERROR])){var i=getCell(n.r,n.c);updateCellDataJson(i,n,n.r,n.c),ye&&$(i).addClass("highlightInvalid"),ENABLE_SAVE_MESSAGE&&showSaveMessage("disable")}Ie.retry=!1,Ie.dvPending&&A()}}}function A(){if(Ie.retry=!1,l())Ie.dvPending=!1,Ie.dvfocusRow=-1,Ie.dvfocusCol=-1,Ie.dvError=!1,Ie.currRespObj=null,a();else{var t=r();if(Ie.dvPending=!0,t&&(Ie.currRespObj=t,t.sn===CURRSHEETNAME)){var e=t[JSONConstants.DATAVALIDATION_ERROR],n=t[ActionConstants.CELL][0];Ie.dvError=!0,Ie.dvfocusRow=parseInt(n.r),Ie.dvfocusCol=parseInt(n.c),focusCell(Ie.dvfocusRow,Ie.dvfocusCol),V("DIALOG_RETRY_CANCEL",e[JSONConstants.DATAVALIDATION_ERRORMSG])}}}function I(){Ie.retry=!0,Ie.dvError=!1,$("#save_message_display").hide(),Re=0,sheetdialog.close();var t=currCell.getAttribute("cV")?currCell.getAttribute("cV"):currCellValue;cellField.value=t,clearTextSelection(),focusCellField(t),setSelectionRange(cellField,0,t.length)}function S(){Ie.retry=!1,Re=2,sheetdialog.close()}function m(){if(Ie.dvError&&(Ie.dvError=!1,2===Re)){if(resetGlobalVariables(),Ie.currRespObj&&!isUndefined(Ie.currRespObj[JSONConstants.DATAVALIDATION_ERROR])){var t=Ie.currRespObj[ActionConstants.CELL][0],e=getCell(t.r,t.c);updateCellDataJson(e,t,t.r,t.c),ye&&$(e).addClass("highlightInvalid"),ENABLE_SAVE_MESSAGE&&showSaveMessage("disable")}Ie.dvPending&&A()}Re=2}function L(){if(Se.listview&&(T(),!DataValidation.isDvCacheEmpty()&&Se.listDropDown)){var t=ActiveCellInfo,e=t.getStartRow(),n=t.getStartCol(),i=getCellPosInPage(e,n);Ne.css(isRTL?{top:i.top,right:i.left,left:"",width:ActiveCellInfo.getWidth()}:{top:i.top,left:i.left,right:"",width:ActiveCellInfo.getWidth()})}if(Oe){var o=DataValidation.getTopLeftForHint();if(o){var r=o.left,l=o.top,a=$("#hintCallout");a.css(isRTL?{top:l+"px",right:r+"px",left:""}:{top:l+"px",left:r+"px",right:""})}}}function N(){var t=document.createElement("div");t.style.position="absolute",t.className="dvListIconContainer",t.id="dvListIconContainer";var e=document.createElement("img");return $(e).css({position:"absolute",cursor:"pointer",right:"1px",bottom:"1px",maxWidth:"100%",maxHeight:"100%",zIndex:15+BASEZINDEX}),t.appendChild(e),Se.listIconContainer=t}function T(t,e){var n=getObj("dvIP"),i=Se.listIconContainer?Se.listIconContainer:N();$(n).empty();var o=i.cloneNode(!0),r=isUndefined(t)?currRow:t,l=isUndefined(e)?currCol:e,a=Merge.getCellInfo(r,l);isUndefined(a)||(r=a.endRow,l=a.endCol);var s=getRowTop(r),d=getRowHeight(r);o.style.height=d+"px",o.style.width=getColWidth(l)+"px",o.style.left=getColLeft(l)+"px",o.style.top=s+"px",n.appendChild(o);var c=o.childNodes[0];c.style.right="-14px",c.src=IMAGE_PATH+"list_dropdown1.png",c.onclick=ae,c.id="dvListDropSrc",b()}function b(){if(ISFREEZED){var t=dvListIconsPane.innerHTML;dvListIconsPane2.innerHTML=t,dvListIconsPane1.innerHTML=t,dvListIconsPane3.innerHTML=t;var e=dvListIconsPane1.childNodes,n=dvListIconsPane2.childNodes,i=dvListIconsPane3.childNodes;e[0].childNodes[0].onclick=ae,n[0].childNodes[0].onclick=ae,i[0].childNodes[0].onclick=ae,browser_ie&&(e[0].onmousedown=sheetMouseDown,n[0].onmousedown=sheetMouseDown,i[0].onmousedown=sheetMouseDown)}}function O(){dvListIconsPane.innerHTML="",ISFREEZED&&(dvListIconsPane1.innerHTML="",dvListIconsPane2.innerHTML="",dvListIconsPane3.innerHTML="")}function V(t,e,n,i){DataValidation.hintCallOutHide();var o=e.length<25?265:400,r={autoOpen:!1,width:o,resizable:!1,title:jsMsg["Service.ZohoOffice"],close:function(){m()},contextmenu:!1,hidetoolbar:!0,sheetswitch:!1,allowtoscroll:!1};xe.dtype=t,e=replaceParams(e,[getCellLabel(Ie.dvfocusRow,Ie.dvfocusCol)]),xe.errormsg=e,xe.hideButtons=n,xe.diffSheetAlert=i,sheetdialog.open("datavalerrordialog",r,xe)}function y(){DataValidation.isDvCacheEmpty()||(ie(Ne),Se.listval=null,Se.partnum=0,Se.tparts=0,Se.noOfItems=0,De=null,we=null,Ae=null)}function x(t,e,n,i,o,r,l,a){isUndefined(o)&&(o=CURRSHEETNAME);var s;s=a?a:new Range(t,e,n,i),n>availableEndRow&&(n=availableEndRow,t=availableStartRow);var d=new Range(t,e,n,i),u=d.getIterator();u.iterate(function(n,i){var a=!1,s=$(getCell(n,i));if(s.removeClass("highlightInvalid").removeClass("dvAnimation"),r&&("MergeDown"===l&&n===t||"MergeAcross"===l&&i===e||n===t&&i===e)){var d=getCellLabel(n,i);c(d),D(n,i),a=!0}if(a===!1)if(o===CURRSHEETNAME){var u=getCell(n,i);if(u&&null!==u.getAttribute("dv")){var d=getCellLabel(n,i);if(c(d),D(n,i),u.removeAttribute("dv"),Merge.getCellInfo(n,i)){var v=getCell(n,i,void 0,!1);v.removeAttribute("dv"),$(v).removeClass("highlightInvalid").removeClass("dvAnimation")}parseInt(currRow)===n&&parseInt(currCol)===i&&DataValidation.checkCurrCellFocusForDv(),DataValidation.isDvCacheEmpty()||Ae===CURRSHEETNAME&&DataValidation.util.isIntersect(n,i,De)&&y()}}else{var d=getCellLabel(n,i);c(d,o)}}),g()||p(s,o)}function H(t,e){null!==t&&t.setAttribute("dv",e)}function M(t,e){if(e){var n=e.getAttribute("dv");null!==n&&(n=decodeURIComponent(n))}var i=e?n:null;if(null!==i){var o=parseJSON(i);Oe=!0;var r=o.hint?o.hint:"";if(r&&r.length>25){var l=r.replace(/.{20}\S*\s+/g,"$&@").split(/\s+@/);r=l.join("\n")}var a=$("#hintCallout"),s=a.find("div#eMsg");s.text("").hide(),DataValidation.showHintTextCallout(r);var d=e.getAttribute("emsg");d&&s.text(d).show();var c=DataValidation.getTopLeftForHint();if(c){var u=c.left,v=c.top;a.css(isRTL?{top:v+"px",right:u+"px",left:"","box-shadow":"3px 0 0 rgb(199, 199, 199)","text-align":"right"}:{top:v+"px",left:u+"px",right:"","box-shadow":"","text-align":""})}}}function _(){var t=document.createElement("div");t.setAttribute("id","hintCallout"),t.setAttribute("class","dvtoolTip"),t.style.position="absolute",t.style.zIndex=1e3+BASEZINDEX,t.style.display="none";var e=document.createElement("span");$(e).append(document.createElement("b")),$(e).find("b").text(jsMsg["DataVal.DV"]+": ");var n=$(document.createElement("div"));n.css("display","none"),n.attr("id","eMsg"),n.css("color","red"),$(e).append(n);var i=document.createElement("div");$(i).css({"margin-top":"2px",width:"170px"}),$(t).append($(e)),$(t).append($(i)),document.body.appendChild(t)}function U(t,e){if(!isUndefined(t)){var n=t.getIterator();n.iterate(function(t,n){P(t,n,e)})}}function P(t,e,n){var i=getCell(t,e);if(i&&n){var o="{";isUndefined(n[JSONConstants.CV_HINT])||(o+='"hint":"'+n[JSONConstants.CV_HINT]+'"'),n.list===!0&&(isUndefined(n[JSONConstants.CV_HINT])||(o+=","),o+='"list":true'),o+="}",i.setAttribute("dv",o),t===currRow&&e===currCol&&DataValidation.checkCurrCellFocusForDv()}}function F(t,e){if(e&&t){if(e!==Se.listSrcSheet&&e!==Ae)return;for(i=0;i<t.length;i++){var n=t[i];switch(n.a){case ActionConstants.INSERT_ROW:case ActionConstants.DELETE_ROW:var o=n.si,r=o+n.count-1;we&&(o>=we.startRow&&o<=we.endRow||r>=we.startRow&&r<=we.endRow||o<=we.startRow)?y():(De&&o>=De.startRow&&o<=De.endRow||r>=De.startRow&&r<=De.endRow)&&y();break;case ActionConstants.INSERT_COL:case ActionConstants.DELETE_COL:var o=n.si,r=o+n.count-1;we&&(o>=we.startCol&&o<=we.endCol||r>=we.startCol&&r<=we.endCol||o<=we.startCol)?y():(De&&o>=De.startCol&&o<=De.endCol||r>=De.startCol&&r<=De.endCol)&&y()}}}}function J(t){t&&(t[JSONConstants.ACTION]===ActionConstants.SHEET_RENAME?(k(t[JSONConstants.OLD_SHEET_NAME],t[JSONConstants.SHEET_NAME]),DataValidation.isDvCacheEmpty()||t[JSONConstants.OLD_SHEET_NAME]!==Se.listSrcSheet||isUndefined(Se.listSrcSheet)||(Se.listSrcSheet=t[JSONConstants.SHEET_NAME],y())):t[JSONConstants.ACTION]===ActionConstants.SHEET_REMOVE&&W(t.sn))}function k(t,e){if(t&&e){var n=v(t);null!==n&&(f(t),u(e,n))}}function W(t){if(t){var e=v(t);null!==e&&f(t)}}function j(t){t&&!DataValidation.isDvCacheEmpty()&&null!==we&&(isUndefined(Se.listSrcNR)||Se.listSrcNR!==t||y())}function B(t,e,n){if(null===we||DataValidation.isDvCacheEmpty()||(isUndefined(n)&&(n=CURRSHEETNAME),Se.listSrcSheet===n&&DataValidation.util.isIntersect(t,e,we)&&y()),!g()){var i=getCellLabel(t,e);c(i)&&D(t,e)}}function G(t,e,n,i){null!==we&&Se.listSrcSheet===CURRSHEETNAME&&DataValidation.util.isRangeIntersect(new Range(t,e,n,i),we)&&y()}function q(){return Ie.dvError?!0:Ie.retry===!0?(Ie.retry=!1,submitCell(),!0):!1}function z(t,e,n,i,o,r){if(t){DataValidation.hintCallOutHide();var l=ActiveCellInfo,o=isUndefined(o)?l.getStartRow():o;o=ActiveCellInfo.isMerged()?ActiveCellInfo.getEndRow():o;var r=isUndefined(r)?l.getStartCol():r,a=getCellPosInPage(o,r);"create"===e?DataValidation.isDvCacheEmpty()?(Ne=Z(ge,n,a),i||ee(Ne)):oe(Ne)||re(Ne,!0):"append"===e&&(n&&K(Ne,n),i||ee(Ne))}if("keyup"===t.type){var s=cellField.value;ce(s)}}function Z(t,e,n){if(!e)return void(Se.listDropDown=!1);Se.listDropDown=!0;var i=$("<ul>",{id:"dvListMenu"});i.addClass("dvListMenu"),i.css({width:ActiveCellInfo.getWidth(),"min-width":cellDefaultWidth,zIndex:23e3});var o=ActiveCellInfo.isMerged()?ActiveCellInfo.getEndRow():currRow;isUndefined(n)&&(n=getCellPosInPage(o,currCol)),i.css(isRTL?{top:n.top,right:n.left,left:""}:{top:n.top,left:n.left,right:""}),i.scroll(function(t){Se.listDropDown&&$(this)[0].scrollHeight&&$(this)[0].scrollHeight-$(this).scrollTop()<=$(this).outerHeight()&&le(t,"append")});var r=X,l=Y,a=te;return i.on("mouseenter","li",r),i.on("dvListFocus","li",l),i.on("click","li",a),K(i,e,n),i}function K(t,e,n){if(!e)return void re(t,!1);var i=Se.row,o=Se.col,r=!1;Se.noOfItems+=e.length,n&&t.css(isRTL?{top:n.top,right:n.left,left:""}:{top:n.top,left:n.left,right:""});var l=t;0!==l.find("li").length&&(r=!0);for(var a=0;a<e.length;a++){var s=e[a],d=$("<li>");d.text(s),l.append(d),d=null}if(i===currRow&&o===currCol){if(!r){$(document.body).append(l);var c=l.find("li:visible").length;ue(l,c),l.find("li:visible").length<Ee?t.css("height","auto"):t.css("height","200px"),setTimeout(function(){se()},100)}if(Te===!0&&r===!0){var s=cellField.value;ce(s,void 0,r)}}else Se.listDropDown=!1,ne(l)}function X(t){var e=t.target||t.srcElement;if(t.preventDefault(),browser_ie){var n=cellField.id;if(document.activeElement.getAttribute("id")!==n){var i=currCell.getAttribute("cV")?currCell.getAttribute("cV"):currCellValue;focusCellField(i)}}$(e).trigger("dvListFocus")}function Y(t){var e=t.target||t.srcElement;if(pe&&(pe.removeClass("dvListHover"),ve.removeClass("dvListHover"),fe.removeClass("dvListHover")),$(e).addClass("dvListHover"),ve=$(e).prev("li"),Te===!0&&!ve.is(":visible")){var n=Ne.find(ve).index();ve=Ne.find("li:lt("+n+"):visible:last")}if(fe=$(e).next("li"),Te===!0&&!fe.is(":visible")){var n=Ne.find(fe).index();fe=Ne.find("li:gt("+n+"):visible:eq(0)")}pe=$(e)}function Q(t){var e=unescapeSpecialChar(t);cellField.value=e,exprField.value=e,DataValidation.listSubmit=!0,re(Ne,!1)}function te(t){var e=t.target||t.srcElement,n=$(e).text();DataValidation.listSubmit=!0,setSuggestValue(escapeSpecialChar(n)),re(Ne,!1)}function ee(t){t&&t.unbind("scroll")}function ne(t){t&&1===t.length&&0!==$("#"+t.attr("id")).length&&(re(t,!1),t.detach())}function ie(t){null!==t&&(ne(t),Ne&&Ne.remove(),Ne=null)}function oe(t){if(!t)return!1;if(1===t.length&&0===$("#"+t.attr("id")).length){var e=currRow,n=currCol;return t.css("width",ActiveCellInfo.getWidth()),$(document.body).append(t),re(t,!0),(e!==currRow||n!==currCol)&&ne(t),!0}return!1}function re(t,e,n){if(!t)return void(Se.listDropDown=!1);if(n||(Se.listDropDown=e),Se.listInFocus=!1,e===!0){var i=t;Te=!1,be=!1,t.show(),i.find("li").show();var o=i.find("li:visible").length;ue(t,o),Ee>o?Ne.css("height","auto"):Ne.css("height",Ce+"px"),se()}else e||n||(be=!1),t.scrollTop(0),t.hide()}function le(t,e,n,i){if(Ve!==!0)if((isUndefined(n)||isUndefined(i))&&(n=currRow,i=currCol),"append"===e||DataValidation.isDvCacheEmpty()||!DataValidation.util.isIntersect(n,i,De)){"create"===e&&y(),Se.row=n,Se.col=i;var o=new RequestParameters(ActionConstants.DATA_VALIDATION_READLIST);o.setParameters(WorkSheets.getAssociatedActiveSheetName(),n,i,Se.tparts,Se.partnum),Ae=WorkSheets.getActiveSheetName(),Ve=!0;var r=new AjaxRequest;r.init("POST",o.getURL(),!0,o.getParametersAsString()),r.addEventListener("onComplete",function(o){Ve=!1;var r=parseJSON(o.responseText),l=r.dataval;if(isUndefined(l)||$.isEmptyObject(l))z(t,"create",void 0,!1,n,i);else{0===Se.partnum&&(De=new Range(l[JSONConstants.START_ROW],l[JSONConstants.START_COLUMN],l[JSONConstants.END_ROW],l[JSONConstants.END_COLUMN]),isUndefined(l.listSrcRange)||(we=new Range(l.listSrcRange[JSONConstants.START_ROW],l.listSrcRange[JSONConstants.START_COLUMN],l.listSrcRange[JSONConstants.END_ROW],l.listSrcRange[JSONConstants.END_COLUMN]),Se.listSrcNR=l.listSrcRange[JSONConstants.NAME_OF_RANGE],Se.listSrcSheet=l.listSrcRange[JSONConstants.SHEET_NAME]));var a=l.list;if(Se.partnum=parseInt(l.partnum),Se.tparts=parseInt(l.tparts),Se.totListItems+=a.length,-1===Se.partnum&&0===l.list.length)z(t,e,void 0,!1,n,i);else{var s=-1===Se.partnum||Se.totListItems>=DV_MAX_CELLRANGE_ITEMS?!1:Se.tparts>1?!0:!1;z(t,e,a,s,n,i)}}}),r.sendRequest()}else Se.row=n,Se.col=i,z(t,e,void 0,void 0,n,i)}function ae(t){if(!Ie.dvError){if(Se.listDropDown)return void re(Ne,!1);Se.listDropDown=!0;var e=currCell.getAttribute("cV")?currCell.getAttribute("cV"):currCellValue;focusCellField(e),le(t,"create",currRow,currCol)}}function se(){if(Se.listDropDown===!0){if(null!==Ne)var t=Ne;else t=$("#dvListMenu");Se.listInFocus=!0,t.find("li:visible:eq(0)").trigger("dvListFocus"),0!==t.scrollTop()&&t.animate({scrollTop:0},100)}}function de(t){if(40===t)if(fe&&0!==fe.length){if(Math.round(pe.position().top)+he>=Ce){var e=Math.round(Ne.scrollTop());Ne.scrollTop(e+he)}fe.is(":visible")&&fe.trigger("dvListFocus")}else Ne.animate({scrollTop:0},100),Ne.find("li:visible:eq(0)").trigger("dvListFocus");else if(38===t){if(ve&&0!==ve.length){if(Math.round(pe.position().top)-he<0){var e=Math.round(Ne.scrollTop());Ne.scrollTop(e-he)}ve.is(":visible")&&ve.trigger("dvListFocus")}}else if(13===t||9===t){if(pe&&0!==pe.length)return Q(escapeSpecialChar(pe.text())),!0}else if(27===t)resetGlobalVariables(),re(Ne,!1),DataValidation.isDvRetryMode()&&(focusCell(currRow,currCol),w());else if(36===t)se();else if(35===t){var n=Ne[0].scrollHeight;Ne.animate({scrollTop:n},100),Ne.find("li:visible:last").trigger("dvListFocus")}return!1}function ce(t,e,n){if("="===t)return void re(Ne,!1);if(Se.listDropDown&&Ne){if(0===t.trim().length)return void re(Ne,!0);t=t.toLowerCase(),8===e&&Te?Ne.show().find("li:hidden").filter(function(){return 0===$(this).text().toLowerCase().indexOf(t)}).show():8!==e&&Te?Ne.find("li:visible").filter(function(){return 0!==$(this).text().toLowerCase().indexOf(t)}).hide():Ne.show().find("li").hide().filter(function(){return 0===$(this).text().toLowerCase().indexOf(t)}).show();var i=Ne.find("li:visible");Te=i.length!==Ne.find("li").length,0!==i.length?(be=!1,n||se(),i.length<Ee?Ne.css("height","auto"):Ne.css("height","200px"),ue(Ne,i.length)):(be=!0,re(Ne,!1,be))}}function ue(t,e){if(null!==t){var n=getCellPosInPage(currRow,currCol),i=n.top,o=n.left,r=$(currCell).height(),l=parseInt(findClientDim().height)-(parseInt(i)+parseInt(r)),a=200;if(Ee>=e&&(a=e*he),a>l)t.css("top",i-(a+r+10)+"px"),t.css(isRTL?{right:o+"px",left:""}:{left:o+"px",right:""});else{var s=ActiveCellInfo,d=ActiveCellInfo.isMerged()?s.getEndRow():s.getStartRow(),c=s.getStartCol(),u=getCellPosInPage(d,c);u&&t.css(isRTL?{top:u.top,right:u.left,left:""}:{top:u.top,left:u.left,right:""})}}}var ve,fe,pe,ge="dvListMenu",he=20,Ce=200,Ee=10,Re=2,De=null,we=null,Ae=null,Ie={dvfocusRow:-1,dvfocusCol:-1,dvError:!1,retry:!1,dvPending:!1,currRespObj:null},Se={listview:!1,listDropDown:!1,listSrcSheet:void 0,listSrcNR:void 0,listIconContainer:void 0,partnum:0,tparts:0,listInFocus:!1,row:-1,col:-1,totListItems:0},me=null,Le=null,Ne=null,Te=!1,be=!1,Oe=!1,Ve=!1,ye=!1,xe={dtype:"",errormsg:"",hideButtons:"",diffSheetAlert:"",init:function(){setTimeout(function(){var t=(xe.dtype,xe.errormsg);if(xe.hideButtons&&xe.diffSheetAlert)$("#stopmsg").text(t),$("#stopmsgDiffSheet").html("<br>"+xe.diffSheetAlert).show(),$("#stopdiv").find(":button").hide();else{$("#stopmsg").text(t),$("#stopmsgDiffSheet").html("");var e=$("#stopdiv").find("button");$(e[0]).bind("click",function(){I()}),$(e[1]).bind("click",function(){S()}),$("#stopdiv").find(":button:eq(0)").focus()}$("#save_message_display").hide()},200)}};return $(document).ready(function(){_()}),appEvent.on("grid.shift",function(){L()}),appEvent.on("grid.afterColumnResize",function(){L()}),appEvent.on("namedrangechanged",function(t,e){var n=e.n;n&&(n=n.replace(/\"/g,""),n=n.replace(/\'/g,""),j(n))}),appEvent.on("range.focus cell.focus",function(){DataValidation.checkCurrCellFocusForDv()}),appEvent.on("cell.clear",function(t){if(!g()){var e=getCellLabel(t.row,t.col);c(e),D(t.row,t.col)}var n=$(getCell(t.row,t.col));n&&n.removeClass("highlightInvalid").removeClass("dvAnimation")}),appEvent.on("cell.dataUpdate",function(t,e,n,i){if(B(t,e,n),isHighlightInvalidData===!0){var o=$(getCell(t,e));o&&o.removeClass("highlightInvalid").removeClass("dvAnimation"),i===!1&&DataValidation.highlightInvalidCell(t,e)}}),appEvent.on("range.onBeforeMerge",function(t){var e=t.SR,n=t.SC,i=t.ER,o=t.EC,r=t.mergeOption,l=!0;x(e,n,i,o,void 0,l,r)}),appEvent.on("range.clearcontent",function(t,e,n,i){G(t,e,n,i)}),appEvent.on("cell.onBeforeSubmit",function(t){var e=t.row,n=t.col,i=t.v,o=getCell(e,n);if(o)var r=o.getAttribute("dv");if(r){var l=parseJSON(r);if(!g()){var a=getCellLabel(e,n);c(a),D(e,n)}Ie.retry===!1&&(ye=!1,$(o).hasClass("highlightInvalid")&&(ye=!0,$(o).removeClass("highlightInvalid").removeClass("dvAnimation")));var s=encodeURIComponent(i);("%08"===s||"%09"===s||"%0A"===s||"%0D"===s)&&(i=""),DataValidation.listSubmit===!0&&l.list===!0&&(0===i.indexOf("'")&&(i=i.replace(/'/,"''")),DataValidation.validateDV=!1,DataValidation.listSubmit=!1)}else DataValidation.validateDV=void 0}),appEvent.on("datavalidation.stopError",function(t){C(t)}),appEvent.on("datavalidation.infoError",function(t){E(t)}),appEvent.on("server.response.workbookLevelAction",function(t){J(t)}),appEvent.on("range.update",function(t,e){F(t,e)}),appEvent.on("range.clearAll",function(t,e,n,i){x(t,e,n,i)}),appEvent.on("book.onaftersheetswitch",function(){DataValidation.hintCallOutHide(),Se.listDropDown&&ne(Ne)}),appEvent.on("grid.afterload",function(){currCell=getCell(cursor_Row_Index,cursor_Col_Index),setTimeout(function(){DataValidation.checkCurrCellFocusForDv()},300),a(),y()}),appEvent.on("datavalidation.infoForCollobarators",function(t,e){if(!e&&!isUndefined(t[ActionConstants.CELL])&&0!==t[ActionConstants.CELL].length&&(!isUndefined(t.sn)&&CURRSHEETNAME!==t.sn||!isUndefined(t.s)&&WorkSheets.getAssociatedActiveSheetName()!==t.s)&&!g())for(var n=0;n<t[ActionConstants.CELL].length;n++)if(isUndefined(t[ActionConstants.CELL][n].r))for(var i=t.sr;i<=t.er;i++)for(var o=t.sc;o<=t.ec;o++){var r=getCellLabel(i,o);c(r,t.sn)&&D(i,o)}else{var l=t[ActionConstants.CELL][n].r,a=t[ActionConstants.CELL][n].c,r=getCellLabel(l,a);c(r,t.sn)&&D(l,a)}}),appEvent.on("cell.datavalidationClear",function(t){for(var e=t,n=0;n<e.length;n++){var i=isUndefined(t.sn)?isUndefined(t.s)?void 0:WorkSheets.getSheetNameFromCode(t.s):t.sn;x(e[n].sr,e[n].sc,e[n].er,e[n].ec,i)}}),appEvent.on("cell.datavalidationApply",function(t){var e=t;if(!isUndefined(e))for(var n=0;n<e.length;n++){var i=new Range(e[n].sr,e[n].sc,e[n].er,e[n].ec);U(i,e[n])}}),appEvent.on("visualcue.createAndShow",function(t,n,i){e(t,n,i)}),appEvent.on("visualcue.show",function(t,n,i){e(t,n,i)}),appEvent.on("grid.cellFieldKeyDown",function(t){var e=browser_ie?window.event.keyCode:t.which;27===e&&DataValidation.isDvHintVisible()===!0&&DataValidation.hintCallOutHide()}),appEvent.on("cell.escapeEdit",function(t,e){DataValidation.isDvRetryMode()===!0&&w(t,e)}),appEvent.on("sheet.verticallyScrolled",function(){DataValidation.checkDVHintPosition()}),appEvent.on("sheet.horizontallyScrolled",function(){DataValidation.checkDVHintPosition()}),appEvent.on("cell.setDataValidation",function(t,e,n,i){if(H(n,i),h(t,e,n),"undefined"!=typeof AuditTrail&&("undefined"==typeof AuditTrail.isCloseVersionHistory||AuditTrail.isCloseVersionHistory===!0)&&isHighlightInvalidData===!0){var o=$.parseJSON(i);o.contentValid===!1&&DataValidation.highlightInvalidCell(t,e,n)}}),appEvent.on("grid.beforeInsertRowOrColumn",function(){var t=q();return t===!0?(Ie.retry=!1,appEvent.preventDefault()):void 0}),appEvent.on("grid.onBeforeInsertCol",function(){var t=q();return t===!0?(Ie.retry=!1,appEvent.preventDefault()):void 0}),appEvent.on("grid.afterRowResize",function(){L()}),appEvent.on("cell.onBeforeFocusCellfield  cell.keyUp  cell.keyDown grid.mousedown cell.focusFillSeries exprField.keyDown colHead.mousedown rowHead.mousedown",function(){return DataValidation.isDvErrorThrown()?appEvent.preventDefault():void 0}),appEvent.on("grid.focusRow grid.focusCol",function(t){DataValidation.checkCurrCellFocusForDv(void 0,void 0,t)}),appEvent.on("cell.showDvList",function(t){var e=currCell;return Se.listview&&null!==e.getAttribute("dv")?(ae(t),appEvent.preventDefault()):void 0}),appEvent.on("grid.cFKeyDownInDvCell",function(t){if(Se.listDropDown&&!DataValidation.isDvListNoResults()){var e=browser_ie?window.event.keyCode:t.which,n=!0;return 38===e||40===e||13===e||35===e||36===e||27===e||9===e?Se.listInFocus===!1?se():n=de(e):Se.listInFocus=!1,n?!1:appEvent.preventDefault()}}),appEvent.on("grid.cFKeyUpInDvCell",function(t){var e=browser_ie?window.event.keyCode:t.which;if(Se.listDropDown){if(!(e>=35&&40>=e)&&13!==e&&27!==e&&18!==e){t.preventDefault();var n=cellField.value;return ce(n,e),appEvent.preventDefault()}}else{var i=currCell.getAttribute("dv"),o=$.parseJSON(i);if(o&&o.list&&27!==e&&!Se.listDropDown){var r=ActiveCellInfo.getStartRow(),l=ActiveCellInfo.getStartCol();return le(t,"create",r,l),appEvent.preventDefault()}}return!1}),appEvent.on("updateServerResponse",function(){y()}),appEvent.on("initVersionView",function(){Se.listview&&t(),Oe&&DataValidation.hintCallOutHide(),isHighlightInvalidData===!0&&$(".highlightInvalid").removeClass("highlightInvalid").removeClass("dvAnimation")}),{validateDV:void 0,isDvErrorThrown:function(){return Ie.dvError===!0},isDvRetryMode:function(){return Ie.retry===!0},getDvListCacheRange:function(){return De},isDvListNoResults:function(){return be===!0},checkDVHintPosition:function(){if(Se.listDropDown&&ne(Ne),Oe){var t=$("#hintCallout");if(t&&0!==t.length){var e=DataValidation.getTopLeftForHint();if(e){{var n=(parseInt(isRTL?t.css("right"):t.css("left")),parseInt(t.css("top")),e.top),i=e.left;screen.width,screen.height}t.css("top",n+"px"),t.css(isRTL?{right:i+"px","box-shadow":"3px 0 0 rgb(199, 199, 199)","text-align":"right",top:n+"px"}:{left:i+"px","box-shadow":"","text-align":"",top:n+"px"});var o=n-sheetTop,r=i-rowHeadWidth;0>o||0>r?t.hide():t.show()}}}},checkCurrCellFocusForDv:function(e,n,i){if(!(jsSHARE_VIEW&&!ALLOW_TO_WRITE||jsVERSION_VIEW)){-1===Ie.dvfocusRow||-1===Ie.dvfocusCol||currRow===Ie.dvfocusRow&&currCol===Ie.dvfocusCol||Ie.dvPending&&A();var o=e?getCell(e,n):currCell;if("undefined"==typeof e&&(e=currRow,n=currCol),o){if(Se.listview&&t(),Oe&&DataValidation.hintCallOutHide(),ProtectedRanges.isSheetLocked(CURRSHEETNAME)||o&&ProtectedRanges.isCellLocked(e,n,!0))return;if("focusRow"!==i&&"focusCol"!==i){var r=o.getAttribute("dv");if(null!==r&&(r=decodeURIComponent(r)),null!==r){var l=parseJSON(r);if(l.list===!0&&(T(),Se.listview=!0),(l.hint||null!==o.getAttribute("emsg"))&&(o.focus||o.click)){var a=o.focus?o.focus:o.click;M(a,o)}}}}}},getTopLeftForHint:function(){var t=currCell;if(null!=t&&Oe){var e=$("#hintCallout");if(hintCallout&&0!==hintCallout.length){var n=parseInt(t.style.height),i=parseInt(t.style.width),o=parseInt(ActiveCellInfo.getLeft())+(i-20)+rowHeadWidth-getNormalizedScrollLeft(),r=parseInt(ActiveCellInfo.getTop())+(n+3)+sheetTop-getSheetScrollTop(),l=findClientDim().width,a=findClientDim().height,s=parseInt(e.css("max-width")),d=parseInt(e.height());return o+s>l&&(o=o-s+80),r+d>a&&(r-=d),{type:"POSITION",top:r,left:o}}return null}},showHintTextCallout:function(t){var e=$("#hintCallout");!e||isRowSelected()||isColSelected()||(Oe=!0,e.show().find("div:eq(1)").text(t))},hintCallOutHide:function(){var t=$("#hintCallout");t&&(Oe=!1,t.hide())},isDvHintVisible:function(){return Oe},isDvCacheEmpty:function(){return null===Ne},highlightCells:function(t,e){if(!isUndefined(t))for(var n=0;n<t.length;n++)for(var i=t[n],o=0;o<=i.length;o++){var r=i[o];isUndefined(r)||DataValidation.highlightInvalidCell(r.r,r.c,void 0,e)}},highlightInvalidCell:function(t,e,n,i){var o="highlightInvalid";i===!0&&(o="dvAnimation");var r=$(n?n:getCell(t,e));isHighlightInvalidData===!0&&r&&(r.addClass(o),i===!0&&setTimeout(function(){r.addClass("highlightInvalid")},200))}}}();DataValidation.util={checkNRexists:function(t){return t?NamedRange.isNamedRange(t):void 0},getNamedRangesArray:function(){var t=NamedRange.getNamedRangesList();if(t.length>0){var e=new Array;return t.forEach(function(t){e.push("="+t)}),e}return null},getSheetNamesArray:function(){var t=getObj("sheetsTab").getElementsByTagName("TD"),e=new Array;if(t)for(var n=0;n<t.length-1;n++)e.push(t[n].getAttribute("sheetname"));return e},isIntersect:function(t,e,n){return n?t>=n.startRow&&t<=n.endRow&&e>=n.startCol&&e<=n.endCol:!1},isRangeIntersect:function(t,e){return t&&e?!(t.startCol>e.endCol||t.endRow<e.startRow||t.endCol<e.startCol||t.startRow>e.endRow):!1},isRange1D:function(t,e){if(1==e){var n=DataValidation.util.getDvRangeValues(CellUtils.removeDollar(t));return n.startRow==n.endRow||n.startCol==n.endCol}return 2==e?NamedRange.isNamedRangeOneDimentional(t):void 0},getDvRangeValues:function(t){if(isUndefined(t))return!1;var e=getDataFrom2DRangeText(t);return{startRow:e.sR,startCol:e.sC,endRow:e.eR,endCol:e.eC,sheetName:e.sheetName}}};
function Filter(e,t,r){this.id=e,this.range=t||{},this.appliedCols=r||[],this.columns=[],this.row=this.range.sr,this.rowTop=getRowTop(this.row);for(var l=t.sc,i=l,s=t.ec;s>=i;i++)this.columns[i]=new columnClass(i-l);return this}function columnClass(e){this.index=e,this.dataType=void 0,this.lastAppliedCondtion=void 0,this.columnData=void 0}function selectBackCustomFilter(){return isFilterOptionsDIVOpened?(selectedFilterTabIndex=8,$("#cF").focus(),void $("#customFilterBack").css("box-shadow","0px 0px 2px 2px #addfff")):!1}function focusSetting(e){$("#"+e).focus(),setTimeout(function(){$("#"+e).focus()},10)}var isFilterOptionsDIVOpened=!1,selectedFilterTab="autoFilterId";Filter.toolBarHandler=function(){var e=$("#reApply"),t=$("#clrFilter");if(Filter.hasFilter&&0!==Filter.getInstance().appliedCols.length)if(e.enable(),currRow>=Filter.getInstance().range.sr&&currRow<=Filter.getInstance().range.er&&Filter.getInstance().appliedCols.contains(currCol)){t.enable();var r='"'+getColHeadLabel(currCol+1)+'"';t.find("span.ui-zmenu-text").text(replaceParams(jsMsg["Filter.Clear_Filter_From_Column"],new Array(r)))}else t.disable(),t.find("span.ui-zmenu-text").text(jsMsg["Filter.Clear_Filter"]);else e.disable(),t.disable(),t.find("span.ui-zmenu-text").text(jsMsg["Filter.Clear_Filter"])},Filter.instances={},Filter.hasFilter=!1,Filter.isPivotFilter=!1,Filter.currCol,columnClass.prototype={getIndex:function(){},getLastAppliedCondition:function(){},getColumnData:function(){},setIndex:function(){},setLastAppliedCondition:function(){},setColumnData:function(){},isDataModified:!1,setDataModifed:function(){}},Filter.header={filterImage:"filter_new.png",filterAppliedImage:"filterApplied.png",selectAllItemsMsg:jsMsg["Filter.selectAll"],selectedItem:"filterItemSelect",partiallySelectedItem:"filterPartialSelection",deselectedItem:"filterItem",filterMenuHeader:"filterMenuHeader"},Filter.getHeader=function(){return Filter.header},Filter.filterIconHandler=function(e){e?(menutabListener.doAction(TOOLBAR.DATA,{id:"filter",action:"enable",callback:applyStyle_addClass,args:["filter","uiGrey"]}),menutabListener.doAction(TOOLBAR.DATA,{id:"filterDropDown",action:"enable",callback:applyStyle_addClass,args:["filterDropDown","uiGrey"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"filterClone",action:"addClass",callback:applyStyle_addClass,args:["filterClone","uiGrey"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"filterDropDownClone",action:"addClass",callback:applyStyle_addClass,args:["filterDropDownClone","uiGrey"]})):(menutabListener.doAction(TOOLBAR.HOME,{id:"filterClone",action:"disable",callback:applyStyle_removeClass,args:["filterClone","uiGrey"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"filterDropDownClone",action:"disable",callback:applyStyle_removeClass,args:["filterDropDownClone","uiGrey"]}),menutabListener.doAction(TOOLBAR.DATA,{id:"filter",action:"disable",callback:applyStyle_removeClass,args:["filter","uiGrey"]}),menutabListener.doAction(TOOLBAR.DATA,{id:"filterDropDown",action:"disable",callback:applyStyle_removeClass,args:["filterDropDown","uiGrey"]}))},Filter.create=function(e,t,r){return Filter.instances[e]=new Filter(e,t,r),Filter.instances[e].buildIcons(),Filter.hasFilter=!0,UIComponents.executeOnDeferredInit(function(){Filter.filterIconHandler(!0)}),Filter.instances[e]},Filter.ClearFilter=function(){Filter.hideFilterOptions()},Filter.reapplyFilter=function(){var e=Filter.getInstance();if(e)var t=e.range,r=t.sr,l=t.sc,i=t.er,s=t.ec;var o=new AjaxRequest,a=new RequestParameters(ActionConstants.FILTER_REAPPLY);a.setParameters(WorkSheets.getAssociatedActiveSheetName(),r,l,i,s),o.init("POST",a.getURL(),!0,a.getParametersAsString()),actionManager.addRequest(o)},Filter.clearExistingFilter=function(){var e=Filter.getInstance();if(e){var t=currCol-e.range.sc;Filter.applyFilterCriteria(CURRSHEETNAME,t,void 0,void 0,void 0,void 0,void 0,void 0,ActionConstants.APPLY_FILTER_ALL)}Filter.enableDisableInsertIcon(!0)},Filter.filterByCellColor=function(){var e=new AjaxRequest,t=new RequestParameters(ActionConstants.FILTER_BY_CELL_COLOR);t.setParameters(WorkSheets.getAssociatedActiveSheetName(),currRow,currCol),e.init("POST",t.getURL(),!0,t.getParametersAsString()),actionManager.addRequest(e),Filter.enableDisableInsertIcon(!1)},Filter.filterByFontColor=function(){var e=new AjaxRequest,t=new RequestParameters(ActionConstants.FILTER_BY_FONT_COLOR);t.setParameters(WorkSheets.getAssociatedActiveSheetName(),currRow,currCol),e.init("POST",t.getURL(),!0,t.getParametersAsString()),actionManager.addRequest(e),Filter.enableDisableInsertIcon(!1)},Filter.filterDataScroll=function(e){var t=getMouseWheelData(e),r=getObj("nrmlflyoutmenu"),l=r.scrollTop,i=30*(t/3);if(0>t)var s=l+-1*i;else s=l-i;getObj("filterColumnData").scrollTop=s,stopEvt(e)},Filter.enableDisableInsertIcon=function(e){e?(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertCellBtn",action:"enable",callback:button_enable,args:["insertCellBtn"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"cellOpt",action:"enable",callback:button_enable,args:["cellOpt"]})):(menutabListener.doAction(TOOLBAR.INSERT,{id:"insertCellBtn",action:"disable",callback:button_disable,args:["insertCellBtn"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"cellOpt",action:"disable",callback:button_disable,args:["cellOpt"]}))},Filter.createFilter=function(e,t,r,l,i){e=WorkSheets.getSheetCodeFromName(e);var s=new RequestParameters(ActionConstants.CREATE_FILTER);s.setParameters(e,t,r,l,i);var o=new AjaxRequest;o.init("POST",s.getURL(),!0,s.getParametersAsString()),actionManager.addRequest(o)},Filter.filterByValue=function(){var e=new AjaxRequest,t=new RequestParameters(ActionConstants.FILTER_BY_VALUE);t.setParameters(WorkSheets.getAssociatedActiveSheetName(),currRow,currCol),e.init("POST",t.getURL(),!0,t.getParametersAsString()),actionManager.addRequest(e),Filter.enableDisableInsertIcon(!1)},Filter.removeFilter=function(e){Filter.hasFilter=!1;var t=Filter.getInstance();if(t){var r=t.range,l=new RequestParameters(ActionConstants.REMOVE_FILTER);e=WorkSheets.getSheetCodeFromName(e),l.setParameters(e,r.sr,r.sc,r.er,r.ec);var i=new AjaxRequest;i.init("POST",l.getURL(),!0,l.getParametersAsString()),actionManager.addRequest(i)}Filter.enableDisableInsertIcon(!0)},Filter.doFilterAction=function(e){if(READ_WRITE){var t,r,l,i;if("undefined"==typeof e&&(e=ActionConstants.CREATE_FILTER,Filter.hasFilter&&(e=ActionConstants.REMOVE_FILTER)),e===ActionConstants.CREATE_FILTER){if(l=currRow,i=currCol,t=l,r=i,isCellRange()){var s=getCellRange();t=s.startRow,r=s.startCol,l=s.endRow,i=s.endCol}Filter.createFilter(CURRSHEETNAME,t,r,l,i)}else e===ActionConstants.REMOVE_FILTER&&Filter.removeFilter(CURRSHEETNAME)}},Filter.remove=function(){var e=Filter.getInstance();e&&(Filter.filterIconHandler(!1),e.remove())},Filter.regenerateAffectedCharts=function(e){var t=[];if(e){var r=Object.keys(e);if(r.forEach(function(r){r===WorkSheets.getAssociatedActiveSheetName()&&(t=e[r])}),t&&t.length>0){var l=new AjaxRequest,i=new RequestParameters(ActionConstants.CHART_REFRESH);i.setParameters(WorkSheets.getAssociatedActiveSheetName(),JSON.stringify(t)),l.init("POST",i.getURL(),!0,i.getParametersAsString()),l.addEventListener("onComplete",function(e){var t=JSON.parse(e.responseText);t&&!isUndefined(t[ActionConstants.CHART])&&chartOnLoad.updateChartJson(t[ActionConstants.CHART])}),l.sendRequest()}}},Filter.filterColDataMouseDown=function(e){var t;return t=browser_ie?e.srcElement:e.target,stopEvt(e),!0},Filter.hasFilteredCols=function(){var e=Filter.getInstance();return e?e.appliedCols.length>0:!1},Filter.clear=function(){Filter.instances={}},Filter.getInstance=function(e){return e||(e=CURRSHEETNAME),Filter.instances[e]},Filter.positionFilterIcons=function(e,t){for(var r=filterIconsPane.children,l=0;l<r.length;l++){var i=r[l];if(t){var s=i.getAttribute("row");s>=e&&(i.style.top=getRowTop(s)+"px",i.style.height=getRowHeight(s)+"px")}else{var o=i.getAttribute("col");o>=e&&(i.style.left=getColLeft(o)+"px",i.style.width=getColWidth(o)+"px")}}ISFREEZED&&Filter.replicateInAllPanes()},Filter.prototype={},Filter.prototype.addToAppliedCols=function(e){var t=this.appliedCols;-1===t.indexOf(e)&&t.push(e)},Filter.prototype.removeFromAppliedCols=function(e){var t=this.appliedCols,r=t.indexOf(e);-1!==r&&(this.appliedCols=t.slice(0,r).concat(t.slice(r+1,t.length)))},Filter.prototype.getColumnData=function(e){return Filter.instances[this.id].columns[e]},Filter.prototype.modfiyRange=function(){},Filter.prototype.buildIcons=function(){{var e=Filter.getHeader(),t=getObj("fIP"),r=this.appliedCols,l=this.range.sr,i=getRowTop(l),s=getRowHeight(l),o=Filter.getIconContainer(),a=this.range,n=a.sc;a.ec}browser_ie&&(t.style.zIndex=51+BASEZINDEX);for(var c=n,d=a.ec;d>=c;c++){var F=c-n,f=-1!==r.indexOf(c),u=o.cloneNode(!0);u.setAttribute("row",l),u.setAttribute("col",c),u.setAttribute("index",F),u.setAttribute("filter",!0),u.style.height=s+"px",u.style.width=getColWidth(c)+"px",isRTL?(u.style.right=getColLeft(c)+"px",u.style.left=""):(u.style.left=getColLeft(c)+"px",u.style.right=""),u.style.top=i+"px",t.appendChild(u);var I=u.childNodes[0];I.src=IMAGE_PATH+(f?e.filterAppliedImage:e.filterImage),I.setAttribute("col",c),I.setAttribute("index",F),I.onclick=Filter.showFilterOptions}return Filter.replicateInAllPanes(),this},Filter.prototype.reconstructIcons=function(){this.removeIcons().buildIcons()},Filter.prototype.removeIcons=function(){function e(e){for(var t=e.querySelectorAll("[filter]"),r=0;r<t.length;r++)e.removeChild(t[r])}return e(filterIconsPane),ISFREEZED&&(e(filterIconsPane1),e(filterIconsPane2),e(filterIconsPane3)),this},Filter.prototype.remove=function(){var e=Filter.getInstance().removeIcons().id;Filter.hasFilter=!1,delete Filter.instances[e];var t=getObj("tfr");t&&$(t).text("")},Filter.prototype.setRange=function(e){this.range=e},Filter.prototype.setAppliedCols=function(e){this.appliedCols=e},Filter.prototype.modify=function(e){this.appliedCols=e},Filter.prototype.isFilteredCol=function(e){var t=this.appliedCols;return-1!==t.indexOf(e)};var isFilterIconsReplicationPending=!1;Filter.replicateInAllPanes=function(e){if(e&&void 0===filterMetaInfo||ISFREEZED){var t=filterIconsPane.innerHTML,r=Filter.getInstance();if(r||Filter.isPivotFilter){isFilterIconsReplicationPending=!1;var l=filterIconsPane.children.length;filterIconsPane2.innerHTML=t,filterIconsPane1.innerHTML=t,filterIconsPane3.innerHTML=t;for(var i=filterIconsPane1.childNodes,s=filterIconsPane2.childNodes,o=filterIconsPane3.childNodes,a=0;l>a;a++){var n=i[a].childNodes[0],c=s[a].childNodes[0],d=o[a].childNodes[0];Filter.isPivotFilter?(PivotUtil.generateFilterDropDown(n),PivotUtil.generateFilterDropDown(c),PivotUtil.generateFilterDropDown(d)):(n.onmousedown=Filter.showFilterOptions,c.onmousedown=Filter.showFilterOptions,d.onmousedown=Filter.showFilterOptions,browser_ie&&(i[a].onmousedown=sheetMouseDown,s[a].onmousedown=sheetMouseDown,o[a].onmousedown=sheetMouseDown))}}else isFilterIconsReplicationPending=!0}},Filter.getIconContainer=function(){if(!Filter.iconContainerProto){var e=document.createElement("div");e.style.position="absolute",e.className="filterIconContainer";var t=document.createElement("img");t.style.position="absolute",t.style.cursor="pointer",isRTL?(t.style.left="1px",t.style.right=""):(t.style.right="1px",t.style.left=""),t.style.bottom="1px",t.style.maxWidth="100%",t.style.maxHeight="100%",t.style.zIndex=51+BASEZINDEX,e.appendChild(t),Filter.iconContainerProto=e}return Filter.iconContainerProto},Filter.isApplied=function(e){e||(e=CURRSHEETNAME);var t=Filter.getInstance(e);return t&&t.appliedCols.length>0},Filter.getIcon=function(e,t){var r=Filter.getInstance(),l=void 0;return r&&(t||filterIconsPane).querySelectorAll("[filter]")[e-r.range.sc]?(t||filterIconsPane).querySelectorAll("[filter]")[e-r.range.sc].childNodes[0]:l},Filter.updateIconStatus=function(e,t){var r=IMAGE_PATH+(t?Filter.header.filterAppliedImage:Filter.header.filterImage);Filter.getIcon(e).src=r,ISFREEZED&&(Filter.getIcon(e,filterIconsPane1).src=r,Filter.getIcon(e,filterIconsPane2).src=r,Filter.getIcon(e,filterIconsPane3).src=r)},Filter.renameFilterInstance=function(e,t){var r=Filter.getInstance(e);r&&(Filter.instances[t]=r,Filter.instances[t].id=t,delete Filter.instances[e])},Filter.isAcrossFilterHeader=function(e,t,r,l){var i=Filter.getInstance();if(i){var s=i.range,o=s.sc,a=s.ec,n=s.sr;if(n>e&&r>=n&&(t>=o&&a>=t||l>=o&&a>=l))return!0}return!1},Filter.reloadView=function(e,t){var r={},l=Filter.getInstance();if(l)if(ISFREEZED&&(r={reloadFrozenRows:!0,onBeforeReload:SHEET.FREEZE.reloadSheetPanes,onAfterReload:function(){SHEET.dom.freeze.setCues(FREEZED_ROW,FREEZED_COL)}}),r.passiveReload="true"===t,responseManager.isRequestPending()){var i={fn:setRowsHeightAndModifyDOM,params:[e,!0,r],condn:function(){return!responseManager.isRequestPending()}};actionManager.addEventListener("onResponse",i)}else setRowsHeightAndModifyDOM(e,!0,r)},Filter.readRowDetails=function(e,t,r){var l=new AjaxRequest,i=new RequestParameters(ActionConstants.FILTER_CALLBACK);e=WorkSheets.getSheetCodeFromName(e),i.setParameters(e,t,r),l.init("POST",i.getURL(),!0,i.getParametersAsString()),l.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);Filter.reloadView(t.rh)}),l.sendRequest()},Filter.updateFilterJson=function(e,t){if(filterMetaInfo=void 0,ActionConstants.READ_FILTER_RANGE===e.a)return void(e.hf?(Filter.remove(),Filter.create(e.sn,e.range,e.fc),_resettingRowHdrs(),Filter.enableDisableInsertIcon(Filter.hasFilter&&0!==Filter.getInstance().appliedCols.length?!1:!0)):(Filter.filterIconHandler(!1),Filter.hasFilter=!1));var r=e.rowsInfo,l=e.filterInfo,i=e.chartList,s=e.aa;if(s!==ActionConstants.CREATE_FILTER||e[ActionConstants.CREATE_FILTER]||Filter.filterIconHandler(!1),i&&Filter.regenerateAffectedCharts(i),l)var o=l.sn,a=l.range,n=l.fc;if(e[ActionConstants.REMOVE_FILTER]&&(r&&(r.rh?Filter.reloadView(r.rh):Filter.readRowDetails(o,r.sr,r.er)),Filter.remove(),activateCellField()),e[ActionConstants.CREATE_FILTER]&&(Filter.create(o,a),activateCellField(),t&&e.aa!==ActionConstants.FILTER_BY_VALUE&&scrollCellIntoView(a.sr,a.sc)),e[ActionConstants.APPLY_FILTER]){var c=e.outputInfo;if(c){var d=c.cfc,F=c.tvr,f=c.cf,u=getObj("cellStatus"),I=a.sc+d,p=Filter.getIcon(I);if(p){var x=Filter.getInstance();f?x&&(x.removeFromAppliedCols(I),Filter.enableDisableInsertIcon(!0)):x&&x.addToAppliedCols(I),Filter.updateIconStatus(I,!f)}if(u){var b="";F>=0&&(b=F+" "+jsMsg["Filter.of"]+" "+(a.er-a.sr)+" "+jsMsg["Filter.foundRecords"]),setStatusText(b),setTimeout(function(){$("#cellStatus").html("").hide()},5e3)}}}if(e[ActionConstants.UPDATE_FILTER_RANGE]){var x=Filter.getInstance();x&&(x.range=a)}if(e[ActionConstants.RECONSTRUCT_FILTER_ICON]){var x=Filter.getInstance();x&&(x.range=a,x.appliedCols=n,x.reconstructIcons())}r&&(r.rh?Filter.reloadView(r.rh):Filter.readRowDetails(o,r.sr,r.er))},Filter.hideFilterOptions=function(){$("#filterSearch").val("");var e=["autoFilterId","cellColorId","textColorId","clearFilter","filterOk","filterCancel","sort_asc","sort_desc","customFilterId"];hoverItem=-2,$("#"+e[selectedFilterTabIndex]).css("box-shadow",""),$($("#headers").find(".fselected")).css("box-shadow",""),selectedFilterTabIndex=0,"block"===getObj("customFilterIdContent").style.display&&(8===selectedFilterTabIndex&&$("#customFilterBack").css("box-shadow",""),$("#customFilterBack").trigger("mousedown")),Filter.resetTicks(!1,!0,!1);for(var t=["#autoFilterId","#cellColorId","#textColorId"],r=0;r<t.length;r++)$(t[r]).removeClass("selected bTc"),$(t[r]).children()[0].style.display="none";var l=getObj("filterColumnData");l&&(isFilterOptionsDIVOpened=!1,getObj("dataDiv").scrollTop=0,l.style.left="-100000px",l.style.top="-100000px",l.style.display="none",$("#ui-datepicker-div").hide()),$("#dataDiv").html(""),$("#cellColorDiv").html(""),$("#textcolorDiv").html("");var i=Filter.getInstance();void 0!==Filter.currCol&&i&&!i.isFilteredCol(Filter.currCol)&&Filter.getIcon(Filter.currCol)&&(Filter.getIcon(Filter.currCol).src=IMAGE_PATH+"filter_new.png"),Filter.resetAutoFilterOptions(),Filter.resetCustomFilter(),setFocusInCellField(),$("#sort_asc").removeClass("sSo"),$("#sort_desc").removeClass("sSo"),$("#sort_asc").removeAttr("title"),$("#sort_desc").removeAttr("title")};var hoverItem=-1,selectedFilterTabIndex=0;Filter.shortCutHandler=function(e){var t=["autoFilterId","select1","searchCont","clearFilter","filterOk","filterCancel","sort_asc","sort_desc","customFilterId"],r="autoFilterHeader"===currentHeader?"dataDiv":"cellColorHeader"===currentHeader?"cellColorDiv":"textColorDiv";switch(e.keyCode){case 9:hoverItem>-1&&$($("#"+r).children()[hoverItem]).removeClass("fhover"),hoverItem=-2,e.shiftKey?($("#"+t[selectedFilterTabIndex]).css("box-shadow",""),$("#customFilterBack").css("box-shadow",""),selectedFilterTabIndex--,selectedFilterTabIndex=-1===selectedFilterTabIndex?8:selectedFilterTabIndex,selectedFilterTabIndex%=9,4===selectedFilterTabIndex&&(selectedFilterTabIndex=$("#filterOk").is(":enabled")?4:3),3===selectedFilterTabIndex&&(selectedFilterTabIndex=$("#clearFilter").is(":enabled")?3:2),selectedFilterTabIndex="block"===getObj("customFilterIdContent").style.display&&2===selectedFilterTabIndex?$("#fVal2").focus():selectedFilterTabIndex,8===selectedFilterTabIndex&&("none"===getObj("customFilterIdContent").style.display?$($("#headers").find(".fselected")).css("box-shadow",""):$("#customFilterBack").css("box-shadow","0px 0px 2px 2px #addfff")),selectedFilterTabIndex>=0&&3>selectedFilterTabIndex?"autoFilterHeader"===currentHeader?2===selectedFilterTabIndex?($("#autoFilterId").trigger("click"),$("#autoFilterId").css("box-shadow",""),$("#select1").addClass("fhover"),hoverItem=-1):1===selectedFilterTabIndex?($("#select1").removeClass("fhover"),setTimeout(function(){$("#filterSearch").focus()},100),hoverItem=-2):0===selectedFilterTabIndex&&(hoverItem=-2,$("#select1").removeClass("fhover"),$("#autoFilterId").trigger("click"),$("#autoFilterId").css("box-shadow","0px 0px 2px 2px #addfff")):"cellColorHeader"===currentHeader?(2===selectedFilterTabIndex&&selectedFilterTabIndex--,1===selectedFilterTabIndex?(hoverItem=-1,$("#cellColorId").addClass("fselected"),$("#cellColorId").css("box-shadow",""),$("#select2").addClass("fhover")):0===selectedFilterTabIndex&&(hoverItem=-2,$("#select2").removeClass("fhover"),$("#cellColorId").trigger("click"),$("#cellColorId").css("box-shadow","0px 0px 2px 2px #addfff"))):"textColorHeader"===currentHeader&&(2===selectedFilterTabIndex&&selectedFilterTabIndex--,1===selectedFilterTabIndex?(hoverItem=-1,$("#textColorId").addClass("fselected"),$("#textColorId").css("box-shadow",""),$("#select3").addClass("fhover")):0===selectedFilterTabIndex&&(hoverItem=-2,$("#select3").removeClass("fhover"),$("#textColorId").trigger("click"),$("#textColorId").css("box-shadow","0px 0px 2px 2px #addfff"))):($("#"+t[selectedFilterTabIndex]).css("box-shadow","0px 0px 2px 2px #addfff"),e.stopPropagation())):($("#"+t[selectedFilterTabIndex]).css("box-shadow",""),$("#customFilterBack").css("box-shadow",""),selectedFilterTabIndex++,(6===selectedFilterTabIndex||7===selectedFilterTabIndex)&&Filter.isPivotFilter&&"disabled"===getObj("sort_desc").getAttribute("disabled")&&(selectedFilterTabIndex=1),8===selectedFilterTabIndex&&Filter.isPivotFilter&&(selectedFilterTabIndex=1),selectedFilterTabIndex%=9,selectedFilterTabIndex>=0&&3>selectedFilterTabIndex&&"none"===getObj("customFilterIdContent").style.display?"autoFilterHeader"===currentHeader?0===selectedFilterTabIndex?($("#autoFilterId").trigger("click"),$("#autoFilterId").css("box-shadow","0px 0px 2px 2px #addfff")):1===selectedFilterTabIndex?(hoverItem=-2,$("#autoFilterId").css(""),setTimeout(function(){$("#filterSearch").focus()},100)):2===selectedFilterTabIndex&&-2===hoverItem?($("#autoFilterId").css("box-shadow",""),$("#select1").addClass("fhover"),hoverItem=-1):$("#autoFilterId").removeClass("fselected"):"cellColorHeader"===currentHeader?0===selectedFilterTabIndex?($("#cellColorId").trigger("click"),$("#cellColorId").css("box-shadow","0px 0px 2px 2px #addfff")):(1===selectedFilterTabIndex||2===selectedFilterTabIndex)&&(hoverItem=-1,$("#select2").addClass("fhover"),$("#cellColorId").css("box-shadow",""),selectedFilterTabIndex++):"textColorHeader"===currentHeader&&(0===selectedFilterTabIndex?($("#textColorId").trigger("click"),$("#textColorId").css("box-shadow","0px 0px 2px 2px #addfff")):(1===selectedFilterTabIndex||2===selectedFilterTabIndex)&&(hoverItem=-1,$("#select3").addClass("fhover"),$("#textColorId").css("box-shadow",""),selectedFilterTabIndex++)):(selectedFilterTabIndex="block"===getObj("customFilterIdContent").style.display&&0===selectedFilterTabIndex?$("#fo1").zcombo("widget").focus():selectedFilterTabIndex,$($("#headers").find(".fselected")).css("box-shadow",""),Filter.isPivotFilter&&$("#select1").removeClass("fhover"),$("#select"+($($("#headers").find(".fselected")).index()+1)).removeClass("fhover"),3===selectedFilterTabIndex&&(selectedFilterTabIndex=$("#clearFilter").is(":enabled")?3:4),4===selectedFilterTabIndex&&(selectedFilterTabIndex=$("#filterOk").is(":enabled")?4:5),8===selectedFilterTabIndex&&"block"===getObj("customFilterIdContent").style.display?$("#customFilterBack").css("box-shadow","0px 0px 2px 2px #addfff"):$("#"+t[selectedFilterTabIndex]).css("box-shadow","0px 0px 2px 2px #addfff")));break;case 38:if(0>hoverItem||selectedFilterTabIndex>3)return;hoverItem--;var r="autoFilterHeader"===currentHeader?"dataDiv":"cellColorHeader"===currentHeader?"cellColorDiv":"textColorDiv";if(hoverItem>-1){var l=$($("#"+r).children()[hoverItem]).position().top;135>l&&$("#"+r).scrollTop($("#"+r).scrollTop()-23)}if(-1===hoverItem){var i="autoFilterHeader"===currentHeader?1:"cellColorHeader"===currentHeader?2:3;$("#select"+i).addClass("fhover"),$($("#"+r).children()[hoverItem+1]).removeClass("fhover")}else hoverItem>-2&&($($("#"+r).children()[hoverItem]).addClass("fhover"),$($("#"+r).children()[hoverItem+1]).removeClass("fhover"));break;case 40:if(3>selectedFilterTabIndex&&(0===selectedFilterTabIndex&&$($("#headers").find(".fselected")).css("box-shadow",""),-2===hoverItem))return hoverItem=-1,selectedFilterTabIndex=2,void $("#select"+($($("#headers").find(".fselected")).index()+1)).addClass("fhover");if(0===selectedFilterTabIndex)return;var r="autoFilterHeader"===currentHeader?"dataDiv":"cellColorHeader"===currentHeader?"cellColorDiv":"textColorDiv";if(hoverItem>$("#"+r).children().length-2||selectedFilterTabIndex>3)return;if(hoverItem++,0===hoverItem){var i="autoFilterHeader"===currentHeader?1:"cellColorHeader"===currentHeader?2:3;$("#select"+i).removeClass("fhover"),$($("#"+r).children()[hoverItem]).addClass("fhover")}else{var l=$($("#"+r).children()[hoverItem]).position().top;l>296&&$("#"+r).scrollTop($("#"+r).scrollTop()+23),$($("#"+r).children()[hoverItem]).addClass("fhover"),$($("#"+r).children()[hoverItem-1]).removeClass("fhover")}break;case 37:if(Filter.isPivotFilter)return;2>=selectedFilterTabIndex&&("cellColorHeader"===currentHeader?(selectedFilterTabIndex=0,$("#autoFilterId").trigger("click"),$("#autoFilterId").css("box-shadow","0px 0px 2px 2px #addfff"),$("#cellColorId").css("box-shadow",""),$("#select2").removeClass("fhover")):"textColorHeader"===currentHeader&&(selectedFilterTabIndex=0,$("#cellColorId").trigger("click"),$("#cellColorId").css("box-shadow","0px 0px 2px 2px #addfff"),$("#textColorId").css("box-shadow",""),$("#select3").removeClass("fhover")));break;case 39:if(Filter.isPivotFilter)return;2>=selectedFilterTabIndex&&("autoFilterHeader"===currentHeader?(selectedFilterTabIndex=0,$("#cellColorId").trigger("click"),$("#cellColorId").css("box-shadow","0px 0px 2px 2px #addfff"),$("#autoFilterId").css("box-shadow",""),$("#select1").removeClass("fhover")):"cellColorHeader"===currentHeader&&(selectedFilterTabIndex=0,$("#textColorId").trigger("click"),$("#textColorId").css("box-shadow","0px 0px 2px 2px #addfff"),$("#cellColorId").css("box-shadow",""),$("#select2").removeClass("fhover")));break;case 32:var s;if(selectedFilterTabIndex>=0&&3>=selectedFilterTabIndex){if(-2===hoverItem)return void(3===selectedFilterTabIndex&&"rgb(173, 223, 255) 0px 0px 2px 2px"===getObj("clearFilter").style.boxShadow&&(s=selectedFilterTabIndex,$($("#"+t[selectedFilterTabIndex])).trigger("mousedown"),$("#"+t[s]).removeClass("ui-state-active")));if(-1===hoverItem){var i="autoFilterHeader"===currentHeader?1:"cellColorHeader"===currentHeader?2:3;1===i?$("#select"+i).click():$("#select"+i).trigger("mousedown")}else{var r="autoFilterHeader"===currentHeader?"dataDiv":"cellColorHeader"===currentHeader?"cellColorDiv":"textColorDiv";Filter.selectItem($($("#"+r).children()[hoverItem])[0]),$($("#"+r).children()[hoverItem]).addClass("fhover")}}else 8===selectedFilterTabIndex?"none"===getObj("customFilterIdContent").style.display?($($("#"+t[selectedFilterTabIndex])).trigger("mousedown"),$("#customFilterBack").css("box-shadow","0px 0px 2px 2px #addfff")):($("#customFilterBack").css("box-shadow",""),$($("#customFilterBack")).trigger("mousedown"),selectedFilterTabIndex=0):(s=selectedFilterTabIndex,$($("#"+t[selectedFilterTabIndex])).trigger("mousedown"),$("#"+t[s]).removeClass("ui-state-active"));break;case 27:Filter.hideFilterOptions();break;case 13:if(8===selectedFilterTabIndex)$("#"+t[selectedFilterTabIndex]).css("box-shadow",""),"none"===getObj("customFilterIdContent").style.display?($($("#"+t[selectedFilterTabIndex])).trigger("mousedown"),$("#customFilterBack").css("box-shadow","0px 0px 2px 2px #addfff")):($("#customFilterBack").css("box-shadow",""),$($("#customFilterBack")).trigger("mousedown"),$("#customFilterId").css("box-shadow","0px 0px 2px 2px #addfff"),$($("#headers").find(".fselected")).removeClass("fselected"),selectedFilterTabIndex=8);else if(3>selectedFilterTabIndex){if(!$("#filterOk").is(":enabled"))return;Filter.applyCustomFilter()}else{var o=selectedFilterTabIndex;$($("#"+t[selectedFilterTabIndex])).trigger("mousedown"),$("#"+t[o]).removeClass("ui-state-active")}break;default:return}return!1},Filter.selectSetFocus=function(){},Filter.setFocus=function(){var e;setTimeout(function(){if(e=browser_safari?browser_chrome?document.activeElement.id:document.activeElement.classList.contains("ui-ztopband-background"):document.activeElement.id,e&&"fVal1"!==e){selectedFilterTabIndex=3;var t=["autoFilterId","cellColorId","textColorId","clearFilter","filterOk","filterCancel","sort_asc","sort_desc","customFilterId"];$("#cF").focus(),3===selectedFilterTabIndex&&(getObj("textColorId").className="",selectedFilterTabIndex=$("#clearFilter").is(":enabled")?3:4),4===selectedFilterTabIndex&&(selectedFilterTabIndex=$("#filterOk").is(":enabled")?4:5),$("#"+t[selectedFilterTabIndex]).css("box-shadow","0px 0px 2px 2px #addfff")}else"fVal1"===e?$("#fVal1").focus():$("#fo2").zcombo("widget").focus()},10)},appEvent.on("grid.shift",function(){Filter.hasFilter&&Filter.getInstance().reconstructIcons()}),appEvent.on("book.onaftersheetswitch",function(){Filter.enableDisableInsertIcon(Filter.hasFilter&&0!==Filter.getInstance().appliedCols.length?!1:!0)});
var lazyLoad=function(){function r(r,n,e){var t=document.createElement(r);return"link"===r?(t.href=n,t.rel="stylesheet",t.type="text/css"):t.src=n,e&&(t.async=!1),document.head.appendChild(t),t}function n(n){var t=function(){n.callback&&n.callback()};if(o||"string"==typeof n.src)if("string"==typeof n.src){var l=r("script",n.src,o);l.onload=l.onerror=t}else for(var s=0;s<n.src.length;s++){var l=r("script",n.src[s],o);s===n.src.length-1&&(l.onload=l.onerror=t)}else c.push(n.src.length),a++,e(n.src,c,n.callback,a)}function e(n,e,t,o){function s(){if(0!==e[o]){var f=n.shift();--c[o];var i=r("script",f);i.onload=function(){0===e[o]&&(l++,l===e.length&&(a=-1),t&&t()),s()}}}n.length;s()}function t(n){var e=function(){n.callback&&n.callback()};if("string"==typeof n.href){var t=r("link",n.href);t.onload=t.onerror=e}else for(var c=0;c<n.href.length;c++){var t=r("link",n.href[c]);c===n.href.length-1&&(t.onload=t.onerror=e)}}var c=[],a=-1,o=document.createElement("script").async,l=0;return{JS:n,CSS:t}}();
var copyDocument=!1,saveToMyAccount=function(){function e(){var e=jsMsg.ConfirmationMessage1,E="",t="",n=!0,o=!1,a=!1;REMOTE.MODE===REMOTE.SCRATCHVIEW&&(t=jsMsg.ConfirmationMessage3),READ_WRITE&&TEMP_CONTAINER_IDENTITY&&null!==TEMP_CONTAINER_IDENTITY&&(a=!0,E=jsMsg.ConfirmationMessage2),ConfirmBox.setInfoMsg(e,E,t,o,n,a),ConfirmBox.showDialog(jsMsg.SaveToMyAccount,s,jsMsg.OK,jsMsg.Cancel),t&&$("#sName").val(jsMsg.Untitled).select()}function s(){var e=getViewType(),s=!1;if("PUBLIC_VIEW"===e||"REMOTE_VIEW"==e||"THROWAWAY_VIEW"==e){var t=getObj("chkBox")?getObj("chkBox").checked:!1;t||(TEMP_CONTAINER_IDENTITY=RESOURCE_ID),REMOTE.MODE===REMOTE.EXCELVIEW&&(s=!0,""===DOCUMENT_NAME&&(DOC_NAME=jsMsg.Untitled)),REMOTE.MODE===REMOTE.SCRATCHVIEW&&(s=!0,DOC_NAME=getObj("sName").value),copyDocument=!0}else TEMP_CONTAINER_IDENTITY=RESOURCE_ID;-1==zuid?showSignupDialog():(message(jsMsg.Loading,"block","..."),E(null,s,t,DOC_NAME)),sheetdialog.close()}function E(e,s,E,t){var n=new RequestParameters(ActionConstants.SAVE_TO_MYACCOUNT),o=new AjaxRequest;n.setParameters(E,s,t),o.init("POST",n.getURL(),!0,n.getParametersAsString()),o.addEventListener("onComplete",function(e){if(e.responseText){var s=parseJSON(e.responseText);s.di&&loadDocument(s.di)}}),o.sendRequest()}return{getDetails:e,saveToMyAccount:s}}();
!function(t){t.widget("ui.zdialog",{_COMPONENTEVENTS:{ztab:"tabchange",zflipswitch:"flipswitchchange",zautosuggest:"zautosuggestchange",ztoggle:"togglechange",zspinner:"spinnerchange",zhiddennumericalslider:"hiddensliderchange",slider:"sliderchange",zcolorpallete:"colorpalletechange",zcombo:"combochange",zstatebutton:"statechange",zspinnerslider:"spinnersliderchange",zmenu:"menuitemclicked",zcolorfield:"colorfieldcolorselected"},widgetEventPrefix:"zdialog",_EVENTS:{ONMINIMIZE:"minimize",ONMAXIMIZE:"maximize",ONAFTERSHOW:"aftershow",ONBEFORECLOSE:"beforeclose"},options:{minimizable:!1,static:!1,modal:!1,draggable:!0,closeAction:!0,closeButton:!0,keys:{"close.label":"Close","minimize.label":"Minimize","maximize.label":"Maximize"},minimizeOffset:{bottom:"0px",right:"0px"}},dialogComponents:void 0,_create:function(){t.ui.dialog.overlay&&!t.ui.dialog.overlay.instances.length&&t.ui.dialog.overlay.instances.push(t("<div>")),this.openDialog(this.options)},setAssociatedObj:function(t){this.options.associatedObj=this._associatedObj=t,this.element.data("associatedObj",t)},_fixButtons:function(){var i=this.options.buttons,e=this;i&&t.each(i,function(i,n){if("function"!=t.type(n.click)&&n.click)if("CLOSE"==n.click)n.click=function(){e.close.call(e)};else{var o=t.ui.utils.getAsFunction(n.click);n.click=o.callable}})},_fixButtonProps:function(){var i=this.options.buttons;i&&t(this._dialogBase).find("[leftbutton=true]").addClass("ui-dialog-leftbtn")},openDialog:function(i){this._associatedObj=i.associatedObj;var e=t(this.element);if(this._fixButtons(),this._dialogPosition=i.position,i.target&&(i.target=t(i.target),!i.position)){var n=i.target.offset();this._dialogPosition=[n.left,n.top+i.target.height()]}var o=this,a=function(){if(o._dialogBase=o.element.parent(),o._addExtraButtons(),o._associatedObj&&t.isFunction(o._associatedObj.beforeInit)&&o._associatedObj.beforeInit(e),t(document).one("componentinitialized",function(){o.dialogComponents=t("[ctype]",t(o.element).children(":first")),o._fillValues(e,i.associatedObj,!0)}),t.ui.utils.initComponents(e),e.dialog("option","position",o._dialogPosition?o._dialogPosition:"center"),o._fixButtonProps(),o.element.data("focussed",o._focusButton()),!o.options.closeAction||!o.options.closeButton){var n=o._dialogBase.find(".ui-dialog-titlebar-close");n.hide()}o.element.find(".ui-tabs-horizontal").length&&o._dialogBase.addClass("ui-dialog-tab-horizontal")},s=t.extend({beforeClose:function(){return o._triggerEvent(o._EVENTS.ONBEFORECLOSE),t.ZContextMenu&&(t.ZContextMenu.hideMenu(),t.ZContextMenu.displayColorPalette(void 0,{},!1)),o.options.closeAction?o.options.hideOnClose?(o._checkAndDestroy(!0),!1):void 0:!1},close:function(){o._checkAndDestroy(!0)},position:o._dialogPosition,zIndex:t.ui.dialog.zIndex?t.ui.dialog.zIndex:1e4,open:a,autoOpen:!1,dragStart:function(){t.ZContextMenu&&t.ZContextMenu.hideMenu()}},i);parseInt(s.width)>0&&(s.width=parseInt(s.width)+10),e.dialog(s),e.data("associatedObj",i.associatedObj),this._addStatusDiv(),i.buttons&&this._checkAndInitLoaderBtn(i.buttons)},_checkAndInitLoaderBtn:function(){var i=this.element.parent().find(".ui-dialog-buttonset"),e=i.find("button[btype=loader]"),n=this;e.on("click",function(i){var e=t(i.target).closest(".ui-button");n.disableButton(e.attr("id"))})},disableButton:function(t){var i=this.element.parent().find(".ui-dialog-buttonset").find("#"+t);"loader"==i.attr("btype")?i.addClass("ui-status-icon ui-state-progress").button({icons:{secondary:"ui-components-icon ui-icon-loader"}}).button("disable"):i.button("enable")},enableButton:function(t){var i=this.element.parent().find(".ui-dialog-buttonset").find("#"+t);"loader"==i.attr("btype")?i.button({icons:{secondary:""}}).button("enable"):i.button("enable")},changeButtonLabel:function(t,i){var e=this.element.parent().find(".ui-dialog-buttonset").find("#"+t);e.button("option","label",i)},changeButtonIcon:function(t,i){var e=this.element.parent().find(".ui-dialog-buttonset").find("#"+t);e.button("option","icons",i)},_addStatusDiv:function(){var i=this.element.parent().find(".ui-dialog-buttonset");this._statusDiv=t("<div>").addClass("ui-widget-content ui-dialog-footer-status").css({display:"inline","margin-right":"5px"}).hide(),i&&i.prepend(this._statusDiv)},showStatus:function(t){t="object"==typeof t?t:{status:t};var i=this._statusDiv;i.html(t.status).show(),setTimeout(function(){i.hide()},t.duration?t.duration:3e3)},open:function(i){i&&(this.element.dialog("option","position",i),this._dialogPosition=i),this.isMinimized()?(this.maximize(),this.refreshValues()):this._hidden?(this._hidden=!1,this.element.dialog("moveToTop",!0),this._dialogBase.show(),this.getOverlay().show(),this.refreshValues()):this.element.dialog("open"),t(this.element).data("dialogOpened",!0),this._triggerEvent(this._EVENTS.ONAFTERSHOW),this._associatedObj&&t.isFunction(this._associatedObj.open)&&this._associatedObj.open(this.element)},_focusButton:function(){var i=this.element.find("input[tabindex], textarea[tabindex], button[tabindex]");if(i.length){var e=t(i.get(0)),n=e.prop("tabindex");i.each(function(i,o){t(o).prop("tabindex")<n&&(e=t(o),n=t(o).prop("tabindex"))})}else{var e=this._dialogBase.find(".ui-dialog-buttonset button:last:not(disabled)");e.length||(e=this._dialogBase.find(".ui-dialog-titlebar a:last"))}return this._setTabindex(),e.focus()},updateTabIndex:function(){this._setTabindex()},_setTabindex:function(){var i=this,e=i._dialogBase.find("button, input, select, textarea, .ui-zcombo");e.last().on("keydown."+this.widgetName,function(t){9==t.keyCode&&(e.get(0).focus(),t.preventDefault())}),e.on("keydown."+this.widgetName,function(e){if(9===e.which){var n=e.shiftKey?-1:1;i._getNextTabElement(t(this),n),e.preventDefault()}})},_getNextTabElement:function(i,e){var n=this._dialogBase.find("button, input, select, textarea, .ui-zcombo").filter(":visible").filter(function(){return t(this).attr("disabled")?!1:!0}),o=t(n.toArray()),a=n.filter(function(){return t(this).attr("tabindex")>0?!0:!1});if(a.length){var s=n.filter(function(){return t(this).attr("tabindex")<1?!0:!1});o=t(a.toArray().concat(s.toArray()))}var l=o.eq((o.index(i)+e)%o.length);l.hasClass("ui-zcombo")&&(l.focus(),l.prev().zcombo("setFocus",!0)),l.focus()},_addExtraButtons:function(){var t=this._titlebar=this.element.closest(".ui-dialog").find(".ui-dialog-titlebar"),i=t.find(".ui-dialog-titlebar-close");i.attr("title",this._getString("close.label"));var e=this;this.options.minimizable&&(this._minimizeButton=this._createButton("ui-icon ui-components-icon ui-icon-minus",i,e._toggleMinimize).attr("title",this._getString("minimize.label")),t.on("dblclick."+this.widgetName,function(){e._toggleMinimize(e._minimizeButton)}))},isMinimized:function(){return this._dialogBase?this._dialogBase.is(".ui-dialog-minimized"):!1},minimize:function(){this._dialogBase.is(":not(.ui-dialog-minimized)")&&this._toggleMinimize(this._minimizeButton)},maximize:function(){this._dialogBase.is(".ui-dialog-minimized")&&this._toggleMinimize(this._minimizeButton)},_toggleMinimize:function(i){var e=!this.element.is(":visible"),n=e?"show":"hide";this.element[n](),this.element.next(".ui-dialog-buttonpane")[n](),t(i).removeClass("ui-state-hover");var o=t(i).find("span");o.toggleClass("ui-components-icon ui-icon-plus").toggleClass("ui-components-icon ui-icon-minus"),this._dialogBase.toggleClass("ui-dialog-minimized"),this.element.dialog("option","draggable",e?this.options.draggable:!1);var a=this.getOverlay();a&&this.options.minimizable&&a[n]();var s=this._getMinimizablePane(),l=this.options.minimizeOffset;l&&!e&&s.css(l),e?(t("body").append(this._dialogBase),i.attr("title",this._getString("minimize.label")).data("title",this._getString("minimize.label"))):(i.attr("title",this._getString("maximize.label")).data("title",this._getString("maximize.label")),s.append(this._dialogBase)),this._triggerEvent(this._EVENTS[e?"ONMAXIMIZE":"ONMINIMIZE"])},_getMinimizablePane:function(){var i="ui-zdialog-minimize-pane",e=t("."+i);return e.length||(e=t("<div>").addClass(i),t("body").append(e)),e},_createButton:function(i,e,n){var o=t("<a>").attr({role:"button",unselectable:"on",href:"#"}).addClass("ui-dialog-titlebar-close ui-dialog-titlebar-minimize ui-corner-all").hover(function(){o.addClass("ui-state-hover")},function(){o.removeClass("ui-state-hover")}).append(t("<span>").addClass(i)),a=this;return o.insertAfter(e),o.click(function(i){return n&&n.call(a,t(i.currentTarget)),!1}),o},_fillValues:function(i,e,n,o){if(e){e&&(t.isFunction(e.init)&&e.init(i),t.isFunction(e.beforeFillValues)&&e.beforeFillValues(i));var a=["zspinner","zspinnerslider"],s=o?o.find("[ctype]"):this.dialogComponents,l=this;s.each(function(i,o){o=t(o);var s=o.attr("ctype");if(!(e&&e.fillVisible&&o[s]("widget").is(":hidden"))&&o.metadata()&&o.metadata().appData){var d=o.metadata().appData,r=d.action;if(e.get){var u=e.get(r,o),c=t.inArray(s,a);-1!=c&&void 0===u&&(u=0),"zstatebutton"!=s&&void 0!==u||"zcombo"==s?"flipswitch"===s?o[s]("select",u):"zbutton"!==s&&o[s]("setValue",u):o.val()==u||"checkbox"==t(o).attr("type")&&1==u?o.attr("checked",!0):o.attr("checked",!1)}if(l._COMPONENTEVENTS[s]&&n){var h=t(o);h.on(l._COMPONENTEVENTS[s]+".zdialog",{obj:e},function(i,e){var n=e.value;"zmenu"==s?n=e.menuitem:"zstatebutton"==s&&(n=h.is(":checked")),e.isFromSetValue||i.data.obj.set&&i.data.obj.set(d,n,t(i.target),s)})}}}),l._nonZohoComponents=i.find("[data]:not([ctype])"),l._nonZohoComponents.each(function(i,o){o=t(o);try{if(o.metadata()&&o.metadata().appData){var a=o.metadata().appData,s=a.action;if(e){if(e.get){var l=e.get(s,o);"checkbox"==o.attr("type")&&o.attr("checked",l),o.is("input")||o.is("button")||o.is("select")||o.is("textarea")?o.val(l):o.text(l)}n&&(o.is("input[type=text]")||o.is("textarea")?o.on("blur.zdialog",function(){e.set&&e.set(a,o.val(),o)}):o.on("change.zdialog",function(){e.set&&e.set(a,o.val(),o)}))}}}catch(t){}}),e&&t.isFunction(e.afterFillValues)&&e.afterFillValues(i)}},refreshValues:function(i,e,n){if(e){var o=t(this.element),a=this,s=this.options;i&&t.isFunction(i.beforeInit)&&i.beforeInit(o),t(document).one("componentinitialized",function(){a.dialogComponents=t("[ctype]",t(a.element).children(":first")),a._fillValues(o,s.associatedObj,!0,n)}),t.ui.utils.initComponents(o),a.element.data("focussed",a._focusButton())}else this._fillValues(this.element,i=i?i:this._associatedObj,!1,n),this.element.data("focussed",this._focusButton())},_getValueOfElementWithAction:function(i,e){var n=t("[action="+i+"]:first",e),o=void 0;if(n.length){{n.attr("ctype")}o={element:n}}return o},destroy:function(){this._destroy()},_destroy:function(){if(t(this.element).data("dialogOpened")){t(this.element).data("dialogOpened",!1);var i=this.options.associatedObj;i&&i.destroy&&i.destroy(),this._titlebar.off("."+this.widgetName),this._buildOrDestroyDialogComponents(!1),t(this.element).dialog("destroy"),t.Widget.prototype.destroy.apply(this,arguments)}},_checkAndDestroy:function(){return t(this.element.data("focussed")).blur(),this.options.hideOnClose?(this._dialogBase.hide(),this.getOverlay().hide(),this._hidden=!0,!1):(this.destroy(),!0)},getOverlay:function(){var i=this.element.data().dialog;return t(i&&i.overlay?i.overlay.$el:void 0)},close:function(){this.element.dialog("close")},_buildOrDestroyDialogComponents:function(i){if(this.dialogComponents){this.dialogComponents.each(function(e,n){var o=t(n).attr("ctype");i||t(n).off(".zdialog");var a=t(this).metadata();t(n)[o](i?a.componentOptions?a.componentOptions:a:"destroy")}),this.dialogComponents=void 0}this._nonZohoComponents&&(this._nonZohoComponents.each(function(i,e){t(e).off(".zdialog")}),this._nonZohoComponents=void 0)},_getString:function(i){return t.i18n?t.i18n("zdialog",i):this.options.keys[i]},_triggerEvent:function(t){var i={dialog:this.element,isMinimized:this.isMinimized()};return this._trigger(t,t,i)}})}(jQuery);
function ZComponents(){}!function(t){t.dialogutil={dialogs:{},options:{},_lastStaticDialog:void 0,open:function(t,e,i,o,a){a||(a={});var n=!0;return"object"==typeof a.ajax&&(n="boolean"==typeof a.ajax.cache?a.ajax.cache:!0),i&&(i.target=e),this.dialogs[t]||(this.dialogs[t]={}),this.isDialogOpened(t)?!1:(this.dialogs[t].cacheStatus&&n?this._initDialog(t,e,i,o,a):this._fetchDialogContent(t,!1,e,i,o,a),this.isDialogOpen=!0,this.dialogDiv)},_checkAndCloseLastStaticDialog:function(t,e){t.staticDialog&&this._lastStaticDialog&&this._lastStaticDialog.zdialog("close"),this._lastStaticDialog=e},_initDialog:function(e,i,o,a,n){var s=this.dialogs[e];if(!s.widget){var l=t("<div>").prop("id",e+"zdialog").html(s.content),d=t(l).children("div:eq(0)").metadata();d=t.extend({name:e,target:i},d),a&&(d=t.extend({},d,a)),s.data=d,s.widget=l.zdialog(d),l.zdialog("setAssociatedObj",o)}var d=s.data;if(d.maintainPosition&&s.position&&(d.position=s.position),n.onLoad){var c=n.onLoad;c()}this._checkAndCloseLastStaticDialog(s.data,s.widget),s.widget.zdialog("open",d.position),a&&a.doNotOpen&&s.widget.zdialog("close"),this._changeRequestStatus(e,"close"),s.widget.one("dialogclose",function(){d.maintainPosition&&(s.position=s.widget.dialog("option","position")),!d.hideOnClose&&s.widget&&s.widget.length&&(s.widget.remove(),delete s.widget)})},_changeRequestStatus:function(t){this.dialogs[t].requestStatus=!1},_cacheDialog:function(t,e){var i=this.dialogs[t];i||(i={},this.dialogs[t]=i),this.dialogs[t].cacheStatus=!0,e.content&&(i.content=e.content),i.widget=e.widget},_getReplacedData:function(t){var e={},i=this.options.dataFormat;for(key in i)value=i[key],"TIME"==value?value=(new Date).getTime():"DIALOG_NAME"==value&&(value=t),e[key]=value;return e},_fetchDialogContent:function(e,i,o,a,n,s){if(this.dialogs[e].requestStatus)return!1;this.dialogs[e].requestStatus=!0;var l=this;s||(s={}),"boolean"!=typeof s.addDefaultData&&(s.addDefaultData=!0);var d="object"==typeof s.ajax?s.ajax:{},c="string"==typeof d.requestType?d.requestType:"GET",g="string"==typeof d.url?d.url:this.options.dialogFetchUrl,u=t.extend({},this._getReplacedData(e),d.data);s.addDefaultData||(u=d.data),t.ajax({type:c,url:g,data:u,error:function(){l._changeRequestStatus(e,"close")},success:function(t){var d=void 0;t&&l._cacheDialog(e,{content:t}),l.dialogs[e].cacheStatus=!0,i?(l._changeRequestStatus(e,"close"),i()):d=l._initDialog(e,o,a,n,s)}})},close:function(t){var e=this.dialogs[t];e&&e.widget&&e.widget.zdialog("close")},isDialogOpened:function(e){if(!e)return!!t(".ui-dialog:visible").length;var i=this.dialogs[e],o=!1;return i&&i.widget&&(o=i.widget.parent().is(":visible")),o},preLoadAllDialogs:function(){this._preloadDialog(0)},_preloadDialog:function(t){var e=this,i=this.options.dialogNames[t];i&&(this.dialogs[i]?e._preloadDialog(++t):(this.dialogs[i]={},this._fetchDialogContent(i,function(){setTimeout(function(){e._preloadDialog(++t)},300)})))},refreshValues:function(t,e,i,o){var a=this.dialogs[e];a&&a.widget&&a.widget.zdialog("refreshValues",t,i,o)},_getElementType:function(e){return t(e).is(".ui-button")?"button":void 0},_getButtonObject:function(e){return t(e).parent().hasClass("ui-buttonset")?t(e).parent().hasClass("ui-button-splitbutton")?t(e).parent().parent():t(e).parent():e},makeCenter:function(t){var e=this.dialogs[t];e&&e.widget&&e.widget.dialog("option","position","center")},configure:function(t){this.options=t,t.preload&&this.preLoadAllDialogs()}},ZComponents.showConfirmMessage=function(e){e=t.extend({},e,{type:"confirm"}),ZComponents.showMessageDialog(e)},ZComponents.showAlertMessage=function(e){e=t.extend({},e,{type:"alert"}),ZComponents.showMessageDialog(e)},ZComponents.showPromptMessage=function(e){e=t.extend({},e,{type:"prompt"}),ZComponents.showMessageDialog(e)},ZComponents.showMessageDialog=function(e){function i(i){var o={isCancel:!0};i&&(o={isCancel:!1,value:"prompt"===e.type?t("#ui-zdialog-"+e.type+"-textbox").val():void 0}),t("#ui-zdialog-"+e.type).trigger("messageDialogClose",o),ZComponents.closeMessageDialog("ui-zdialog-"+e.type),e.onClose&&e.onClose(o)}var o=t("#ui-zdialog-"+e.type);o&&o.length&&ZComponents.closeMessageDialog("#ui-zdialog-"+e.type);var a={position:["auto",window.innerHeight/3/3],title:e.primary,modal:!0,closeButton:!1,resizable:!1,autoOpen:!0},n=t("<div ctype='zdialog' id='ui-zdialog-"+e.type+"'></div>");void 0!==e.secondary&&n.append("<span>"+e.secondary+"</span>"),"prompt"===e.type?(n.append("<br><input id='ui-zdialog-"+e.type+"-textbox' type='text'/>"),e.commandType="ok-cancel"):"confirm"===e.type?e.commandType="ok-cancel":"alert"===e.type&&(e.commandType="default"),a.buttons=void 0!==e.buttons?e.buttons:ZComponents._getButtonPanelElements(e);var s=0;t.each(a.buttons,function(t,e){e.click=function(){i("true"===e.indicate)},s+=e.text.length}),s>50&&(a.width="auto"),n.on("dialogopen",function(){if(""===e.primary||void 0===e.primary?n.closest(".ui-dialog").find(".ui-dialog-titlebar").remove():e.titleClass&&n.closest(".ui-dialog-titlebar").find("span").addClass(e.titleClass),n.css("border-top-width","0px"),e.icon){var i=t("<span />").addClass("ui-zalert-icon "+e.icon);""===e.primary||void 0===e.primary?n.prepend(i):n.prev(".ui-dialog-titlebar").prepend(i)}n.find("span").last().addClass("ui-zdialog-msg"),n.closest(".ui-dialog").addClass("ui-alert-dialog");var o=n.next().find("button");1===o.length?o.addClass("ui-zbutton-secondary"):2===o.length&&(t(o[0]).addClass("ui-zbutton-primary"),t(o[1]).addClass("ui-zbutton-secondary")),e.onOpen&&e.onOpen()}),n.zdialog(a)},ZComponents.closeMessageDialog=function(e){t("#"+e).zdialog("close").remove()},ZComponents._getButtonPanelElements=function(t){t.keys={ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"};var e=[{id:"ui-zdialog-cancel",text:t.keys.cancel,indicate:"false"},{id:"ui-zdialog-ok",text:t.keys.ok,indicate:"true"},{id:"ui-zdialog-yes",text:t.keys.yes,indicate:"true"},{id:"ui-zdialog-no",text:t.keys.no,indicate:"false"}];return"yes-no-cancel"===t.commandType?e.splice(1,1):"ok-cancel"===t.commandType?e.splice(2,2):"yes-no"===t.commandType?e.splice(0,2):("default"===t.commandType||void 0===t.commandType)&&(e.splice(0,1),e.splice(1,2)),e}}(jQuery);
var sheetdialog=function(e){var t={},o=void 0,n=void 0,l=void 0,a=!0,r=!1,s=!0,u=!1,c=!0,d=!1,f=!1,h="#cF",g=function(i,n,l,a){var r={},s=n;if(o=i,a){var u=a,c="",d=a.indexOf("?");-1!==d&&(u=a.slice(0,d),c=a.slice(d+1,a.length)),r={ajax:{url:u,cache:!1,data:O(c),requestType:"POST"},addDefaultData:!1,onLoad:"function"==typeof s?s:void 0}}e.dialogutil.open(o,l,s,t,r)},m=function(){var e=Math.round(1e10*Math.random());return r=!0,e.toString()},v=function(i,n){o=m();var l=e("<div/>",{id:o});l.html(i).zdialog(t).zdialog("open"),e.ui.utils.initComponents(l),e.ZToolbarHandler.init(["#"+o]),n&&n()},b=function(i,t){var o=e("#sheetnotifydialog");o.css({"max-width":"500px","min-width":"300px"}),o.html(i).zdialog(t).zdialog("open"),o.parent().find(".ui-dialog-titlebar-close").hide(),e(o.parent().find("button")[0]).focus()},p=function(i){var n={autoOpen:!1,modal:!1,resizable:!1,close:function(t,n){i.close&&i.close(t,n),d=!1,z(),featurePermission.resetPermission(),mask.bottomBand(!1,!1),f&&(allowtowrite=!0,f=!1),r&&(e("#"+o).zdialog("close").remove(),r=!1)}};i&&Object.keys(i).forEach(function(e){"close"!=e&&(n[e]=i[e])}),t=n},O=function(e){var t={};if(e){var o=e.split("&");for(i=0;i<o.length;i++){var n=o[i].indexOf("="),l=o[i].substring(0,n),a=o[i].substring(n+1);t[l]=a}}return t},w=function(){REMOTE.MODE===REMOTE.SCRATCHVIEW&&e.ajaxSetup({headers:{"User-Locale":USER_LOCALE}}),e.dialogutil.configure({dialogNames:["findandreplacedialog","gotodialog","commentsdialog"],dialogFetchUrl:ctxpath+"openDialog.do",dataFormat:{DIALOG_NAME:"DIALOG_NAME"},preload:!0}),e.dialogutil.zIndex=1e4},D=function(e,i,t,o,n){exitFormatPainter(),a=void 0!==i.sheetswitch?i.sheetswitch:!0,u=void 0!=i.contextmenu?i.contextmenu:!1,s=void 0!=i.hidetoolbar?i.hidetoolbar:!0;var l=i.hidesheetTabMenu?i.hidesheetTabMenu:!0;if(y(!0),p(i),i.modal&&READ_WRITE&&(allowtowrite=!1,f=!0),featurePermission.setPermission({contextmenu:u,hidetoolbar:s,sheetswitch:a,allowToScroll:c,hidesheetTabMenu:l}),mask.bottomBand(!1,!0),h=document.activeElement,isCellEdited()&&!i.dontSubmit&&submitCell(),d=!0,"object"==typeof e){var r=e.html();v(r,t)}else-1!==e.indexOf("<")?v(e,t):g(e,t,o,n);setTimeout(function(){var e=k();e.length&&e.find("input").bind("focusout",function(){h=this})},1e3),setTimeout(function(){var e=k();e.length||(featurePermission.resetPermission(),f&&(allowtowrite=!0,f=!1))},3e3)},y=function(i){if(d||e.dialogutil.isDialogOpened(o)){if(i&&n)return;o&&(e.dialogutil.close(o),e("#"+o).zdialog("close"),e("#"+o)&&e("#"+o).remove())}dialogOpened&&closeDialog()},E=function(){e(sheetdialog.getOpenedDialog().children()[1]).dialog("option","closeOnEscape")&&y()},C=function(){d&&(n=k(),n.hide(),d=!1,l=o,o=void 0)},T=function(){n&&(n.show(),o=l,isNaN(o)||(r=!0),l=void 0,n=void 0,d=!0)},x=function(i,t){h=document.activeElement,ole.currObj&&(h=ole.currObj.el),e("#notifyDivCnt #notifyVal").html(i);var o=e("#notifyDivCnt").html(),n={width:"auto",title:jsMsg["Service.ZohoOffice"],modal:!0,resizable:!1,close:function(){z()},buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){j()},keypress:function(e){var i=browser_ie?window.event.keyCode:e.which;13===i&&e.preventDefault()},keyup:function(e){var i=browser_ie?window.event.keyCode:e.which;13===i&&j(t)}}]};setTimeout(function(){b(o,n)},200)},M=function(i,t){h=document.activeElement,ole.currObj&&(h=ole.currObj.el),e("#notifyDivCnt #notifyVal").html(i);var o=e("#notifyDivCnt").html(),n={width:"auto",resizable:!1,title:jsMsg["Service.ZohoOffice"],modal:!0,close:function(){j()}};n.buttons=t.buttons,setTimeout(function(){b(o,n)},200)},j=function(){e("#sheetnotifydialog").zdialog("destroy"),z()},z=function(){t.dontSubmit||(hideCellField(),exprField.value=getCellContent()),setTimeout(function(){var e=h.id;OLE[e]?ole(e)._setSelectLayer().positionActionBar():t.dontSubmit&&h.focus()},200)},S=function(){return o},A=function(){return t.title},k=function(){return e(".ui-dialog").filter(":visible")},L=function(){return d};return w(),{open:D,close:y,escClose:E,getDialogName:S,getTitle:A,getOpenedDialog:k,hideDialog:C,recallDialog:T,isDialogOpen:L,showAlertDialog:x,showConfirmDialog:M,closeNotify:j}}(jQuery);
!function(){var e=$.debounce(300,function(t){t=JSON.parse(t);for(var o=0;o<t.length;o++){var n=t[o];if(-1===n.sr||-1===n.er){var r=new XMLHttpRequest,a={rowsInPage:Row.getAvailableRows().toString(),startEnd:getAvailableStartRow()+":"+getAvailableEndRow(),tiles:sheetTable.childNodes.length,isFreezed:ISFREEZED,isRespondedInScroll:isRespondedInScroll,rid:RESOURCE_ID};r.open("post","/reporter.do",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send($.param(a)),appEvent.off("viewport.update",e)}}});appEvent.on("viewport.update",e)}();
jQuery(function(e){function t(){var t=e("<div>").css({width:"100px",height:"100px",overflow:"scroll"}).appendTo("body"),o=t.width()-t[0].scrollWidth;t.remove(),e.ZContextMenu.scrollWidth=o}function o(e){return!e.fromDataBinding}function n(t,n){if(n||(n={}),!t.button||0==t.button){var i=s(t);if(!i.is("input[type=file]")){o(n)&&u(i);var r=p(t,"popup");return r&&(r=p(t,"toolbar"))?e.ZContextMenu.colorpaletteRegistered?p(t,"colorpalette"):void 0:r}}}function i(e,t){e.data=t,t&&t.target&&(e.target=t.target);var o={left:e.clientX,top:e.clientY};return p(e,"context",o,!0)}function r(e){return e.parent().is("button")?e.parent():e}function a(t,o){var n=!1;return e.each(t,function(e,t){return t==o[0]?(n=!0,!1):void 0}),n}function u(e,t,o){setTimeout(function(){l(e,t,o)},10)}function l(t,o,n){var i=o?!1:!0;o=o?o:{};var r="data-association",l="["+r+"]";if(t=t.is(l)?t:e(t.parents(l).get(0)),!(!t.length||o&&void 0==o.disabled&&t.is(":disabled"))){if(n){if(a(n,t))return}else n=[];n.push(t[0]);var s=t.attr(r),c=e(s);c.each(function(r,l){if(l!=t[0]&&!a(n,e(l))){l=e(l);var s={fromDataBinding:!0};if("undefined"!=typeof o.visible)if(l.is("input, button")&&l.button("widget").hasClass("ui-button"))l=l.parent().hasClass("ui-button-splitbutton")?l.parent():l.button("widget"),l[o.visible?"show":"hide"]();else{var c=l.closest(".ui-zmenu");c.length?c.zmenu((o.visible?"show":"hide")+"MenuItem","#"+l.attr("id")):l[o.visible?"show":"hide"]()}if("undefined"!=typeof o.disabled)if(l.is("input, button")&&l.button("widget").hasClass("ui-button"))l.button(o.disabled?"disable":"enable");else{var c=l.closest(".ui-zmenu");c.length?c.zmenu((o.disabled?"disable":"enable")+"MenuItems","#"+l.attr("id")):l[o.disabled?"disable":"enable"](!1,!0,s)}if("undefined"!=typeof o.checked){if(t.is("[checked]")||t.is("input[type=checkbox]")||t.is("input[type=radio]")){var d=t.is(":checked");if(l.is(".ui-zmenu-item")){l.data("checked",d);var c=l.closest(".ui-zmenu");c.zmenu("check",l,d)}else l.attr("checked",d)}l.is("input, button")&&(l.data("ui-zbuttonset")?l.buttonset("refresh"):l.data("ui-zbutton")&&l.button("refresh"))}i&&l.trigger("click",s),u(l,o,n)}})}}function s(t){var o=t.data&&t.data.target?t.data.target:t.srcElement;if(o){var n=o.correspondingElement;n&&(o=e(n))}else o=e(t.target);return e(o)}function c(e){e.stopPropagation(),e.preventDefault()}function d(e){return e.is("input,button,textarea,select")?e.is(":disabled"):e.hasClass("ui-state-disabled")}function p(t,o,n,i){var a=s(t);if(a.closest(".ui-zmenu").length)return t.stopPropagation(),t.preventDefault(),!1;var u=e.ZContextMenu.currentMenu;if(!e.ZContextMenu.hideMenu(t))return!1;e.ZContextMenu.colorpaletteRegistered&&"colorpalette"!=o&&e.ZContextMenu.colorpalette.zcolorpalette("hide"),a=r(e(a));var l=h(a,o),p=l.attr;if(a=l.element,d(a))return!0;if(p){var M=e("#"+p);if("toolbar"==o&&!M.length){var v=e(a.parent().metadata().relatedTabPane);v.hasClass("ui-ztoolbar-panel")&&(M=v.ztoolbar("getToolbarAsMenu"),M.attr("relativeto","parent"),e(a).attr("popup",e(a).attr("toolbar")).removeAttr("toolbar"))}if(u&&u[0]==M[0]&&this._lastVisitedMenu[0]===a[0]&&M.metadata().toggle&&!i)return c(t),!1;this._lastVisitedMenu=a;var C=!0,g=d(e(l.element));if("colorpalette"!=o||g)g||(C=e.ZContextMenu.showMenu(M,a,n,t,i));else{var x=e(l.element).hasClass("ui-zcolorchooser")?e(l.element).prev():e(l.element),a=e(l.element),m=x.metadata().colorpaletteOptions?x.metadata().colorpaletteOptions:{},Z=e.data(a[0],"selectedColor");Z=Z&&"transparent"!=Z?Z:!1;var b=e.ZContextMenu.colorpalette;m.relativeto?e(b).attr("relativeto",m.relativeto):e(b).removeAttr("relativeto");var w=f(b,a);options=e.extend({},m,{relativeToEle:w,selectedColor:Z}),e.ZContextMenu.displayColorPalette(a,options,!0)}return C&&c(t),!C}return!0}function h(t,o){var n="["+o+"]";return t=t.is(n)?t:e(t.parents(n).get(0)),{element:t,attr:t.attr(o)}}function f(e,t){var o=e.attr("relativeto");if(o){for(var n=o.split("."),i=t,r=0;r<n.length;r++){try{var a=i[n[r]]();if(!a||!a.length)break}catch(e){break}i=a}i&&(t=i)}return t}function M(t,o,n,i){var r=t.attr("position");o=f(t,o);var a=o.offset(),u=o.outerHeight(),l=o.outerWidth(),s=t.outerHeight(),c=t.outerWidth();switch(r||(r="after_start"),r){case"after_start":a.top+=u,e.ui.directionIsRTL&&(a.left+=l,a.left-=c);break;case"after_end":a.top+=u,a.left+=l;break;case"before_start":a.top-=s;break;case"before_end":a.top-=s,a.left+=l;break;case"start_before":a.left-=c;break;case"start_after":a.left-=c,a.top+=u;break;case"end_before":a.left+=l;break;case"end_after":a.left+=l,a.top+=u;break;case"end_after_end":a.top+=u,a.left=a.left+l-c;break;case"overlap":break;case"after_pointer":a={left:n.clientX,top:n.clientY};break;case"adjustable":var d=a.top+u;e.ui.directionIsRTL&&(a.left+=l,a.left-=c);var p=t.data("height")<s?t.data("height")+2:s,h=d+s-e.ZContextMenu.windowHeight;if(h>0){var M=a.top-p;M=M>0?M:0,M>=e(window).scrollTop()&&(d=M)}a.top=d}var v=void 0!==i&&i.length?i.width():e.ZContextMenu.windowWidth;return a.left+c>=v&&(a.left=a.left-(a.left+c-v+2)),a}var v="zcontextmenu";_lastVisited=void 0,_lastVisitedMenu=void 0,e.ZContextMenu=function(o){bindEvents(e(o)),t()},e.ZContextMenu.clearTimout=function(){clearTimeout(e.ZContextMenu.ctimeout),e.ZContextMenu.ctimeout=void 0},e.ZContextMenu.hidingMenu=!0,bindEvents=function(t){t.on("click."+v,function(t,o){e.ZContextMenu.hidingMenu=!0,setTarget(t),e.ZContextMenu.clearTimout(),n(t,o)}),t.on("mousedown."+v,function(t){e.ZContextMenu.isColorpaletteShowing=!1,setTarget(t);var o=e(t.target);o.closest(".ui-zmenu, .ui-zmenu-scroll-top, .ui-zmenu-scroll-bottom").length||(e.ZContextMenu.ctimeout=setTimeout(function(){e.ZContextMenu.hideMenu()},100))}),t.on("contextmenu."+v,function(t,o){setTarget(t),e.ZContextMenu.clearTimout(),i(t,o)}),e(".ui-dialog").on("dialogdragstart."+v,function(e){n(e)}),e(document).on("element_state_changed",function(t,n){o(n)&&u(e(t.target),n)}),e(document).on("menuitemclicked",function(e,t){o(t)&&u(t.menuitem)}),e(document).on("tabselect",function(e,t){o(t)&&u(t.tab)})},setTarget=function(e){e.target.correspondingElement&&(e.target=e.target.correspondingElement)},e.ZContextMenu.getMenuPosition=function(e,t,o,n){return M(e,t,o,n)},e.ZContextMenu.highlightItem=function(e,t){if(!e.is(".ui-zcolorchooser")&&0!=e.metadata().highlightOnMenuShow){var o=t?"removeClass":"addClass",n="ui-state-highlight",i="ui-state-open";e[o](n);var r=e.parent();r&&(r[o](i),r.is(".ui-button-splitbutton")&&r[o](n))}},e.ZContextMenu.showMenu=function(t,o,n,i,r,a){if(!t||!t.length)return!1;var u=void 0,l=t.metadata();l&&(u=l.componentOptions),r||t.one("menushow.zcontext",function(t,o){o.skipHighlightTarget||e.ZContextMenu.highlightItem(e(o.target))}),t.zmenu(u),n||(n=M(t,o,i));var s=n.left,c=n.top;return e.ZContextMenu.currentMenu=t,t.zmenu("show",{left:s,top:c,currentTarget:i.target,target:o,event:i,isRightClick:r},void 0,a),e.ZContextMenu._isMenuShowing=!0,e.ZContextMenu.hidingMenu=!1,t.one("menuhide.zcontext",function(t,o){var n=e(o.currentTarget).closest(".ui-button").length?e(o.currentTarget).closest(".ui-button"):e(o.target);e.ZContextMenu.highlightItem(n,!0),e.ZContextMenu.currentMenu=void 0,e.ZContextMenu._isMenuShowing=!1}),!0},e.ZContextMenu.hideMenu=function(t){return(e.ZContextMenu.currentMenu&&e.ZContextMenu._isMenuShowing||e.ZContextMenu.colorpalette&&e.ZContextMenu.colorpalette.is(":visible"))&&(e.ZContextMenu.currentMenu&&e.ZContextMenu.currentMenu.hasClass("ui-zmenu")?e.ZContextMenu.currentMenu.zmenu("hide"):e.ZContextMenu.isColorpaletteShowing=!0,e.ZContextMenu._isMenuShowing=!1,e.ZContextMenu.currentMenu=void 0,t&&e.ZContextMenu.consumeEventOnMenuHide)?(t.stopPropagation(),t.preventDefault(),!1):!0},e.ZContextMenu._tabDropdownClicked=void 0,e.ZContextMenu.currentMenu=void 0,e.ZContextMenu._colorpaletteHoveredMenuItem=void 0,e.ZContextMenu._isMenuShowing=!1,e.ZContextMenu.colorpalette=void 0,e.ZContextMenu.windowWidth=e(window).width(),e.ZContextMenu.windowHeight=e(window).height(),e.ZContextMenu.colorpaletteRegistered=!1,e.ZContextMenu.displayMenuComponents=function(t,o){e.ZContextMenu._colorpaletteHoveredMenuItem&&(e.ZContextMenu.displayColorPalette(void 0,void 0,!1),e.ZContextMenu._colorpaletteHoveredMenuItem=void 0);var n=o.menuitem.metadata();if(n.colorpalette){var i=e(o.menuitem),r=e(n.relatedButton);r=r.data("menuButton")?r.data("menuButton"):r,i.addClass("ui-state-hover");var a=n.colorpaletteOptions?n.colorpaletteOptions:{},u=e.data(e(r)[0],"selectedColor");u=u&&"transparent"!=u?u:!1;var l=e.ZContextMenu.colorpalette;a.relativeto?l.attr("relativeto",a.relativeto):l.removeAttr("relativeto"),options=e.extend({},a,{relativeToEle:r,selectedColor:u}),e.ZContextMenu.colorpalette.one("colorpaletteshow",function(){var t=e.ZContextMenu.adjustElementPosition({bufferWidth:i.width()+l.width(),bufferHeight:l.height()-i.outerHeight(),top:i.offset().top,left:i.offset().left+i.width(),width:l.width(),height:l.height()});e.ZContextMenu.colorpalette.addClass("ui-zcolorpalette-menu-popover"),e.ZContextMenu.colorpalette.css({top:t.top,left:t.left})}),e.ZContextMenu._colorpaletteHoveredMenuItem=i,e.ZContextMenu.colorpalette.one("mouseenter",function(){e.ZContextMenu._colorpaletteHoveredMenuItem&&e.ZContextMenu._colorpaletteHoveredMenuItem.addClass("ui-state-hover")}),i.one("mouseleave",function(){l.is(":visible")&&e.ZContextMenu._colorpaletteHoveredMenuItem&&e.ZContextMenu._colorpaletteHoveredMenuItem.addClass("ui-state-hover")}),l.zcolorpalette("show",r,options)}},e.ZContextMenu.adjustElementPosition=function(t){return e.ZContextMenu.windowWidth-(t.left+t.width+e.ZContextMenu.scrollWidth)<5&&(t.left=t.left-t.bufferWidth),e.ZContextMenu.windowHeight-(t.top+t.height+e.ZContextMenu.scrollWidth)<5&&(t.top=t.top-t.bufferHeight),t},e.ZContextMenu.registerColorpalette=function(t){e.ZContextMenu.colorpalette||(e.ZContextMenu.colorpalette=e("<div>"),e("body").append(e.ZContextMenu.colorpalette),e.ZContextMenu.colorpalette.zcolorpalette(t),e.ZContextMenu.colorpalette.on("colorpalettecolorselected",function(t,o){e(o.colorpicker).trigger("colorpalettecolorselected",o),e.data(e(o.colorpicker)[0],"selectedColor",o.color)}).on("colorpalettehover",function(t,o){e(o.colorpicker).trigger("colorpalettehover",o)}),e.ZContextMenu.colorpaletteRegistered=!0)},e.ZContextMenu.displayColorPalette=function(t,o,n,i){var r=e.ZContextMenu.colorpalette;r&&(setTimeout(function(){n?r.focus():r.focusout()},10),n?r.one("colorpalettebeforeshow",function(t,o){var n=e(o.colorpicker).trigger("colorpalettebeforeshow",o);return n===!1?!1:void 0}).one("colorpaletteshow",function(t,o){e(o.colorpicker).trigger("colorpaletteshow",o),e.ZContextMenu.highlightItem(e(o.colorpicker))}).one("colorpalettehide",function(t,o){e(o.colorpicker).trigger("colorpalettehide",o),e.ZContextMenu.highlightItem(e(o.colorpicker),!0)}):e.ZContextMenu._colorpaletteHoveredMenuItem&&e.ZContextMenu._colorpaletteHoveredMenuItem.removeClass("ui-state-hover"),e.ZContextMenu.isColorpaletteShowing&&this._lastVisited&&t&&this._lastVisited[0]===t[0]&&(n=!1),this._lastVisited=t,i?r.zcolorpalette(n?"openAdvancedColorPalette":"closeAdvancedColorPalette",t,o):r.zcolorpalette(n?"show":"hide",t,o))},e.fn.zcontextmenu=function(){e.ZContextMenu(this),e(window).on("resize."+v,e.debounce(500,function(){e.ZContextMenu.windowWidth=e(window).width(),e.ZContextMenu.windowHeight=e(window).height()})).on("resize.z"+v,function(){e.ZContextMenu.hideMenu()})},e(document).zcontextmenu()});
jQuery(function(t){function e(e,i){var a=e.data("menuButton");a&&a.button(i?"disable":"enable"),e=t(e);var u=void 0,r=void 0;if(e.is(".ui-zmenu-item")?(u=t(e.parents(".ui-zmenu").get(0)),r="zmenu"):(u=e.is("[ctype]")?e:t(e.parents("[ctype]").get(0)),r=u.attr("ctype")),!u.length)return!1;switch(r){case"ztoolbar":u[r](i?"disableButton":"enableButton",e.attr("id"));break;case"zmenu":u[r]("disableMenuItem",e.attr("id"),!i);break;case"button":case"zbutton":n(e,!i);break;default:return e.is("[ctype]")?(e[e.attr("ctype")](i?"disable":"enable"),!0):!1}return!0}function n(t,e){if(t.is(".ui-button")){if(t.button(e?"enable":"disable"),t.metadata().splitbutton){var n=t.next(".ui-splitbutton");n.length&&n.button(e?"enable":"disable")}return!0}return!1}function i(e){n(e)||t(e).is(":disabled")||(t(e).attr("disabled","true"),t(e).addClass("ui-state-disabled"),s[d]=t(e),d++)}function a(e,i){n(e,!0)||(i?u(e):t(e).removeAttr("disabled"),t(e).removeClass("ui-state-disabled"))}function u(){t(s).each(function(e,n){t(n).removeAttr("disabled")})}function r(t,e,n){n=n?n:{},n.element=t,n.disabled=e,t.trigger("element_state_changed",n)}var s=[],d=0,o=function(u,r,s,d){if(!e(u,r)){if(!s)return void(r?i(t(u)):a(t(u),!0,void 0,d));var o=t(u).find("[ctype]");t(o).each(function(e,i){i=t(i);var a=i.attr("ctype");"zbutton"==a&&(a="button"),n(i,!r)||i[a](r?"disable":"enable")}),o=t(u).find("select,div,button,input:not([ctype]):not(.ui-widget)"),t(o).each(function(e,n){n=t(n);var s=n.closest(".ui-widget");u.has(s[0]).length||(r?i(n):a(n,d))}),r?i(u):a(u)}};t.fn.disable=function(e,n,i){var a=t(this);o(a,!0,e),(void 0==n||n)&&r(a,!0,i)},t.fn.enable=function(e,n,i,a){var u=t(this);o(u,!1,e,a),(void 0==n||n)&&r(u,!1,i)}});
!function(n){var e={},r=function(r){n.isArray(r)&&(r=r[0]),e=r},t="key",i="module",u="service",f=function(n){var e=n.split(".",2),r={};if(2!=e.length)return r[t]=n,r;r[u]=e[0],r[i]=e[1];var f=e[0].length+e[1].length+1,o=n.indexOf(".",f);return r[t]=n.substring(o+1,n.length),r},o=function(n,r,t){var i=e[n],u="[noi18n] "+r;if(i){var f=i[r];f&&(u=g(f,t))}return u},g=function(n,e){if("undefined"!=typeof e&&e.length>0)for(var r=0;r<e.length;r++){var t=new RegExp("\\{"+r+"\\}","gi");n=n.replace(t,e[r])}return n},a=function(n,e){var r=f(n);return o(r[i],r[t],e)};n.i18n=function(){var n=arguments,e=n[0];return 1==n.length&&"object"==typeof e?r(e):n.length>=1?"string"==typeof n[1]?o(n[0],n[1],n[2]):a(e,n[1]):void 0}}(jQuery);
!function(e){var t={_create:function(){this.element.attr("tabindex","0").addClass("ui-focusable").css("outline","0")},getFocusElement:function(){return this.element},focus:function(){this.element.focus()},destroy:function(){this.element.unbind(this.widgetName).removeClass("ui-focusable").removeAttr("tabindex")}};e.widget("ui.focusable",t)}(jQuery);
!function(t){var e={_prevented:!1,_shortcutkeys:!0,_changeShortCut:!1,_isMac:!1,_spCharArr:{"<F1>":"112","<F2>":"113","<F3>":"114","<F4>":"115","<F5>":"116","<F6>":"117","<F7>":"118","<F8>":"119","<F9>":"120","<F10>":"121","<F11>":"122","<F12>":"123",PRINTSCREEN:"44",NUMLOCK:"144",PAUSE:"19",INSERT:"45",HOME:"36",PAGEUP:"33",PAGEDOWN:"34",DELETE:"46",END:"35",TAB:"9",CAPSLOCK:"20",WINDOWS:"91",ARROW_UP:"38",ARROW_DOWN:"40",ARROW_LEFT:"37",ARROW_RIGHT:"39",ENTER:"13",BACKSPACE:"8",SPACE:"32",ESCAPE:"27",DOT:"190",".":"190","":"226",91:"219",92:"220",93:"221",61:"187",45:"189",96:"192",44:"188",47:"191",39:"222",59:"186",123:"219",124:"220",125:"221",43:"187",95:"189",126:"192",60:"188",62:"190",63:"191",34:"222",58:"186",33:"49",64:"50",35:"51",36:"52",37:"53",94:"54",38:"55",42:"56",40:"57",41:"48"},_create:function(){this.options=t.extend({},t.ui.shortcutkeys.defaults,this.options),this._isMac=this._isMacOS(),this._isWindows=this._isWindowsOS();var e=this;t(document).on("keydown",function(t){e._shortcutkeys&&e._keyDown(t)})},_keyDown:function(t){if(this._checkTargetElement(t)){var e=this._getShortCutObject(t);e.eventObj&&"keyup"!==e.eventObj.handleOn&&this._triggerShortCut(e.eventObj,t,e.shortcutkey)}},_keyUp:function(t){if(this._checkTargetElement(t)){var e=this._getShortCutObject(t);e.eventObj&&"keyup"===e.eventObj.handleOn&&this._triggerShortCut(e.eventObj,t,e.shortcutkey)}},_checkTargetElement:function(e){if(this.options.discardInputElements){var r=e.srcElement;if(r||(r=e.target),r=t(r),!r.hasClass("ui-focus-element")&&(r.is("input")||!r.data("shortcut")&&void 0!=r.data("shortcut")||r.is("textarea")))return!1}return!0},_getShortCutObject:function(e){var r="",i=e.keyCode;e.ctrlKey&&(r+="ctrl+"),this._isMac&&e.metaKey&&(r+="cmd+"),e.shiftKey&&(r+="shift+"),e.altKey&&(r+="alt+");var s=String.fromCharCode(i);i>=65&&90>=i&&(i=s.charCodeAt());var n=this,o=r;r+=i;var a=r,u=t.ui.shortcutkeys.keys[r];if(!u)for(var c in n._spCharArr){if(n._spCharArr[c]===i.toString()){var h=o+c.toLowerCase();a=h,u=t.ui.shortcutkeys.keys[h]}if(u)break}return{eventObj:u,shortCutKey:a}},_triggerShortCut:function(e,r,i){this._prevented=!0;var s=t(e.element);s&&!s.is(":disabled")&&(s.trigger(e.event,{ele:s,fromShortCut:!0,shortcutkey:i}),(s.is(".ui-button")||s.is("input, button"))&&s.button("refresh"),r.preventDefault(),r.stopPropagation())},_getShortCutKey:function(t,e){var r=void 0;for(var i in t)t[i]===e.toString()&&(r=i.toLowerCase());return r},_registerKey:function(e,r,i,s){var n=this._sortKeyCombination(r);n&&(t.ui.shortcutkeys.keys[n]={element:e,event:i,handleOn:s.handleOn})},_isMacOS:function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mac")},_isWindowsOS:function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("win")},_unregisterKey:function(e){var r=this._sortKeyCombination(e);r&&delete t.ui.shortcutkeys.keys[r]},_sortKeyCombination:function(e){var r=["ctrl","cmd","shift","alt"],s=e.split("+"),n="",e="";for(i=0;i<t(r).size();i++)for(j=0;j<s.length;j++)r[i]==s[j]?n+=s[j]+"+":-1==t.inArray(s[j],t(r))&&(e=s[j]),""==s[j]&&(e="+");return this._spCharArr[e.toUpperCase()]||(e=e.toUpperCase().charCodeAt(0)),n+=e},register:function(e){e=t(e);var r=e.metadata(),i=this._getKey(e,this._isMac),s={},n=r.shortcutkey&&r.shortcutkey.event?r.shortcutkey.event:"click",o=r.skipshortcutregister;if(s.handleOn=this._isWindows||"keyup"!==r.handleOn?r.handleOn:"keydown","keyup"!==s.handleOn||this._keyUpEvent||this._bindKeyUpEvent(),n=n?n:"click",i){var a=this;t.each(i,function(t,u){o||a._registerKey(e,u,n,s),r.skipShortcutFormat||(u=a._getDisplayKey(u),i[t]=u)})}return i?i:!1},_bindKeyUpEvent:function(){var e=this;this._keyUpEvent=!0,t(document).on("keyup.shortcutkeys",function(t){e._shortcutkeys&&e._keyUp(t)})},unregister:function(e){e=t(e);var r=this._getKey(e,this._isMac);r||(r=this._getKey(e));var i=this;t.each(r,function(t,e){i._unregisterKey(e)})},getShortcutKey:function(e){var r=this._getKey(e,this._isMac);if(r){var i=this;return t.each(r,function(t,e){r[t]=i._getDisplayKey(e)}),r}return!1},arrowSymbols:{Arrow_up:" &uarr;",Arrow_down:" &darr;",Arrow_left:" &larr;",Arrow_right:" &rarr;"},_getDisplayKey:function(e){var r=e.split("+"),i="";return t(r).each(function(t,e){e=e.charAt(0)==e.charAt(0).toUpperCase()?e.toUpperCase():e.charAt(0).toUpperCase()+e.substring(1,e.length),r.length-1!=t&&(e+="+"),i+=e}),i},_getKey:function(e,r){var i=e.metadata(),s=i.shortcutkey,n=this;if(s){var o="object"==typeof s&&t.isArray(s)?s:[s];return t.each(o,function(t,e){var s=e,a=i.skipShortcutFormat;return"object"!=typeof s||(e=r&&s.mac?s.mac:s.key,a=s.skipShortcutFormat,s.key||n._isMac)?(e&&!s.mac&&n._isMac&&(e=e.replace(/ctrl/i,a?"Cmd":"cmd")),a||(e=e.toString().toLowerCase()),void(o[t]=e)):!1}),o}},enable:function(){this._shortcutkeys=!0},disable:function(){this._shortcutkeys=!1}};e=t.extend({},t.ui.key,e),t.widget("ui.shortcutkeys",e),t.ui.shortcutkeys.keys={},t.ui.shortcutkeys.defaults={type:"click",discardInputElements:!0,keycode:!1},t.ui.shortcutkeys.getter=["register"],t.ui.shortcutkeys.register=function(e){return t(document).shortcutkeys("register",e)},jQuery(function(t){t(document).shortcutkeys()})}(jQuery);
!function(t){t.widget("ui.zbutton",{_dropDownIcon:"ui-components-icon ui-icon-triangle-1-s",_noIcon:"ui-zbutton-no-icon",_create:function(){this._make(this.element)},widgetEventPrefix:"button",_ctypeElems:".ui-zoom-panel,.ui-hiddenslider,.ui-zslider-panel,.ui-zstate,.ui-zspinner,.ui-ztoggle,.ui-zcombo,.ui-zcolorchooser",_EVENTS:{ONICON_CHANGE:"iconchange",ONLABEL_CHANGE:"labelchange"},options:{noIconScope:!1,iconScope:"",keys:{"validfilemessage.label":"Please select a valid file"}},_getLabel:function(e){var n=e.next("label");if(n.length)return n;n=void 0;var i=e.metadata().label;return i||(i=e.attr("label")),i&&(n=t("<label>").text(i).insertAfter(e),"file"!=e.attr("type")&&n.attr("for",e.attr("id"))),n},_make:function(e){if(e.is("input[type=file]"))return this._makeFileButton();e=e?e:this.element;var n=this._getData(e);if(e.is("input")&&this._getLabel(e),n.buttonset){if("bottom"!==this.options.labelPosition&&(e.parent().metadata().buttonset?e.parent().addClass("ui-buttonset-sep-main"):e.addClass("ui-buttonset-sep-main"),n.label)){var i=t("<button>").attr({disabled:"disabled",class:"ui-buttonset-label",data:'{"label": "'+n.label+'"}'}).text(n.label);"right"===this.options.labelPosition?i.insertAfter(e.children(":last")).addClass("ui-buttonset-label-left"):i.insertBefore(e.children(":first")).addClass("ui-buttonset-label-right")}this._initButtonSet(e)}else n.splitbutton&&!n.splitInited?(n.splitInited=!0,this._initSplitButton(n,e)):this._initButton(n,e)},_makeFileButton:function(t){t=t?t:this.element;var e=this._getLabel(t);t.data("widgetBase",e),e.button().css("overflow","hidden").attr("autocomplete","off"),e.append(t.addClass("ui-zbutton-file"));var n=this;t.on("change."+this.widgetName,function(i){var a=t.val();if(e.attr("title",a),void 0!==a&&""!==a&&t.metadata().extension){var o=n._checkExtension(t,a);if(!o){i.stopImmediatePropagation();var s=t.metadata().validFileMessage,u=s?s:n._getString("validfilemessage.label","zerror");alert(u)}}})},_checkExtension:function(e,n){var i=e.metadata().extension.split(","),a=n.lastIndexOf("."),o=n.substr(a+1).toLowerCase();return t.inArray(o,i)<0?!1:!0},_getString:function(e,n){return t.i18n?t.i18n(n?n:"zbutton",e):this.options.keys[e]},_initItems:function(e){var n=this;t(e).each(function(e,i){var a=t(i),o=a.metadata();o.buttonset?(o=t.extend({},o,{iconScope:n.options.iconScope,labelPosition:n.options.buttonsetLabelPosition}),a.zbutton(o)):(a.is("input")||a.is("button"))&&n._make(a)})},_initButton:function(e,n){if(n=n?n:this.element,t.ui.shortcutkeys){t.ui.shortcutkeys.register(n)}var i=void 0;n.is("[type=file]")&&(i=n),n.is("[popup]")&&(e||(e={}),e.splitButtonDropDown||e.splitbutton||0==e.popupIcon||(e.icons||(e.icons={}),e.icons.secondary=this._dropDownIcon)),n.button(e).attr("autocomplete","off"),e.noIconScope&&n.button("widget").find(".ui-icon").removeClass("ui-icon"),i&&i.css({position:"absolute",opacity:0}),n.is("button")&&n.on("mouseout."+this.widgetName,function(){n.removeClass("ui-state-focus")}),n.is("input")&&n.button("widget").addClass(n.attr("class")).removeClass("ui-helper-hidden-accessible"),n.is(":disabled")&&this._disable("#"+n.attr("id"))},_initButtonSet:function(e,n){n||e.on("change",function(){e.find("input").each(function(e,n){n=t(n);var i=n.data("menuButton");i&&!n.is(":checked")&&i.triggerHandler("mouseout")})}),buttonSet=e?e:this.element;var i=void 0;if(e.hasClass("ui-button-splitbutton")?i=t("input"+(n?"":", button")+":not([ctype], select)",buttonSet):(i=buttonSet.children(":not([ctype],"+this._ctypeElems+",select)"),buttonSet.addClass("ui-buttonset-container")),buttonSet.metadata().buttonset){t("input[type='radio']",buttonSet).length===i.length&&0!=i.length&&buttonSet.metadata().buttonset&&buttonSet.addClass("ui-zbutton-radioset");var a=buttonSet.parent();a.metadata().buttonset&&(a.metadata().mainButtonset=!0,buttonSet.metadata().innerButtonset=!0,buttonSet.addClass("ui-buttonset-inner"),buttonSet.next(":not(.ui-group-text)").length&&buttonSet.append(t("<span>").attr("class","ui-components-icon ui-buttonset-sep ui-icon-dot-separator")))}this._initItems(i),e.hasClass("ui-button-splitbutton")||e.buttonset();var o=e.find(".ui-button:first");o.prev(".ui-button").length||e.parent().metadata().buttonset?e.prev(".ui-buttonset").length||o.find(".ui-button-text").addClass("no-sep-bg"):o.find(".ui-button-text").addClass("no-sep-bg")},_initSplitButton:function(e,n,i){n=n?n:this.element;var a=t("<div>").addClass("ui-button-splitbutton ui-buttonset");n.metadata().id&&a.attr("id",n.metadata().id),a.insertBefore(n),a.css({display:"inline-block"});var o=n.attr("id"),s=o?o+"DropDown":void 0,u=void 0;n.is("input")?(u=n.next().next(),(!u.length||u.is(":not('button')"))&&(u=t("<button>").data("created",!0))):u=i||n.next().is(":not('button')")?t("<button>").data("created",!0):n.next(),u.addClass("ui-splitbutton"),u.text().length||u.text(this._getString("more.label","zcommon")),u.attr("id")||u.attr("id",s);var r=u.metadata();r.splitButtonDropDown=!0,r.text=!1,r.icons={primary:this._dropDownIcon},u.data("created")&&e&&e.appData&&(r.appData=e.appData);var d=void 0;n.is("input")&&(d=n.next()),a.append(n),d&&a.append(d),a.append(u),setTimeout(function(){u.removeAttr("title").data("title","")},1e3);var l=this._getData(n);if(l.splitButtonPopup&&u.attr("popup",l.splitButtonPopup),this._initButton(l,n),n.is(":disabled")&&u.attr("disabled",!0),this._initButton(r,u),e&&e.splitbuttonAttrs&&u.attr(e.splitbuttonAttrs),this._initButtonSet(a,!0),n.is("input")){var p="ui-state-active",c=n.button("widget");n.on("change",function(){u[c.hasClass(p)?"addClass":"removeClass"](p)}),n.button("widget").on("mousedown",function(){if(n.is("[type=radio]")){var e=t("input[type=radio][name="+n.attr("name")+"]:checked");e.button("widget").next(".ui-splitbutton").removeClass(p)}}),n.is(":checked")&&u.addClass(p),u.on("mouseout",function(){c.hasClass(p)&&u.addClass(p)})}return n.data("menuButton",u),a.hover(function(e){var n=t(e.target).closest(".ui-button");n.hasClass("ui-state-disabled")||a.addClass("ui-state-hover")},function(){a.removeClass("ui-state-hover")}),a.on("mousemove",function(e){var n=t(e.target).closest(".ui-button");n.hasClass("ui-state-disabled")&&a.removeClass("ui-state-hover")}),a},_getData:function(t,e){t=t?t:this.element;var n=t.metadata();return this.options.noIconScope||n.noIconScope||n.icons&&this.options.iconScope&&!e&&(n.icons.primary&&(n.icons.primary=this.options.iconScope+" "+n.icons.primary),n.icons.secondary&&(n.icons.secondary=this.options.iconScope+" "+n.icons.secondary)),n},_isButtonSet:function(t){return t.metadata().buttonset},expandButtonSet:function(e,n){var i=this.element;if(n){var a=t(i).children(":not(.ui-extended-buttonset,input)");a.each(function(e,n){t(n).show()});var o=i.data().popup;if(o){t(o).zmenu("destroy").remove(),i.data().popup=void 0;var s=i.data().popupButton;t("#"+s).zbutton("destroy"),t("#"+s).remove()}}else t(e).each(function(e,n){n.show();var a=n.is("button")?"shrinked_menuitem_"+n.attr("id"):"shrinked_menuitem_"+n.attr("for");if(i=n.parent(),n.hasClass("ui-button-splitbutton")){var o=n.children(".ui-splitbutton").attr("popup")?"group_":"";n=n.children(":first"),a=o+"shrinked_menuitem_"+n.attr("id"),n.is("input")&&(a=o+"shrinked_menuitem_"+n.next().attr("for"))}var s=t(i.data().popup);if(s&&(s.zmenu("removeMenuItem",a),0==s.zmenu("getItemCount"))){s.zmenu("destroy").remove(),i.data().popup=void 0;var u=i.data().popupButton;t("#"+u).zbutton("destroy"),t("#"+u).remove()}})},shrinkButtonSet:function(e){var n=this.element,i=this;if(n.metadata().mainButtonset){var a=n.data().popup;t(e).each(function(e,o){var s=t(o);if(!s.is(":hidden")){s.hide();var u=i.getAsObject(s,!0),r=s.parent();r.metadata().mainButtonset?(a=n.data().popup,a||i._createButtonsetMenu(n)):(a=r.data().popup,a||i._createButtonsetMenu(r)),a?a.zmenu("addMenuItem",u,0):(a=r.data().popup=t.ui.zmenu.createMenu(r.attr("id")+"Menu",t(u)),a.on("menuitemhovered",function(e,n){t.ZContextMenu.displayMenuComponents(e,n)}))}})}else{this._createButtonsetMenu(n);var a=n.data().popup;t(e).each(function(e,o){if(!o.is(":hidden")){o.hide();var s=i.getAsObject(o,!0);a?a.zmenu("addMenuItem",s,0):(a=n.data().popup=t.ui.zmenu.createMenu(t(o.parent()).attr("id")+"Menu",t(s)),a.on("menuitemhovered",function(e,n){t.ZContextMenu.displayMenuComponents(e,n)}))}})}},_createButtonsetMenu:function(e){if(e.metadata().buttonset&&!e.data().popup){var n=t(e).attr("id")+"Menu",i=t("<button class='ui-ztoolbar-splitmenu ui-extended-buttonset'>"+this._getString("moreoptions.label","zcommon")+"</button>");i.attr("data",'{"text": false, "icons":{"primary": "ui-icon ui-components-toolbar-icon ui-icon-zmore"}}'),i.zbutton(),i.attr({popup:n,id:n+"Button"}),i.css("width","16px"),i.insertAfter(e.children(":not(.ui-buttonset-sep)").last()),e.data().popupButton=n+"Button"}},shrinkButtonSetAsMenu:function(e){var e=e?e:this.element;if(!e.data().popup){var n=e.children(":visible:not(.ui-buttonset-sep,.ui-extended-buttonset,input)"),i=e.attr("id")+"Menu",a=e.children(":visible:first"),o=a.metadata(),s=o.label?o.label:this._getString("moreoptions.label","zcommon"),u=t("<button class='ui-ztoolbar-splitmenu ui-extended-buttonset'>"+s+"</button>");u.attr("data",'{"text": false, "icons":{"primary": "'+o.icons.primary+'", "secondary": "ui-components-icon ui-icon-triangle-1-s"}}'),u.zbutton(),u.attr({popup:i,id:i+"Button"}),u.insertAfter(e.children(":not(.ui-buttonset-sep)").last()),e.data().popupButton=i+"Button";var r=this,d=[];n.each(function(e,n){var i=t(n);i.is(":hidden")||(i.hide(),d[d.length]=r.getAsObject(i,!0))}),d.reverse(),e.data().popup=t.ui.zmenu.createMenu(i,d)}},getAsObject:function(e,n,i){e=e?e:this.element;var a=e,o=t(e).parent().hasClass("ui-buttonset")&&!t(e).parent().hasClass("ui-button-splitbutton"),s=e.metadata(),u={},r=void 0,d=void 0;if(o){if(e.hasClass("ui-button-splitbutton")&&(e=e.children(":first"),e.is("input")&&(e=e.next())),e.is("button")){if(r=t(e).attr("id"),r&&(u.id="menuitem_"+r,u.relatedButton="#"+r),u.mtype=e.attr("btype"),e.hasClass("ui-buttonset-label")&&(i?u.submenu="#"+e.parent().attr("id")+"menu":u.mtype="group"),e.parent().hasClass("ui-button-splitbutton")){var l=t(e).next(),p=l.attr("popup");p&&(u.submenu="#"+p,d="#"+l.attr("id"),u.mtype="splitmenu"),u.colorpalette=l.attr("colorpalette")}else{var p=t(e).attr("popup");p&&(u.submenu="#"+p),u.colorpalette=t(e).attr("colorpalette")}u["data-association"]="#"+r}else if(e.is("label"))if(r=e.attr("for"),u.id="menuitem_"+r,u["data-association"]="#"+r,u.label=e.text(),e=e.prev(),u.inputtype=t(e).attr("type"),t(e).is(":checked")&&(u.checked=t(e).is(":checked")),u.name=t(e).attr("name")+"zbutton",e.parent().hasClass("ui-button-splitbutton")){var l=t(e).next().next(),p=l.attr("popup");u.colorpalette=l.attr("colorpalette"),p&&(u.submenu="#"+p,d="#"+l.attr("id"),u.mtype="splitmenu")}else{var p=t(e).attr("popup");p&&(u.submenu="#"+p),u.colorpalette=t(e).attr("colorpalette"),u.relatedButton="#"+r}}else{var c=e.attr("id");if(r="menuitem_"+c,u.id=r,u.dataassociation="#"+r,e.parent().hasClass("ui-buttonset")){u.id="menuitem_"+t(e).attr("id"),s=e.metadata();var b=e.next(".ui-button").attr("popup");b&&(u.submenu="#"+b,d="#"+c,u.mtype="splitmenu")}else{var h=t(e).attr("popup");h&&(u.submenu="#"+h)}u["data-association"]="#"+c}var m=void 0;if(e.is("[data-association]")){var f=e.attr("data-association");u["data-association"]+=","+f,u.id&&(m=f+",#"+u.id)}else m="#"+u.id;m&&e.attr("data-association",m),!e.attr("disabled")&&!e.hasClass("ui-state-disabled")||e.hasClass("ui-buttonset-label")||i||(u.disabled=!0);var s=e.metadata();if(u.data=e.attr("data"),d&&(u.splitButtonData=d),u.icon=s.icons?s.icons.primary==this._noIcon?"ui-zmenu-no-icon":s.icons.primary:void 0,!u.label){var v=s.label;e.hasClass("ui-button")&&(u.label=v?v:e.text())}if(s.textIcon){u.iconText=u.label?u.label:e.text();var g=e.button("widget");u.label=g.attr("title"),u.icon=g.attr("class").split(" ")[0]}return u.shortcutkey=s.shortcutkey,u.skipshortcutregister=!1,u.baseButton=a,e.data("hidden")&&(u.hidden=!0),n&&(u.pos=0,u.id="shrinked_"+u.id),u},_destroySplitButton:function(e){var n=e?e:this.element,e=t("button",n).button("destroy");e.last(".ui-splitbutton").removeClass(".ui-splitbutton"),e.data("isInternal")&&e.remove(),t(n).buttonset("destroy")},_destroyFileButton:function(t){var e=t.data("widgetBase");t.insertBefore(e),t.data("widgetCreated")&&e.remove(),t.removeClass("ui-zbutton-file"),e.button("destroy"),t.off("."+this.widgetName)},destroy:function(){var e=this.element;e.is("input[type=file]")?this._destroyFileButton(e):e.is(".ui-buttonset")?e.buttonset("destroy"):e.metadata().splitbutton?this._destroySplitButton(e.parent()):e.button("destroy"),e.off("."+this.widgetName),t.Widget.prototype.destroy.apply(this,arguments)},check:function(t){this._check(!0,t)},uncheck:function(t){this._check(!1,t)},_check:function(e,n){var i=n?this.element.find(n):this.element;i.each(function(n,i){if(i=t(i),!i.is(":disabled")){if(i.hasClass("ui-buttonset"))return;i.prop("checked",e),i.metadata().splitbutton&&i.button("widget").next("button.ui-splitbutton")[e?"addClass":"removeClass"]("ui-state-active"),i.button("refresh"),i.trigger("element_state_changed",{checked:e})}})},_disable:function(e,n){var i=n?"enable":"disable",a=this.element.metadata(),o=a.splitbutton&&this.element.parent().hasClass("ui-buttonset")?this.element.parent():this.element;if(o.metadata().buttonset){var s=e?this.element.find(e):o.children("input, button, div");t.each(s,function(e,a){t(a).hasClass("ui-button-splitbutton")?t(a).find("input,button").button().attr("disabled",!n).button(i):t(a).attr("disabled",!n).button(i),t(a).trigger("element_state_changed",{disabled:!n,checked:t(a).is(":checked")})})}else o.attr("disabled",!n),o.data("ui-button")&&o.button(i),o.trigger("element_state_changed",{disabled:!n,checked:o.is(":checked")})},disable:function(t){this._disable(t)},enable:function(t){this._disable(t,!0)},_show:function(e,n){var i=n?"show":"hide",a=this.element.metadata(),o=a.splitbutton?this.element.parent(".ui-buttonset"):this.element;if(o.hasClass("ui-buttonset")){var s=e&&!a.splitbutton?this.element.find(e):o.children("input, button");t.each(s,function(e,a){t(a).button("widget")[i](),t(a).data("hidden",n?!1:!0),t(a).trigger("element_state_changed",{visible:n,disabled:t(a).attr("disabled"),checked:t(a).is(":checked")})})}else o.button("widget")[i](),o.data("hidden",n?!1:!0),o.trigger("element_state_changed",{visible:n,disabled:o.attr("disabled"),checked:o.is(":checked")})},show:function(t){this._show(t,!0)},hide:function(t){this._show(t,!1)},changeIcon:function(e,n){n&&(n=-1!=n.indexOf("#")?n:"#"+n);var i=n?this.element.find(n):this.element;i.data("fromButtonChange",!0);var a={};a.primary=i.button("option","icons").primary,a.secondary=i.button("option","icons").secondary,e&&(e.primary&&(a.primary=e.primary),e.secondary&&(a.secondary=e.secondary));var o=t(i.data("association")).data("fromMenuItemChange");t(a).length&&(i.button("option","icons",a),i.metadata().icons=a,o||this._triggerEvent(this._EVENTS.ONICON_CHANGE,{button:i,icons:a}))},changeLabel:function(e,n){n&&(n=-1!=n.indexOf("#")?n:"#"+n),ele=n?this.element.find(n):this.element;var i=t(ele.data("association")).data("fromMenuItemChange");e&&(ele.button("option","label",e),i||this._triggerEvent(this._EVENTS.ONLABEL_CHANGE,{button:ele,label:e}))},_triggerEvent:function(t,e){return this._trigger(t,t,e)}})}(jQuery);
!function(e){var t={_baseElement:void 0,_deltaWidth:23,_COMBO_SCOPES:{icon_text:"",icon_only:"ui-zcombo-icononly",text_only:"ui-zcombo-textonly",icon_only_floating:"ui-zcombo-icononly ui-zcombo-floating",text_only_floating:"ui-zcombo-textonly ui-zcombo-floating"},widgetEventPrefix:"combo",_EVENTS:{ONBEFORESHOW:"beforeshow",ONSHOW:"show",ONCHANGE:"change",ONOPTIONFOCUS:"onfocus",ONHIDE:"hide",ONCLICK:"click"},contentType:"text",_create:function(){if(this.options=e.extend({},e.ui.zcombo.defaults,this.options),this._buildCombo(),this._optionTextArray=[],this._onLoadCheck=!0,this._defaultIndex=this.element.get(0).selectedIndex,this._prevSearchKey="",this._prevSearchTimer=void 0,this._prevKeydownTime="","html"==this.options.contentType&&(this.options.editable=!1),this.options.defaultValue){var t=e("option[value='"+this.options.defaultValue+"']",this.element);t.length&&(this._defaultIndex=t.get(0).index)}this._defaultIndex=this._defaultIndex?this._defaultIndex:0;var o=this._buildDropDown();this._buildComboMenu(o),this._addEvents(),this.options.editable||this._optArea.addClass("ui-zcombo-readonly")},_addScopeForCombo:function(){var e=this.options.type;this._baseElement.addClass(this._COMBO_SCOPES[e])},_buildCombo:function(){var t="ui-zcombo "+this.element.attr("class")+(e.ui.directionIsRTL?" zmenu___rtl ":" ");this._baseElement=e("<div>").attr("class",t+(this.options.editable?"ui-zcombo-editable":""));var o=this.element.outerHeight();o&&this._baseElement.height(o),this._baseElement.width(this.element.outerWidth()+this._deltaWidth),this._baseElement.insertAfter(this.element.hide());var i=this;this._dropDownArrow=e("<div>").addClass("ui-zcombo-dropdown ui-state-default").hover(function(){i._dropDownArrow.addClass("ui-state-hover")},function(){i._dropDownArrow.removeClass("ui-state-hover")});var n=e("<div>").addClass("ui-icon ui-components-icon ui-icon-triangle-1-s");this._dropDownArrow.append(n),this._optArea=e("<div>").addClass("ui-zcombo-select-item").css({width:this._baseElement.outerWidth()-this._deltaWidth}),this._baseElement.append(this._dropDownArrow),this._baseElement.append(this._optArea),e(this._baseElement).focusable(),e(this._baseElement).on("focusin focus",function(){i._baseElement.hasClass("ui-state-disabled")||i._baseElement.addClass("ui-state-focus")}),e(this._baseElement).on("focusout",function(){i._baseElement.removeClass("ui-state-focus")}),this._addScopeForCombo(),e(this.element).is(":disabled")&&this.disable()},_buildDropDown:function(t,o){t=t?t:this.element;var i=this._onLoadCheck?":not(optgroup):eq("+this._defaultIndex+")":"",n=t[this._onLoadCheck?"find":"children"](i),s=[],r=this;return n.each(function(t,i){if("none"!=i.style.display){i=e(i);var n=i.attr("mtype"),a={};if("separator"==n)a.mtype="separator";else{var d=i.metadata();if(a=e.extend({},d),i.is("optgroup"))a.mtype=r.options.optgroupAsSplitMenu?"splitmenu":"group",a.label=i.attr("label"),a.id="optgroup"+i.attr("id"),a.menuItems=r._buildDropDown(i,o),a.attr={"data-isoptgroup":!0,"data-optgroupid":i.attr("id")};else{a.label=i.text();var l=Math.round(1e10*Math.random());i.attr("optionfor",l),a.attr={index:l},r._optionTextArray[r._optionTextArray.length]={text:i.dataDisabled?"":i.text(),value:i.val()},"icon_only"===r.options.type&&(a.title=i.text()),i.attr("hidden")&&(a.hidden=!0)}a._option=i}s[s.length]=a}}),s},_addOption:function(t,o,i){var n=this,s=[],t=t instanceof Array?t:[t];return o=o?o:n.element,e.each(t,function(t,r){var a={},d=Math.round(1e10*Math.random());targetElement=e("object"==typeof r.optionGroup?r.optionGroup:o),allItems=targetElement.children(),optionElement=e("object"==typeof r.options?'<optgroup label="'+r.label+'" data-readOnly="'+r.readOnly+'" id="'+r.id+'"></optgroup>':'<option value="'+r.value+'" data-readOnly="'+r.readOnly+'" optionfor="'+d+'" style="'+r.style+'" >'+r.label+"</option> "),insertAfter=!1,itemPosition=r.position<=0?0:r.position,itemPosition<allItems.length?(relativeOption=allItems.eq(itemPosition),optionElement.insertBefore(relativeOption)):optionElement.appendTo(targetElement),"separator"==r.mtype?a.mtype="separator":(a=e.extend({},optionElement.metadata()),a.pos=itemPosition,a.label=r.label,"object"==typeof r.options?(a.mtype=n.options.optgroupAsSplitMenu?"splitmenu":"group",a.menuItems=n._addOption(r.options,optionElement,r.id),a.attr={"data-isoptgroup":!0,"data-optgroupid":r.id},a.id="optgroup"+r.id):("object"==typeof r.optionGroup&&(i=i?i:r.optionGroup.attr("id"),a.menu=n.options.optgroupAsSplitMenu?e("#optgroup"+i).next().children("ul"):e("#optgroup"+i)),a.attr={index:d},n._optionTextArray[n._optionTextArray.length]={text:r.label,value:r.value},"icon_only"===n.options.type&&(a.title=r.label)),a._option=optionElement),s[s.length]=a}),s},addOption:function(e){var t=this._addOption(e,this.element);this._buildComboMenu(t)},removeOption:function(t){var o=e(this._getOptionWithValue(t)),i=o.attr("data-readOnly");"true"!==i&&o.length&&(t=t.replace(/\s+/g,""),e("li[index='"+o.attr("optionfor")+"']",this._dropDownMenu).attr("id","ui-zc-"+t),this._dropDownMenu.zmenu("removeMenuItem","ui-zc-"+t),this.element.find('option[value!="'+t+'"]').remove())},removeAllOptions:function(){var t=this.element.children();t.each(function(t,o){var i=e(o),n=i.attr("data-readOnly");"true"!==n&&i.remove()}),this._reloadDropDownMenu()},removeOptGroup:function(t){t=-1!=t.indexOf("#")?t:"#"+t;var o=e(t,this.element);o.length&&(o.remove(),this._dropDownMenu.zmenu("removeMenuItem","optgroup"+t))},updateOption:function(e,t,o){var i=this._getOptionWithValue(e);return o?void i.attr(t,o):i.attr(t)},_buildComboMenu:function(t){var o=this,i=function(e,t){var i=t._option;e.is("[mtype=separator]")||(o.options.applyOptionStyles&&i.is("[style]")&&e.attr("style",i.attr("style")),o.options.applyOptionClass&&i.is("[class]")&&e.addClass(i.attr("class")))};if(this._dropDownMenu)this._dropDownMenu.zmenu("addMenuItems",t,i);else{this._dropDownMenuId="combo_"+this.element.attr("id")+"Menu",this._dropDownMenu=e.ui.zmenu.createMenu(this._dropDownMenuId,t,{positionAlterable:!1,type:this.options.type,bindKeys:!1,addItemCallback:i,height:this.options.dropDownMenuHeight,menuClass:"ui-zcombo-dropdown"}),this._dropDownMenu.attr({position:"adjustable",relativeTo:"parent"}),this._dropDownArrow.click(function(e){o._showDropDown(e)}).attr("popup",this._dropDownMenuId);var n=this._baseElement.width();n>this._dropDownMenu.width()&&this._dropDownMenu.width(this._baseElement.width()),this._optArea.click(function(e){o._showDropDown(e,!0)}),this._dropDownMenu.metadata().toggle=!0}var s=this._onLoadCheck?this._defaultIndex:this.element.get(0).selectedIndex;this._setOptionValue(s,!0)},_showDropDown:function(e,t){return this._onLoadCheck&&this._reloadDropDownMenu(),this._prevSearchKey="",this._prevKeydownTime="",this._prevSearchIndex="",this._prevSearchTimer=void 0,t&&this.options.editable?this._handleEditable():void(t&&(this._dropDownArrow.click(),e&&(e.stopPropagation(),e.preventDefault())))},_handleEditable:function(){if(!this._baseElement.is(".ui-state-disabled")&&"html"!=this.options.contentType){var t=e(".ui-zmenu-text",this._optArea),o=t.text(),i=e("<input>").attr("type","text").val(o).addClass("ui-zcombo-editable");i.data("base",t),i.data("text",o);var n=this;i.blur(function(){n._finishEditing(!0)});var s=function(t){var o=t.keyCode;o!=e.ui.keyCode.ENTER&&o!=e.ui.keyCode.ESCAPE&&n._dropDownMenu.is(":hidden")&&n._baseElement.click();var s=i.val();if(s!=i.data("text")&&s.length){var r=n._optionInputSearch(s);if(r.length){var a=e("li[index='"+r.attr("optionfor")+"']",n._dropDownMenu);a.length&&(i.data("baseItem",a),n._selectRemainingTextOfEditable(i,a.text()),i.data("text",s))}}};i.on("keydown.comboeditable",e.debounce(250,s)),t.replaceWith(i),i.select()}},_selectRemainingTextOfEditable:function(e,t){var o=e.val();if(o!=e.data("text")){var i=t.indexOf(o)+o.length;e.val(t),e[0].setSelectionRange(i,t.length)}},_finishEditing:function(t){var o=e(".ui-zcombo-editable",this._optArea);if(o.length){var i=o.data("baseItem");o.off(".comboeditable");var n=o.data("base");if(i)i.click(),o.remove();else{var s=n.text(),r=o.val();n.text(r),o.replaceWith(n),s!=r&&this._triggerEvent(this._EVENTS.ONCHANGE,{prevVal:s,value:r})}t||this._handleEditable()}},_getOptionElements:function(){return e("option",this.element)},_getCorrectedOptPosition:function(e){var t=this._getOptionElements().length;return e>=t?e=t-1:0>e&&(e=0),e},_getOptionMenuPosition:function(t){if(this._onLoadCheck)return 0;var o=t-e("option",this.element).filter(function(){return"separator"==e(this).attr("mtype")&&e(this).index()<=t?!0:!1}).length;return o?o:0},_setOptionValue:function(t,o,i){t=this._getCorrectedOptPosition(t);var n=this.selected;this.selected=t;var s=i&&i.length?i:e(this._dropDownMenu.zmenu("getMenuItemAt",this._getOptionMenuPosition(t))),r=e(s.clone().html()),a=" width:"+this._optArea.css("width");if(this._optArea.empty().append(r),this._optArea.find(".ui-zmenu-shortcut").empty().remove(),!o){var d=this.element,l=void 0!=n?d.val():void 0;d.get(0).selectedIndex=t,l!=d.val()&&this._triggerEvent(this._EVENTS.ONCHANGE,{prevVal:l})}var h=this.element.get(0);h.selectedIndex=t;var u=e(".ui-zmenu-text:visible",this._optArea);if(u.length&&(this.options.optioinTextIsHTML?u.html(s.find(".ui-zmenu-text").html()):u.text(r.text())),this.options.applyOptionStylesOnCombo){var p=this.element.get(0).options[t].getAttribute("style");a+=null!=p?";"+p:"",a&&(this._optArea.attr("style",a),u.attr("style",a))}},_addEvents:function(){var t=this;this._dropDownMenu.on("menuhide."+this.widgetName,function(){t._triggerEvent(t._EVENTS.ONHIDE),t._baseElement.focusout().blur()}),this._dropDownMenu.on("menubeforeshow."+this.widgetName,function(){var e=t._triggerEvent(t._EVENTS.ONBEFORESHOW);return e?void t._dropDownMenu.zmenu("showMenuItemAsSelected",t._getOptionMenuPosition(t.selected)):!1}),this._dropDownMenu.on("menushow."+this.widgetName,function(){t._triggerEvent(t._EVENTS.ONSHOW)}),this._dropDownMenu.on("menuitemhovered."+this.widgetName,function(o,i){var n={focusItem:i.menuitem,focusValue:e("option[optionfor='"+e(i.menuitem).attr("index")+"']",this.element).val()};t._triggerEvent(t._EVENTS.ONOPTIONFOCUS,n)}),this._dropDownMenu.on("menuitemclicked."+this.widgetName,function(o,i){t._triggerEvent(t._EVENTS.ONCLICK);var n="option[optionfor='"+e(i.menuitem).attr("index")+"']";if(t.options.optgroupAsSplitMenu){var s=e(i.menuitem).data();s&&s.isoptgroup&&(n="#"+s.optgroupid+" :eq(0)")}t._setOptionValue(e(n,this.element).get(0).index,!1,e(i.menuitem)),t.options.retainFocus&&setTimeout(function(){t._setFocus()},200)}),this._baseElement.on("keydown."+this.widgetName,function(e){t._keyPress(e)})},_setCurrentSearchOption:function(t){var o=e("option[value='"+this._optionTextArray[t].value+"']",this.element);o.length&&(e("li",this._dropDownMenu).removeClass("ui-state-hover"),this._currentSearchOption=e("li[index='"+o.attr("optionfor")+"']",this._dropDownMenu),this._currentSearchOption.trigger("mouseover"),this._scrollToView("search"))},_scrollToView:function(){var e=this,t=e._dropDownMenu.scrollTop(),o=e._currentSearchOption.height(),i=e._currentSearchOption.position().top,n=e._dropDownMenu.height();return o>n-i?e._dropDownMenu.scrollTop(t+(i-(n/3-o))):-1>i&&e._dropDownMenu.scrollTop(i-o),e},_setFocus:function(){e(".ui-zcombo-editable",this._optArea).length||this._baseElement.focus()},setFocus:function(e){this._baseElement[e?"addClass":"removeClass"]("ui-state-focus")},_showMenuAndSelectOption:function(e){this._dropDownMenu.is(":visible")||this._dropDownArrow.click(),this._dropDownMenu.zmenu(e?"hoverNextMenuItem":"hoverPreviousMenuItem")},_handleDropDownKeyCode:function(e){this._dropDownMenu.zmenu("handleKeyCode",e)},_keyPress:function(t){var o=t.charCode||t.keyCode,i=!1,n=this;switch(o){case e.ui.keyCode.UP:this._showMenuAndSelectOption(),i=!0;break;case e.ui.keyCode.LEFT:this.options.editable||(this._showMenuAndSelectOption(),i=!0);break;case e.ui.keyCode.DOWN:this._showMenuAndSelectOption(!0),i=!0;break;case e.ui.keyCode.RIGHT:this.options.editable||(this._showMenuAndSelectOption(!0),i=!0);break;case e.ui.keyCode.SPACE:(this._dropDownMenu.is(":visible")||e(".ui-zcombo-editable",this._optArea).length<1)&&(i=!0);break;case e.ui.keyCode.ENTER:i=!0,this._finishEditing();{this._dropDownMenu.zmenu("selectHoveredMenuItem")}this._dropDownMenu.zmenu("hide");break;case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.HOME:this._handleDropDownKeyCode(o);break;case e.ui.keyCode.ESCAPE:this._dropDownMenu.is(":visible")&&(t.stopPropagation(),t.preventDefault(),e.ZContextMenu.hideMenu(),this.options.retainFocus&&setTimeout(function(){n._setFocus()},200));break;case e.ui.keyCode.TAB:this._dropDownMenu.is(":visible")&&(t.stopPropagation(),t.preventDefault(),e.ZContextMenu.hideMenu());break;default:this._dropDownMenu.is(":visible")&&(alphaNumericKey=String.fromCharCode(o),this._callOptionsSearch(alphaNumericKey,(new Date).getTime()))}i&&(t.stopPropagation(),t.preventDefault())},_callOptionsSearch:function(e,t){var o=!1;""!==this._prevKeydownTime&&t-this._prevKeydownTime>700?(o=this._prevSearchKey==e?!0:!1,this._prevSearchKey=e):this._prevSearchKey=this._prevSearchKey+e,this._prevKeydownTime=t,this._optionMenuSearch(o)},_optionMenuSearch:function(e){var t=new RegExp("^"+this._prevSearchKey.replace(/[|()\[{.+*?$\\]/g,"\\$0"),"i"),o=e&&this._prevSearchIndex<this._optionTextArray.length-1?this._prevSearchIndex+1:0;for(x=o;x<this._optionTextArray.length;x++)if(this._optionTextArray[x].text.match(t)){this._prevSearchIndex=x;var i=!1;for(y=x+1;y<this._optionTextArray.length;y++)this._optionTextArray[y].text.match(t)&&(i=!0);return i||(this._prevSearchIndex=-1),void this._setCurrentSearchOption(x)}},_optionInputSearch:function(t){var o=new RegExp("^"+t.replace(/[|()\[{.+*?$\\]/g,"\\$0"),"i");for(x in this._optionTextArray)if(this._optionTextArray[x].text.match(o))return e("option[value='"+this._optionTextArray[x].value+"']",this.element)},_triggerEvent:function(t,o){var i={combo:e(this.element),value:e(this.element).val()};return o&&(i=e.extend(i,o)),this._trigger(t,t,i)},destroy:function(){this._baseElement.off("."+this.widgetName),this._dropDownMenu.zmenu("destroy").remove(),e.Widget.prototype.destroy.apply(this,arguments)},_getOptionWithValue:function(e){var t=document.getElementById(this.element.attr("id")).options,o=void 0;for(i=0;i<t.length;i++)e==t[i].value&&(o=t[i]);return o},setValue:function(t){this._onLoadCheck&&this._reloadDropDownMenu();var o=this._getOptionWithValue(t);o?this._setOptionValue(o.index,!0):this.options.editable?(this.selected=void 0,t||(t=""),e(".ui-zmenu-text",this._optArea).text(t)):(this.selected=void 0,this._optArea.empty())},getValue:function(){var e=this._getOptionElements();return e.get(this.element.get(0).selectedIndex).value},getSelectedOption:function(){var e=this.getSelectedIndex();return this._getOptionElements()[e]},getSelectedIndex:function(){return this.element.get(0).selectedIndex},setSelectedIndex:function(e){this._onLoadCheck&&this._reloadDropDownMenu();var t=this.element.get(0);return this._setOptionValue(e,!0),t.selectedIndex},getDropDown:function(){return this._onLoadCheck&&this._reloadDropDownMenu(),this._dropDownMenu},getDropDownId:function(){return this._dropDownMenuId},disable:function(){e(this._baseElement).attr("disabled","true"),e(this._baseElement).addClass("ui-state-disabled"),e(this._dropDownArrow).attr("disabled","true"),e(this._dropDownArrow).addClass("ui-state-disabled")},enable:function(){e(this._baseElement).removeAttr("disabled"),e(this._baseElement).removeClass("ui-state-disabled"),e(this._dropDownArrow).removeAttr("disabled"),e(this._dropDownArrow).removeClass("ui-state-disabled")},widget:function(){return this._baseElement},refresh:function(){this._reloadDropDownMenu()},_reloadDropDownMenu:function(){this._optionTextArray=[],this._onLoadCheck=!1,this._dropDownMenu.zmenu("removeAllMenuItems");var e=this._buildDropDown();this._buildComboMenu(e)},show:function(){this._baseElement.show()},hide:function(){this._baseElement.hide()}};e.widget("ui.zcombo",t),e.ui.zcombo.defaults={editable:!1,type:"icon_text",applyOptionStyles:!0,applyOptionClass:!0,applyOptionStylesOnCombo:!1,retainFocus:!0,optgroupAsSplitMenu:!1,dropDownMenuHeight:void 0}}(jQuery);
!function(e){e.widget("ui.zmenu",{widgetEventPrefix:"menu",_DEFAULT_ICONS:{CHECK_BOX_NOT_CHECKED_ICON:"ui-zmenu-no-icon",CHECK_BOX_CHECKED_ICON:"ui-icon-check",RADIO_BUTTON_NOT_CHECKED_ICON:"ui-zmenu-no-icon",RADIO_BUTTON_CHECKED_ICON:"ui-icon-bullet"},_MENU_ITEM_TYPES:{CHECK_BOX:"checkbox",RADIO_BUTTON:"radio",SUB_MENU:"submenu"},_EVENTS:{ONBEFORESHOW:"beforeshow",ONBEFOREHIDE:"beforehide",ONSHOW:"show",ONHIDE:"hide",ONMENUITEMCLICKED:"itemclicked",ONBEFORESUBMENUSHOW:"beforesubshow",ONSUBMENUSHOW:"subshow",ONBEFORESUBMENUHIDE:"beforesubhide",ONSUBMENUHIDE:"subhide",ONMENUITEMHOVERED:"itemhovered",ONMENUITEMDISABLED:"itemdisabled",ONICONCHANGE:"itemiconchange",ONLABELCHANGE:"itemlabelchange"},_MENU_SCOPES:{icon_text:"ui-zmenu-icontext",icon_only:"ui-zmenu-icononly",text_only:"ui-zmenu-textonly",icon_only_floating:"ui-zmenu-icononly ui-zmenu-floating",text_only_floating:"ui-zmenu-textonly ui-zmenu-floating",icon_text_floating:"ui-zmenu-icontext-floating",icon_text_header:"ui-zmenu-icontext-header",icon_text_on_top:"ui-zmenu-icontext-top",icon_text_on_bottom:"ui-zmenu-icontext-bottom",icon_text_hint:"ui-zmenu-icontext-hint"},_CHECK_SELECTION_ICON:"ui-state-active",options:{positionAlterable:!0,type:"icon_text",bindKeys:!0,fixed:!1,fixWidth:!0,columns:3,skipHighlightTarget:!1,scroll:"default",toggle:!0},_create:function(){var t=this,i=this.element.metadata().toggle||this.options.toggle;this.element.metadata().toggle=i?!0:!1,t._buildMenu(this.element),this._menuTextArray=[],this._initEvents();var n=this.options.appendTo;void 0!==n&&""!==n&&(n=-1!=n.indexOf("#")?n:"#"+n,this.options.appendTo=e(n)),this.options.fixed?(this._resetMenuTextArray(this.element),this.show()):this.element.hide(),this.options.bindKeys&&this.element.focusable(),this.options.height&&this.element.data("height",this.options.height),this.element.data("positionAlterable",this.options.positionAlterable)},_addScopeForMenu:function(e,t){e.addClass(this._MENU_SCOPES[t?t:this.options.type])},_initEvents:function(t){var i=t?"sub":"",n=t;if(t=t?t:this.element,!(t.data("initialized")&&!n||this._isExternalSubmenu(t))){t.data("initialized",!0);var s=this;e(t).on("click."+i+this.widgetName,function(e,t){return s._menuClicked(e,t)})}},_buildMenu:function(t,i){var n="ui-zmenu "+(e.ui.directionIsRTL?" zmenu___rtl ":"");t.addClass(n+(this.options.fixed?"":"ui-widget-shadow-new ui-zmenu-position")),this._addScopeForMenu(t,i),this._buildDefaults(t)},_uninitSliders:function(e){var t=e.metadata();t.sliders&&(t.sliders.top&&t.sliders.top.remove(),t.sliders.bottom&&t.sliders.bottom.remove())},_createSlider:function(t,i){var n=i?"top":"bottom",s=t.metadata();s.sliders||(s.sliders={});var u=s.sliders[n];u&&u.remove(),u=e("<div>").addClass("ui-zmenu-scroll-"+n),s.sliders[n]=u;var a=this;u.hover(function(){a._startScroll(t,i)},function(){a._stopScroll(t)}).hide(),u.click(function(){var e=t.scrollTop();return a._stopScroll(t),t.scrollTop(e+100*(i?-1:1)),a._startScroll(t,i),!1});var r=t.position(),o=t.outerWidth()-2,l=i?0:t.outerHeight()-6;u.css({top:r.top+1+l,left:r.left+1,width:o}).fadeTo(0,1);var h=i?"-3px":"-1px",d="top"==n?"ui-corner-bottom":"ui-corner-top",m=e('<button class="ui-button ui-widget ui-state-default ui-button-icon-only ui-scroll-arrowbg '+d+'"></button>').css({top:h}),c="top"==n?"n":"s",_=e('<span class="ui-button-icon-primary ui-icon ui-components-icon ui-icon-triangle-1-'+c+'"></span>'),p=e('<span class="ui-button-text">.</span>');return e(_).appendTo(e(m)),e(p).appendTo(e(m)),e(m).appendTo(u),u.insertAfter(t),u},_initSliders:function(e){this._createSlider(e),this._createSlider(e,!0);this._displayScrolls(e)},_displayScrolls:function(e){var t=e.metadata().sliders,i=e.scrollTop();t.top[0==i?"hide":"show"](),t.bottom[e[0].scrollHeight-i<e.outerHeight()?"hide":"show"]()},_startScroll:function(e,t){var i=t?0:e[0].scrollHeight-e.innerHeight(),n=this,s=e.scrollTop()-i,u=Math.abs(1e3*s/50);e.animate({scrollTop:i},{duration:u,easing:"linear",complete:function(){n._displayScrolls(e)}})},_stopScroll:function(e){e.stop(),this._displayScrolls(e)},_scrollToView:function(e,t){var i=t.scrollTop(),n=e.height(),s=e.position().top,u=t.height();if(n>u-s){var a=i+(s-(u/3-n));t.animate({scrollTop:a},{duration:300,easing:"linear"})}else if(-1>s){var a=s-n;t.animate({scrollTop:a},{duration:300,easing:"linear"})}return!1},_buildDefaults:function(t){var i=t.children("li"),n=this;i.each(function(i,s){n._buildMenuItem(e(s),t)})},_setWidth:function(t,i){if(!this._isFloatingMenu(t)){var n=e("#tmpDiv");n.length||(n=e("<div>").attr("id","tmpDiv").css({width:"auto"}).appendTo("body")),n.attr("class","ui-zmenu "+t.attr("class")),n.html(e(i).clone());var s=n.outerWidth()+1;e(i).data("width",s),n.empty().hide()}},_addEventsForMenuItems:function(t){var i=this;t.hover(function(t,n){t.data=n,i._handleMouseOverOnMenuItems(e(this),t)},function(t,n){t.data=n,i._handleMouseOutOnMenuItems(e(this),t)})},_getMenuItemType:function(e){return e.attr("mtype")},_isChecked:function(e){return this._isCheckBoxOrRadioButton(e)?e.data("checked"):!1},_getRelatedIcon:function(e){var t=this._getInputType(e),i=e.metadata(),n=i.icon;if(t){var s=this._isChecked(e);if(n)n=s?n+" "+this._CHECK_SELECTION_ICON:n;else switch(t){case this._MENU_ITEM_TYPES.CHECK_BOX:n=this._DEFAULT_ICONS[s?"CHECK_BOX_CHECKED_ICON":"CHECK_BOX_NOT_CHECKED_ICON"];break;case this._MENU_ITEM_TYPES.RADIO_BUTTON:n=this._DEFAULT_ICONS[s?"RADIO_BUTTON_CHECKED_ICON":"RADIO_BUTTON_NOT_CHECKED_ICON"]}}return n},_getIconForMenuItem:function(e){var t=e.metadata(),i=this._getRelatedIcon(e);return i||(i=t.icon),t.iconText&&(i=(i?i+" ":"")+"ui-zmenu-icon-textable"),i=i?i:"ui-zmenu-no-icon"},_isGroup:function(e){var t=this._getMenuItemType(e);return"group"===t},_isSeparator:function(e){var t=this._getMenuItemType(e);return"separator"===t},_buildGroup:function(t){var i=e(t).children("ul");if(!i.length)return!1;i.addClass("ui-zmenu-group-base");var n=i.metadata(),s=n.type;!s&&n.componentOptions&&(s=n.componentOptions.type),this._addScopeForMenu(i,s);{var u=e(i).children("li"),a=this,r=t.attr("id");i.metadata().type}u.each(function(t){var n=e(u[u.length-t-1]);a._buildMenuItem(n,i),a._buildGroupItem(n,r)});t.text();return t.attr("mtype","group"),t.attr("gname",t.attr("id")),t.addClass("ui-zmenu-group-wrapper"),i},_buildGroupItem:function(e,t){this._isGroup(e)||(e.attr("gname",t),e.is("[mtype=separator]")||e.addClass("ui-zmenu-group-item"))},_buildSeparator:function(e){var t=e.attr("groupSep");e.addClass("ui-zmenu-separator"),t&&e.addClass("ui-zmenu-group-separator")},_getScopedMenu:function(e){var t=e.closest(".ui-zmenu-group-base");return t.length||(t=e.closest(".ui-zmenu")),t},_getMenuItemScopeType:function(e){var t=this._getScopedMenu(e),i=this.getMenuType(t);return i},_buildMenuItem:function(t,i){t.addClass("ui-zmenu-item");var n=this._isFloatingMenu(i);n&&t.addClass("ui-zmenu-item-floating");var s=t.metadata();s.hidden&&this._hideMenuItem(t,!1,!0);var u=this._getMenuItemType(t);if("custom"==u){s&&s.html&&t.html(s.html),t.addClass("ui-zmenu-item-custom");var a=t.find(".ui-widget-shadow-new");a.removeClass("ui-widget-shadow-new");var r=t.find(".ui-corner-all");return r.removeClass("ui-corner-all"),this._addEventsForMenuItems(t),void(i.children(":not([mtype=custom])").length&&this._setWidth(i,t))}if(this._isSeparator(t))return this._buildSeparator(t);var o=!1;if(this._isGroup(t)){o=!0;var l=this._buildGroup(t);l&&(t=t.clone(!0),t.attr("id",t.attr("id")+"Label"),t.removeClass("ui-zmenu-group-wrapper"),l.prepend(t),l.parent().removeClass("ui-zmenu-item")),t.addClass("ui-zmenu-group")}else"icon_text_floating"==this._getMenuItemScopeType(t);n=n&&!t.hasClass("ui-zmenu-group")&&!t.hasClass("ui-zmenu-subsplit");var h=e("<span />").addClass("ui-zmenu-icon-layout"),d=e("<span />").addClass("ui-icon ui-zmenu-icon-inner"+(n?" ui-zmenu-icon-placeholder":"")).addClass(this._getIconForMenuItem(t));s.iconText&&(i.data("iconAsText",!0),d.text(s.iconText)),h.append(d),d.hasClass(this._CHECK_SELECTION_ICON)&&(d.removeClass(this._CHECK_SELECTION_ICON),this._isFloatingMenu(t,!0)||h.addClass(this._CHECK_SELECTION_ICON));var m=void 0;"file"==u&&(m=t.find("input[type=file]").detach(),m.addClass("ui-zmenu-file"));var c=o?"":t.text();if(this._isSubMenuItem(t)){var _=e(t).contents().filter(function(){return 3==this.nodeType}),p=this;_.each(function(t,i){var n=p._trimStr(e(i).text());n.length&&(c=n,e(i).remove())})}else t.text("");s.label||(s.label=this._trimStr(c));var f=s.ellipsis?s.label+"...":s.label,v=e("<span />").addClass("ui-zmenu-text"+(n?" ui-zmenu-text-placeholder":"")).text(f),g=e.ui.shortcutkeys?e.ui.shortcutkeys.register(t):void 0;if(t.append(h,v),this._isRadioButton(t)&&this._isChecked(t)&&this._fixCheckRadio(t,!0),s.html){var M=s.html.content,I=s.html.replaceWithText;if(M){var b=void 0;if(I)t.find(".ui-zmenu-text").html(M),b=t.find(".ui-zmenu-text");else{var C=this._getIconHolderForMenuItem(t);C.html(M),C.css({background:"none"}),b=C}b.css({width:"auto",height:"auto",position:"relative",left:"0px",top:"0px"})}}var E=e("<span>").addClass("ui-zmenu-item-placeholder");if(this._isSubMenuItem(t)){if(this._buildSubMenu(t),g&&t.is("[mtype=splitmenu]")){var y=this._createShortCutEle(t,g);E.insertAfter(y).hide()}}else if(g){var y=this._createShortCutEle(t,g);E.insertAfter(y)}var O=t.metadata().hint;if(O){var x=e("<span />").addClass("ui-zmenu-hint");x.text(O),t.append(x)}m&&t.append(m),o?s.label.length||t.remove():(this._checkAndDisableMenuItem(t,!0),this._addEventsForMenuItems(t));var T=t.attr("onclick");this._fixClick(t,T),t.removeAttr("onclick"),t.off("click")},_createShortCutEle:function(t,i){var n=e("<span />").addClass("ui-zmenu-shortcut");return n.text(i[0]),t.append(n),n},_trimStr:function(e){return e.replace(/^\s+|\s+$/g,"")},_fixClick:function(e,t){var i=e.metadata();i.clickHandler||(i.clickHandler=t,i.onclick=function(e){var t=i.clickHandler;t&&t.call(e)})},_buildSplitMenu:function(t){var i=t.metadata(),n=e("<ul>").attr("mtype","group").addClass("ui-zmenu-splitgroup"),s=e("<li>").attr({mtype:"group",id:"group_"+t.attr("id")}),u=e("<li>").addClass("ui-zmenu-subsplit");u.data("mainsplit",t),t.data("subsplit",u);var a=this._isDisabled(t);a&&this._disableMenuItem(u,!a),i.doNotOpenSubmenu||t.hover(function(e){var i=setTimeout(function(){u.trigger(e)},400);t.data("timeout",i)},function(){var e=t.data("timeout");e&&clearTimeout(e)}),s.append(n),s.addClass("ui-zmenu-splitmenu"),s.insertBefore(t),this._buildMenuItem(s,n),n.append(t);var r=this._getSubMenu(t);if("object"==typeof r)if(r.metadata().isExternalSubMenu){var i=t.metadata();u.metadata().submenu=i.submenu,delete i.submenu}else u.append(r);else u.append(r);return n.append(u),n.addClass("ui-zmenu-floating"),this._buildMenuItem(u,n),!0},_buildSubMenu:function(t){if("splitmenu"!=t.attr("mtype")||!this._buildSplitMenu(t)){var i=t.metadata();if(i.contextual){t.addClass("ui-zmenu-item-contextual");var n=this;t.on("contextmenu."+this.widgetName,function(e){n._showSubmenu(t,{left:e.clientX,top:e.clientY,forcePosition:!0},!0),n._setFocus()})}var s=e("<span />").addClass("ui-icon ui-zmenu-submenu-arrow-cue ui-components-icon ui-icon-triangle-1-e");t.append(s);var u=this._getSubMenu(t);if(u&&(u.hide().attr({mtype:"submenu"}),u.parent().attr({mtype:"submenuitem"}),t.metadata().submenu=u,u.metadata().parent=t,!u.metadata().isExternalSubMenu)){var a=u.metadata(),r=a.type;!r&&a.componentOptions&&(r=a.componentOptions.type),this._buildMenu(u,r)}}},_isSubMenuItem:function(e){var t=e.metadata();return t.submenu?!0:e.is("[mtype=group]")?!1:e.children(":first").is("ul")},_isSubMenu:function(e){var t=e.metadata().parent;return!!t},_getSubMenu:function(t){var i=t.metadata().submenu;if("string"==typeof i){if(i=e(i),!i.length)return void 0;var n=i.metadata();i.data("zmenu")||i.zmenu(n.componentOptions),n.isExternalSubMenu=!0}return i&&i.length?(i.metadata().parent=t,i):t.children("ul:first")},_clearMenuTimeout:function(){this._menuTimeout&&(clearTimeout(this._menuTimeout),this._menuTimeout=void 0)},_isLastMenuItem:function(e){return e.parent().children("li:last").get(0)==e.get(0)},_isFirstMenuItem:function(e){return e.parent().children("li:first").get(0)==e.get(0)},_isDirectEvent:function(e){return!!e.originalEvent},_isMenuOfMenuItemShown:function(t){return this._isSubMenuItem(t)&&e(this._getSubMenu(t)).is(":visible")},_checkAndHideAllOpenedSubMenus:function(t){var i=t.find(".ui-zmenu-item-hover:last");if(i.length){var n=this._getSubMenu(i);e(n).is(":visible")&&(this._checkAndHideAllOpenedSubMenus(n),i.trigger("mouseleave"))}},_handleMouseOverOnMenuItems:function(e,t,i){i&&this._scrollToView(e,e.closest(".ui-zmenu"));var n=t?this._isDirectEvent(t):!1;if(e.is(".ui-zmenu-item-hover")&&this._isMenuOfMenuItemShown(e))return void this._setLastOverlayedMenuItem(e);if(this._checkAndHideAllOpenedSubMenus(e.closest(".ui-zmenu")),this._setLastOverlayedMenuItem(e),this._clearMenuTimeout(),!e.is("[mtype=custom]")){var s=this._isSubMenuItem(e);if(this._isDisabled(e)||e.addClass("ui-zmenu-item-hover"),!this._isDisabled(e)&&e.is(".ui-zmenu-subsplit")){var u=e.data("mainsplit");u&&u.addClass("ui-zmenu-item-hover")}this._isDisabled(e)||(s&&n&&!e.is(".ui-zmenu-item-contextual")&&this._showSubmenu(e,{isSplitMenu:e.is(".ui-zmenu-subsplit")}),this._triggerEvent(this._EVENTS.ONMENUITEMHOVERED,t,e.parent(),e))}},_showSubmenu:function(t,i,n){var s=this;i.target||(i.target=t);var u=function(){s.show(i,e(s._getSubMenu(t)))};n?u():s._menuTimeout=setTimeout(u,300)},_handleMouseOutOnMenuItems:function(t,i){var n=this._isDirectEvent(i);if(n){if(!t.parent().has(i.relatedTarget).length){if(this._isSubMenuItem(t)&&this._isMenuOfMenuItemShown(t))return;this._setLastOverlayedMenuItem(void 0)}}else{var s=i.data;if(!this._isMenuOfMenuItemShown(t)||!this._isElementInMenu(s,e(this._getSubMenu(t)))){if(this._clearMenuTimeout(),t.removeClass("ui-zmenu-item-hover"),t.is(".ui-zmenu-subsplit")){var u=t.data("mainsplit");u&&u.removeClass("ui-zmenu-item-hover")}if(this._isSubMenuItem(t)){var a=this._getSubMenu(t);if(!a)return;this._isElementInMenu(s,e(a))||this.hide(a)}}}},_isElementInMenu:function(t,i){return i||(i=this.element),t=e(t)[0],1==i.has(t).length},_getAllMenuItems:function(e,t,i,n,s){return e&&e.length||(e=this.element),e.find(".ui-zmenu-item:not([mtype=group], .ui-zmenu-subsplit"+(s?", .ui-zmenu-separator":"")+(t?", .ui-zmenu-item-floating":"")+(i?", li ul[mtype=submenu] li":"")+")"+(n?":visible":""))},_getMenuTypeFromData:function(e){var t=e.metadata(),i=t.type;return!i&&t.componentOptions&&(i=t.componentOptions.type),i},getMenuType:function(e){if(e&&this._isExternalSubmenu(e))return e.zmenu("getMenuType");e||(e=this.element);var t=this._getMenuTypeFromData(e);return t||(e.is(".ui-zmenu-group-base")&&(e=e.closest(".ui-zmenu"),t=this._getMenuTypeFromData(e)),t||(t=this.options.type)),t},_isFloatingMenu:function(e,t){var i=t?this._getScopedMenu(e):e?e:this.element,n=this.getMenuType(i);return this._isTypeFloating(n,i)},_isTypeFloating:function(e,t){return e&&-1!=e.indexOf("floating")||t&&(t.hasClass("ui-zmenu-floating")||t.hasClass("ui-zmenu-icontext-floating"))?!0:!1},_fixTextOnlyFloatingItemsWidth:function(t){var i=t.children("li:not(.ui-zmenu-group):not(.ui-zmenu-separator)"),n=0;i.each(function(t,i){i=e(i);var s=i.width();s>n&&(n=s)}),i.width(n)},_fixFloatingMenuWidth:function(t){var i=t.metadata().columns;if(!i||-1==i){var n=t.closest(".ui-zmenu");if(i=this._isExternalSubmenu(n)?n.zmenu("option","columns"):this.options.columns,!i||-1==i)return}var s=this._getAllMenuItems(t,!1,!1,!0),u=e(s[0]).outerWidth(!0);this._fixEllipsisForMenuItems(s,t,u*i);var a=u*i;t.width(a+1),t.data("width",a)},_getItemWithMaxWidth:function(t){t=t?t:this._getAllMenuItems(this.element,!1,!1,!0);var i=0,n=t[0];return t.each(function(t,s){s=e(s);var u=s.data("width");u>i&&(i=u,n=s)}),n},_getItemsLargerThanMenu:function(t,i,n){var s=[];return t=t?t:this._getAllMenuItems(this.element,!1,!1,!0),t.each(function(t,i){i=e(i);var u=i.width();u>n&&s.push(i)}),s},_fixEllipsisForMenuItems:function(t,i,n){var s=this._getItemsLargerThanMenu(t,i,n),u=this;e(s).each(function(t,i){i=e(i),u._fixEllipsisForMenuItem(i,n)})},_fixEllipsisForMenuItem:function(t,i){var n=this;e(t).each(function(t,s){var u=i,s=e(s),a=s,r=void 0;if(s.is("[mtype=custom]"))if(s.html()==s.text())r=s.text();else if(1==s.children().length)s=s.children(":first"),r=s.text();else{var o=s.find("[ellipsis=true]");o.length&&(r=o.text(),s=o)}else{a=s.find(".ui-zmenu-text"),r=a.text();var l=s.find(".ui-zmenu-icon-layout"),h=s.find(".ui-zmenu-shortcut");u=i-(l.is(":visible")?l.width():0)-(h.is(":visible")?h.width():0)}if(r){var d=n._getEllipsisText(r,u);s.attr("title",r),s.data("text",r),a.text(d)}})},_getEllipsisText:function(t,i){var n="...",s=0,u=e("<span>").addClass("ui-zmenu-item ui-zmenu-item-dummy").text(t);for(e("body").append(u);u.width()>i&&10>=s;)s++,t=t.substring(0,t.length-7)+n,u.text(t);return u.remove(),delete u,t},_fixMenuItemsWidth:function(e,t){if(e&&this.options.fixWidth){this.element[0]==e[0]&&e.css("width","");var i=e;return e.is(".ui-zmenu-group-base")&&(i=e.closest(".ui-zmenu")),t||(t=this.getMenuType(e)),this._isTypeFloating(t)?("text_only_floating"==t&&this._fixTextOnlyFloatingItemsWidth(e),this._fixFloatingMenuWidth(e)):void 0}},_fixMenuHeight:function(t,i){t.removeClass("ui-zmenu-scroll");var n="auto";t.height(n);var s=t.data("positionAlterable");s||this._positionMenu(t,i);var u=t.height(),a=1*t.css("top").split("px")[0]-e(window).scrollTop();a=a?a:0;var r=e(window).height(),o=r-u;if(a+u>=r&&(0>o||!s)&&(n=r-a-15),t.data("height")){var l=t.data(t.data("height")?"height":"modifiedHeight");n=u>l?l:n}else o>0&&s&&(n=u);t.height(n);var h=e.ZContextMenu.scrollWidth,d=t.metadata(),m=d.isExternalSubMenu&&d.componentOptions?d.componentOptions.scroll:this.options.scroll;if(u>n){t.data("modifiedHeight",n);var c=t.data("modifiedHeight");if(m=m?m:"default",m&&"no"!=m)if(t.data("pos")||this._positionMenu(t,i),"slider"==m)c&&c!=n&&this._uninitSliders(t),this._initSliders(t);else{t.addClass("ui-zmenu-scroll");var _=t.data("width")+(this._isFloatingMenu(t)?h+1:h);t.width(_)}}else m&&"no"!=m&&t.removeClass("ui-zmenu-scroll")},_positionMenu:function(t,i,n){if(i||(i=t.data("pos"))){if(void 0==n&&(n=t.data("isSubMenu")),n&&(!i||!i.forcePosition)){var s=t.metadata().parent,u=s.offset();if(e.ui.directionIsRTL){var a=u.left-t.outerWidth()+3,r=u.top+1;i={left:a,top:r}}else{var a=u.left+s.outerWidth()-3,r=u.top+1;i={left:a,top:r}}}(this.options.positionAlterable||n)&&(i=this._checkBoundriesAndAlterPosition(t,i,s)),t.data({pos:i,isSubMenu:n});var o=t.metadata().sliders;o&&(o.top.css({left:i.left+1,top:i.top+1}),o.bottom.css({left:i.left+1,top:i.top+(t.outerHeight()-6)+1})),t.css(i)}},_checkBoundriesAndAlterPosition:function(t,i,n){var s=this.options.positionAlterable,u=this.options.appendTo,a=void 0!==u&&u.length?u:e(window),r={height:a.scrollTop()+a.height(),width:a.scrollLeft()+a.width()},o=i.top+t.outerHeight(),l=i.left+t.outerWidth();return"left"!=s&&(r.height<o&&(i.top=r.height-t.outerHeight()-2),i.top<0&&(i.top=0)),"top"!=s&&(r.width<l&&(i.left=n?i.left-n.outerWidth()-t.outerWidth()+5:r.width-t.outerWidth()-2),i.left<0&&(i.left=0)),i},_hideAllSubMenus:function(){var e=this._traverseAndFindBaseMenu();e[0]!=this.element[0]?e.zmenu("hide"):this._checkAndHideAllOpenedSubMenus(e)},_traverseAndFindBaseMenu:function(e){var t=e;e=e?e:this.element;var i=e.metadata();if(i.isExternalSubMenu||!t&&e.is("[mtype=submenu]"))for(var n=i.parent;n;){var t=n.closest(".ui-zmenu");t.is(":visible")?(e=t,i=e.metadata(),n=i.parent):n=!1}return e.closest(".ui-zmenu")},_initRuntimeEvents:function(){var t=this;e(this.element).on("keydown.run"+this.widgetName,function(i){var n=i&&i.target?i.target:i.srcElement;e(n).is(".ui-focusable")&&t._keyPressed(i)})},_lastOverlayedMenuItem:void 0,_lastOverlayedMenu:void 0,_setLastOverlayedMenuItem:function(e,t){if(!this._lastOverlayedMenuItem||!e||this._lastOverlayedMenuItem.get(0)!=e.get(0)){if(this._lastOverlayedMenuItem&&e&&e.length&&!this._lastOverlayedMenu.has(e.get(0)).length){var i=e.metadata().submenu;if(!i||i[0]!=this._lastOverlayedMenu[0]){var n=this._lastOverlayedMenu.metadata().parent;n&&n.parent().has(e[0]).length&&n.trigger("mouseleave",e)}}if(this._lastOverlayedMenuItem&&!t&&this._lastOverlayedMenuItem.trigger("mouseleave",e),this._lastOverlayedMenuItem=e,e&&e.length){var s=e.closest(".ui-zmenu");this.updateLastMenuChain(s)}}},updateLastMenuChain:function(e,t){if(this._lastOverlayedMenu=e,!t&&e[0]!=this.element[0]){var i=this._traverseAndFindBaseMenu();i.zmenu("updateLastMenuChain",e,!0)}},_getExactItem:function(e,t){var i=e.children("ul:first");return i.length&&i.is(".ui-zmenu-group-base")?i.children("li:visible:not(.ui-zmenu-group, .ui-zmenu-separator):"+(t?"last":"first")):e},_getNextFloatingMenuItem:function(t,i,n,s,u){var a=void 0,r=s?"top":"left",o=i.length;return e.each(i,function(n,s){s=i[u?o-n-1:n];var l=e(s).position();return l[r]==t[r]?(a=e(s),!1):void 0}),a},_getNextMenuItem:function(t,i,n,s){var u=this._lastOverlayedMenu&&0!=this._lastOverlayedMenu.length?this._lastOverlayedMenu:this.element,a=this._isFloatingMenu(u),r=void 0;if(n=void 0!=n?n:this._lastOverlayedMenuItem,n=n&&n.hasClass("ui-zmenu-subsplit")?n.closest(".ui-zmenu-group-wrapper"):n,0==n&&(n=void 0),n&&n.length){if(n.is(".ui-zmenu-group-wrapper"))r=n[t?"prev":"next"](),(!r.length||r.is(".ui-zmenu-group-wrapper,.ui-zmenu-group,.ui-zmenu-separator")&&!r.find("li:visible").length)&&(r=this._getNextMenuItem(t,i,r));else{r=n[t?"prevAll":"nextAll"](":visible.ui-zmenu-item,.ui-zmenu-group-wrapper").not(".ui-zmenu-separator,.ui-zmenu-group");var o=n.position(),l=s==e.ui.keyCode.LEFT||s==e.ui.keyCode.RIGHT;if(a?(r=this._getNextFloatingMenuItem(o,r,t,l),r||(r=n[t?"nextAll":"prevAll"](".ui-zmenu-item:not(.ui-zmenu-separator):not(.ui-zmenu-group):visible"),o[l?"left":"top"]=0,r=this._getNextFloatingMenuItem(o,r,t,l,!0))):r=e(r[0]),!r||!r.length){var h=n.closest("ul.ui-zmenu-group-base"),d=!1;h.length&&(d=h.parent()),r=this._getNextMenuItem(t,i,d)}}r=this._getExactItem(r,t)}else r=u.find(".ui-zmenu-item:visible:not(.ui-zmenu-group, .ui-zmenu-separator, .ui-zmenu-subsplit):"+(t?"last":"first")),r=this._getExactItem(r,t);return this._setLastOverlayedMenuItem(r,i),this._lastOverlayedMenuItem},_menuClicked:function(t,i){var n=e(t.target);if(n.is("input[type=file]")){var s=this;return n.one("change",function(){s.hide()}),!0}return n.is("li")||(n=n.parent()),this._handleClickOnMenuItem(n,t,i),!1},_handleClickOnMenuItem:function(t,i,n){t=e(t).closest(".ui-zmenu-item"),n||(n={});var s=t.metadata();if(t.is("[mtype=splitmenu]")&&!s.doNotOpenSubmenu&&this._clearMenuTimeout(),t.length&&!(this._isDisabled(t)||this._isGroup(t)||this._isSubMenuItem(t)&&!s.contextual)){var u=s.onclick;if(u&&u(),i.originalEvent||(i=void 0),this._isCheckBoxOrRadioButton(t)&&this._check(t,void 0,n),!t.is("[mtype=custom]")){var a=t.closest(".ui-zmenu");a.data("isSubMenu")&&(this._target=a.data("target")),s.doNotTriggerClickEvent||this._triggerEvent(this._EVENTS.ONMENUITEMCLICKED,i,a,t,n)}!t.is(".ui-zmenu-item-contextual")&&(this.options.fixed||this._isSubMenuItem(t))||s.doNotTriggerClickEvent||"checkbox"!=t.attr("inputtype")&&this.hide()}},_keyPressed:function(e){if(this.options.bindKeys){var t=e.keyCode;this.handleKeyCode(t,e),e.preventDefault(),e.stopPropagation()}},_hideLastShownMenu:function(){var e=this._lastOverlayedMenu.metadata().parent;this._lastOverlayedMenuItem=e,this.hide(this._lastOverlayedMenu);var t=e.closest(".ui-zmenu");this.updateLastMenuChain(t)},_isMenuMainMenu:function(t){return e(t).get(0)==this.element.get(0)},destroy:function(){this._uninitSliders(this.element),this.element.off("."+this.widgetName),this.element.find(".ui-zmenu-item-contextual").off("."+this.widgetName),e.Widget.prototype.destroy.apply(this,arguments)},_destroyRuntimeEvents:function(){e(this.element).off(".run"+this.widgetName)},_isCheckBoxOrRadioButton:function(e){var t=this._getInputType(e);return t==this._MENU_ITEM_TYPES.CHECK_BOX||t==this._MENU_ITEM_TYPES.RADIO_BUTTON},_isCheckBox:function(e){return this._getInputType(e)==this._MENU_ITEM_TYPES.CHECK_BOX},_isRadioButton:function(e){return this._getInputType(e)==this._MENU_ITEM_TYPES.RADIO_BUTTON},_getInputType:function(e){return e.attr("inputtype")},_fixCheckIcon:function(t,i){var n=this._isCheckBox(t);t.data("checked",i),delete t.metadata().checked;var s=this._isFloatingMenu(t,!0);if(s&&"splitmenu"!=t.attr("mtype"))return void t[i?"addClass":"removeClass"](this._CHECK_SELECTION_ICON);var u=e(".ui-zmenu-icon-layout",t).children(":first");u.removeClass(this._DEFAULT_ICONS[n?"CHECK_BOX_CHECKED_ICON":"RADIO_BUTTON_CHECKED_ICON"]),u.removeClass(this._DEFAULT_ICONS[n?"CHECK_BOX_NOT_CHECKED_ICON":"RADIO_BUTTON_NOT_CHECKED_ICON"]),u.removeClass(this._CHECK_SELECTION_ICON);var a=t.metadata(),r=a.icon,o=this._getRelatedIcon(t);r?(u=u.parent(),u[-1!=o.indexOf(this._CHECK_SELECTION_ICON)?"addClass":"removeClass"](this._CHECK_SELECTION_ICON)):u.addClass(o)},_defaultFixCheckIcon:function(e,t){"undefined"==typeof t&&(t=!this._isChecked(e)),this._fixCheckIcon(e,t)},_fixCheckRadio:function(t,i){var n=e(t).attr("name");if(!n)return this._defaultFixCheckIcon(t);var s=t.closest(".ui-zmenu"),u=this,a=s.find("li[inputtype=radio][name="+n+"]");a.filter(function(){return e(this).data("checked")});var r=t;a.each(function(t,n){n=e(n),i&&u._isChecked(n)&&(r=n),u._fixCheckIcon(n,!1)}),u._fixCheckIcon(r,!0)},_check:function(e,t,i,n){var s=this._getInputType(e);if(this._isCheckBoxOrRadioButton(e))switch(s){case this._MENU_ITEM_TYPES.CHECK_BOX:this._defaultFixCheckIcon(e,t);break;case this._MENU_ITEM_TYPES.RADIO_BUTTON:this._fixCheckRadio(e)}n&&(i?i&&i.fromDataBinding&&e.trigger("element_state_changed",{checked:e.data("checked")?!0:!1}):e.trigger("element_state_changed",{checked:e.data("checked")?!0:!1}))},_isDisabled:function(e){var t=e.attr("disabled")?e.attr("disabled"):!1;return t},_checkAndDisableMenuItem:function(e,t){var i=this._isDisabled(e),n="ui-state-disabled";e[i?"addClass":"removeClass"](n),t||this._triggerEvent(this._EVENTS.ONMENUITEMDISABLED,void 0,this.element,e)},_disableMenuItem:function(t,i){var n="string"==typeof t?e("#"+t,this.element):e(t);i?n.removeAttr("disabled"):n.attr({disabled:!i}),this._checkAndDisableMenuItem(n);var s=n.data("subsplit");s&&this._disableMenuItem(s,i),n.trigger("element_state_changed",{disabled:i?!1:!0,checked:n.data("checked")?!0:!1})},_isBaseMenu:function(e){return!e||e.get(0)==this.element.get(0)},_isExternalSubmenu:function(e){return e.metadata().isExternalSubMenu},_triggerEvent:function(t,i,n,s,u){var a=this._isBaseMenu(n),r={orgEvent:i,currentTarget:this._currentTarget,target:this._target?this._target:n.data("target"),offset:this.element.offset(),menu:n,isBaseMenu:a};return s&&(r.menuitem=s),u&&(r=e.extend({},r,u)),this._isExternalSubmenu(n)&&-1!=t.indexOf("sub")&&n.zmenu("triggerEvent",t.replace("sub",""),i,r),this._trigger(t,i,r)},triggerEvent:function(e,t,i){return this._trigger(e,t,i)},_getLastAppendableElement:function(e){var t=e.metadata().parent.closest(".ui-zmenu"),i=t.metadata().sliders;if(i&&i.length){if(i.bottom)return i.bottom;if(i.top)return i.top}return t},_setFocus:function(){var e=this,t=function(){e.element.focus()};setTimeout(t,100)},show:function(t,i,n){var s=this.options.appendTo,u=!1,a="auto",r={};if(this.options.fixed||(t&&(r.target=t.target,r.currentTarget=t.currentTarget),i?i.data("target",t.target):(this._target=t.target,this._currentTarget=t.currentTarget)),i){if(u=!0,i.is(":visible"))return;if(!i.length)return;i.insertAfter(this._getLastAppendableElement(i)),this._initEvents(i)}else{if(i=this.element,this._initRuntimeEvents(),i.is(":visible")&&!n)return;this.options.fixed||(void 0!==s&&s.length?s.append(i):e("body").append(i)),this._setFocus()}var o=this._isFloatingMenu(i);if(o||i.width(a),this.updateLastMenuChain(i),this.options.fixed)i.show();else{var l=t?t.event:void 0,h=this._triggerEvent(this._EVENTS[u?"ONBEFORESUBMENUSHOW":"ONBEFORESHOW"],l,i,void 0,r);if(0==h)return;if(t.target&&t.isSplitMenu&&!t.target.is(":visible"))return;if(i.fadeIn(200),this.refresh(i),this._fixMenuUI(i,t,u),t){t.isRightClick&&i.attr("position","after_pointer");var d=e.ZContextMenu.getMenuPosition(i,t.target,t.event,s);if(t.left=d.left,t.top=d.top,void 0!==s&&s.length){var m=s.css("position");if("absolute"===m||"relative"===m){var c=s.offset();t.left=d.left-(c.left+parseInt(s.css("borderRightWidth"))),t.top=d.top-(c.top+parseInt(s.css("borderTopWidth")))}}this._positionMenu(i,t,u)}this.options.skipHighlightTarget&&(r.skipHighlightTarget=this.options.skipHighlightTarget),this._triggerEvent(this._EVENTS[u?"ONSUBMENUSHOW":"ONSHOW"],l,i,void 0,r)}if(!o){var _=i.innerWidth()+1,p=e.ZContextMenu.scrollWidth;i.width(i.hasClass("ui-zmenu-scroll")?_+p:_)}this._resetMenuTextArray(i)},refresh:function(e){e=e?e:this.element,this._fixMenuItemsWidth(e)},_fixMenuUI:function(e,t,i){e.is(":visible")&&(this._fixMenuHeight(e,t),this._positionMenu(e,t,i),e.scrollTop(0))},_resetMenuTextArray:function(t){this._menuTextArray=[],this._prevSearchKey="",this._prevKeydownTime="",this._prevSearchIndex="",this._prevSearchTimer=void 0;var i=":visible[mtype!=separator][mtype!=custom][disabled!=disabled]";this.options.fixed&&(i="[mtype!=separator][mtype!=custom][disabled!=disabled]");for(var n=t.children(i),s=0;s<n.length;s++)if(e(n[s]).hasClass("ui-zmenu-group-wrapper"))for(var u=e(n[s]).children(":visible").children(":visible[mtype!=separator][mtype!=custom][disabled!=disabled]"),a=0;a<u.length;a++)this._menuTextArray[this._menuTextArray.length]={text:e(u[a]).metadata().label,menuitem:e(u[a])};else this._menuTextArray[this._menuTextArray.length]={text:e(n[s]).metadata().label,menuitem:e(n[s])}},hide:function(t){if(!this.options.fixed){var i=!1;if(t&&t.length){i=!0,t=e(t),t.off(".sub"+this.widgetName);var n=t.metadata().parent;n&&!t.metadata().isExternalSubMenu&&n.append(t)}else t=this.element,this._hideAllSubMenus(),this._destroyRuntimeEvents();if(t=e(t),e("li.ui-zmenu-item-hover",t).each(function(t,i){e(i).removeClass("ui-zmenu-item-hover")}),t.get(0)!=this.element.get(0)?this.updateLastMenuChain(t.parent().parent()):this._lastOverlayedMenuItem=void 0,!t.is(":hidden")){if(this._triggerEvent(this._EVENTS[i?"ONBEFORESUBMENUHIDE":"ONBEFOREHIDE"],void 0,t),this._uninitSliders(t),this._isFloatingMenu(t)?null:t.width(t.innerWidth()+1+e.ZContextMenu.scrollWidth),t.hide(),i){var s=e(t.metadata().parent).parent();s.hasClass("ui-zmenu-group-base")&&(s=s.parent().parent()),this._resetMenuTextArray(s)}else this._resetMenuTextArray(t);t.css({top:"",left:"",height:"",width:""}),this._triggerEvent(this._EVENTS[i?"ONSUBMENUHIDE":"ONHIDE"],void 0,t)}}},_attrNames:["id","name","mtype","inputtype","disabled","data-association","data"],addMenuItem:function(t,i,n){var s=e("<li>"),u=e(this.element);t.menu&&t.menu.length&&"object"==typeof t.menu&&(u=e(t.menu).is("ul")?t.menu:e(t.menu).children("ul"));var a=void 0,r=u.children("li");if("undefined"!=typeof t.pos&&r.length){var o=!1;t.pos>=r.length&&(t.pos=r.length-1,o=!0),t.pos<=0&&(t.pos=0),a=e(r.eq(t.pos)),a.hasClass("ui-zmenu-group")&&u.hasClass("ui-zmenu-group-base")?1===r.length?u.append(s):s.insertAfter(a):s[o?"insertAfter":"insertBefore"](a)}else u.append(s);var l=t.mtype;if(s.attr("mtype",l),"separator"!=l){e(this._attrNames).each(function(e,i){t[i]&&s.attr(i,t[i]+"")});var h=s.metadata(),d=this;for(var m in t)-1==e.inArray(m,d._attrNames)&&"menuItems"!=m&&"onclick"!=m&&t[m]&&(h[m]=t[m]);if(this._fixClick(s,t.onclick),"object"==typeof t.menuItems){var c=e("<ul>");c.metadata().type=t.type,s.append(c),e(t.menuItems).each(function(e,t){t.menu=c,t.internal=!0,d.addMenuItem(t,void 0,n)})}else n&&n(s,t)}else t.id&&s.attr("id",t.id),t.isGroupSep&&s.attr("groupSep",t.isGroupSep);if(t.checked&&s.data("checked",t.checked),t.hidden&&s.data("hidden",t.hidden),t.internal||(this._buildMenuItem(s,u),this._isGroup(u.parent())&&this._buildGroupItem(s,u.parent().attr("id"))),t.attr&&s.attr(t.attr),t.title&&s.attr("title",t.title),t.html){var _=t.html.content,p=t.html.replaceWithText;if(_){var f=void 0;if(p)s.find(".ui-zmenu-text").html(_),f=s.find(".ui-zmenu-text");else{var v=this._getIconHolderForMenuItem(s);v.html(_),v.css({background:"none"}),f=v}f.css({width:"auto",height:"auto",position:"relative",left:"0px",top:"0px"})}}var g=t.externalAssociation;g&&s.data("externalAssociation",g);var M=t.iconText;if(M){s.metadata().iconText=M}var I=t.splitButtonData;return I&&s.data("relatedButton",I),i||this._fixMenuUI(u),s},addMenuItems:function(t,i){var n=this,s=[];return e(t).each(function(e,t){var u=n.addMenuItem(t,!0,i);s.push(u)}),this._fixMenuUI(this.element),s},removeMenuItem:function(t){t=-1!=t.indexOf("#")?t.replace("#",""):t,this.hide(),e("#"+t,this.element).remove(),this._fixMenuUI(this.element)},removeAllMenuItems:function(t,i,n){t=t?t:this.element;var s=null,u=n?":not(.ui-zmenu-group)":"";s=e(t).is("li")?e(t).children("ul").children(u):e(t).children(u),s&&(this._removeAllMenuItems(s,i),this._resetMenuItemsWidthAndHeight(t.closest(".ui-zmenu")))},_removeAllMenuItems:function(t,i){var n=this;e(t).each(function(t,s){s=e(s);s.metadata();if(n._isSubMenuItem(s)){var u=n._getSubMenu(s);n._isExternalSubmenu(u)?i||u.zmenu("removeAllMenuItems",u):(n.removeAllMenuItems(u),u.remove())}s.remove()})},_resetMenuItemsWidthAndHeight:function(e){e.height("auto"),e.find("ul").width("auto"),e.find("li:not(.ui-zmenu-group-wrapper .ui-zmenu-group)").width("auto"),this.refresh(e)},disableMenuItem:function(e,t){var i=this._getMenuItemId(e);return i.length?this._disableMenuItem(i,t):void 0},_itemsWidthStateChanged:!1,_hideMenuItem:function(e,t){var i=this._getMenuItemId(e);i.length&&i[t?"show":"hide"]();this.element.is(":visible");return this._showOrHideCorrespondingSep(i,t),this._itemsWidthStateChanged=!0,i.trigger("element_state_changed",{visible:t?!0:!1,disabled:this._isDisabled(i),checked:i.data("checked")?!0:!1}),i},_showOrHideCorrespondingSep:function(e,t){var i=t?"":":visible",n=e.prevAll(".ui-zmenu-separator"+i),s=e.nextAll(".ui-zmenu-separator"+i+":first");if(n.length&&s.length)e.prevAll(t?":first":":visible:first").is(".ui-zmenu-separator")&&e.nextAll(t?":first":":visible:first").is(".ui-zmenu-separator")&&e.nextAll(".ui-zmenu-separator"+(t?":first":":visible:first"))[t?"show":"hide"]();else if(n.length){var u=e.prevAll(t?":first":":visible:first"),a=e.next(".ui-zmenu-item"+i),r=t?!0:0==a.filter(":visible").length;r&&u.is(".ui-zmenu-separator")&&u[t?"show":"hide"]()}else{var o=e.nextAll(t?":first":":visible:first"),l=e.prev(".ui-zmenu-item"+i),h=t?!0:0==l.filter(":visible").length;h&&o.is(".ui-zmenu-separator")&&o[t?"show":"hide"]()}},hideMenuItem:function(e){this._hideMenuItem(e)},showMenuItem:function(e){this._hideMenuItem(e,!0)},hideAllMenuItems:function(){var t=e(this.element).find("li:not(.ui-zmenu-group-wrapper)");this._hideMenuItems(t)},showAllMenuItems:function(){var t=e(this.element).find("li");this._hideMenuItems(t,!0)},_hideMenuItems:function(t,i){var n=this;e(t).each(function(e,t){var s=n._hideMenuItem(t,i);i&&n._isSubMenuItem(s)&&n._hideMenuItems(s.find("li"),i)})},hideMenuItems:function(e){this._hideMenuItems(e)},showMenuItems:function(e){this._hideMenuItems(e,!0)},_getGroupArrSelector:function(t,i){var n="string"==typeof t?[t]:t,s=i?"!":"",u="",a=n.length;return e.each(n,function(e,t){u+="li[gname"+s+"="+t+"]",e!=a-1&&(u+=",")}),u},_hideMenuGroup:function(t,i){var n=this._getGroupArrSelector(t),s=e(n,this.element);this._hideMenuItems(s,i)},hideMenuGroup:function(e){this._hideMenuGroup(e)},showMenuGroup:function(t,i){var n="string"==typeof t?[t]:t;if(i){var s=this._getGroupArrSelector(t,!0),u=e(s,this.element);this._hideMenuItems(u)}this._hideMenuGroup(n,!0)},_disableMenuItems:function(t,i){var n=this;e(t).each(function(e,t){n._disableMenuItem(t,i)})},disableMenuItems:function(e){this._disableMenuItems(e)},enableMenuItems:function(e){this._disableMenuItems(e,!0)},_disableMenuGroup:function(t,i){var n=e("[gname="+t+"]",this.element);this._disableMenuItems(n,i)},disableMenuGroup:function(e){this._disableMenuGroup(e)},enableMenuGroup:function(e){this._disableMenuGroup(e,!0)},getItemCount:function(){return e(this.element).children(".ui-zmenu-item,.ui-zmenu-splitmenu").length},check:function(e,t){var i=this._getMenuItemId(e);return i&&i.length>0?this._check(i,t):void 0},_uncheckAllItems:function(t){var i=t.children("[inputtype=radio],[inputtype=checkbox]");i.filter(function(){return e(this).data("checked")});var n=this;i.each(function(t,i){i=e(i),n._fixCheckIcon(i,!1)})},checkAllItems:function(t,i){var n=this.element;if(!t)return this._uncheckAllItems(n);i=i?i:n.find("[inputtype=checkbox],[inputtype=radio]");var s=this;i.each(function(i,n){s.check(e(n),t)})},_getIconHolderForMenuItem:function(e){return e.find(".ui-zmenu-icon-inner")},getIconHolderForMenuItem:function(t){var i="object"==typeof t?t:e("#"+t,this.element);return this._getIconHolderForMenuItem(i)},getAllIconHolders:function(t){var i=t?[]:{},n=this;return this._getAllMenuItems().each(function(s,u){u=e(u);var a=t?s:u.attr("id"),r=n._getIconHolderForMenuItem(u);i[a]={icon:r,item:u}}),i},getIconHolderForMenuItems:function(t){var i=[],n=this;return e(t).each(function(e,t){i[i.length]=n.getIconHolderForMenuItem(t)}),i},_getMenuItemAsObject:function(t){var i=this,n={};e(this._attrNames).each(function(e,i){var s=t.attr(i);s&&(n[i]=s)});var s=t.metadata(),i=this;for(var u in s)-1==e.inArray(u,i._attrNames)&&"menuItems"!=u&&s[u]&&(n[u]=s[u]);if(this._isSubMenuItem(t)){var a=this._getSubMenu(t);a&&(n.menuItems=this._getMenuAsObject(a))}return n},_getMenuAsObject:function(t){t||(t=this.element);var i=this,n=t.children(),s=[];return n.each(function(t,n){s.push(i._getMenuItemAsObject(e(n)))}),s},getMenuAsObject:function(){return this._getMenuAsObject()},getMenuItemAt:function(e,t){return t||(t=this.element),t.find(".ui-zmenu-item[mtype!=separator][mtype!=group]:eq("+e+")")},getMenuItemAsObjectAt:function(e,t){return this._getMenuItemAsObject(this.getMenuItemAt(e,t))},showMenuItemAsSelected:function(e,t){this.getMenuItemAt(e,t).trigger("mouseover")},_hoverOnMenuItem:function(e){e.trigger("mouseover")},hoverPreviousMenuItem:function(){this._hoverOnMenuItem(this._getNextMenuItem(!0))},hoverNextMenuItem:function(){this._hoverOnMenuItem(this._getNextMenuItem())},hoverMenuItemWithLableStartingWith:function(t){var i=this.element.children(":visible"),n=!1;return e(i).each(function(i,s){return s=e(s),0==s.text().indexOf(t)?(n=e(s),!1):void 0}),n?this._hoverOnMenuItem(n):this._lastOverlayedMenuItem&&(this._lastOverlayedMenuItem.trigger("mouseout"),this._lastOverlayedMenuItem=void 0),n},handleKeyCode:function(t){var i=this._isFloatingMenu();switch(t){case e.ui.keyCode.UP:this._getNextMenuItem(!0).trigger("mouseover");break;case e.ui.keyCode.DOWN:this._getNextMenuItem().trigger("mouseover");break;case e.ui.keyCode.RIGHT:var n=(this._lastOverlayedMenuItem.nextAll(":visible.ui-zmenu-item,.ui-zmenu-group-wrapper").not(".ui-zmenu-separator,.ui-zmenu-group"),this._getSubMenu(this._lastOverlayedMenuItem)),s=this._lastOverlayedMenuItem.closest(".ui-zmenu");if(i||!n.length&&s.hasClass("ui-zmenu-floating")){var u=void 0;this._getNextMenuItem(u,u,u,t).trigger("mouseover");break}if(this._lastOverlayedMenuItem.is(".ui-state-disabled"))return;if(this._isSubMenuItem(this._lastOverlayedMenuItem)){var s=this._getSubMenu(this._lastOverlayedMenuItem);if(!s)return;this.show({target:this._lastOverlayedMenuItem},s),this._lastOverlayedMenuItem=void 0,this._getNextMenuItem(!1,!0).trigger("mouseover")}break;case e.ui.keyCode.LEFT:var s=this._lastOverlayedMenuItem.closest(".ui-zmenu-group-base");s.length||(s=this._lastOverlayedMenuItem.closest(".ui-zmenu"));var a=s.find(":visible.ui-zmenu-item,.ui-zmenu-group-wrapper").not(".ui-zmenu-separator,.ui-zmenu-group").filter(":first"),r=a.position().left,o=this._lastOverlayedMenuItem.position().left,l=o>r?!1:!0;if(i||!l){var u=void 0;this._getNextMenuItem(!0,u,u,t).trigger("mouseover");break}this._isMenuMainMenu(this._lastOverlayedMenu)||this._hideLastShownMenu();break;case e.ui.keyCode.ESCAPE:this.options.fixed||(this._isMenuMainMenu(this._lastOverlayedMenu)?this.hide():this._hideLastShownMenu());break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this.selectHoveredMenuItem();break;default:alphaNumericKey=String.fromCharCode(t),this._menuTextArray.length&&this._callMenuitemSearch(alphaNumericKey,(new Date).getTime())}},_callMenuitemSearch:function(e,t){var i=!1;""!==this._prevKeydownTime&&t-this._prevKeydownTime>700?(i=this._prevSearchKey==e?!0:!1,this._prevSearchKey=e):this._prevSearchKey=this._prevSearchKey+e,this._prevKeydownTime=t,this._menuitemSearch(i)},_menuitemSearch:function(t){var i=new RegExp("^"+this._prevSearchKey.replace(/[|()\[{.+*?$\\]/g,"\\$0"),"i"),n=t&&this._prevSearchIndex<this._menuTextArray.length?this._prevSearchIndex+1:0;for(n=n>0&&n<this._menuTextArray.length?n:0,x=n;x<this._menuTextArray.length;x++)if(this._menuTextArray[x].text.match(i)){this._prevSearchIndex=x;var s=!1;for(y=x+1;y<this._menuTextArray.length;y++)this._menuTextArray[y].text.match(i)&&(s=!0);return s||(this._prevSearchIndex=-1),void this._handleMouseOverOnMenuItems(e(this._menuTextArray[x].menuitem),void 0,!0)}},selectHoveredMenuItem:function(){var t=this._lastOverlayedMenuItem;return t&&e(t).trigger("click"),this.hide(),t?t:!1},getSplitMenuItem:function(e){return e.hasClass(".ui-zmenu-subsplit")?e.prev(".ui-zmenu-item"):e.closest(".ui-zmenu-splitgroup").find(".ui-zmenu-item")},bindKeys:function(e){this.options.bindKeys=e},_disable:function(e,t){var i=this;e=e?e:this.element,this._getAllMenuItems().each(function(e,n){i._disableMenuItem(n,t)})},disable:function(e){this._disable(e)},enable:function(e){this._disable(e,!0)},changeIcon:function(t,i){var n=this._getMenuItemId(t);if(n.data("fromMenuItemChange",!0),i=i.primary?i.primary:i){var s=this._getIconHolderForMenuItem(n);s.attr("class","ui-icon ui-zmenu-icon-inner "+i)}var u=e(n.metadata().relatedButton).data("fromButtonChange");u||this._triggerEvent(this._EVENTS.ONICONCHANGE,void 0,this.element,n,{icon:i})},_getMenuItemId:function(t){if("string"!=typeof t)return e(t);var i=-1!=t.indexOf("#")?t:"#"+t;return this.element.find(i)},changeLabel:function(t,i){var n=this._getMenuItemId(t);if(n.length){i=n.metadata().ellipsis?i+"...":i,n.data("fromMenuItemChange",!0),i&&n.find(".ui-zmenu-text").text(i);var s=e(n.metadata().relatedButton).data("fromButtonChange");s||this._triggerEvent(this._EVENTS.ONLABELCHANGE,void 0,this.element,n,{label:i})}},setPlaceHolderDimesion:function(e,t){t=t?t:this.element;var i=t.find(".ui-zmenu-icon-placeholder");t.hasClass("ui-zmenu-icononly")&&t.hasClass("ui-zmenu-floating")?i.css(e):t.hasClass("ui-zmenu-icontext-floating")&&(i.css(e),t.find(".ui-zmenu-text-placeholder").css({width:e.width}))}}),e.ui.zmenu.createMenu=function(t,i,n){var s=e("<ul>").attr({id:t}).hide(),u=void 0;"object"==typeof n&&(n.menuClass&&s.addClass(n.menuClass),n.appendTo&&(u=n.appendTo)),s=s.zmenu(n),s.zmenu("addMenuItems",i,n?n.addItemCallback:void 0);var a=e("body");return void 0!==u&&""!==u&&(u=-1!=u.indexOf("#")?u:"#"+u,a=e(u)),a.append(s),s}}(jQuery);
!function(t){var e={widgetEventPrefix:"tab",_tabs:void 0,_selectedTabIndex:0,_selectedTab:void 0,_left:0,_tabsMain:void 0,_isMenuTab:!1,_EVENTS:{ONMOUSEOVERTAB:"mouseover",ONMOUSEOUTTAB:"mouseout",ONCLICKTAB:"click",ONADDTAB:"add",ONBEFORESELECTTAB:"beforeselect",ONSELECTTAB:"select",ONBEFOREDELETETAB:"beforedelete",ONDELETETAB:"delete",ONBEFOREHIDETAB:"beforehide",ONHIDETAB:"hide",ONBEFOREUNHIDETAB:"beforeunhide",ONUNHIDETAB:"unhide",ONBEFOREDISABLETAB:"beforedisable",ONDISABLETAB:"disable",ONBEFOREENABLETAB:"beforeenable",ONENABLETAB:"enable",ONSORTTAB:"sort",ONBEFOREEDITLABEL:"beforeeditlabel",ONEDITLABEL:"editlabel",ONBEFOREUPDATELABEL:"beforeupdatelabel",ONUPDATELABEL:"updatelabel",ONDROPDOWNCLICK:"dropdownclick"},_create:function(){if(this.options.toolbarButtonsetLabelPosition=this.options.toolbarButtonsetLabelPosition||this.element.attr("toolbarButtonsetLabelPosition"),this._lastHoverTab=void 0,this._tabMenuArray=[],this.options=t.extend({},t.ui.ztab.defaults,this.options),this._initContainer(),this._hiddenOnInitTabs=[],this._initTabs(),this._isMenuTab){var e="ui-ztabs-editor "+(t.ui.directionIsRTL?" zmenu___rtl ":"");this.element.addClass(e)}this._initTabSliders(),this._firstEleDiv&&this._tabsMain.css("left",this._firstEleDiv.width()),this._bindEvents(),this.options.selectTabOnInit?this.selectTab(this._selectedTabIndex,!0):this._selectedTabIndex=-1;var i=this;t(this._hiddenOnInitTabs).each(function(t,e){i._hideTab(e)}),this._hiddenOnInitTabs.splice(0,this._hiddenOnInitTabs.length),this._hiddenOnInitTabs=void 0},_initContainer:function(){this.element.addClass("ui-tabs ui-widget ui-widget-content "+(this.options.vertical?"ui-tabs-vertical":"ui-tabs-horizontal")),this._tabsPanel=t("<div>").attr("class","ui-tabs-panel ui-widget-content ui-ztabs-label-"+this.options.toolbarButtonsetLabelPosition);var e=this.element.children("*:not(ul, [ttype=custom])"),i=this;e.each(function(t,e){i._tabsPanel.append(e)}),this.element.append(this._tabsPanel)},_setBaseContainerHeight:function(){if(!this.options.vertical){var t=this._tabsPanel.outerHeight(!0)-this._tabsPanel.height();t=0;var e=this.element.height()-this._innerPanel.outerHeight(!0)-t;this._tabsPanel.height(e)}},_bindEvents:function(){var e=t.ui.ztab.allowedMouseOperations,i=this.options.selectTabOn;this.options.selectTabOn=i=-1!=t.inArray(i,e)?i:e[0];var a=this,s=function(t){a._tabSelected(t,a)};this._tabsMain.on(i+"."+this.widgetName,s),this.options.allowKeyBind&&t(this._tabsMain).on("keydown",function(e){var i=t(a.element).hasClass("ui-state-disabled")||t(e.target).attr("disabled");return i?!1:void a._keyPress(e)}),this._isMenuTab&&(t(document).on("menushow.ztab",function(e,i){var s=t(i.menu).attr("id");if(-1!=t.inArray(s,a._tabMenuArray)){var n=t("#"+t("#"+s).data("tabId")),l=t(i.menu).outerWidth(!0),r=n.innerWidth();n.children(".ui-tab-before").remove();var o={width:l-r};t.ui.directionIsRTL?o.right=r:o.left=r,n.prepend(t("<div class='ui-tab-before'>").css(o)),a._tabMenuIsOpened=!0}}),t(document).on("menuhide.ztab",function(e,i){var s=t(i.menu).attr("id");-1!=t.inArray(s,a._tabMenuArray)&&(a._tabMenuIsOpened=!1)}))},_initTabs:function(){this._tabsMain=t("ul:first",this.element),this._tabsMain.addClass("ui-ztab ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header"),this._tabs=t(this._tabsMain).children("[ttype!=custom]");var e=this,i=0;if(this._selectedTabIndex=0,t(this._tabsMain).children(".ui-ztab-menu-only")&&(this._selectedTabIndex=t(this._tabsMain).children("[ttype!=custom]:not(.ui-ztab-menu-only):eq(0)").index()),this._tabs.each(function(){e._initTab(t(this),i++)}),this._isMenuTab&&this.element.addClass("ui-ztab-menutab"),this.options.sortable)try{var e=this;this._tabsMain.sortable({cursor:"move",axis:e.options.vertical?"y":"x",update:function(i,a){e._triggerEvent(e._EVENTS.ONSORTTAB,t(a.item[0])),e._refreshTabs()},containment:e._innerPanel})}catch(t){}this._tabsMain.on("dblclick."+this.widgetName,function(t){e._handleEditTabLabel(t)}),this._tabs=t(this._tabsMain).children("[ttype!=custom]")},_handleEditTabLabel:function(e){var i=t(e.target),a=i.is("li")?i:i.closest("a").closest("li");if(!a.length||this._isDisabled(a))return!1;if(!a.metadata().editable)return!1;var s=this._triggerEvent(this._EVENTS.ONBEFOREEDITLABEL,a);if(s){var n=i.closest("a"),l=t("<input>").attr("type","text").css({width:n.outerWidth(),height:n.height()}).val(n.text()).addClass("ui-tabs-label-text");n.hide(),l.insertAfter(n),l.select();var r=this;l.on("blur change",function(){l.off("blur").off("change"),r._updateLabel(a,l.val()),n.show(),l.remove()}),this._triggerEvent(this._EVENTS.ONEDITLABEL,a)}},_updateLabel:function(e,i){var a=this._triggerEvent(this._EVENTS.ONBEFOREUPDATELABEL,e,{value:i});if(a)var a=(t("a",t(e)).text(i),this._triggerEvent(this._EVENTS.ONUPDATELABEL,e,{value:i}))},_getRelatedTabPane:function(e){if(!e.hasClass("ui-ztab-menu-only")){var i=e.metadata(),a=this,s=t("a",e).off("click").on("click",function(t){t.stopPropagation(),t.preventDefault(),a._tabSelected(t,a),a.element.trigger("click")}).attr("href");if(void 0===i.relatedTabPane&&""!==s&&(e.metadata().relatedTabPane=s),s=s?s:i.relatedTabPane,-1!=s.indexOf("#")){var n=s.split("#");s="#"+n[n.length-1]}}return t(s,this.element)},_initTab:function(e,i){var a=e.metadata();e.hasClass("filemenu")&&e.addClass("ui-ztab-menu-only"),t.ui.shortcutkeys&&t.ui.shortcutkeys.register(e);var s=this._getRelatedTabPane(e),n=a.toolbar?a.toolbar:a.popup;s.attr("buttonsetLabelPosition",this.options.toolbarButtonsetLabelPosition);var l=this;if(n){var r=a.toolbar?"toolbar":"popup";this._isMenuTab=!0;var o=t("<span class='ui-ztab-dropdown ui-ztab-arrow'><span class='ui-ztab-dropdown-icon ui-components-icon ui-ztab-menu'></span></span>").appendTo(e);e.hasClass("ui-ztab-menu-only")?(t("#"+n).addClass("ui-ztab-toolbar-menu ui-tabs-only"),t("#"+n).metadata().positionAlterable=!1,e.attr(r,n)):o.attr(r,n),this._tabMenuArray.push(n),l._currerntHoverTab=void 0,o.hover(function(){l._isDisabled(t(this))||(o.addClass("ui-ztab-dropdown-hover"),l._tabMenuIsOpened&&(l._lastHoverTab&&l._lastHoverTab[0]!=o[0]||!l._lastHoverTab)&&o.trigger("click"),l._currerntHoverTab=o)},function(){l._lastHoverTab=o,o.removeClass("ui-ztab-dropdown-hover")}),o.on("click",function(t){if(!e.hasClass("ui-ztab-menu-only")){l._selectedDropdown=this;var i=void 0!==t.originalEvent&&t.originalEvent?!0:!1;l._triggerEvent(l._EVENTS.ONDROPDOWNCLICK,e,{fromUI:i}),l._tabMenuIsOpened=!0}}),this._tabMenuIsOpened=!1}var h=t("a",e);if(linktext=h.text(),a.icon){h.empty();var d=t("<span/>").addClass("ui-icon "+a.icon).css({float:"left"});h.append(d),d.after(linktext)}var b=n?"ui-state-default ui-corner-top ui-tabs-nav-menu":"ui-state-default ui-corner-top ";e.metadata().contextual&&(b=b+" ui-ztab-contextual ui-ztab-contextual-"+e.metadata().group),e.addClass(b);var l=this;e.hover(function(i){if(!l._isDisabled(t(this))){if(e.hasClass("ui-state-active"))return;t(i.target).hasClass("ui-ztab-dropdown")||t(i.target).hasClass("ui-icon")?e.addClass("ui-state-hover").removeClass("ui-state-hover-hover"):e.addClass("ui-state-hover ui-state-hover-hover"),l._triggerEvent(l._EVENTS.ONMOUSEOVERTAB,e,{fromUI:!!i.originalEvent})}},function(t){l._isDisabled(e)||(e.removeClass("ui-state-hover ui-state-hover-hover"),l._triggerEvent(l._EVENTS.ONMOUSEOUTTAB,e,{fromUI:!!t.originalEvent})),e.hasClass("ui-ztab-menu-only")}),e.on("mousemove",function(i){l._isDisabled(e)||(t(i.target).hasClass("ui-ztab-dropdown")||t(i.target).hasClass("ui-icon")?e.addClass("ui-state-hover").removeClass("ui-state-hover-hover"):e.addClass("ui-state-hover ui-state-hover-hover"))}),t(s).hide(),a.index=i,a.selected&&(this._selectedTabIndex=i);var u=e.metadata();if(u.hidden&&this._hiddenOnInitTabs.push(e),u.closeable){var l=this,c=t("<span>").addClass("ui-icon ui-icon-close").click(function(){return l._isDisabled(e)?!1:void(u.hideonclose?l._hideTab(e):l._deleteTab(e,!0))});e.append(c)}this._isDisabled(e)&&this._disableTab({tab:e,enable:!1,isFromInit:!0},a.disableRelatedPane)},_clearRelatedTabProps:function(e){var i=e.metadata();t(i.relatedTabPane).hide()},_triggerEvent:function(e,i,a){var s=t(i).metadata(),n={tab:t(i),index:s.index,relatedPaneId:t(s.relatedTabPane).attr("id"),relatedPane:t(s.relatedTabPane)};return a&&(n=t.extend(n,a)),this._trigger(e,e,n)},_isDisabled:function(t){var e=t.hasClass("ui-state-disabled");return e?!0:!1},_selectTab:function(e,i,a){if(!this.element.hasClass("ui-state-disabled")&&(e=t(e),e.length)){if(e.is(":hidden")){if(!this.options.selectHiddenTabs)return!1;this._hideTab(e,!0)}var s=e.metadata();if(this._isDisabled(e))return!1;if(s.relatedTabPane&&!e.hasClass("ui-ztab-menu-only")){if(s.contextual&&this._tabsPanel.addClass("ui-ztoolbar-highlight-"+s.group),this._triggerEvent(this._EVENTS.ONCLICKTAB,e,{fromUI:a}),!i&&s.index===this._selectedTabIndex&&!this._tabExpand)return!1;var n=this._triggerEvent(this._EVENTS.ONBEFORESELECTTAB,e,{fromUI:a});if(!n)return!1;if(this._isMenuTab){var l=t(".ui-icon-collapse",this.element);l.length&&this._showhideToolbar(l)}if(this._selectedTab){this._selectedTab.metadata().selected=!1;var r=t(this._selectedTab).metadata();r.group!=s.group&&this._tabsPanel.removeClass("ui-ztoolbar-highlight-"+r.group),this._clearRelatedTabProps(this._selectedTab),t(this._selectedTab).removeClass("ui-tabs-selected ui-state-active")}e.addClass("ui-tabs-selected ui-state-active"),s.selected=!0,this._selectedTab=e,this._selectedTabIndex=s.index;var o=this._getRelatedTabPane(e);o.show();var h=o.data();null!=h&&"object"==typeof h.ztoolbar&&h.ztoolbar._isDocumentResized&&(h.ztoolbar._isDocumentResized=!1,o.ztoolbar("resizeTooolbar")),this._scrollTabToView(e),this._triggerEvent(this._EVENTS.ONSELECTTAB,e,{fromUI:a})}else{if(this._triggerEvent(this._EVENTS.ONCLICKTAB,e),!i&&s.index===this._selectedTabIndex)return!1;var n=this._triggerEvent(this._EVENTS.ONBEFORESELECTTAB,e,{fromUI:a});if(!n)return!1}}},_scrollTabToView:function(e){if(!this.options.vertical){e=t(e);var i=e.position();if(i.width=e.outerWidth(),e.outerWidth(!0)!==this._tabsMain.width()){var a=this._tabsMain.position();a.width=this._innerPanel.outerWidth()-this._lastEleDiv.width();var s=i.width+i.left,n=a.width,l=void 0,r=this._firstEleDiv,o=r.position().left+r.outerWidth();s+a.left>n?l=a.width-i.left-i.width-5:a.left+i.left<=o&&(l=o-i.left),void 0!=l&&this._animateToPosition(l)}}},_tabSelected:function(e){var i=t(e.target);if(!i.hasClass(".ui-ztab-arrow")){var a=i.is("li")?i:i.closest("a").closest("li");if(!a.length)return!1;var s=void 0!==e.originalEvent&&e.originalEvent?!0:!1;this._selectTab(a,void 0,s)}return!1},_keyPress:function(e){if(e.ctrlKey){var i=t(this.getSelectedTab()).metadata().index,a=this._tabs.length;switch(e.keyCode?e.keyCode:e.charCode){case t.ui.keyCode.RIGHT:i++;break;case t.ui.keyCode.LEFT:i--;break;case t.ui.keyCode.HOME:i=0;break;case t.ui.keyCode.END:i=a-1}0>i?i=a-1:i>=a&&(i=0),this.selectTab(i)}},_createSliderButton:function(e){var i=e?"left":"right",a=t("<div>").attr("_dir",i).addClass("ui-tabs-slider-"+i).addClass("ui-button ui-state-default ui-tabs-slider");return a.append(t("<span>").attr("_dir",i).addClass(e?"ui-scrolltab-l":"ui-scrolltab-r").addClass("ui-icon").addClass(e?"ui-icon-triangle-1-w":"ui-icon-triangle-1-e")),a.hover(function(){t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")}),a.hide()},_getExtraContainers:function(e){var i=this,a=t("<div>").addClass("ui-widget-content ui-ztab-custom-outer"),s=t("<div>").addClass("ui-widget-header ui-ztab-custom ui-ztab-custom-"+(e?"left":"right")).height(this._tabsMain.height()-1).append(a);if(this._isMenuTab){var n=t("<div>").attr({title:this._getString("collapse.label"),class:"ui-ztab-custom-right ui-ztab-expand ui-components-icon ui-icon-expand"}).appendTo(s);n.on("click",function(){i._showhideToolbar(n,!0)}).on("mousedown",function(){n.attr("title",i._getString(n.hasClass("ui-icon-expand")?"expand.label":"collapse.label"))})}return e?s.insertBefore(this._innerPanel):s.insertAfter(this._innerPanel),a},_showhideToolbar:function(e,i){if(this._selectedTab){relatedTabPane=this._getRelatedTabPane(t(this._selectedTab));var a=this._selectedTab.metadata();e.hasClass("ui-icon-expand")?(e.removeClass("ui-icon-expand").addClass("ui-icon-collapse"),a.contextual&&this._tabsPanel.removeClass("ui-ztoolbar-highlight-"+a.group),this._tabExpand=!0,this._selectedTab.removeClass("ui-tabs-selected ui-state-active"),relatedTabPane.ztoolbar("hide")):(e.removeClass("ui-icon-collapse").addClass("ui-icon-expand"),this._tabsPanel.removeClass("ui-ztab-toolbar-border"),i&&this._selectedTab.addClass("ui-tabs-selected ui-state-active"),a.contextual&&this._tabsPanel.addClass("ui-ztoolbar-highlight-"+a.group),this._tabExpand=!1,relatedTabPane.ztoolbar("show")),e.attr("title",this._getString(e.hasClass("ui-icon-expand")?"collapse.label":"expand.label"))}},_initTabSliders:function(){var e=t("<div>");if(this._innerPanel=e,this._sliderLeft=this._createSliderButton(!0),this._sliderRight=this._createSliderButton(),e.append(this._sliderLeft,this._tabsMain,this._sliderRight),t(e).insertBefore(t(this.element).children(":first")),e.addClass(this.options.vertical?"ui-tabs-inner-panel-v":"ui-tabs-inner-panel"),!this.options.vertical){var i=this,a=this.element.children("[ttype=custom][position=first], [ttype=custom]:not([position])");this._firstEleDiv=this._getExtraContainers(!0),this._lastEleDiv=this._getExtraContainers(),a.each(function(e,a){i._firstEleDiv.append(t(a))});var s=this.element.children("[ttype=custom][position=last]");s.each(function(e,a){i._lastEleDiv.append(t(a))}),t("div[_dir]",e).on("click",function(t){i._adjustTabs(t)}),this._sliderLeft.css("margin-left",this._firstEleDiv.width()),this._sliderRight.css("right",this._lastEleDiv.width()),t(window).on("resize."+this.widgetName,function(){i._showSliders()}),t.debounce(500,i._showSliders)}},_adjustTabs:function(e){var i=(t(e.target),this._getAlteredLeft(e));this._animateToPosition(i)},_getCorrectedLeft:function(t){var e=this._firstEleDiv.width(),i=this._getMaxLeft();return i>t&&(t=i),t>e&&(t=e),t},_animateToPosition:function(e){var i=this,a=t(this._tabsMain);a.stop(!0,!0),e=this._getCorrectedLeft(e),a.animate({left:e},1e3,function(){i._showSliders(!0)})},_getMaxLeft:function(){var t=this._tabsMain.children("li:visible:last");return t.length?(this._maxLeft=this._innerPanel.width()-(t.position().left+t.outerWidth()),this._lastEleDiv&&(this._maxLeft-=this._lastEleDiv.outerWidth()),this._maxLeft):0},_showSliders:function(e){if(!this.options.vertical)if(t.ui.directionIsRTL){var i=this._lastEleDiv.width();e||t(this._tabsMain).css("right",i)}else{var i=this._firstEleDiv.width();e||t(this._tabsMain).css("left",i);var a=this._tabsMain.position(),s=a.left+i;this._sliderLeft[s>=i?"hide":"show"]();var n=this._getMaxLeft()+i;this._sliderRight[1*s.toFixed(1)>1*n.toFixed(1)?"show":"hide"]()}},_getAlteredLeft:function(e){var i=t(e.target),a=this._tabsMain.position().left,s=i.attr("_dir"),n=(this._innerPanel,0);switch(s){case"right":n=a-100;break;case"left":n=a+100}return this._getCorrectedLeft(n)},getSelectedTab:function(){return this._tabsMain.children("li.ui-tabs-selected")},getSelectedRelatedTabPane:function(){var e=this.getSelectedTab();return t(e).metadata().relatedTabPane},_getTabAt:function(e,i){var a;return isNaN(e)?a=t("object"==typeof e?e:"#"+e):(a=i?this._tabsMain.children():this._tabs,e=!e||0>e?0:e>=a.length?a.length-1:e,a=a[e]),a},selectTab:function(t,e){this._selectTab(this._getTabAt(t,e),e)},_getTabByType:function(e){return t("[ttype="+e+"]:first",this._tabsMain)},selectTabByType:function(t,e){var i=this._getTabByType(t);return i.length?this._selectTab(i,e):void 0},showNextTab:function(){this.selectTab(t(this.getSelectedTab()).metadata().index+1)},showPrevTab:function(){this.selectTab(t(this.getSelectedTab()).metadata().index-1)},_nonDataParams:["label","relatedPaneId"],_refreshTabs:function(){this._maxLeft=void 0,this._tabs=t(this._tabsMain).children(":not([hidden]):not([ttype=custom])");var e=this;t(this._tabs).each(function(i,a){var s=t(a).metadata();s.index=i,s.selected&&(e._selectedTabIndex=i)}),this._showSliders()},_generateNewPaneId:function(){return"tab_"+this._tabs.length+this._getMaxLeft().toFixed(0)},addTab:function(e,i){var a=t("<li>"),s=this._tabs.length;!e.index||this._tabs.length-1<e.index?this._tabsMain.append(a):(s=e.index,a.insertBefore(this._tabs[e.index]));var n=t("<a>"),l=a.metadata();for(var r in e)-1===t.inArray(r,this._nonDataParams)&&(l[r]=e[r]);n.html(e.label),a.attr({ttype:e.type,id:e.id});var o=void 0;return e.relatedPaneId?o=t("#"+e.relatedPaneId):e.relatedPaneId=this._generateNewPaneId(),o&&o.length||(o=e.url?t("<iframe>").attr({id:e.relatedPaneId,src:e.url,frameborder:"0px"}).css("border","none"):t("<div>").attr("id",e.relatedPaneId)),e.relatedPane=o,n.attr("href","#"+e.relatedPaneId),this._tabsPanel.append(o),a.append(n),this._initTab(a,s),this._refreshTabs(),this._triggerEvent(this._EVENTS.ONADDTAB,a),this.options.highlightTabOnAdd&&this._highlightTab(a),i&&i(e),e.selected&&this._selectTab(a,!0),e},_deleteTab:function(e,i){if(1!==this._tabs.length){var e=t(e);if(e&&e.length){var a=this._triggerEvent(this._EVENTS.ONBEFOREDELETETAB,e);if(a){var s=this;e.height(e.height()),e.width(e.width()),e.empty(),e.animate({width:0,opacity:0},{duration:s.options.animateOnDeleteTab?300:0,complete:function(){s._removeTab(e,i)}})}}}},_removeTab:function(e,i){this._clearRelatedTabProps(e),i&&t(e.metadata().relatedTabPane).remove();var a=e.metadata().index;e.remove(),this._refreshTabs(),this._triggerEvent(this._EVENTS.ONDELETETAB,e),a===this._selectedTabIndex&&this.selectTab(a,!0)},deleteTab:function(t,e){this._deleteTab(this._getTabAt(t,!1),e)},deleteTabByType:function(t,e){var i=this._getTabByType(t);this._deleteTab(i,e)},highlightTab:function(t){this._highlightTab(this._getTabAt(t,!1))},highlightTabByType:function(t){var e=this._getTabByType(t);this._highlightTab(e)},_highlightTab:function(t){if(t&&t.length){var e=t.clone().addClass("ui-state-error"),i=t.position();e.css({position:"absolute",left:i.left,top:i.top}),e.fadeTo(0,0),t.parent().append(e),e.fadeTo(700,1,function(){e.fadeTo(700,.7,function(){e.fadeTo(700,1,function(){e.fadeTo(700,.7,function(){e.remove()})})})})}},_hideTab:function(e,i){if(e=t(e),(1!==this._tabs.length||i)&&e&&e.length){var a=e.metadata(),s=this._triggerEvent(this._EVENTS[i?"ONBEFOREUNHIDETAB":"ONBEFOREHIDETAB"],e);s&&(i||this._clearRelatedTabProps(e),a.selected=!1,this._selectedTabIndex=-1,this._selectedTab&&(this._selectedTab.metadata().group==a.group&&i||this._tabsPanel.removeClass("ui-ztoolbar-highlight-"+a.group)),a.contextual?i?e.is(":visible")||(e.css({top:"35px"}).animate({top:"0px"},{duration:1e3,easing:"easeInOutElastic"}),e.nextAll().is(":visible")&&e.nextAll().animate({left:e.innerWidth()+12},200),setTimeout(function(){e.nextAll().css({left:""}),e.show()},500)):e.is(":visible")&&(e.clearQueue().animate({top:"35px"},{duration:800,easing:"easeInOutElastic"}),e.nextAll().clearQueue().delay(300).animate({left:-(e.innerWidth()+12)}),setTimeout(function(){e.nextAll().css({left:""}),e.hide()},1e3)):e[i?"show":"hide"](),e.attr("hidden",!i),this._refreshTabs(),this._triggerEvent(this._EVENTS[i?"ONUNHIDETAB":"ONHIDETAB"],e),i&&this.options.highlightTabOnShow&&this._highlightTab(e))}},hideTab:function(t){this._hideTab(this._getTabAt(t,!0))},unhideTab:function(t){this._hideTab(this._getTabAt(t,!0),!0)},hideTabByType:function(t){var e=this._getTabByType(t,!0);this._hideTab(e)},unhideTabByType:function(t){var e=this._getTabByType(t,!0);this._hideTab(e,!0)},unhideAll:function(){var e=t(this._tabsMain).children("li:hidden"),i=this;t(e).each(function(e,a){i._hideTab(t(a),!0)})},hideTabs:function(e){var i=this;t(e).each(function(e,a){i._hideTab(t("#"+a))})},unhideTabs:function(e){var i=this;t(e).each(function(e,a){i._hideTab(t("#"+a),!0,1)})},_disableTab:function(e,i){var a=t(e.tab),s=e.enable;if(a&&a.length){var n=this._triggerEvent(this._EVENTS[s?"ONBEFOREENABLETAB":"ONBEFOREDISABLETAB"],a);if(n){t(a)[s?"removeClass":"addClass"]("ui-state-disabled"),s?t(a).removeAttr("disabled"):t(a).attr("disabled",!s);var l=t(a).find("[toolbar]");if(l.push(t(a).find("[popup]")),l.length&&t.each(l,function(e,i){s?t(i).removeClass("ui-state-disabled"):t(i).addClass("ui-state-disabled"),s?t(i).removeAttr("disabled"):t(i).attr("disabled",!s)}),i){var r=this._getRelatedTabPane(t(a));(r.data("ui-ztoolbar")||r.data("ztoolbar"))&&r.ztoolbar(s?"enable":"disable")}e.isFromInit||this._refreshTabs(),s&&this.element.removeClass("ui-state-disabled").removeAttr("disabled"),this._triggerEvent(this._EVENTS[s?"ONENABLETAB":"ONDISABLETAB"],a)}}},_getString:function(e){return t.i18n?t.i18n("ztab",e):this.options.keys[e]},disableTab:function(t,e){var i=this._getTabAt(t,!0);this._disableTab({tab:i,enable:!1},e)},disableTabByType:function(t,e){var i=this._getTabByType(t,!0);this._disableTab({tab:i,enable:!1},e)},enableTab:function(t,e){var i=this._getTabAt(t,!0);this._disableTab({tab:i,enable:!0},e)},enableTabByType:function(t,e){var i=this._getTabByType(t,!0);this._disableTab({tab:i,enable:!0},e)},disable:function(e){this.element.attr("disabled","true").addClass("ui-state-disabled"),this.element.children(".ui-tab").attr("disabled","true").addClass("ui-state-disabled");var i=this.element.find(".ui-ztab").children("li"),a=this;t.each(i,function(i,s){a._disableTab({tab:t(s),noTabClassChange:!0},e)})},enable:function(e){t(this.element).removeAttr("disabled"),t(this.element).removeClass("ui-state-disabled");var i=this.element.find(".ui-ztab").children("li"),a=this;t.each(i,function(i,s){a._disableTab({tab:t(s),enable:!0},e)})},destroy:function(){var e=this,i=t(this.element).find("[ttype=custom]");t.each(i,function(i,a){t(a).insertBefore(e.element.children(":last")).off(),t(e.element).find(".ui-ztab-custom").remove()}),t(this.element).find(".ui-tabs-slider").remove();var a=t(this.element).find(".ui-ztab");a.off().insertBefore(e.element.children(":last")),t(this.element).find(".ui-tabs-inner-panel").remove(),t.each(a.children("li"),function(e,i){t(i).removeAttr("class").off().find(".ui-icon-close").remove(),t(i).children("a").off()}),a.removeAttr("style").removeAttr("class");var s=t(this.element).find(".ui-tabs-panel");t.each(s.children(),function(i,a){t(a).removeAttr("style").insertBefore(e.element.children(":last")).off()}),s.remove(),t(this.element).removeAttr("style").removeAttr("class"),a.off("."+this.widgetName),this.element.off("."+this.widgetName),t.Widget.prototype.destroy.apply(this,arguments)}};e=t.extend({},e),t.widget("ui.ztab",e),t.ui.ztab.allowedMouseOperations=["click","mousedown","mouseup","mouseover"],t.ui.ztab.defaults={toolbarButtonsetLabelPosition:"left",sortable:!1,selectTabOn:"click",allowKeyBind:!0,selectHiddenTabs:!1,highlightTabOnShow:!1,highlightTabOnAdd:!1,animateOnDeleteTab:!0,selectTabOnInit:!0,keys:{"expand.label":"Expand Toolbar","collapse.label":"Collapse Toolbar"}}}(jQuery);
!function(t){var e={_toolbarButtons:void 0,_lastRemovedButton:void 0,options:{enableAutoResize:!0},_eleArr:[],_ctypeElems:".ui-zoom-panel,.ui-hiddenslider,.ui-zslider-panel,.ui-zstate,.ui-zspinner,.ui-ztoggle",_create:function(){this._radioButtonAsMenu=!1,this.options.buttonsetLabelPosition=this.options.buttonsetLabelPosition||this.element.attr("buttonsetLabelPosition"),this.options=t.extend({},t.ui.ztoolbar.defaults,this.options);var e="ui-ztoolbar-panel "+(t.ui.directionIsRTL?" zmenu___rtl ":"");this.element.addClass(e+" ui-ztoolbar-label-"+this.options.buttonsetLabelPosition),this._isDocumentResized=!1,this._fixToolbarWidth(),this._initItems(),this._eleArr=[],this._addEvents();var n=this,i=function(){n._onDocumentResized()};setTimeout(i,500)},widgetEventPrefix:"toolbar",_EVENTS:{ONINIT:"init",ONBUTTONCLICKED:"buttonclicked",ONTOOLBARSHRINK:"shrank",ONTOOLBAREXPAND:"expanded",ONBUTTONDOUBLECLICKED:"buttondblclicked",ONTOOLBARHIDE:"hide",ONTOOLBARSHOW:"show"},_addEvents:function(){var e=this;if(e.options.enableAutoResize){var n=function(){t(window).on("resize."+e.widgetName,t.debounce(500,function(t){e._onDocumentResized(t)}))};setTimeout(n,100)}this.element.on("click."+this.widgetName,function(t,n){t.data=n,e._fireEvent(t,e)}),this.element.on("dblclick."+this.widgetName,function(t,n){t.data=n,e._fireEvent(t,e)}),this._triggerEvent(this._EVENTS.ONINIT,!1,this.element)},_parseAndFixGroups:function(){var e=this.element.children("[ttype=group]");e.each(function(e,n){n=t(n);var i=n.children();i.each(function(e){var o=t(i[i.length-1-e]);o.insertAfter(n),o.attr("gname",n.attr("id"))}),n.remove()})},_initItems:function(){this._toolbarButtons=this.element.children();var e=t("<div>").addClass("ui-ztoolbar-inner-panel");this.element.append(e),this._toolbarButtons.each(function(t,n){e.append(n)}),this.innerPane=e;var n=this._toolbarButtons.filter(":not([ctype],select)"),i=this;n.each(function(e,n){var o=t(n),s=o.metadata();s.buttonset?(s.noseparator?o.addClass("ui-buttonset-nosep"):o.next().length||o.addClass("ui-buttonset-nosep"),o.zbutton({iconScope:"ui-components-toolbar-icon",labelPosition:i.options.buttonsetLabelPosition}),s.label&&"bottom"===i.options.buttonsetLabelPosition&&t("<span>").attr("class","ui-group-text").text(s.label).appendTo(o)):"custom"!==o.data("uitype")&&(o.is("select")?i._initCombo(o):o.zbutton({iconScope:"ui-components-toolbar-icon"}))});var o=this._toolbarButtons.children("select:not([ctype])");this._initCombo(o)},_initCombo:function(e){e.each(function(e,n){var i=t(n).metadata().componentOptions;t(n).zcombo(i)})},_registerShortcutkey:function(e){t.ui.shortcutkeys&&e.length&&(shortcut=t.ui.shortcutkeys.register(e))},_getLastEle:function(){return t(this.innerPane).children(":visible").last()},_fixToolbarWidth:function(){this.element.css("width",this.element.parent().width())},_getOffsets:function(e){e||(e=this._getLastEle());var n=t.ui.directionIsRTL?0:e.outerWidth(),i=e.length>0?Math.round(e.offset().left+n):0,o=Math.round(this.element.width()+this.element.offset().left);return{buttonEnd:i,toolbarEnd:o}},_isInBounds:function(){var e=this._getOffsets();return t.ui.directionIsRTL?e.buttonEnd>0:e.toolbarEnd>e.buttonEnd},_onDocumentResized:function(){return this.element.is(":hidden")||!t(this.innerPane).is(":visible")?void(this._isDocumentResized=!0):(this._fixToolbarWidth(),void(this._isInBounds()?(this._expandToolbar(),this._triggerEvent(this._EVENTS.ONTOOLBAREXPAND,!1,this.element)):(this._shrinkToolbar(),this._triggerEvent(this._EVENTS.ONTOOLBARSHRINK,!1,this.element))))},resizeTooolbar:function(){this._onDocumentResized()},_isButtonInButtonSet:function(e){return e.length?t(e).parent().hasClass("ui-button-splitbutton")?t(e).parent().parent().metadata().buttonset:t(e).parent().metadata().buttonset:!1},_isButtonSet:function(t){return t.metadata().buttonset},_addExtendedMenuButton:function(e){if(!this.extendMenuButton){var n=this._getLastVisibleButton();this.extendMenuButton=t("<button class='ui-ztoolbar-splitmenu'>"+t.i18n("zcommon","moreoptions.label")+"</button>"),this.extendMenuButton.attr("data",'{"text": false, "icons":{"primary": "ui-icon-carat-1-e"}}'),this.extendMenuButton.zbutton();var i=this.element.attr("id")+"Menu";this.extendMenuButton.attr("popup",i),this.extendedMenuPopup=t.ui.zmenu.createMenu(i,t(e)),this.extendMenuButton.css("width","16px"),this.extendMenuButton.appendTo(t(n).parent())}},_removeExtendedMenuButton:function(){this.extendedMenuPopup.zmenu("destroy").remove(),this.extendMenuButton.button("destroy").remove(),this.extendedMenuPopup=this.extendMenuButton=void 0},_shrinkToolbar:function(){if(!this._isInBounds()){var e=this._getButton();if(!e.length)return;if(this._eleArr.push(e),this._isButtonInButtonSet(e)){var n=e.parent();n=n.metadata().innerButtonset?n.parent():n,n.hasClass("ui-button-splitbutton")&&(n=n.parent());var i=n.attr("id");if(n.hasClass("ui-zbutton-radioset")){n.zbutton("shrinkButtonSetAsMenu",n),this._eleArr.pop(e),this._eleArr.push(n);var o=i+"Menu",s=o+"Button";t("#"+o).off("menuitemclicked").on("menuitemclicked",function(t,e){var i=e.menuitem.metadata();n.zbutton("changeIcon",{primary:i.icons.primary+" ui-components-toolbar-icon"},s),n.zbutton("changeLabel",i.label,s)})}else n.zbutton("shrinkButtonSet",[e]);t("#"+i).off("element_state_changed").on("element_state_changed",function(e,n){var o=n.disabled?!1:!0;t("#"+i+"Menu").zmenu("disableMenuItem","shrinked_menuitem_"+t(e.target).attr("id"),o);var s=n.checked?!0:!1;t("#"+i+"Menu").zmenu("check","shrinked_menuitem_"+t(e.target).attr("id"),s)})}else{var u=e.zbutton("getAsObject",e,!0);e.metadata().alteredId=u.id,this.extendMenuButton?this.extendedMenuPopup.zmenu("addMenuItem",u,0):this._addExtendedMenuButton(u),e.hide();var a=this;e.off("element_state_changed").on("element_state_changed",function(e,n){var i=n.disabled?!1:!0;a.extendedMenuPopup.zmenu("disableMenuItem","shrinked_menuitem_"+t(this).attr("id"),i);var o=n.checked?!0:!1;a.extendedMenuPopup.zmenu("check","shrinked_menuitem_"+t(this).attr("id"),o)})}this._shrinkToolbar()}},_expandToolbar:function(){if(this._eleArr&&this._eleArr.length>0){var e=t(this._eleArr[this._eleArr.length-1]),n=e.outerWidth(!0),i=0;if(this.innerPane.children(":visible").each(function(){i+=t(this).outerWidth(!0)}),i+n<this.element.width()){if(this._isButtonSet(e))e.zbutton("expandButtonSet",[e],!0),e.hasClass("ui-zbutton-radioset")&&(this._radioButtonAsMenu=!1);else if(this._isButtonInButtonSet(e)){var o=e.parent();o.hasClass("ui-button-splitbutton")?o.parent().zbutton("expandButtonSet",[e]):o.metadata().innerButtonset?o.parent().zbutton("expandButtonSet",[e]):o.zbutton("expandButtonSet",[e])}else e.show(),this.extendedMenuPopup.zmenu("removeMenuItem",e.metadata().alteredId);this._eleArr.splice(this._eleArr.length-1,1),this._expandToolbar()}}this.extendedMenuPopup&&0==this.extendedMenuPopup.zmenu("getItemCount")&&this._removeExtendedMenuButton()},_isSplitButton:function(t){return t.is("div.ui-buttonset")},_getLastVisibleButton:function(){return t(this.innerPane).children(".ui-button:visible:not(.ui-buttonset-sep,.ui-splitbutton,.ui-ztoolbar-splitmenu)").last()},_getButton:function(){var e="",n=void 0,i="",o=(this._radioButtonAsMenu?".ui-buttonset:visible:not(div.ui-button-splitbutton)":".ui-zbutton-radioset:visible",this._radioButtonAsMenu?".ui-buttonset":".ui-zbutton-radioset"),s=t(this.innerPane).children(o+",.ui-zbutton-group:visible:not(.ui-buttonset-sep,div.ui-button-splitbutton)");if(t(s.get().reverse()).each(function(e,o){if(!n){var s=t(o);if(s.is(".ui-buttonset")){var u=s.children(":visible:not(.ui-group-text,.ui-buttonset-sep,.ui-extended-buttonset,input,.ui-buttonset-label, .ui-zcombo)");s.metadata().mainButtonset?t(u).each(function(e,o){return i=t(o),i.children(":visible:not(.ui-group-text,.ui-buttonset-sep,.ui-extended-buttonset,input,.ui-buttonset-label, .ui-zcombo)").length>1?void(n=i):void 0}):i=s}else i=s;return i&&i.children(":visible:not(.ui-group-text,.ui-buttonset-sep,.ui-extended-buttonset,input,.ui-buttonset-label, .ui-zcombo)").length>1?void(n=i):void 0}}),n&&(e=n.hasClass("ui-button")?n:n.children(":visible:not(.ui-group-text,.ui-buttonset-sep,.ui-extended-buttonset,.ui-buttonset-label, input)").last()),!e.length){if(!this._radioButtonAsMenu)return this._radioButtonAsMenu=!0,this._getButton();e=this._getLastVisibleButton()}return e.length?e:!1},_getCorrespondingToolbarButton:function(e){var n=e;do{if(t.inArray(n,this._toolbarButtons))return n;n=n.parent()}while(n==this.element)},_fireEvent:function(e){var n=t(e.target),i=n.is("input")?n:n.closest(".ui-button");i.is(":not(input)")&&i.is(":not(button)")||i.length&&!i.is(":disabled")&&this._triggerEvent(this._getEvent(e),e,i)},_getEvent:function(t){var e=void 0;switch(t.type){case"click":e=this._EVENTS.ONBUTTONCLICKED;break;case"mouseover":e=this._EVENTS.ONMOUSEOVER;break;case"mouseout":e=this._EVENTS.ONMOUSEOUT;break;case"dblclick":e=this._EVENTS.ONBUTTONDOUBLECLICKED}return e},_getGroupBtnAsObj:function(t,e){var n=t.attr("data"),i={};return i.data=n,i.label=t.metadata().label,e?i.submenu="#"+t.parent().attr("id")+"menu":i.mtype="group",i},_filterCtypeElems:function(e){var n=[];return t.each(e,function(e,i){var o=t(i).parent();(o.hasClass("ui-zbutton-group")||o.hasClass("ui-buttonset"))&&n.push(i)}),n},_initAsMenu:function(){var t=this.element.parent().parent().find("a[href='#"+this.element.attr("id")+"']").parent().find(".ui-ztab-dropdown");if(t){var e=this.getToolbarAsMenu();e.attr("relativeto","parent"),t.attr("popup",t.attr("toolbar")),t.removeAttr("toolbar")}},getToolbarAsMenu:function(){var e=t(this.element.children()[0]).children(":not([ctype],select,"+this._ctypeElems+",.ui-zcolorchooser)"),n=t(this.element).attr("id")+"menu",i=this;this._menuArray=new Array,t(e).each(function(e,n){var o=t(n),s=o.children().filter(":not([ctype],select,"+i._ctypeElems+",.ui-zcolorchooser,.ui-zslider-panel,.ui-buttonset-sep,.ui-buttonset-sub-sep,.ui-zcombo,.ui-buttonset-label,.ui-group-text)").length;o.hasClass("ui-buttonset")&&!s||"custom"===o.data("uitype")||i.getButtonAsObj(o,void 0)});var o=t.ui.zmenu.createMenu(n,this._menuArray,{positionAlterable:!1,menuClass:"ui-ztab-toolbar-menu"});o.on("menuitemiconchange",function(e,n){var i=n.menuitem.metadata().relatedButton,o=t(i);o.parent().hasClass("ui-buttonset")?o.parent().zbutton("changeIcon",{primary:n.icon},i):o.zbutton("changeIcon",{primary:n.icon})}).on("menuitemlabelchange",function(e,n){var i=n.menuitem.metadata().relatedButton,o=t(i);o.parent().hasClass("ui-buttonset")?o.parent().zbutton("changeLabel",n.label,i,!0):o.zbutton("changeLabel",n.label,void 0,!0)}).on("menuitemhovered",function(e,n){t.ZContextMenu.displayMenuComponents(e,n)});var s=this.element.parent().parent().find("a[href='#"+this.element.attr("id")+"']").parent();return o.data("tabId",s.attr("id")),this._initButtonsEvents(this.element,o),o},getGroupAsObj:function(e,n,i){var o=this;e=e.filter(":not([ctype],select,"+o._ctypeElems+")"),t(e).each(function(t,e){o.getButtonAsObj(e,n,i)})},getButtonAsObj:function(e,n){var i=this,o=t(e),s=void 0,u=o.metadata(),a=o.hasClass("ui-buttonset")&&!o.hasClass("ui-button-splitbutton");if(a){var r=o.next(),l=u.innerButtonset&&o.next(":not(.ui-buttonset-sep)").length?!0:!1,h=o.children(":not([ctype],select,"+i._ctypeElems+",.ui-extended-buttonset,.ui-group-text,.ui-buttonset-label,.ui-buttonset-sep,.ui-buttonset-sub-sep,.ui-zcolorchooser,.ui-zcombo)");"bottom"!==this.options.buttonsetLabelPosition||n?"left"===this.options.buttonsetLabelPosition&&(n||u.mainButtonset||h.children().length&&(s=o.zbutton("getAsObject",void 0,!1,i.options.setGroupAsSubmenu),s.mtype="group",i._menuArray.push(s))):h.children().length&&(s=o.zbutton("getAsObject",void 0,!1,i.options.setGroupAsSubmenu),s.mtype="group",i._menuArray.push(s)),t(h).each(function(e,o){o=t(o);var u=void 0,a=!1;if(!o.is("input")&&!o.is("select")&&(n?u=n:o.hasClass("ui-button")||o.hasClass("ui-button-splitbutton")?u=o.parent():o.hasClass("ui-buttonset")&&(u=o.parent(),a=!0),s=u.zbutton("getAsObject",o,!1,i.options.setGroupAsSubmenu),o.hasClass("ui-buttonset-container")||(s.externalAssociation=o,o.data("associatedMenuItem",s.id),i._menuArray.push(s)),a)){if("left"===i.options.buttonsetLabelPosition){var r=o.children(":not([ctype],select,"+i._ctypeElems+",.ui-extended-buttonset,.ui-group-text,.ui-buttonset-label,.ui-buttonset-sep,.ui-buttonset-sub-sep,.ui-zcolorchooser,.ui-zcombo)");r.length&&(s.mtype="group",i._menuArray.push(s))}i.getButtonAsObj(o,u)}});var d=r.children().filter(":not([ctype],select,"+i._ctypeElems+",.ui-zcolorchooser,.ui-zcombo,.ui-buttonset-label,.ui-group-text)"),c=o.children().filter(":not([ctype],select,"+i._ctypeElems+",.ui-zcolorchooser,.ui-buttonset-sep,.ui-icon-dot-separator,.ui-zcombo,.ui-buttonset-label,.ui-group-text)");if(!r.hasClass("ui-zcombo")&&!r.is("select")&&!r.hasClass("ui-buttonset-sep")&&d.length&&c.length){var b=r.metadata();b.buttonset?b.label||i._menuArray.push({mtype:"separator",isGroupSep:l}):i._menuArray.push({mtype:"separator",isGroupSep:l})}}else{if(o.hasClass("ui-ztoolbar-splitmenu"))return;if(!o.hasClass("ui-zcombo")){var p=o.hasClass("ui-button-splitbutton")?o.children("button:first"):o;if(p.is("input"))return;s=p.zbutton("getAsObject"),s.externalAssociation=p,p.data("associatedMenuItem",s.id),i._menuArray.push(s)}}},_initButtonsEvents:function(t,e){t.on("buttoniconchange",function(t,n){n.button.data("association")&&e.zmenu("changeIcon",n.button.data("association"),n.icons.primary)}).on("buttonlabelchange",function(t,n){n.button.data("association")&&e.zmenu("changeLabel",n.button.data("association"),n.label)})},_triggerEvent:function(t,e,n){e||(e=t);var i={target:n};e.data&&(i.eventData=e.data),this._trigger(t,e,i)},destroy:function(){this.element.off("."+this.widgetName),this.element.off("click."+this.widgetName),this.element.off("mouseover."+this.widgetName),this.element.off("mouseout."+this.widgetName)},_getGroupButtons:function(e){var n=t("[gname="+e+"]",this.element);return n},_hideButton:function(e,n){var i="string"==typeof e?t("#"+e,this.element):t(e),o=this._getElementType(i),s=n?"show":"hide";o?t(i)[o]("widget")[s]():t(i)[s]()},_hideButtons:function(t,e){var n=this;t.each(function(t,i){n._hideButton(i,e)})},_hideGroup:function(t,e){var n=this._getGroupButtons(t);this._hideButtons(n,e)},showGroup:function(t){this._hideGroup(t,!0)},hideGroup:function(t){this._hideGroup(t)},hideButton:function(t){this._hideButton(t)},showButton:function(t){this._hideButton(t,!0)},hideButtons:function(e){var n=this;t(e).each(function(t,e){n._hideButton(e)})},showButtons:function(e){var n=this;t(e).each(function(t,e){n._hideButton(e,!0)})},_getElementType:function(t){return(t.is("input")||t.is("select"))&&(t=t.next()),t.is(".ui-zcombo")?"zcombo":t.is(".ui-button")?"button":void 0},_disableButton:function(e,n){var i="string"==typeof e?t("#"+e,this.element):t(e),o=this._getElementType(i);o?i[o](n?"enable":"disable"):i[n?"enable":"disable"]();var s=i.data("menuButton");s&&s.button(n?"enable":"disable");var u={element:i,disabled:!n};i.removeClass("ui-state-hover"),i.trigger("element_state_changed",u)},_disableButtons:function(t,e){var n=this;t.each(function(t,i){n._disableButton(i,e)})},_disableGroup:function(t,e){var n=this._getGroupButtons(t);this._disableButtons(n,e)},enableGroup:function(t){this._disableGroup(t,!0)},disableGroup:function(t){this._disableGroup(t)},disableButton:function(t){this._disableButton(t)},enableButton:function(t){this._disableButton(t,!0)},disableButtons:function(e){var n=this;t(e).each(function(t,e){n._disableButton(e)})},enableButtons:function(e){var n=this;t(e).each(function(t,e){n._disableButton(e,!0)})},checkAndFixToolbar:function(){this._onDocumentResized()},_disable:function(e){var n=this.getToolbarButtons();this._disableButtons(n,e?!0:!1);var i=this.element.find("[ctype]");t.each(i,function(n,i){t(i)[t(i).attr("ctype")](e?"enable":"disable")});var o=this.element.find("select");t.each(o,function(n,i){t(i).data("zcombo")&&t(i).zcombo(e?"enable":"disable")})},disable:function(){this._disable()},enable:function(){this._disable(!0)},getToolbarButtons:function(){var e=t(this.element).find("label.ui-button").not(".ui-buttonset-label").prev("input"),n=t(this.element).find("button.ui-button").not(".ui-buttonset-label");return e.push(n),t(e)},setExcludeElements:function(t,e){t&&(this._ctypeElems=e?t:this._ctypeElems+t)},show:function(){var e=this,n=this.element.parent();n.removeClass("ui-ztab-toolbar-border").animate({height:n.data("tabHeight")},100,void 0,function(){e._triggerEvent(e._EVENTS.ONTOOLBARSHOW,t(e))})},hide:function(){var e=this.element.parent();e.css("height","").data("tabHeight",e.innerHeight()).addClass("ui-ztab-toolbar-border");var n=this;e.animate({height:0},100,void 0,function(){n._triggerEvent(n._EVENTS.ONTOOLBARHIDE,t(n))})}};e=t.extend({},e),t.widget("ui.ztoolbar",e),t.ui.ztoolbar.defaults={buttonClickedEvent:"toolbar_button_clicked",valueChangedEvent:"combo_value_changed"}}(jQuery);
!function(t){t.widget("ui.ztoggle",{widgetEventPrefix:"toggle",options:{size:"regular",iconClass:{on:"",off:""}},_EVENTS:{ONCHANGE:"change"},_create:function(){var e=this;this.element.hide(),this.options=t.extend({},this.element.data().metadata,this.options);var s='<span style="left: 8px;"></span><span style="left: 12px;"></span><span style="left: 16px;"></span>',i=this.options.text?this.options.text.left:t.i18n("ztoggle","on.label"),o=this.options.text?this.options.text.right:t.i18n("ztoggle","off.label");"small"==e.options.size.toLowerCase()&&(i="",o="",s='<span style="left: 5px;"></span><span style="left: 7px;"></span><span style="left: 9px;"></span>'),this.toggle=t("<div>").addClass("ui-ztoggle ui-ztoggle-"+e.options.size.toLowerCase()).on("contextmenu",function(){return!1}),this.toggleBase=t("<div>").addClass("ui-ztoggle-base");var n=""!=this.options.iconClass.on&&""!=this.options.iconClass.off?!0:!1;this.left=t("<div class='ui-ztoggle-left ui-ztoggle-"+e.options.size.toLowerCase()+" "+(n?this.options.iconClass.on:"")+"' >");var h=t("<div class='ui-ztoggle-right ui-ztoggle-"+e.options.size.toLowerCase()+" "+(n?this.options.iconClass.off:"")+"' >");n||(this.left.html(i),h.html(o));var a=t("<div>").addClass("ui-ztoggle-handle ui-ztoggle-"+e.options.size.toLowerCase()).html(s);this.toggleBase.append(this.left,h,a).appendTo(this.toggle),e.element.after(this.toggle);var l=this._getWidth(this.left);rightWidth=this._getWidth(h),handleWidth=this._getWidth(a,!0)+2,this.maxWidth=l>rightWidth?l:rightWidth;var d=this.maxWidth;this.left.css({width:d,padding:0}),h.css({left:this.maxWidth+handleWidth,width:this.maxWidth,padding:0}),a.css({left:this.maxWidth}),this.toggle.css({width:this.maxWidth+handleWidth}),this.toggleBase.css({width:2*this.maxWidth+handleWidth,left:-this.maxWidth}),e.drag=function(s,i){t("body").css("cursor","pointer");var o=s.clientX,n=!1,h=parseInt(e.toggleBase.css("left")),a=(e.maxWidth+handleWidth,o-t(i).offset().left,h);e.left.css("padding-right","3px"),t(window).on("mousemove.onoff",function(t){n=!0,X=t.clientX-o+h,0>=X&&X>=-e.maxWidth?(a=X,e.toggleBase.css("left",X)):0>X?e.toggleBase.css("left",-e.maxWidth):X>-e.maxWidth&&e.toggleBase.css("left",0)}).on("mouseup.onoff",function(){if(t("body").css("cursor",""),e.left.css("padding-right",0),t(this).off("mousemove.onoff mouseup.onoff selectstart.onoff"),n){var s=Math.abs(a);e.maxWidth/2>=s?e._switchOn(!0):e._switchOff(!0)}else e.element[0].checked?e._switchOff(!0):e._switchOn(!0)}).on("selectstart.onoff",function(){return!1})},this._isEnabled=!0,this.toggle.on("mousedown.onoff",function(t){e.drag(t,this)}),this.toggleBase.css("left",this.element[0].checked?0:-this.maxWidth),this.element.is(":disabled")&&this.disable()},_getWidth:function(t,e){var s=t.clone(!0).appendTo("body"),i=e?s.width():s.innerWidth();return s.remove(),i},_triggerEvent:function(t,e){var s={element:this.element,state:this.element[0].checked,fromUI:e};return this._trigger(t,t,s)},switchOn:function(){this._switchOn()},switchOff:function(){this._switchOff()},_switchOn:function(t){if(this._isEnabled){this.left.css("padding-right","3px"),t?this.toggleBase.animate({left:0},200):this.toggleBase.css({left:0});var e=this.element[0].checked?!1:!0;this.element[0].checked=!0,e&&this._triggerEvent(this._EVENTS.ONCHANGE,t)}},_switchOff:function(t){if(this._isEnabled){var e=this;this.left.css("padding-right","3px"),t?this.toggleBase.animate({left:-this.maxWidth},200,function(){e.left.css("padding-right",0)}):(this.toggleBase.css({left:-this.maxWidth}),e.left.css("padding-right",0));var s=this.element[0].checked?!0:!1;this.element[0].checked=!1,s&&this._triggerEvent(this._EVENTS.ONCHANGE,t)}},state:function(){return this.element[0].checked},disable:function(){this.element.attr("disabled","true"),this.toggle.attr("disabled","true").addClass("ui-state-disabled ui-ztoggle-disabled").off("mousedown.onoff"),this._isEnabled=!1},enable:function(){var t=this;this.element.removeAttr("disabled"),this.toggle.removeAttr("disabled").removeClass("ui-state-disabled ui-ztoggle-disabled").off("mousedown.onoff").on("mousedown.onoff",function(e){t.drag(e,this)}),this._isEnabled=!0},destroy:function(){this.toggle.remove(),t(this.element).off("."+this.widgetName),t.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery);
!function(n){n.ZToolbarHandler={init:function(e){this.menutabs=n("#menutabs"),this.selectedShapeTypes=[],this._bindEvents(e),toolbarinited=!0},_bindEvents:function(e){var t=this,a=n(e[0]);if(e.length>1)for(i=1;i<e.length;i++)a=a.add(n(e[i]));n(a).bind("toolbarbuttonclicked",function(n,e){t._fireEvent(n,e,e.target)});var c=n(a).find("select");n.each(c,function(e){n(c[e]).bind("combochange",function(n,e){t._fireEvent(n,e,e.combo)})});var f=n(a).find('input[ctype="zspinner"]');n.each(f,function(e){n(f[e]).bind("spinnerchange",function(n,e){t._fireEvent(n,e,e.spinner)})}),n.each(f,function(e){n(f[e]).bind("spinnerspin",function(n,e){t._fireEvent(n,e,e.spinner)})});var r=n(a).find("ul[ctype='zmenu']");n.each(r,function(e){n(r[e]).bind("menuitemclicked",function(n,e){t._fireEvent(n,e,e.menuitem)})}),"zmenu"==n(a).attr("ctype")&&n(a).bind("menuitemclicked",function(n,e){t._fireEvent(n,e,e.menuitem)})},_fireEvent:function(e,i,t){if(t&&t.length){var a=t.metadata();if(a){var c=a.callable;if(0==c)return!1;var f=a.appData;if(!f)return;var r=f.eventData;if(f&&f.callback){var l=f.arg,d=f.callback.split("."),o=window,u="";if(n(d).each(function(n,e){o=o[e],n==d.length-2&&(u=o)}),isUndefined(r)){if(isUndefined(r)&&isUndefined(l))o.call();else if(!isUndefined(l)){for(var s=l.split(","),v=0;v<s.length;v++)"this"===s[v]&&(s[v]=t),"event"===s[v]&&(s[v]=e);o.apply(u,s),f.afterclick&&f.afterclick()}}else o.call(u,r,t)}}}}}}(jQuery);
function toggleElements(e,t,n,i){isUndefined(n)?$("#"+e[0]).is(":hidden")?(showElements(e),hideElements(t)):(showElements(t),hideElements(e)):n?(showElements(e,i),hideElements(t,i)):(hideElements(e,i),showElements(t,i))}function changebuttonsState(e,t,n){var i;for(i=0;i<n.length;i++)$("#"+e).zbutton(t,"#"+n[i])}function errorDocMenutab(e){e=e?e:"disable",widgetmenu.changeFileMenuState(e),"disable"===e?$("#filetw").css("zIndex",1e3+BASEZINDEX):$("#filetw").css("zIndex","")}function enableFileMenuItems(){for(var e=["exportfileas","printSort"],t=0;t<e.length;t++)$("#"+e[t]).enable("true")}function zbuttonpress(e,t,n){isUndefined(n)&&(n=!$(e).hasClass(t)),n?$(e).addClass(t):$(e).removeClass(t)}function changetooltip(e,t){$(e).attr("title",t)}var zswidgets={init:function(){ZComponentTabs.init(),subMenuBindings.init(),menutabs.initreadonlysheet()}},ZComponentTabs={TAB_LIST:[],CURR_TAB:"homeTab",init:function(){for(var e=$("#menutabs"),t=e.find(".ui-ztab").children("li"),n=0;n<t.length;n++)t[n]&&(this.TAB_LIST[n]=t[n].id);e.bind("tabclick",function(e,t){ZComponentTabs.tabSwitch(e,t)}),e.bind("tabdropdownclick",function(e,t){var n=t.relatedPaneId;setTimeout(function(){ZComponentMenus.dropDownClickFn(e,t),appEvent.trigger("menutabListener",[n])},10)}),e.on("toolbarhide",function(){resetSheetDim(),appEvent.trigger("docpanel.resetDim")}),e.on("toolbarshow",function(){resetSheetDim(),appEvent.trigger("docpanel.resetDim")})},tabSwitch:function(e,t){var n=t.relatedPaneId;switch(this.CURR_TAB=n,"homeTab"==n?$("#copyButtonDiv").show():$("#copyButtonDiv").hide(),setTimeout(function(){appEvent.trigger("menutabListener",[n])},100),n){case"homeTab":break;case"formatTab":TOOLBARS.initFormatToolbar();break;case"insertTab":TOOLBARS.initInsertToolbar();break;case"formulasTab":TOOLBARS.initFormulaToolbar();break;case"mdataTab":TOOLBARS.initDataToolbar();break;case"webformTab":TOOLBARS.initFormToolbar();break;case"viewTab":TOOLBARS.initViewToolbar();break;case"reviewTab":TOOLBARS.initReviewToolbar();break;case"macrosTab":TOOLBARS.initMacrosToolbar();break;case"shareTab":TOOLBARS.initShareToolbar();break;case"tabulardataTab":}},initDefaults:function(){HIDE_PUBLISH_OPTION&&$("#extpub, #orgpub").hide(),featurePermission.setPermission({contextmenu:!0}),ZComponentMenus.init()},getSelectedTab:function(){return $("#menutabs").ztab("getSelectedTab")},setSelectedTab:function(e){var t=this.TAB_LIST.indexOf(e);$("#menutabs").ztab("selectTab",t)},changeBtnState:function(e,t,n){if(t)$("#"+e).zbutton(n);else for(var i=0;i<e.length;i++)$("#"+e[i]).zbutton(n)}},TOOLBARS={initDataToolbar:function(){ProtectedRanges.initLockMenu()},initFormulaToolbar:function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)?(menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"disable",callback:ztoolbar_enable,args:["formulasTab"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"recalculate",action:"enable",callback:button_enable,args:["recalculate"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"namethiscell",action:"enable",callback:button_enable,args:["namethiscell"]})):menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"enable",callback:ztoolbar_enable,args:["formulasTab"]})},initFormatToolbar:function(){var e=ActiveCellInfo._getFormat(currCell),t=$("#formatCellsNumber");e.PERCENT?t.zbutton("check","#PERCENT"):t.zbutton("uncheck","#PERCENT");var t=$("#formatCellsNumber");e.hasSeparator?t.zbutton("check","#comma"):t.zbutton("uncheck","#comma")},initViewToolbar:function(){if(BLOCK_RTL?$("#shtDirectbtn").css("display","none"):$("#shtDirectbtn").css("display","block"),isSheetFreezed||ISFREEZED){var e=function(){$("#freezePanes").zbutton("show","#unfreeze")},t=function(){$("#freezePanes").zbutton("hide","#freeze, #freezetoprow, #freezefirstcol")};menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"show",callback:e}),menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"hide",callback:t})}else{var e=function(){$("#freezePanes").zbutton("hide","#unfreeze")},t=function(){$("#freezePanes").zbutton("show","#freeze, #freezetoprow, #freezefirstcol")};menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"hide",callback:e}),menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"show",callback:t})}if(ProtectedRanges.isSheetLocked(CURRSHEETNAME)?menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"disable",callback:ZComponentTabs.changeBtnState,args:["freezePanes",!0,"disable"]}):menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"enable",callback:ZComponentTabs.changeBtnState,args:["freezePanes",!0,"enable"]}),isGridHidden){var n=function(){$("#hideShowGrid").zbutton("show","#showgrid"),$("#hideShowGrid").zbutton("hide","#hidegrid")};menutabListener.doAction(TOOLBAR.VIEW,{id:"hideShowGrid",action:"show",callback:n});var i=function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)?ZComponentTabs.changeBtnState("hideShowGrid",!0,"disable"):ZComponentTabs.changeBtnState("hideShowGrid",!0,"enable")};menutabListener.doAction(TOOLBAR.VIEW,{id:"hideShowGrid",action:"show",callback:i})}else{var n=function(){$("#hideShowGrid").zbutton("show","#hidegrid"),$("#hideShowGrid").zbutton("hide","#showgrid")};menutabListener.doAction(TOOLBAR.VIEW,{id:"hideShowGrid",action:"show",callback:n});var i=function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)?ZComponentTabs.changeBtnState("hideShowGrid",!0,"disable"):ZComponentTabs.changeBtnState("hideShowGrid",!0,"enable")};menutabListener.doAction(TOOLBAR.VIEW,{id:"hideShowGrid",action:"show",callback:i})}setSheetDirectionLabel()},initReviewToolbar:function(){cdview&&($("#createversion").hide(),$("#viewhistory").hide()),Discussion.allowComments()?Discussion.toggle():hideElements(["addDiscussion","addDiscussionDropDown"],"cellDiscussion",!0)},initMacrosToolbar:function(){$("#macroPanel").is(":visible")&&(RECORDINGMACRO?showElements(["stoprecordmacro"],"macroBuildPort"):hideElements(["stoprecordmacro"],"macroBuildPort"))},initShareToolbar:function(){$("#shareTab").attr("style","display: block !important"),jsSHARE_VIEW?isCoOwnerSharedDoc&&menutabListener.doAction(TOOLBAR.SHARE,{id:"shareDocPort",action:"enable",callback:applyStyle_zbutton,args:["shareDocPort","show","share"]}):menutabListener.doAction(TOOLBAR.SHARE,{id:"shareDocPort",action:"enable",callback:applyStyle_zbutton,args:["shareDocPort","show","share"]}),HIDE_PUBLISH_OPTION&&menutabListener.doAction(TOOLBAR.SHARE,{id:"docPublishPort",action:"disable",callback:ztoolbar_disable,args:["docPublishPort"]}),orgDisplayName||orgName?($("#orgembedBtn").show(),$("#embed").hide()):($("#orgembedBtn").hide(),$("#embed").show())},initInsertToolbar:function(){Filter.enableDisableInsertIcon(Filter.hasFilter&&0!==Filter.getInstance().appliedCols.length?!1:!0),colSelection&&rowSelection?(changebuttonsState("insertRowColumn","disable",["insrowstbtn","insrowsmenu"]),changebuttonsState("insertRowColumn","disable",["inscolstbtn","inscolsmenu"])):colSelection?(changebuttonsState("insertRowColumn","disable",["insrowstbtn","insrowsmenu"]),changebuttonsState("insertRowColumn","enable",["inscolstbtn","inscolsmenu"])):rowSelection&&(changebuttonsState("insertRowColumn","enable",["insrowstbtn","insrowsmenu"]),changebuttonsState("insertRowColumn","disable",["inscolstbtn","inscolsmenu"]))},initFormToolbar:function(){WebForm.updateFormMenuTab()}},ZComponentMenus={init:function(){$("#rowOptMenus").bind("menubeforeshow",function(e,t){widgetmenu.initRowMenu(e,t)}),$("#colOptMenus").bind("menubeforeshow",function(e,t){widgetmenu.initColMenu(e,t)}),$("#protectrangemenu").bind("menubeforeshow",function(){ProtectedRanges.initLockMenu()}),$("#insertcolsmenu").bind("menubeforeshow",function(e,t){widgetmenu.initInsertColMenu(e,t)}),$("#insertrowsmenu").bind("menubeforeshow",function(e,t){widgetmenu.initInsertRowMenu(e,t)}),$("#filterbySub").bind("menubeforeshow",function(){Filter.toolBarHandler()}),$("#publishmenu").bind("menubeforeshow",function(){widgetmenu.initPublishMenu()}),$("#discussionmenu").bind("menubeforeshow",function(){Discussion.toggle()}),$("#conditionalformatmenu").bind("menubeforeshow",function(){colorScalesBag.colorScaleThemeColor()}),$("#colorscaledialogtheme").bind("menubeforeshow",function(){colorScalesBag.colorScaleThemeColor()}),$("#createruledialogtheme").bind("menubeforeshow",function(){formatWithConditions.selectThemeInMenu()}),$("#createruledialogtheme").bind("menubeforehide",function(){formatWithConditions.storeCustomProperty()}),$("#iconsetmenuDialog").bind("menubeforeshow",function(){var e=$("#iconsetsPreview").attr("setName"),t=$("#iconsetmenuDialog").find(".isBoxIcons");if($(t).css("background-color",""),"custom"!=e)for(var n=0,i=t.length;i>n;n++)$(t[n]).attr("type")==e&&$(t[n]).css("background-color","#d6d3d3")})},dropDownClickFn:function(e,t){var n=t.relatedPaneId;switch(n){case"homeTab":TABMENUS.initHomeMenu();break;case"formatTab":TABMENUS.initFormatMenu(),widgetmenu.initcurrencymenu();break;case"insertTab":case"formulasTab":TABMENUS.initFormulaMenu();break;case"mdataTab":TABMENUS.initDataMenu();break;case"webformTab":TABMENUS.initWebFormMenu();break;case"viewTab":TABMENUS.initViewMenu();break;case"reviewTab":TABMENUS.initReviewMenu();break;case"macrosTab":TABMENUS.initMacroMenu();break;case"shareTab":TABMENUS.initShareMenu();break;case"tabulardataTab":}}},TABMENUS={initHomeMenu:function(){$("#menuitem_borderBtn").children("span:first").children("span:first").attr("class",$("#borderBtn").children("span:first").attr("class")),changeAlignIcon(),toggleCellInsertOption()},initFormatMenu:function(){$("#menuitem_currency").children("span:first").text($("#currency").children("span:first").text()),$("#menuitem_currency").children("span:first").next().text(jsMsg["FormatCells.PopularCurrencies"])},initFormulaMenu:function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)?(menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"disable",callback:ztoolbar_disable,args:["formulasTab"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"recalculate",action:"enable",callback:ztoolbar_enable,args:["recalculate"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"namethiscell",action:"enable",callback:ztoolbar_enable,args:["namethiscell"]})):menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"enable",callback:ztoolbar_enable,args:["formulasTab"]})},initDataMenu:function(){os_mac&&$("#menuitem_filter .ui-zmenu-shortcut").text("Cmd+Shift+F"),ProtectedRanges.initLockMenu()},initViewMenu:function(){isSheetFreezed||ISFREEZED?($("#freezePanes").zbutton("show","#unfreeze"),$("#freezePanes").zbutton("hide","#freeze, #freezetoprow, #freezefirstcol")):($("#freezePanes").zbutton("hide","#unfreeze"),$("#freezePanes").zbutton("show","#freeze, #freezetoprow, #freezefirstcol")),ProtectedRanges.isSheetLocked(CURRSHEETNAME)?ZComponentTabs.changeBtnState("freezePanes",!0,"disable"):ZComponentTabs.changeBtnState("freezePanes",!0,"enable"),isGridHidden?($("#hideShowGrid").zbutton("show","#showgrid"),$("#hideShowGrid").zbutton("hide","#hidegrid"),ProtectedRanges.isSheetLocked(CURRSHEETNAME)?ZComponentTabs.changeBtnState("hideShowGrid",!0,"disable"):ZComponentTabs.changeBtnState("hideShowGrid",!0,"enable")):($("#hideShowGrid").zbutton("show","#hidegrid"),$("#hideShowGrid").zbutton("hide","#showgrid"),ProtectedRanges.isSheetLocked(CURRSHEETNAME)?ZComponentTabs.changeBtnState("hideShowGrid",!0,"disable"):ZComponentTabs.changeBtnState("hideShowGrid",!0,"enable")),BLOCK_RTL?$("#shtDirectbtn").parent().zbutton("hide","#shtDirectbtn"):($("#shtDirectbtn").parent().zbutton("show","#shtDirectbtn"),isRTL?($("#rtls").addClass("ui-state-active"),$("#ltrs").removeClass("ui-state-active")):($("#ltrs").addClass("ui-state-active"),$("#rtls").removeClass("ui-state-active"))),setSheetDirectionLabel()},initReviewMenu:function(){cdview&&hideElements(["createversion","viewhistory"],"versionPort",!0),Discussion.on?Discussion.toggle():hideElements(["addDiscussion","addDiscussionDropDown"],"cellDiscussion",!0)},initMacroMenu:function(){RECORDINGMACRO?showElements(["stoprecordmacro"],"macroBuildPort"):hideElements(["stoprecordmacro"],"macroBuildPort")},initShareMenu:function(){jsSHARE_VIEW?($("#menuitem_share").hide(),isCoOwnerSharedDoc&&$("#menuitem_share").show()):($("#menuitem_share").show(),jsPUBLIC_VIEW&&$("#menuitem_share").hide()),HIDE_PUBLISH_OPTION&&$("#shareTabmenu").zmenu("disableMenuItems",["menuitem_publishSheet","menuitem_orgembedBtn","menuitem_embed"]),orgDisplayName||orgName?($("#menuitem_orgembedBtn").show(),$("#menuitem_embed").hide()):($("#menuitem_orgembedBtn").hide(),$("#menuitem_embed").show())},initWebFormMenu:function(){WebForm.updateFormMenuTab()}},menutabs={isToolbarAltered:!1,initreadonlysheet:function(){jsSHARE_VIEW&&READ_WRITE&&TOOLBARS.initShareToolbar()},sheetbasedtoggle:function(){menutabs.isToolbarAltered=!READ_WRITE,READ_WRITE?($("#menutabs").ztab("selectTab",9),showElements(["formattw","inserttw","formulastw","datatw","viewtw","reviewtw","macrostw","pivottabletw"]),$("#savefile").enable("true"),$("#readonlyico").hide()):($("#menutabs").ztab("selectTab",9),hideElements(["formattw","inserttw","formulastw","datatw","viewtw","reviewtw","macrostw","pivottabletw","pivottw"]),$("#savefile").disable("true"),$("#readonlyico").show())},protectionBasedToggle:function(e){if(e=isUndefined(e)?ProtectedRanges.isSheetLocked(CURRSHEETNAME):e,menutabs.isToolbarAltered=e,e){menutabListener.doAction(TOOLBAR.HOME,{id:"homeTab",action:"disable",callback:ztoolbar_disable,args:["homeTab"]}),menutabListener.doAction(TOOLBAR.HOME,{id:"homeTab",action:"enable",callback:ztoolbar_enableButtons,args:["homeTab","enableButtons",["copyButton","open"]]}),toggleUNDO(),toggleREDO(),$("#formattw").disable("true"),$("#inserttw").disable("true"),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"disable",callback:ztoolbar_disable,args:["formulasTab"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"recalculate",action:"enable",callback:button_enable,args:["recalculate"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"namethiscell",action:"enable",callback:button_enable,args:["namethiscell"]}),menutabListener.doAction(TOOLBAR.DATA,{id:"mdataTab",action:"disable",callback:ztoolbar_disable,args:["mdataTab"]}),$("#pivottw").disable(),$("#protectrangemenu").bind("menubeforeshow",function(){$("#rangeProtect").disable()});var t=ZComponentTabs.CURR_TAB;("mdataTab"===t||"insertTab"===t||"formatTab"===t)&&menutabListener.doAction(t,{id:"currTab",action:"disable",callback:ztoolbar_disable,args:[t]}),ProtectedRanges.showMenuEntry()?menutabListener.doAction(TOOLBAR.DATA,{id:"protectCell",action:"enable",callback:button_enable,args:["protectCell"]}):menutabListener.doAction(TOOLBAR.DATA,{id:"protectCell",action:"disable",callback:button_disable,args:["protectCell"]}),menutabListener.doAction(TOOLBAR.DATA,{id:"pivotbuilder",action:"enable",callback:button_enable,args:["pivotbuilder"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePanes",action:"disable",callback:zbutton_action,args:["freezePanes","disable"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"hidegrid",action:"disable",callback:zbutton_action,args:["hideShowGrid","disable"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"showgrid",action:"disable",callback:zbutton_action,args:["hideShowGrid","disable"]}),menutabListener.doAction(TOOLBAR.REVIEW,{id:"addcomment",action:"disable",callback:button_disable,args:["addcomment"]}),menutabListener.doAction(TOOLBAR.REVIEW,{id:"editcomment",action:"disable",callback:button_disable,args:["editcomment"]}),menutabListener.doAction(TOOLBAR.REVIEW,{id:"removecomment",action:"disable",callback:button_disable,args:["removecomment"]})}else $("#homeTab").ztoolbar("enable"),toggleUNDO(),toggleREDO(),$("#formattw").enable("true"),$("#inserttw").enable("true"),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"enable",callback:ztoolbar_enable,args:["formulasTab"]}),menutabListener.doAction(TOOLBAR.DATA,{id:"mdataTab",action:"enable",callback:ztoolbar_enable,args:["mdataTab"]}),$("#pivottw").enable(),$("#protectrangemenu").bind("menubeforeshow",function(){$("#rangeProtect").enable()}),ProtectedRanges.showMenuEntry()?menutabListener.doAction(TOOLBAR.DATA,{id:"protectCell",action:"enable",callback:button_enable,args:["protectCell"]}):menutabListener.doAction(TOOLBAR.DATA,{id:"protectCell",action:"disable",callback:button_disable,args:["protectCell"]}),menutabListener.doAction(TOOLBAR.INSERT,{id:"insertTab",action:"enable",callback:ztoolbar_enable,args:["insertTab"]}),menutabListener.doAction(TOOLBAR.FORMAT,{id:"formatTab",action:"enable",callback:ztoolbar_enable,args:["formatTab"]}),menutabListener.doAction(TOOLBAR.FORMULAS,{id:"formulasTab",action:"enable",callback:ztoolbar_enable,args:["formulasTab"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"freezePane",action:"enable",callback:zbutton_action,args:["freezePane","enable"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"unfreezePane",action:"enable",callback:zbutton_action,args:["unfreezePane","enable"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"hidegrid",action:"enable",callback:zbutton_action,args:["hideShowGrid","enable"]}),menutabListener.doAction(TOOLBAR.VIEW,{id:"showgrid",action:"enable",callback:zbutton_action,args:["hideShowGrid","enable"]}),$("#addcomment, #editcomment, #removecomment").enable()},toggleToolbar:function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)?menutabs.protectionBasedToggle():isSheetBasedShare&&!READ_WRITE?menutabs.sheetbasedtoggle():menutabs.isToolbarAltered&&(0!==ProtectedRanges.getObject().getSheets().list.length?menutabs.protectionBasedToggle():isSheetBasedShare&&menutabs.sheetbasedtoggle())}},widgetmenu={initFcomponents:function(){var e={contextPath:ctxpath+"fcomponents/",service:"ST",csrfParamName:"zsreqcsr",csrfCookieName:"zscookcsr"};-1!=zuid&&FComponents.init(e),$(".ztb-topband").length&&(this.initTopBar(),this.initfileNameField())},initInsertColMenu:function(e,t){var n=t.menu,i=n.children("li"),a=1,o=!1;if(isCellRange()){var s=getCellRange();a=s.endCol-s.startCol+1,o=!0}n.zmenu("hideAllMenuItems"),ClipRange.getClipObject().insertCopyCols?($(i[2]).show(),$(i[3]).show()):ClipRange.getClipObject().insertCutCols?($(i[4]).show(),$(i[5]).show()):(o&&a>1?(a=a.toString(),$(i[0]).children("span.ui-zmenu-text").html(replaceParams(jsMsg.NoofColumnsBefore,new Array(a))),$(i[1]).children("span.ui-zmenu-text").html(replaceParams(jsMsg.NoofColumnsAfter,new Array(a)))):($(i[0]).children("span.ui-zmenu-text").html(jsMsg.ColumnBefore),$(i[1]).children("span.ui-zmenu-text").html(jsMsg.ColumnAfter)),$(i[0]).show(),$(i[1]).show())},initInsertRowMenu:function(e,t){var n=t.menu,i=n.children("li"),a=1,o=!1;if(isCellRange()){var s=getCellRange();a=s.endRow-s.startRow+1,a-=Row.getHiddenRowCount(s.startRow,s.endRow),o=!0}n.zmenu("hideAllMenuItems"),ClipRange.getClipObject().insertCopyRows?($(i[2]).show(),$(i[3]).show()):ClipRange.getClipObject().insertCutRows?($(i[4]).show(),$(i[5]).show()):(o&&a>1?(a=a.toString(),$(i[0]).children("span.ui-zmenu-text").html(replaceParams(jsMsg.NoofRowsAbove,new Array(a))),$(i[1]).children("span.ui-zmenu-text").html(replaceParams(jsMsg.NoofRowsBelow,new Array(a)))):($(i[0]).children("span.ui-zmenu-text").html(jsMsg.RowAbove),$(i[1]).children("span.ui-zmenu-text").html(jsMsg.RowBelow)),$(i[0]).show(),$(i[1]).show())},initRowMenu:function(e,t){var n=!1,i=0;if(isCellRange()){var a=getCellRange();i=a.endRow-a.startRow+1,i-=Row.getHiddenRowCount(a.startRow,a.endRow),n=!0}var o=t.menu;!isColSelected()&&i>1&&(isRowSelected()||n)?($("#rinsertOpt").enable(),$("#rdeleteOpt").enable(),i=i.toString(),o.zmenu("changeLabel","rinsertOpt",replaceParams(jsMsg["HomeTab.Row.InsertNoofRows"],new Array(i))),o.zmenu("changeLabel","rdeleteOpt",replaceParams(jsMsg["HomeTab.Row.DeleteNoofRows"],new Array(i)))):(o.zmenu("changeLabel","rinsertOpt",jsMsg["HomeTab.Row.Insert"]),o.zmenu("changeLabel","rdeleteOpt",jsMsg["HomeTab.Row.Delete"]),isColSelected()?($("#rinsertOpt").disable(),$("#rdeleteOpt").disable()):($("#rinsertOpt").enable(),$("#rdeleteOpt").enable()))},initColMenu:function(e,t){var n=!1,i=0;if(isCellRange()){var a=getCellRange();i=a.endCol-a.startCol+1,n=!0}var o=t.menu;!isRowSelected()&&i>1&&(isColSelected()||n)?($("#cinsertOpt").enable(),$("#cdeleteOpt").enable(),i=i.toString(),o.zmenu("changeLabel","cinsertOpt",replaceParams(jsMsg["HomeTab.Column.InsertNoofCols"],new Array(i))),o.zmenu("changeLabel","cdeleteOpt",replaceParams(jsMsg["HomeTab.Column.DeleteNoofCols"],new Array(i)))):(o.zmenu("changeLabel","cinsertOpt",jsMsg["HomeTab.Column.Insert"]),o.zmenu("changeLabel","cdeleteOpt",jsMsg["HomeTab.Column.Delete"]),isRowSelected()?($("#cinsertOpt").disable(),$("#cdeleteOpt").disable()):($("#cinsertOpt").enable(),$("#cdeleteOpt").enable()))},initcurrencymenu:function(){for(var e=$("#currencymenu").children(),t=0;t<e.length;t++)$(e[t]).children().first().children().css({height:"16px",width:"16px"});0!=$("#menuitem_currency").length&&($("#menuitem_currency").children(".ui-zmenu-text").text(jsMsg["FormatCells.PopularCurrencies"]),$("#menuitem_currency").children().first().children().first().css({width:"16px",height:"16px"}))},initmacroswidgets:function(e){if(!isUndefined(e)){var t=$("#macrosTab :input");t.each(function(){"disable"===e?("macrohelp"!==$(this).attr("id")&&"stoprecordmacro"!==$(this).attr("id")&&$(this).button("disable"),$("#macroBuildPort").zbutton("show","#stoprecordmacro")):"enable"===e&&("macrohelp"!==$(this).attr("id")&&"stoprecordmacro"!==$(this).attr("id")&&$(this).button("enable"),$("#macroBuildPort").zbutton("hide","#stoprecordmacro"))})}},insertdefault:function(e){"rows"==e?ClipRange.getClipObject().insertCopyRows?ClipObject.showLocaleInfoDialog("INSERT_COPIED_ROWS","ROW","above"):ClipRange.getClipObject().insertCutRows?ClipObject.showLocaleInfoDialog("INSERT_CUT_ROWS","ROW","above"):Range.executeShiftOperation("INSERT","ROW","above"):"cols"==e&&(ClipRange.getClipObject().insertCopyCols?ClipObject.showLocaleInfoDialog("insertCopyCols"):ClipRange.getClipObject().insertCutCols?ClipObject.showLocaleInfoDialog("insertCutCols"):insertCol("before"))},initFileMenu:function(){var e=$("#filemenu");if(isErrorDoc&&!isNewDoc)this.changeFileMenuState("disable");else{if(appEvent.trigger("menutabListener",["FileTab"]),e.zmenu("enable"),allowExport&&("PUBLIC_VIEW"!=getViewType()||allowExportPublic&&allowExportOrg))if(allowPrint){var t=["saveasfile","saveastemplate","exportfileas","printSort","newversion","versionhistory"];isNewDoc&&0==$("#save_message_display").text().trim().length&&e.zmenu("disableMenuItems",t)}else e.zmenu("hideMenuItems",["printSort"]);else REMOTE.ISRMVIEW?e.zmenu("hideMenuItems",["printSort","saveToMyAcnt","fSaveSep","fExpSep","exportfileas"]):e.zmenu("disableMenuItems",["printSort","saveToMyAcnt","exportfileas"]);maskOpenRec&&e.zmenu("disableMenuItems",["openRectfile"])}},initfileNameField:function(){setTimeout(function(){if($("#fileName").length){var e=!0,t=!0;(jsSHARE_VIEW&&!isCoOwnerSharedDoc||TEMPLATE_FLAG.toBoolean())&&(e=!1),jsPUBLIC_VIEW&&(t=!1,e=!1,hasRenamePermission=!1),$("#fileName").zfilefield({displayLength:450,rename:hasRenamePermission,fileId:RESOURCE_ID,fileName:escapeSpecialCharacters(DOCUMENT_NAME),saveToFolder:e,canFavourite:t,submit:function(e,t){updateDocName(t.fileHTMLName)},blur:function(){focusCell(currRow,currCol,void 0,!0)},success:function(){var e=new AjaxRequest,t=new RequestParameters(ActionConstants.RENAME_DOCUMENT);t.setParameters(encodeURIComponent(DOCUMENT_NAME)),e.init("POST",t.getURL(),!0,t.getParametersAsString()),e.sendRequest()}})}jsPUBLIC_VIEW&&$("#pubdoc").show()},500)},initTopBar:function(){REMOTE.ISRMVIEW||cdview||(userInfoOpt={},-1!=zuid&&(userInfoOpt={name:LOGIN_FULL_NAME,emailAddress:LOGIN_EMAILID,photo:PHOTO_SERVER_URL+"/file?fs=thumb&ID="+zuid,userId:zuid,signOutURL:function(){""!=COLLAB_ID&&"null"!=COLLAB_ID&&Collaboration.quit(COLLAB_ID),document.location.href=ctxpath+"logout.do"}}),ztopbar({product:"sheet",homePageLink:"#home",userInfo:userInfoOpt,myAccountLink:IAM_SERVER_URL,signInPageLink:this.getSignInUrl(),signUpPageLink:this.getSignUpUrl(),helpMenu:{helpLinks:{helpLink:REBRAND_URLS.SettingMenuHelpUrl,others:[{id:"appearance",label:jsMsg.WhatsNew,action:"URL:"+jsMsg.NewFeaturesURL,target:"_blank"},{id:"appearance1",label:jsMsg.KeyboardShortcuts,action:"URL:"+jsMsg.KeyboardShortcutsURL,target:"_blank"}]},blogLink:jsMsg.BlogsURL,forumLink:jsMsg.ForumsURL,feedback:function(){Feedback.showdialog()}}}),ISREBRANDED&&($("#ztb-switch-menu, #ztb-helpLink, #appearance, #ztb-helpsep1, #ztb-about, #ztb-blogs, #ztb-helpsep2, #ztb-forums, #ztb-zoho-uid-info").hide(),$("#ztb-placeholder-container").css("margin-left","5px")));var e=$("#save_message_display").parent().parent();$(e).css("display","block"),RTLlang?($("body").addClass("ztb-rtl"),$("#ztb-help-menu").css("direction","rtl"),$(e).css("float","left"),$("#docstausicons").css("float","right"),$("#save_message_display").css("direction","rtl")):$(e).css("float","right")},getSignInUrl:function(){return jsMsg.ZohoHomeURL.indexOf("skydesk")>0?jsMsg.ZohoHomeURL+"login.html":void 0},getSignUpUrl:function(){return jsMsg.ZohoHomeURL.indexOf("skydesk")>0?jsMsg.ZohoHomeURL+"register.html":void 0},initPublishMenu:function(){var e=orgDisplayName?orgDisplayName:orgName,t=$("#publishmenu");if(t.zmenu("hideAllMenuItems"),e){if(t.zmenu("showMenuItems",["publicMenuSeparator","publishRangeCommon","showpubrange"]),isDocumentPublic?t.zmenu("showMenuItems",["viewpubURL","removepublic"]):isDocumentSemiPublic&&!isDocumentPublic&&t.zmenu("showMenuItems",["makePublicinExtn","orgpubmenusep","viewpubURLinOrg","removepublic"]),!isDocumentSemiPublic&&!isDocumentPublic){t.zmenu("showMenuItems",["makePublicBoth"]);var n=($("#makePublicmenu"),replaceParams(jsMsg["Share.Public.MakePublicWithin"],new Array(e)));$($("#orgpub1").children("span")[1]).text(n),$("#makePublicmenu").css("width","auto"),$("#makePublicmenu").children("li").css("width","auto")}}else t.zmenu("showMenuItems",["publicMenuSeparator","publishRange","showpubrange"]),isDocumentPublic?t.zmenu("showMenuItems",["viewpubURL","removepublic"]):t.zmenu("showMenuItems",["makePublicExtn"])},changeMenuTabsState:function(e){e=e?e:"disable";var t=ZComponentTabs.TAB_LIST;if("disable"==e)for(i=0;i<t.length;i++)$("#"+t[i]).disable();else for(i=0;i<t.length;i++)$("#"+t[i]).enable();ZComponentTabs.CURR_TAB=ZComponentTabs.CURR_TAB?ZComponentTabs.CURR_TAB:"homeTab",$("#"+ZComponentTabs.CURR_TAB).ztoolbar(e)},changeFileMenuState:function(e){e=e?e:"disable";var t=["saveasfile","saveastemplate","exportfileas","print","newversion","showDocumentSetting","renamefile"];"disable"==e?menutabListener.doAction(TOOLBAR.FILE,{id:"filemenu",action:"disable",callback:zmenu,args:["filemenu","disableMenuItems",t]}):menutabListener.doAction(TOOLBAR.FILE,{id:"filemenu",action:"enable",callback:zmenu,args:["filemenu","enableMenuItems",t]})}},contextMenu={initContextMenu:function(){var e=$("#rmenu"),t=$("#sheettabrmenu"),n=$("#sheetpastemenu");e.bind("menuitemclicked",function(e,t){contextMenu._bindrclickevent(e,t)}),e.bind("menubeforeshow",function(e,t){return featurePermission.setPermission({allowToScroll:!1}),zcontextmenu.initGridRightClickMenu(t.target.attr("id"))}),t.bind("menuitemclicked",function(e,t){contextMenu._bindrclickevent(e,t)}),t.bind("menubeforeshow",function(e,t){return zcontextmenu.initSheetTabRightClickMenu(e,t)}),n.bind("menuitemclicked",function(e,t){contextMenu._bindrclickevent(e,t)}),n.bind("menubeforeshow",function(e,t){return zcontextmenu.initSheetTabRightClickPasteMenu(e,t)})},_bindrclickevent:function(e,t){var n=$(t.menuitem).metadata().appData;if(n&&n.callback){var i=n.arg,a=n.eventData,o=t.menuitem,s=n.callback.split("."),r=window,l="";if($(s).each(function(e,t){r=r[t],e==s.length-2&&(l=r)}),isUndefined(a)){if(isUndefined(a)&&isUndefined(i))r.call();else if(!isUndefined(i)){for(var c=i.split(","),b=0;b<c.length;b++)"this"===c[b]&&(c[b]=o),"event"===c[b]&&(c[b]=e);r.apply(l,c)}}else r.call(l,a,o)}}},subMenuBindings={init:function(){var e=$("#popupmenu").find("ul[ctype='zmenu']");$.each(e,function(t){$(e[t]).bind("menubeforeshow",function(e,t){var n=t.menu[0].id,i=ActiveCellInfo._getFormat(currCell);switch(n){case"halignmenu":subMenuBindings.halignMenu(n,i);break;case"valignmenu":subMenuBindings.valignMenu(n,i);break;case"showHideUsers":subMenuBindings.collaborators(n)}})})},halignMenu:function(e,t){var n=$("#"+e);" tac"==t.hAlign||" fac"==t.hAlign?n.zmenu("check","center",!0):" tar"==t.hAlign||" far"==t.hAlign?n.zmenu("check","right",!0):isRTL?n.zmenu("check","right",!1):n.zmenu("check","left",!0)},valignMenu:function(e,t){var n=$("#"+e);" vam"==t.vAlign?n.zmenu("check","vcenter",!0):" vab"==t.vAlign?n.zmenu("check","vbottom",!0):n.zmenu("check","vtop",!0)},collaborators:function(){appEvent.trigger("collabpanel.hidePresence")}};
function initUIComponents(){return jsVERSION_VIEW?void initVersionToolbar():(RTLlang&&($.ui.directionIsRTL=!0),void $.ui.utils.initDeferredComponents({ztab:"#menutabs"},100,function(){$("#toolbarContainer").show(),resetEditorDim(),$.ui.utils.initDeferredComponents({ztoolbar:"#homeTab,#rhomeTab,#pivotTab",zbutton:"#sheetOptions"},500,function(){$("#sheetOptions").css("visibility","visible"),$("#toolbarContainer").is(":visible")&&($("#menutabs1").remove(),$("#rmvstyle").remove(),$("#mainOuterDiv").css({height:"auto",width:clientDim.width}),$("#menutabs").ztab("selectTab",$("#filetw").length?1:0),UIComponents.deferInitialize(),appEvent.trigger("toolbar.home.load"),$("#docstausicons").show(),customiseUIBehavior(),appEvent.trigger("doMenuItemBinding"),resetEditorDim())})}))}function initVersionToolbar(){$.ui.utils.initComponents($("#versionview")),$("#versionExport").show(),$("#versionMacroMenu").show()}function initializeToolbar(e,t){$.ui.utils.initDeferredComponents({ztoolbar:e},1),t&&t.removeAttribute("onmouseover"),setTimeout(function(){setDefaultStatus(e)},100)}function setDefaultStatus(e){switch(e){case"#shareTab":CollabPanel.getCollaboratorsCount()>0?menutabListener.doAction(TOOLBAR.SHARE,{id:"chatwithusersPanel",action:"enable",callback:button_enable,args:["chatwithusersPanel"]}):menutabListener.doAction(TOOLBAR.SHARE,{id:"chatwithusersPanel",action:"disable",callback:button_disable,args:["chatwithusersPanel"]}),IS_DOCUMENT_SHARED?menutabListener.doAction(TOOLBAR.SHARE,{id:"notifysharedusers",action:"enable",callback:button_enable,args:["notifysharedusers"]}):menutabListener.doAction(TOOLBAR.SHARE,{id:"notifysharedusers",action:"disable",callback:button_disable,args:["notifysharedusers"]});break;case"#formulasTab":break;case"#reviewTab":Discussion.allowComments()?Discussion.toggle():hideElements(["addDiscussion","addDiscussionDropDown"],"cellDiscussion",!0);break;case"#webformTab":$("#formpublishmenu").on("menubeforeshow",function(){WebForm.updateFormPublishMenu()})}}function customiseUIBehavior(){appEvent.on("doMenuItemBinding",function(){$("#filemenu").bind("menubeforeshow",function(){widgetmenu.initFileMenu()})}),$("#bgcolor").children("span:first").css({"border-bottom":"3px solid #FFFF00"}),$("#fontcolor").children("span:first").css({"border-bottom":"3px solid 	#FF0000"}),jsSHARE_VIEW&&!isCoOwnerSharedDoc&&$("#share").hide(),zswidgets.init(),"true"===TEMPLATE_FLAG?($("#sharetw").hide(),$("#templateicon").show()):($("#sharetw").show(),$("#templateicon").hide());var e=["openfile","open","share"];$.each(e,function(t){$("#"+e[t]).bind("click",function(){sheetdialog.close()})}),$(".ui-zadvcolorpalette").parent().css("zIndex",3e3+BASEZINDEX),$(".ui-zadvcolorpalette").parent().bind("dialogfocus",function(){if(sheetdialog.isDialogOpen()&&"cformatdialog"==sheetdialog.getDialogName()){var e=$("#conditionalDialogContent").parent().parent().css("z-index"),t=parseInt(e)+1;$(".ui-zadvcolorpalette").parent().css("zIndex",t)}else if(sheetdialog.isDialogOpen()&&"colorscalesdialog"==sheetdialog.getDialogName()){var e=$(".clrScl").parent().parent().css("z-index"),t=parseInt(e)+1;$(".ui-zadvcolorpalette").parent().css("zIndex",t)}else $(".ui-zadvcolorpalette").parent().css("zIndex",3e3+BASEZINDEX);$("#menutabs :input").css("zIndex",999+BASEZINDEX)}),jsPUBLIC_VIEW||jsSHARE_VIEW||($("#orgpub").attr("title",replaceParams(jsMsg["Share.Public.withInOrg"],new Array(orgDisplayName))),isDocumentSemiPublic&&!isDocumentPublic&&$("#orgpub").show(),isDocumentPublic&&$("#extpub").show()),1==RESOURCE_LOCKED?"READ"==DOCUMENT_MAX_PERMISSION?$("#readonlyico").show():$("#readonlyico").hide():jsTRASH_VIEW||!READ_WRITE&&!ProtectedRanges.isSheetLocked(CURRSHEETNAME)||jsSHARE_VIEW&&!ALLOW_TO_WRITE?$("#readonlyico").show():$("#readonlyico").hide(),allowExport&&("PUBLIC_VIEW"!=getViewType()||allowExportPublic&&allowExportOrg)||($("#savecopy").disable(),$("#toolbar_print").hide(),$("#rosavecopy").disable(),$("#rotoolbar_print").hide()),allowPrint||($("#toolbar_print").hide(),$("#rotoolbar_print").hide()),decideMergeIcon(),changeAlignIcon(),toggleCellInsertOption(),setSheetDirectionLabel()}function applyStyle_zbutton(e,t,o){$("#"+e).zbutton(t,"#"+o)}function applyStyle_addClass(e,t){$("#"+e).addClass(t)}function applyStyle_removeClass(e,t){$("#"+e).removeClass(t)}function applyStyle_zCombo(e,t){$("#"+e).zcombo(t)}function applyStyle_zCombo_with_fn(e,t,o){$("#"+e).zcombo(t,o)}function button_enable(e){$("#"+e).enable()}function button_disable(e){$("#"+e).disable()}function zmenu(e,t,o){$("#"+e).zmenu(t,o)}function ztoolbar_enable(e){$("#"+e).ztoolbar("enable")}function ztoolbar_disable(e){$("#"+e).ztoolbar("disable")}function ztoolbar_enableButtons(e,t,o){$("#"+e).ztoolbar(t,o)}function zbutton_hide(e){$("#"+e).zbutton("hide")}function zbutton_show_mouseout(e){$("#"+e).zbutton("show").mouseout()}function zbutton_action(e,t){$("#"+e).zbutton(t)}function zbutton_show(e){$("#"+e).zbutton("show")}var UIComponents={isDeferInitializationDone:!1,listeners:[],deferInitialize:function(){UIComponents.triggerListeners(),UIComponents.isDeferInitializationDone=!0,this.setToolbarStatus()},executeOnDeferredInit:function(e){this.listeners.push(e),this.isDeferInitializationDone&&this.triggerListeners()},triggerListeners:function(){UIComponents.listeners.forEach(function(e){e()}),UIComponents.listeners=[]},setToolbarStatus:function(){documentBakeStatus.isBaked()&&this.isDeferInitializationDone&&featurePermission.setPermission({hidetoolbar:!1})}};$(document).ready(function(){$.metadata.setType("attr","data");var e={ok:jsMsg.OK,cancel:jsMsg.Cancel,close:jsMsg.Close};COMPONENTS_I18N_VALUES.common=e,$.i18n(COMPONENTS_I18N_VALUES),function(e){e.fcomponents=e.extend(!0,e.fcomponents,{getCurrentDocStatus:function(){return 1}})}(jQuery),$("#mainOuterDiv").css("width",clientDim.width)}),$("#menutabs").bind("tabbeforedelete",function(e,t){return 2==t.index?(e.preventDefault(),!1):void 0}),appEvent.on("book.onaftersheetswitch",function(){menutabs.toggleToolbar()}),appEvent.on("toolbar.home.load",function(){"undefined"!=typeof NiceURL&&(NiceURL.isToolbarLoaded=!0,NiceURL.process()),menutabs.toggleToolbar(),appEvent.trigger("menutabListener",["homeTab"])});
var menutabListener=function(a){var n={},r={},e=function(n,r){var e=(r.id,r.action,r.callback),i=a("#"+n).hasClass("ui-ztoolbar-panel"),c=r.args;i?o(e,c):t(n,r)},i=function(a,r){for(var e=n[a],i=e.length;i--;)e[i]===r&&e.splice(i,1)},t=function(a,e){n[a]||(n[a]=[]),n[a].push(e),r[a]=!0},o=function(a,n){var r=a;n?r.apply("",n):r.call()},c=function(a){if(r[a])for(var e=n[a],t=e.length-1;t>=0;t--){var c=e[t],b=c.callback,l=c.args;o(b,l),i(a,c)}};return appEvent.on("menutabListener",function(a){c(a)}),{doAction:e}}(jQuery),TOOLBAR={HOME:"homeTab",FORMAT:"formatTab",INSERT:"insertTab",FORMULAS:"formulasTab",DATA:"mdataTab",VIEW:"viewTab",REVIEW:"reviewTab",MACROS:"macrosTab",SHARE:"shareTab",VERSIONVIEW:"versionview",FILE:"FileTab"};
var Annot=function(e){var t,n,o,a,l=[],r=!1,s=void 0,c=!1,f=!1,d=!1,v=!1,h=0,u=!1,m=void 0,p=e("#commentPaneContiner"),g=function(t,n,o,i,a){var s=t.className;-1==s.indexOf(" cC")||a?(e(t).addClass(isRTL?"cCRTL":"cC"),e(t).on("mouseover",function(){v||(clearTimeout(h),w(o,i))}).on("mouseout",function(){v||x()}).on("mousemove",function(){r||v||w(o,i)}),setTimeout(function(){v&&w(o,i)},100)):v&&T(n,o,i),l[o]||(l[o]=[]),l[o][i]=JSON.stringify(n)},C=function(){var e="<div class='annoteContiner'>";return e+=READ_WRITE?"<div class='commentContentDiv' contenteditable='true'></div><input type='hidden'/><div class='annoteHeader' style= 'direction:ltr'><span>Cell:&nbsp;</span> <span class='commentRef'></span><div class='annoteTrash annotetrashAnimate' ><div class='lid'></div><div class='can' title='"+jsMsg.Delete+"'></div></div></div>":"<div class='commentContentDiv'></div><input type='hidden'/>",e+="</div>"},w=function(t,n){if(V(t,n)){var o=getCell(t,n);if(!o)return;var i=l[t][n];if(null!=i){if(!v){if(c)return!1;E()}var a=t+"_"+n,s=C(),f=JSON.parse(i),d=f.v,h=(e("#l_"+a),"move");web_kit?h="-webkit-grab":browser_firefox&&(h="-moz-grab");var u=e("#"+a);if(!u.length){u=e("<div>",{id:a,class:"commentCallout"}).appendTo(e("#cCP")),u.html(s),d=decodeURIComponent(d),d=escapeSpecialCharacters(d).replace(/\n/g,"<br>"),u.find(".commentContentDiv").html(d);var m=getCellLabel(t,n);u.find(".commentRef").text(m),u.find("input").val(a)}var p=void 0;v&&(u.draggable({cancel:".commentContentDiv",opacity:.5,zIndex:2e3,cursor:h,containment:"#cCP",scroll:!1,start:function(){e("#l_"+a).hide()},drag:function(t,n){e("#l_"+a).hide(),S(t,n)},stop:function(e,t){K(t),U(t)}}),u.find(".annoteContiner").css("cursor",h),f.x&&f.y&&(p=f)),u.find(".annoteTrash").show();var g=b(o,u,p);g?R(u):E(a)}r=!0}},S=function(e,t){var n=t.position.top,o=t.position.left,i=s.width(),a=s.height(),l=!1;n>getSheetScrollTop()+getSheetHeight()||n<getSheetScrollTop()?(o>sheetScrollLeftVal&&o+i<sheetScrollLeftVal+getSheetWidth()&&(l=!0),n<getSheetScrollTop()&&scrollAnimator.scroll(!1,n,o,a,i,"TOP",l),n+a>getSheetScrollTop()+getSheetHeight()&&scrollAnimator.scroll(!1,n,o,a,i,"BOTTOM",l)):(o+i>getSheetScrollLeft()+getSheetWidth()&&o+i<getColLeft(totCols)||o>getSheetScrollLeft()+getSheetWidth()||o<getSheetScrollLeft())&&(o<getSheetScrollLeft()&&scrollAnimator.scroll(!1,n,o,a,i,"LEFT"),o+i>getSheetScrollLeft()+getSheetWidth()&&scrollAnimator.scroll(!1,n,o,a,i,"RIGHT"))},T=function(t,n,o){var i=n+"_"+o,a=e("#"+i);if(a.length&&t){var l=t.v;l=decodeURIComponent(l),l=escapeSpecialCharacters(l).replace(/\n/g,"<br>"),a.find(".commentContentDiv").html(l)}},b=function(e,t,n){var o,i;if(n)i=n.x,o=n.y;else if(e){var a=findCellLeft(e),l=findCellTop(e),r=getCellWidth(e),s=getCellHeight(e);o=l>5?l-5:l,i=a+r+5;var c=getNormalizedScrollLeft(),f=p.scrollTop(),d=t.width(),v=t.height(),h=parseInt(sheetPane.style.width),u=parseInt(sheetPane.style.height);i-c+d>h&&(i=a-d),o-f+v>u&&(o=l+s-v),0>o&&(o=0),0>i&&(i=0)}return isRTL?(i+=parseInt(getObj("ssVScrollbar").style.width)-1,t.css("right",i+"px")):t.css("left",i+"px"),t.css("top",o+"px"),K(void 0,t),!0},R=function(i){i.hover(function(){d=!0,s=e(this)},function(){d=!1,E()}),i.find(".annoteContiner").on("mousedown",function(){var e="move";web_kit?e="-webkit-grabbing":browser_firefox&&(e="-moz-grabbing"),v&&(this.style.cursor=e)}).on("mouseup",function(){var e="move";web_kit?e="-webkit-grab":browser_firefox&&(e="-moz-grab"),v&&(this.style.cursor=e)}),i.find(".commentContentDiv").on("click",function(){if(!READ_WRITE)return!1;N(!0,s);var e=s.find("input").val(),i=e.split("_");t=n=i[0],o=a=i[1]}).on("keydown",function(e){var t=e.which;if(browser_ie)var e=window.event,t=e.keyCode;var n=(e.shiftKey,e.ctrlKey),o=(e.altKey,e.metaKey);if(27==t){var i=s.find("input").val();v||E(i),setTimeout(function(){focusActiveElement()},10)}else if(9==t||os_mac&&o&&13==t||!os_mac&&n&&13==t){W("add"),N(!1);var i=s.find("input").val();E(),setTimeout(function(){focusActiveElement()},10)}}),i.find(".annoteTrash").on("click",function(){k()}),i.find(".commentContentDiv").on("paste",function(e){e.preventDefault();var t="";t=window.clipboardData?window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData.getData("text/plain"),A(t)})},A=function(e){if(window.getSelection){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount){var n=t.getRangeAt(0);n.deleteContents(),n.insertNode(document.createTextNode(e))}}else document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)},y=function(e){e.focus();var t=document.createRange();t.selectNodeContents(e),t.collapse(!1),selection=window.getSelection(),selection&&(selection.removeAllRanges(),selection.addRange(t)),e.scrollTop=e.scrollHeight},x=function(){clearTimeout(h),h=setTimeout(function(){E()},500)},E=function(t){clearTimeout(h),!r||c||d||t||v||(P(),r=!1),t&&(e("#"+t).remove(),e("#l_"+t).remove(),N(!1),d=!1)},P=function(){e("#cCP").html("")},_=function(){var i=currCell,l=ActiveCellInfo;if(t=n=l.getStartRow(),o=a=l.getStartCol(),V(t,o))return void L();var c=t+"_"+o,d=getCellLabel(t,o),v=C();s=e("<div>",{id:c,class:"commentCallout"}).appendTo(e("#cCP")),s.html(v),s.find("input").val(c),s.find(".commentRef").text(d),s.find(".annoteTrash").hide(),b(i,s),R(s),y(s.find(".commentContentDiv")[0]),r=!0,f=!0,N(!0,s)},L=function(){var i=ActiveCellInfo;t=n=i.getStartRow(),o=a=i.getStartCol();var l=t+"_"+o;v||w(t,o),s=e("#"+l),y(s.find(".commentContentDiv")[0]),N(!0,s)},N=function(e,t){c=e,e?(t.css("zIndex",2e3),m=t):m&&m.css("zIndex","")},I=function(e,t,n,o){for(var i=e;n>=i;i++)for(var a=t;o>=a;a++){var r=getCell(i,a);O(r),z(i,a),l[i]&&(l[i][a]=void 0)}},D=function(){W("removeAll")},k=function(){if(r){var i=s.find("input").val(),c=i.split("_");t=n=c[0],o=a=c[1],N(!1),d=!1;var f=t+"_"+o;e("#l_"+f).remove(),s.addClass("trashoutAnimate trashout"),O(getCell(t,o)),setTimeout(function(){e("#"+f).remove()},1e3)}else{var v=ActiveCellInfo;t=n=v.getStartRow(),o=a=v.getStartCol()}l[t][o]=void 0,W("remove")},O=function(t){t&&(removeCSSStyle("cellComment",t),e(t).hasClass("cC")?e(t).removeClass("cC"):e(t).hasClass("cCRTL")&&e(t).removeClass("cCRTL"))},z=function(t,n){V(t,n)&&(e("#"+t+"_"+n).remove(),e("#l_"+t+"_"+n).remove())},W=function(e){var i="";if("add"==e){if(i=s.find(".commentContentDiv")[0].innerText,!i)return void E();{s.offset()}G(),f?(e="add",f=!1):e="edit"}else if("removeAll"==e){var l=getCellRange();t=l.startRow,o=l.startCol,n=l.endRow,a=l.endCol,e="remove"}var r=new RequestParameters(ActionConstants.CELL_COMMENT);r.setParameters(WorkSheets.getAssociatedActiveSheetName(),t,o,n,a,e,encodeURIComponent(i));var c=new AjaxRequest;c.init("POST",r.getURL(),!0,r.getParametersAsString()),actionManager.addRequest(c)},U=function(e){var t=e.position,n=t.left,o=t.top,i=e.helper,a=i.find("input").val(),r=i.find(".commentContentDiv"),s=a.split("_"),c=s[0],f=s[1],d=r.width(),v=r.height(),h=l[c][f];if(h){var u=JSON.parse(h);u.x=n,u.y=o,l[c][f]=JSON.stringify(u)}var m=new RequestParameters(ActionConstants.RESET_ANNOTE_POSITION);m.setParameters(WorkSheets.getAssociatedActiveSheetName(),c,f,n,o,d,v);var p=new AjaxRequest;p.init("POST",m.getURL(),!0,m.getParametersAsString()),p.sendRequest()},H=function(e){var t=e.sn;if(CURRSHEETNAME==t){var n=e.m;if("remove"==n)I(e.sr,e.sc,e.er,e.ec);else for(i in e.n){{var o=e.n[i],a=o.r,l=o.c;getCell(a,l)}o&&new Cell(a,l).executeMethod(Annot.addComment,o,a,l)}}},M=function(){v?(J(),e("#cellNotePopUp").zmenu("changeIcon","showAllNotes","ui-zmenu-no-icon")):(q(),e("#cellNotePopUp").zmenu("changeIcon","showAllNotes","ui-icon-check"))},j=function(){u&&(q(),e("#cellNotePopUp").zmenu("changeIcon","showAllNotes","ui-icon-check"))},V=function(e,t){if(l[e]){var n=l[e][t];if(n)return n}return!1},q=function(){v=!0;for(var e=getAvailableStartRow(),t=getAvailableStartCol(),n=getAvailableEndRow(),o=getAvailableEndCol(),i=l.length,a=0;i>a;a++){var r=l[a];if(r)for(var s=0;s<r.length;s++){var c=r[s];c&&a>=e&&n>=a&&s>=t&&o>=s&&w(a,s)}}},J=function(){P(),v=!1,r=!1},K=function(t,n){if(n)var o=isRTL?parseInt(e(n).css("right")):n.cssUnit("left")[0],i=n.cssUnit("top")[0];else{n=t.helper;var a=t.position,o=a.left,i=a.top}var l=n.find("input").val(),r=n.width(),s=n.height(),c=l.split("_"),f=c[0],d=c[1],v=getCell(f,d);if(e(v).is(":visible")){var h=findCellLeft(v),u=findCellTop(v),m=getCellWidth(v),g=(p.scrollLeft(),p.scrollTop(),h+m),C=u;g>o+r/2&&(o+=r),C>i+s/2&&(i+=s);var w={x:o,y:i},S={x:g,y:C};B(S,w,"l_"+l)}},B=function(t,n,o){var i=getObj(o);i?e(i).show():(i=document.createElement("canvas"),i.setAttribute("class","lineCanvas"),i.setAttribute("id",o),getObj("cCP").appendChild(i));var a,l;t.x<n.x?(a=t,l=n):(a=n,l=t);var r=1,s=10,c={x:a.x-s,y:Math.min(t.y,n.y)-s};i.width=Math.max(l.x-a.x,r)+2*s,i.height=Math.abs(t.y-n.y)+2*s,i.style[isRTL?"right":"left"]=c.x+"px",i.style.top=c.y+"px",isRTL&&(i.style.transform="scaleX(-1)");var f=i.getContext("2d");f.save(),f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,i.width,i.height),f.restore(),f.lineWidth=1,f.strokeStyle="#f9a503",f.beginPath(),f.moveTo(t.x-c.x,t.y-c.y),f.lineTo(n.x-c.x,n.y-c.y),f.stroke()},F=function(){var t=e(sheetPane).width(),n=e(sheetPane).height();p=e("#commentPaneContiner");var o=rowHeadWidth,i=e("#docPanel");"none"!=i.css("display")&&(o+=parseInt(i.css("width"))),p.css(isRTL?{top:sheetTop,right:o,width:t,height:n}:{top:sheetTop,left:sheetLeft,width:t,height:n}),e("#cCP").css({width:totalTableWidth+sheetLeft,height:totalTableHeight+sheetTop})},G=function(){var e=getSheetScrollTop(),t=getSheetScrollLeft();p.scrollTop(e),p.scrollLeft(t)},Q=function(){return r};return appEvent.on("Toolbar.Initialized",function(){F(),e(document).shortcutkeys("disable"),setTimeout(function(){e("#commentPaneContiner").show(),G()},2e3)}),appEvent.on("annot.add",function(e,t,n,o){g(e,t,n,o)}),appEvent.on("annot.handleResponse",function(e){H(e)}),appEvent.on("body.mousedown",function(e){if(browser_ie){e=window.event;var t=e.srcElement}else var t=e.target;var n=t.className;c&&"commentContentDiv"!=n&&W("add"),N(!1),E()}),appEvent.on("book.onbeforesheetswitch",function(){l=[]}),appEvent.on("book.onaftersheetswitch",function(){F(),setTimeout(function(){e("#commentPaneContiner").show(),G()},500)}),appEvent.on("sheet.horizontallyScrolled sheet.verticallyScrolled",function(){G()}),appEvent.on("tableWidthChanged",function(t){e("#cCP").css("width",t+"px")}),appEvent.on("tableHeightChanged",function(t){e("#cCP").css("height",t+"px")}),appEvent.on("sheet.resize",function(){F()}),appEvent.on("isAddCmtOn",function(){if(s&&s.is(":visible")){var e=s.find(".commentContentDiv")[0];y(e)}}),appEvent.on("range.clearAll",function(e,t,n,o){I(e,t,n,o)}),appEvent.on("zsmousewheel.scroll",function(){e("#cCP .commentCallout").css("pointer-events","none")}),appEvent.on("zsmousewheel.scroll",e.debounce(1e3,function(){e("#cCP .commentCallout").css("pointer-events","all")})),appEvent.on("initVersionView",function(){v&&(J(),u=!0)}),{add:_,edit:L,show:w,hide:x,isNoteOn:Q,remove:k,removeAll:I,hasNote:V,clearAll:D,addComment:g,toggleView:M,setNoteView:j}}(jQuery);
function showURLInDialog(t,e,i,o,s){var n=new AjaxRequest;n.init("POST",t.split("?")[0],!0,t.split("?")[1]),n.addEventListener("onComplete",function(t){var n=showDialog(t.responseText,e,i,s);o&&n.setAttribute("opener",o)}),n.sendRequest()}$.ui.zcombo&&($.ui.zcombo.prototype._setOptionValue=function(t,e){t=this._getCorrectedOptPosition(t);var i=this.selected;this.selected=t;var o=$(this._dropDownMenu.zmenu("getMenuItemAt",t)),s=$(o.clone().html()),n=void 0;if(this.options.applyOptionStylesOnCombo&&(n=$(o).attr("style")),this._optArea.empty().append(s),this._optArea.find(".ui-zmenu-shortcut").empty().remove(),!e){var r=this.element,a=void 0!=i?r.val():void 0;r.get(0).selectedIndex=t,this._triggerEvent(this._EVENTS.ONCHANGE,{prevVal:a})}var l=this.element.get(0);l.selectedIndex=t;var p=$(".ui-zmenu-text:visible",this._optArea);p.length&&p.text(s.text()),n&&(this._optArea.attr("style",n),p.attr("style",n))});
var ProtectedRanges=function(){this.ranges=new ZS_RangeList("prDiv",!0,0),this.sheets=new ZS_ProtectedSheetList,this.highlight=!1};ProtectedRanges.prototype={initialize:function(e,t){0==isUndefined(e)&&this.ranges.initialize(e),0==isUndefined(t)&&this.sheets.initialize(t)},getRanges:function(){return this.ranges},getSheets:function(){return this.sheets},setHighlight:function(e){this.highlight=e},isHighlight:function(){return this.highlight},hasProtectedRange:function(e,t,n){for(var s,a=this.ranges.getIterator();a.hasNext();)if(s=a.next(),"INSERTLEFT"===t||"DELETERIGHT"===t||"INSERTTOP"===t||"DELETEBOTTOM"===t){if(s.isPartOfRange(e))return jsMsg["ProtectedRange.alert.ProtectRangeMessage.Move"]}else if(s.isIntersect(e)){if((t===ActionConstants.INSERT_ROW||t===ActionConstants.INSERT_CUT_ROW||t===ActionConstants.INSERT_COPY_ROW)&&e.getStartRow()<=s.getStartRow()||(t===ActionConstants.INSERT_COL||t===ActionConstants.INSERT_CUT_COLUMN||t===ActionConstants.INSERT_COPY_COLUMN)&&e.getStartCol()<=s.getStartCol())continue;if(n||s.isLock())return jsMsg["ProtectedRange.alert.ProtectRangeMessage"];if(t===ActionConstants.MERGE_RANGE&&!s.isContains(e))return jsMsg["ProtectedRange.alert.ProtectRangeMessage.Merge"]}return!1},hasProtectedSheet:function(e){return this.sheets.isSheetProtected(e)},addRange:function(e){var t=this.ranges.find(e);if(-1!==t){var n=this.ranges.getRange(t);n.isLock()!==e.isLock()&&(n.setLock(e.isLock()),e.isLock()===!0?this.ranges.addElement(n,ProtectedRanges.getObject().isHighlight()):ProtectedRanges.showMenuEntry()===!0?n.removeDivElement(ProtectedRanges.getObject().isHighlight()):this.ranges.remove(t))}else this.ranges.removeRange(e),(e.isLock()===!0||ProtectedRanges.showMenuEntry()===!0)&&this.ranges.add(e);if(e.isLock()&&isCellEdited()){var s=new ZS_Range(currRow,currCol,currRow,currCol);e.isIntersect(s)&&(resetCurrCellValue(),showAlertDialog(jsMsg["ProtectedRange.alert.ProtectRangeMessage"]))}},addSheet:function(){},updateResponse:function(e){if(ObjectUtil.isUndefined(e[JSONConstants.ACTION])===!0){if(!isUndefined(e[JSONConstants.PROTECTED_RANGES])||!isUndefined(e[JSONConstants.PROTECTED_SHEETS])){var t,n;if(CURRSHEETNAME===e[JSONConstants.SHEET_NAME]&&(t=e[JSONConstants.PROTECTED_RANGES]),isUndefined(e[JSONConstants.PROTECTED_SHEETS])||(n=e[JSONConstants.PROTECTED_SHEETS]),this.initialize(t,n),CURRSHEETNAME===e[JSONConstants.SHEET_NAME])for(var s=0;s<t.length;s++)t[s].lock&&appEvent.trigger("protectRange.apply",[t[s].sr,t[s].sc,t[s].er])}}else{var a,o,r=e[JSONConstants.ACTION];switch(r){case ActionConstants.LOCK_RANGE:a=ProtectedRanges.getRangeObj(e),this.addRange(a),appEvent.trigger("protectRange.apply",[a.startRow,a.startCol,a.endRow]);break;case ActionConstants.UNLOCK_RANGE:if(a=ProtectedRanges.getRangeObj(e),this.ranges.removeRange(a),ObjectUtil.isUndefined(e[JSONConstants.PROTECTED_RANGES])===!1)for(var i=new ZS_Iterator(e[JSONConstants.PROTECTED_RANGES]);i.hasNext();)a=ProtectedRanges.getRangeObj(i.next()),this.addRange(a);appEvent.trigger("protectRange.remove",[a.startRow,a.startCol,a.endRow]);break;case ActionConstants.LOCK_SHEET:o=this.sheets.getSheetObj(e[JSONConstants.SHEET_NAME]);var g=ZS_ProtectedSheet.getSheetObj(e);null!=o||1!=g.isLock()&&1!=ProtectedRanges.showMenuEntry()?o.isLock()!=g.isLock()&&(1==g.isLock()?(o.setLock(!0),o.lockSheetTab()):(o.unlockSheetTab(!0),1==ProtectedRanges.showMenuEntry()?o.setLock(!1):this.sheets.remove(g.getName()))):(o=g,this.sheets.add(o)),CURRSHEETNAME===e[JSONConstants.SHEET_NAME]&&this.ranges.initialize(e[JSONConstants.PROTECTED_RANGES]);break;case ActionConstants.UNLOCK_SHEET:o=this.sheets.getSheetObj(e[JSONConstants.SHEET_NAME]),null!=o&&(1==o.isLock()&&(CURRSHEETNAME===e[JSONConstants.SHEET_NAME]&&this.ranges.initialize(e[JSONConstants.PROTECTED_RANGES]),o.unlockSheetTab(!0)),this.sheets.remove(o.getName()))}}DataValidation.checkCurrCellFocusForDv()},onMoveOrResizeAction:function(e,t,n){switch(e){case ActionConstants.INSERT_ROW:this.ranges.iterateRangeMethods(ZS_Range.prototype.insertRow,[t,n]);break;case ActionConstants.DELETE_ROW:this.ranges.iterateRangeMethods(ZS_Range.prototype.deleteRow,[t,n],ProtectedRanges.deleteCallBack);break;case ActionConstants.HEIGHT:this.ranges.iterateRangeMethods(ZS_Range.prototype.resizeRow,[t]);break;case ActionConstants.INSERT_COL:this.ranges.iterateRangeMethods(ZS_Range.prototype.insertCol,[t,n]);break;case ActionConstants.DELETE_COL:this.ranges.iterateRangeMethods(ZS_Range.prototype.deleteCol,[t,n],ProtectedRanges.deleteCallBack);break;case ActionConstants.WIDTH:this.ranges.iterateRangeMethods(ZS_Range.prototype.resizeColumn,[t])}},onSheetRename:function(e,t){this.sheets.renameSheet(e,t)},onSheetDelete:function(e){this.sheets.deleteSheet(e)},onFreeze:function(){this.ranges.iterateRangeMethods(ZS_Range.prototype.freeze)},onUnfreeze:function(){this.ranges.iterateRangeMethods(ZS_Range.prototype.unFreeze)}};var protectedRanges;ProtectedRanges.getObject=function(){return(ObjectUtil.isUndefined(protectedRanges)||null==protectedRanges)&&(protectedRanges=new ProtectedRanges),protectedRanges},ProtectedRanges.getRangeObj=function(e){return new ZS_Range(e[JSONConstants.START_ROW],e[JSONConstants.START_COLUMN],e[JSONConstants.END_ROW],e[JSONConstants.END_COLUMN],e[JSONConstants.LOCK])},ProtectedRanges.lockRange=function(e,t,n,s,a,o,r,i,g,c){var R=new RequestParameters(ActionConstants.LOCK_RANGE);R.setParameters(WorkSheets.getSheetCodeFromName(e),t,n,s,a,o,r,i,g,c);var h=new AjaxRequest;h.init("POST",R.getURL(),!0,R.getParametersAsString()),actionManager.addRequest(h)},ProtectedRanges.lockSheet=function(e,t,n,s,a,o){var r=new RequestParameters(ActionConstants.LOCK_SHEET);r.setParameters(e,t,n,s,a,o);var i=new AjaxRequest,g=r.getParametersAsString();i.init("POST",r.getURL(),!0,g),actionManager.addRequest(i)},ProtectedRanges.lockMultipleRange=function(){var e=new RequestParameters(ActionConstants.LOCK_MULTIPLE);e.setParameters(JSON.stringify(protectionDialog.getModifiedRanges()),$("#manageSheets").is(":visible"));var t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),actionManager.addRequest(t)},ProtectedRanges.unlockRange=function(e,t,n,s,a){var o=new RequestParameters(ActionConstants.UNLOCK_RANGE);o.setParameters(WorkSheets.getSheetCodeFromName(e),t,n,s,a);var r=new AjaxRequest;r.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(r)},ProtectedRanges.unlockSheet=function(e){var t=new RequestParameters(ActionConstants.UNLOCK_SHEET);t.setParameters(e);var n=new AjaxRequest;n.init("POST",t.getURL(),!0,t.getParametersAsString()),actionManager.addRequest(n)},ProtectedRanges.toggleHighlight=function(){ProtectedRanges.getObject().isHighlight()?ProtectedRanges.removeHighlight():ProtectedRanges.highlight()},ProtectedRanges.highlight=function(){$("#protectrangemenu").zmenu("changeIcon","highlightProtect","ui-individual-icon ui-icon-ztick"),ProtectedRanges.getObject().getRanges().highlight(),ProtectedRanges.getObject().getSheets().highlight(),ProtectedRanges.getObject().setHighlight(!0)},ProtectedRanges.removeHighlight=function(){var e=function(){$("#protectrangemenu").zmenu("changeIcon","highlightProtect","ui-zmenu-no-icon")};menutabListener.doAction(TOOLBAR.DATA,{id:"protectCell",action:"enable",callback:e}),ProtectedRanges.getObject().getRanges().removeHighlight(),ProtectedRanges.getObject().getSheets().removeHighlight(),ProtectedRanges.getObject().setHighlight(!1)},ProtectedRanges.getSelectedRange=function(){var e=getCellRange();return new ZS_Range(e.startRow,e.startCol,isColSelected()?getRowMax()-1:e.endRow,isRowSelected()?getColMax()-1:e.endCol)},ProtectedRanges.isCellLocked=function(e,t,n){return ProtectedRanges.isRangeLocked(e,t,e,t,null,n)},ProtectedRanges.isRangeLocked=function(e,t,n,s,a,o,r){var i=ProtectedRanges.getObject(),g=new ZS_Range(e,t,n,s),c=i.hasProtectedRange(g,a,r);return c?(o||showAlertDialog(c),!0):!1},ProtectedRanges.showMenuEntry=function(){return jsNEW_DOC_VIEW||jsOPEN_DOC_VIEW||jsSHARE_VIEW&&isCoOwnerSharedDoc},ProtectedRanges.isSheetLocked=function(e){return ProtectedRanges.getObject().hasProtectedSheet(e)},ProtectedRanges.deleteCallBack=function(e,t){0==e&&ProtectedRanges.getObject().getRanges().removeRange(t)},ProtectedRanges.resetMenuItem=function(e){var t=$(e);if(t){var n=t.parent();t.is(":checked")?n.zbutton("uncheck",e):n.zbutton("check",e)}},ProtectedRanges.initLockMenu=function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)?($("#mdataTab").ztoolbar("disable"),$("#protectrangemenu").bind("menubeforeshow",function(){$("#rangeProtect").disable()})):$("#mdataTab").ztoolbar("enable"),ProtectedRanges.showMenuEntry()?$("#protectCell").enable():$("#protectCell").disable(),$("#pivotbuilder").enable()},ProtectedRanges.counterValuesForProtectRangeWithinAvailableRows=function(e){e||(e=0);for(var t=[],n=0,s=0;n<ProtectedRanges.getObject().ranges.list.length;n++){var a=ProtectedRanges.getObject().ranges.list[n].startRow,o=ProtectedRanges.getObject().ranges.list[n].endRow,r=ProtectedRanges.getObject().ranges.list[n].startCol;if(!(availableEndRow>=a&&a>=availableStartRow))break;for(var i=a;o>=i;i++,s++)t[s]=i*(totCols-e)+(r-e)}return t},appEvent.on("book.onaftersheetswitch",function(){ProtectedRanges.isSheetLocked(CURRSHEETNAME)&&mask.grid(!0,!1,!1,!0)});
var protectionDialog=function(){function e(){if(!ProtectedRanges.isSheetLocked(CURRSHEETNAME)){var e=ProtectedRanges.getSelectedRange(),t=ProtectedRanges.getObject().getRanges().getIntersectedRanges(e);if(t.isEmpty())B=!1,n(!1,!1,e,null,!0);else if(B=!0,1===t.size()){var a=t.getRange(0);if(e.equals(a))n(!1,!1,e);else if(a.isContains(e))n(!1,!1,e);else{var s={buttons:[{text:jsMsg.Yes,class:"ui-zbutton-primary",click:function(){n(!1,!0,e,t.getRange(0),!0),sheetdialog.closeNotify()}},{text:jsMsg.No,click:function(){n(!1,!1,e,null,!0),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};sheetdialog.showConfirmDialog(jsMsg["ProtectedRange.confirm.Extend"],s)}}else{var o={buttons:[{text:jsMsg.OK,class:"ui-zbutton-primary",click:function(){n(!1,!1,e,null,!0),sheetdialog.closeNotify()}},{text:jsMsg.Cancel,click:function(){sheetdialog.closeNotify()}}]};sheetdialog.showConfirmDialog(jsMsg["ProtectedRange.confirm.RemoveExisting"],o)}}}function t(e){var t=e?currSheetOnRightClick:CURRSHEETNAME;B=null!==ProtectedRanges.getObject().getSheets().getSheetObj(t),n(!0,!1,WorkSheets.getSheetCodeFromName(t),null,!B)}function n(e,t,n,s,o){var i=jsMsg["ProtectRange.UI.Menu.ProtectRange"];e&&(i=jsMsg["Menu.ProtectRange.ProtectSheet"]);var r={init:function(){e?($("#prSheetInput").show(),$("#prSheetInput input").val(CURRSHEETNAME),$("#shareNote").text(jsMsg["ProtectedRange.UI.SheetLockCollaboratorsInfo"])):(appEvent.on("grid.mousedown",G),$("#prRangeInput").show(),$("#inputRange").focus(function(){var e=this;RangeSelector.on({el:e,isAbsoluteRef:!0,appendSheetName:!0})}),$("#inputRange").focus());var i=new RequestParameters(ActionConstants.PROTECT_RANGE_DIALOG);i.setParameters(e?null:n.getStartRow(),e?null:n.getStartCol(),e?null:n.getEndRow(),e?null:n.getEndCol(),e?n:WorkSheets.getAssociatedActiveSheetName(),e,t,t?s.getStartRow():null,t?s.getStartCol():null,t?s.getEndRow():null,t?s.getEndCol():null);var r=e?CURRSHEETNAME:CellUtils.constructCellName(n.getStartRow(),n.getStartCol(),n.getEndRow(),n.getEndCol(),!0,CURRSHEETNAME);$("#inputRange").attr("value",r);var l=new AjaxRequest;l.init("POST",i.getURL(),!0,i.getParametersAsString()),l.addEventListener("onComplete",function(t){var n=parseJSON(t.responseText),s=$("#content");s.empty();var i="prTable";$("<table/>",{style:"table-layout:fixed; margin-left: 10px; margin-right:10px",cellspacing:"0"}).attr("id",i).appendTo(s);var r=N(n[JSONConstants.PROTECTED_RANGES].owner,i),l=O(n[JSONConstants.PROTECTED_RANGES],i,r);l=I(n[JSONConstants.PROTECTED_RANGES],i,l),M(n[JSONConstants.PROTECTED_RANGES],i),x(),"partial"===l?$("#lockSelector").attr("class","pChkI"):l?$("#lockSelector").attr("class","chkI"):$("#lockSelector").attr("class","unChkI"),B||l?o&&$("#pR_ok").enable():$("#pR_ok").disable(),e&&$("#isSheet").attr("value",!0),$(".user, .group, .org, .linkShare").on("change",function(){a()})}),l.sendRequest()},destroy:function(){RangeSelector.off(),appEvent.off("grid.mousedown",G)}},l={autoOpen:!1,width:500,resizable:!1,title:i,modal:e,close:function(){e===!1&&(focusCellRange(n.getStartRow(),n.getStartCol(),n.getEndRow(),n.getEndCol(),void 0,!0),Q&&ProtectedRanges.removeHighlight())}};sheetdialog.open("protectdialog",l,r)}function a(){var e,t=0;$("#pR_ok").enable(),$(".user, .group, .org, .linkShare").each(function(){if($(this).is(":checked")?$(this).siblings().last().addClass("off"):$(this).siblings().last().removeClass("off"),0===t)e=$(this).is(":checked");else if(!$(this).is(":disabled")&&$(this).is(":checked")!==e)return $("#lockSelector").attr("class","pChkI"),!1;t++}),t===$(".user, .group, .org, .linkShare").length&&(e?$("#lockSelector").attr("class","chkI"):($("#lockSelector").attr("class","unChkI"),B||$("#pR_ok").disable()))}function s(){var e=$("#lockSelector").attr("class"),t="true"==getObj("isSheet").value;if(t)var n=WorkSheets.getAssociatedActiveSheetName();else{var a=$("#inputRange")[0].value,s=DataValidation_UI.validateDvRange(a);if(!s)return void showAlertDialog(jsMsg.InvalidRange);var a=getDataFrom2DRangeText(s);if(a.sR===a.eR&&a.sC===a.eC){var o=Merge.getCellInfo(a.sR,a.sC);o&&(a.endRow=o.eR,a.endCol=o.eC)}}if("chkI"===e){var i=new StringBuffer;return $(".user").each(function(){$(this).is(":disabled")||i.append($(this).attr("zid"))}),sheetdialog.close(),void(0==t?ProtectedRanges.lockRange(a.sheetName,a.sR,a.sC,a.eR,a.eC,null,i,null,null):ProtectedRanges.lockSheet(n,null,i,null,null))}if("pChkI"===e){var r=new StringBuffer,i=new StringBuffer,l=new StringBuffer,c=new StringBuffer,g=null,d=!0;if($(".user").each(function(){$(this).is(":disabled")||($(this).is(":checked")?(d=!1,i.append($(this).attr("zid"))):r.append($(this).attr("zid")))}),$(".group").each(function(){$(this).is(":disabled")||($(this).is(":checked")?d=!1:l.append($(this).attr("zid")))}),$(".org").each(function(){$(this).is(":disabled")||($(this).is(":checked")?d=!1:c.append($(this).attr("zid")))}),$(".linkShare").length&&!$(".linkShare").is(":disabled")&&(g=!$(".linkShare").is(":checked"),g||(d=!1)),!d)return sheetdialog.close(),void(t===!1?ProtectedRanges.lockRange(a.sheetName,a.sR,a.sC,a.eR,a.eC,r.toString(",",!0),i.toString(",",!0),l.toString(",",!0),c.toString(",",!0),g):ProtectedRanges.lockSheet(n,r.toString(",",!0),i.toString(",",!0),l.toString(",",!0),c.toString(",",!0),g))}sheetdialog.close(),t===!1?ProtectedRanges.unlockRange(a.sheetName,a.sR,a.sC,a.eR,a.eC):ProtectedRanges.unlockSheet(n)}function o(){var e={autoOpen:!1,width:575,modal:!0,resizable:!1,title:jsMsg["Menu.ProtectRange.ManageProtection"],close:function(){L(),H(!0),sheetdialog.allowToClose=!0}},t={set:function(e,t){"managePrSheetSelection"===e.action&&i(t)},init:function(){sheetdialog.allowToClose=!1;for(var e=0;e<WorkSheets._sheetNamesMetaList[WorkSheets.NAME_POS].length;e++){{$("#prSheetName").append($("<option>",{value:WorkSheets._sheetNamesMetaList[WorkSheets.META_POS][e],text:WorkSheets._sheetNamesMetaList[WorkSheets.NAME_POS][e]}))}if(WorkSheets._sheetNamesMetaList[WorkSheets.NAME_POS][e]===CURRSHEETNAME)var t=e+1}$("#prSheetName").zcombo("setSelectedIndex",t),i(WorkSheets.getAssociatedActiveSheetName(),!0)}};sheetdialog.open("manageprotectdialog",e,t)}function i(e,t){$("#content").empty(),$("#dialogLoadingMsg").show();var n=p(e);if("undefined"!=typeof n)protectionDialog.constructManageProtectRangeDiv(n,e);else{var a=new RequestParameters(ActionConstants.READ_PROTECTED_RANGES);a.setParameters(e,t);var s=new AjaxRequest;s.init("POST",a.getURL(),!0,a.getParametersAsString()),s.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);K[t[JSONConstants.ASSOCIATED_SHEET_NAME]]=t[JSONConstants.PROTECTED_RANGES],protectionDialog.constructManageProtectRangeDiv(t[JSONConstants.PROTECTED_RANGES],t[JSONConstants.ASSOCIATED_SHEET_NAME])}),s.sendRequest()}}function r(e,t){if($("#prSheetName").zcombo("getValue")===t){var n=$("#content");if(n.empty(),$("#dialogLoadingMsg").hide(),!e.length>0||1===e.length&&!e[0].prArray>0)U(n);else{$("#expandCollapse").show();var a=$("<div/>",{class:"treeExpand",click:function(){w(this)}}),s=$("<span/>",{class:"appliesTo"}),o=$("<table/>",{class:"uLC dFI aD1",cellspacing:"0"}),i=$("<div/>",{class:"trashAnimate",title:jsMsg.Remove}).click(function(e){var t=$(this).closest(".treeExpand"),n=0===t.length?$(this).closest(".treeCollapse"):t,a=n.next(),s=getDataFrom2DRangeText(a.attr("range"));ProtectedRanges.unlockRange(s.sheetName,s.sR,s.sC,s.eR,s.eC),l(a,n),stopEvt(e)}),r=$("<div/>",{class:"lid"}),c=$("<div/>",{class:"can"});i.append(r).append(c);for(var g=0;g<e.length;g++)for(var d=e[g],p=d.prArray,f=0;f<p.length;f++){var S=p[f],R=a.clone(!0),v=s.clone(!0).text(S.pr);v.click(u());var C=i.clone(!0);R.append(v),R.append(C),n.append(R);{var k=""+g+f,m="userListContainer"+k;o.clone(!0).attr("id",m).attr("range",S.pr).appendTo(n)}N(S.owner,m,k),O(S,m,void 0,k),I(S,m,void 0,k),M(S,m,k)}x(),$("#content .user, #content .group, #content .org, #content .linkShare").on("change",{isSheet:!1},h)}}}function l(e,t){$(e).removeClass("dFI aD1"),$(t).removeClass("dFI aD1"),setTimeout(function(){$(e).addClass("bFO aD"),$(t).addClass("bFO aD")},1),setTimeout(function(){$(e).removeClass("bFO aD"),$(t).removeClass("bFO aD")},1e3),setTimeout(function(){$(e).addClass("fO"),$(t).addClass("fO")},1001)}function c(){!$("#lockRanges").attr("disabled")&&$("#content").children().length<=0&&i($("#prSheetName").zcombo("getValue"))}function g(){if(!$("#lockSheets").attr("disabled")&&"undefined"==typeof K.sheets){$("#contentSheet").empty(),$("#dialogLoadingMsg").show();var e=new RequestParameters(ActionConstants.READ_PROTECTED_SHEETS),t=new AjaxRequest;t.init("POST",e.getURL(),!0,e.getParametersAsString()),t.addEventListener("onComplete",function(e){var t=parseJSON(e.responseText);K.sheets=!0,protectionDialog.constructManageProtectSheetDiv(t[JSONConstants.PROTECTED_SHEETS])}),t.sendRequest()}}function d(e){var t=$("#contentSheet");if(t.empty(),$("#dialogLoadingMsg").hide(),e.length<=0)U(t,!0);else{$("#expandCollapse1").show();var n=$("<div/>",{class:"treeExpand",click:function(){w(this)}}),a=$("<span/>",{class:"appliesTo"}),s=$("<table/>",{class:"uLC dFI aD1",cellspacing:"0"}),o=$("<div/>",{class:"trashAnimate",title:jsMsg.Remove}).click(function(e){{var t=$(this).closest(".treeExpand"),n=0===t.length?$(this).closest(".treeCollapse"):t,a=n.next();a.attr("range")}ProtectedRanges.unlockSheet(WorkSheets.getSheetCodeFromName(a.attr("range"))),l(a,n),stopEvt(e)}),i=$("<div/>",{class:"lid"}),r=$("<div/>",{class:"can"});o.append(i).append(r);for(var c=0;c<e.length;c++){var g=e[c],d=(g.prArray,g),p=n.clone(!0),f=a.clone(!0).text(d.sn);f.click(u());var S=o.clone(!0);p.append(f),p.append(S),t.append(p);{var R="S"+c+j,v="userListContainer"+R;s.clone(!0).attr("id",v).attr("range",d.sn).appendTo(t)}N(d.owner,v,R),O(d,v,void 0,R),I(d,v,void 0,R),M(g,v,R)}x(),$("#contentSheet .user, #contentSheet .group, #contentSheet .org, #contentSheet .linkShare").on("change",{isSheet:!0},h)}}function u(){return function(e){var t=$(this).text();Goto.gotoCellInit(t);var n=getCellRangeFromString(t);n&&moveDialogBox(n.startRow,n.startCol),stopEvt(e)}}function h(e){var t=$(this).attr("zid"),n=$(this).attr("id"),a=!$(this).is(":checked"),s=$(this).closest("table"),o="#"+s.attr("id"),i=new StringBuffer,r=new StringBuffer,l=new StringBuffer,c=new StringBuffer,g=null,d=!0;$(o+" .user").each(function(){$(this).is(":disabled")||($(this).is(":checked")?(r.append($(this).attr("zid")),$(this).siblings().last().addClass("off"),d=!1):(i.append($(this).attr("zid")),$(this).siblings().last().removeClass("off")))}),$(o+" .group").each(function(){$(this).is(":disabled")||($(this).is(":checked")?($(this).siblings().last().addClass("off"),d=!1):(l.append($(this).attr("zid")),$(this).siblings().last().removeClass("off")))}),$(o+" .org").each(function(){$(this).is(":disabled")||($(this).is(":checked")?(d=!1,$(this).siblings().last().addClass("off")):(c.append($(this).attr("zid")),$(this).siblings().last().removeClass("off")))}),$(o+".linkShare").length&&!$(".linkShare").is(":disabled")&&(g=!$(o+".linkShare").is(":checked"),g||($(this).siblings().last().addClass("off"),d=!1)),y(s.attr("range"),i.toString(",",!0),r.toString(",",!0),l.toString(",",!0),c.toString(",",!0),g,d),e.data.isSheet||f(s.attr("range"),t,$(this).is(":checked")),z(o,n,a,s.attr("range")),v(!1)}function p(e){return void 0!==Y[e]?Y[e]:K[e]}function f(e,t,n){var a=$("#prSheetName").zcombo("getValue");void 0===Y[a]&&(Y[a]=JSON.parse(JSON.stringify(K[a])));var s=Y[a][0].prArray;$.each(s,function(a,s){return s.pr===e?($.each(s,function(e,a){if(a instanceof Array)$.each(a,function(e,a){return t===a.zuid?(a.lock=n,!1):void 0});else if(t===a.zuid)return a.lock=n,!1}),!1):void 0})}function S(e){delete K[e]}function R(){if(ProtectedRanges.lockMultipleRange(),$("#manageSheets").is(":visible"))for(var e=0;e<q.length;e++){var t=WorkSheets.getSheetCodeFromName(q[e].pr);S(t),$("#prSheetName").zcombo("getValue")===t&&$("#content").empty()}L(),W(),v(!0)}function v(e){e?($("#close").show(),$("#saveChanges").slideUp(),$("#manageSheets").is(":visible")?$("#lockRanges").enable():$("#lockSheets").enable()):($("#close").hide(),$("#saveChanges").addClass("lCA"),$("#saveChanges").slideDown(),$("#manageSheets").is(":visible")?$("#lockRanges").disable():$("#lockSheets").disable())}function C(){$(".user, .group, .org, .linkShare").unbind("change");for(var e=0;e<V.length;e++){var t=$(V[e].tableId).find("input#"+V[e].eleId);V[e].prevState?(t.prop("checked",!0),$(t).siblings().last().addClass("off")):(t.prop("checked",!1),$(t).siblings().last().removeClass("off"))}W(),L(),H(),$(".user, .group, .org, .linkShare").on("change",{isSheet:$("#manageSheets").is(":visible")},h),v(!0)}function k(){"manageprotectdialog"===sheetdialog.getDialogName()&&i($("#options").children("select").val())}function m(e,t,n,a){return 0==t&&a==getRowMax()-1?getColHeadLabel(e+1)+":"+getColHeadLabel(n+1):getColHeadLabel(e+1)+getRowHeadLabel(t)+":"+getColHeadLabel(n+1)+getRowHeadLabel(a)}function E(e){if(sheetdialog.isDialogOpen()&&"manageprotectdialog"===sheetdialog.getDialogName()){var t=e.sn+"."+m(e.sc,e.sr,e.ec,e.er),n=$("#content"),a=$("#expandCollapse");if(e.a===ActionConstants.UNLOCK_SHEET&&(t=e.sn,n=$("#contentSheet"),a=$("#expandCollapse1")),b(V,t),b(q,t),e.a!==ActionConstants.UNLOCK_SHEET){var s=WorkSheets.getSheetCodeFromName(e.sn);if(Y[s]){var o=Y[s][0].prArray;o&&b(o,t)}if(K[s]){var o=K[s][0].prArray;o&&b(o,t)}}setTimeout(function(){var e=$("[range='"+t+"']");e.prev().remove(),e.remove(),0===n.children().length&&(U(n),$("#expandCollapse").hide()),0===q.length&&v(!0)},1e3)}}function b(e,t){for(var n=e.length;n--;)e[n].pr===t&&e.splice(n,1)}function P(){var e=$("#lockSelector").attr("class");$(".user, .group, .org, .linkShare").unbind("change"),$("#pR_ok").enable();var t=!0;"pChkI"===e||"unChkI"===e?$("#lockSelector").attr("class","chkI"):($("#lockSelector").attr("class","unChkI"),t=!1,B||$("#pR_ok").disable()),$(".user, .group, .org, .linkShare").each(function(){$(this).prop("checked",t),t?$(this).siblings().last().addClass("off"):$(this).siblings().last().removeClass("off")}),$(".user, .group, .org, .linkShare").on("change",a)}function N(e,t,n){if("undefined"==typeof e.lock)var a=!1;else a=e.lock;return T(e.name,parseInt(e.zuid),e.email,a,"zdc-shareuser_icon","user",jsMsg["ProtectRange.UI.Owner"],t,null,e.isSL,n),a}function O(e,t,n,a){var n=A(e[JSONConstants.CO_OWNER_USERS],"zdc-shareuser_icon","user",jsMsg["ProtectRange.UI.CoOwner"],t,null,null,n,a);return n=A(e[JSONConstants.CO_OWNER_GROUPS],"zdc-sharegroup_icon","group",jsMsg["ProtectRange.UI.CoOwner"],t,null,null,n,a),n=A(e[JSONConstants.READ_WRITE_USERS],"zdc-shareuser_icon","user",jsMsg["ProtectRange.UI.ReadWrite"],t,null,null,n,a),n=A(e[JSONConstants.READ_WRITE_GROUPS],"zdc-sharegroup_icon","group",jsMsg["ProtectRange.UI.ReadWrite"],t,null,null,n,a),n=A(e[JSONConstants.READ_WRITE_ORGS],"orgIcon","org",jsMsg["ProtectRange.UI.ReadWrite"],t,null,null,n,a)}function I(e,t,n,a){var s=e[JSONConstants.LINK_SHARE_PERMISSSION],o=!1;if("undefined"!=typeof s){var i=jsMsg["ProtectRange.UI.PublicOnTheWeb"],r="publicIcon";4096===s.shTp&&(i=jsMsg["ProtectRange.UI.PublicOnTheWebPassword"],r="publicProtectIcon",o=!!s.lock);var l=s.isRo?jsMsg["ProtectRange.UI.ReadOnly"]:jsMsg["ProtectRange.UI.ReadWrite"];T(i,-1,i,s.isRo?!0:s.lock,r,"linkShare",l,t,s.isRo,s.isRo?!1:s.isSL,a),"partial"!==n&&n!==o&&(n="partial")}return n}function M(e,t,n){A(e[JSONConstants.READ_ONLY_USERS],"zdc-shareuser_icon","user",jsMsg["ProtectRange.UI.ReadOnly"],t,!0,!0,void 0,n),A(e[JSONConstants.READ_ONLY_GROUPS],"zdc-sharegroup_icon","group",jsMsg["ProtectRange.UI.ReadOnly"],t,!0,!0,void 0,n),A(e[JSONConstants.READ_ONLY_ORGS],"orgIcon","org",jsMsg["ProtectRange.UI.ReadOnly"],t,!0,!0,void 0,n)}function A(e,t,n,a,s,o,i,r,l){if("undefined"!=typeof e)for(var c=0;c<e.length;c++){var g="undefined"==typeof e[c].lock?!1:e[c].lock;if("undefined"==typeof r)var r=g;else"partial"!==r&&r!==g&&(r="partial");var d=i?!1:e[c].isSL;T(e[c].name,parseInt(e[c].zuid),e[c].email,i?!0:g,t,n,a,s,o,d,l)}return r}function T(e,t,n,a,s,o,i,r,l,c,g){var d=$("<tr/>");if("user"===o||"group"===o){var u=PHOTO_SERVER_URL+"/file?fs=thumb&ID="+t;"group"===o&&(u+="&t=group"),d.append($("<td/>").append($("<span/>",{class:"ui-zcollaborator-imgcontainer"}).append($("<img/>",{class:"ui-zcollaborator-img",src:u,style:"border-radius: 100%"}))))}else d.append($("<td/>").append($("<div/>",{class:"lUI"}).append($("<div/>",{class:s}))));var h=$("<div/>",{class:"elipsis uNW",text:e,title:n});zuid===t&&h.append($("<span/>",{text:"  ("+jsMsg["ProtectRange.UI.me"]+")",style:"color:#a9a9a9;padding-left: 5px;"})),d.append($("<td/>",{class:"uPC"}).append(h).append($("<div/>",{text:i,class:"userRole"}))),d.append(c?$("<td/>",{style:"width: 25%;"}).append($("<span/>",{text:jsMsg["ProtectRange.UI.SheetLocked"],class:"lockInfo elipsis"})):$("<td/>",{class:"lUCell"}));var p=g?t+"_"+g:t,f=$("<div></div>"),S=$("<input />"),R=$("<label />"),v=$("<span />");$(v).attr("class",a?"lckRng off":"lckRng"),$(f).addClass("toggleCheckBox"),$(S).attr("id",p),$(S).attr("zid",t).attr("checked",a),$(S).attr("class",o),$(S).attr("type","checkbox"),$(R).attr("for",p),$(f).append(S),$(f).append(R),$(f).append(v),d.append($("<td/>").append(f)),zuid===t?d.prependTo($("#"+r)):d.appendTo($("#"+r))}function _(){return $("table[id^='userListContainer']").hide(),$(".treeExpand").attr("class","treeCollapse"),!1}function D(){return $("table[id^='userListContainer']").show(),$(".treeCollapse").attr("class","treeExpand"),!1}function w(e){"treeExpand"==e.className?($(e).attr("class","treeCollapse"),$(e).next().hide()):($(e).attr("class","treeExpand"),$(e).next().show())}function x(){$.ui.utils.initComponents($("#content")),$.ui.utils.initComponents($("#contentSheet"))}function U(e,t){var n=$("<div/>",{style:"text-align: center; top: 47%; position: relative;",text:t?jsMsg["ProtectRange.UI.NoProtectedSheet"]:jsMsg["ProtectRange.UI.NoProtectedRange"]});e.append(n)}function y(e,t,n,a,s,o,i){for(var r=!1,l=0;l<q.length;l++)if(q[l].pr===e){r=!0,q[l].isAllUnlocked=i,q[l].au=t?t:q[l].au,q[l].uau=n?n:q[l].uau,q[l].ag=a?a:q[l].ag,q[l].ao=s?s:q[l].ao,q[l].isPubA=o?o:q[l].isPubA;break}r||q.push(i?{pr:e,isAllUnlocked:i}:{pr:e,au:t,uau:n,ag:a,ao:s,isPubA:o})}function L(){q=[]}function z(e,t,n,a){for(var s=!1,o=0;o<V.length;o++)if(V[o].tableId===e&&V[o].eleId===t){s=!0;break}s||V.push({tableId:e,eleId:t,prevState:n,pr:a})}function W(){V=[]}function H(e){Y={},e&&(K={})}function J(){return q}function F(e){B=e}function G(){RangeSelector.isActive()&&(Q=ProtectedRanges.getObject().isHighlight()?!1:!0,ProtectedRanges.getObject().getRanges().highlight())}var B=!1,q=[],V=[],K={},Y={},Q=!1;return{getModifiedRanges:J,protectRangeMenu:e,protectSheetMenu:t,showProtectedRangeDialog:n,onDialogSubmit:s,showManageProtectedRangeDialog:o,constructManageProtectRangeDiv:r,constructManageProtectSheetDiv:d,getProtectedSheetsInfo:g,getProtectedRangesInfo:i,saveChangesInManage:R,handleDeletionInManage:E,resetManageDialog:C,refreshManageDialog:k,setLockOption:P,collapseAll:_,expandAll:D,setAlreadyProtected:F,tempHighlight:G,openManageRangeTab:c}}();
var ObjectUtil={isUndefined:function(t){return"undefined"==typeof t}},ZS_Range=function(t,e,i,n,s){this.initialize(t,e,i,n),this.lock=ObjectUtil.isUndefined(s)?!1:s};ZS_Range.prototype={initialize:function(t,e,i,n){this.startRow=t,this.startCol=e,this.endRow=i,this.endCol=n,this.divElement=null},addDivElement:function(t,e,i){null==this.divElement&&0==ObjectUtil.isUndefined(t)?(this.divElement=new ZS_Div(t,this),this.divElement.addElement(e)):i&&(this.divElement.highlight(!0,this.lock,!1,this),this.lock&&this.divElement.lock())},removeDivElement:function(t){null!=this.divElement&&(this.divElement.removeElement(t),t||(this.divElement=null))},getDivElement:function(){return this.divElement},isLock:function(){return this.lock},setLock:function(t){this.lock=t},getStartRow:function(){return this.startRow},getStartCol:function(){return this.startCol},getEndRow:function(){return this.endRow},getEndCol:function(){return this.endCol},setStartRow:function(t){this.startRow=t},setStartCol:function(t){this.startCol=t},setEndRow:function(t){this.endRow=t},setEndCol:function(t){this.endCol=t},reset:function(t,e,i,n){this.initialize(t,e,i,n)},cloneRange:function(){return new ZS_Range(this.getStartRow(),this.getStartCol(),this.getEndRow(),this.getEndCol())},equals:function(t){return this.getStartRow()==t.getStartRow()&&this.getStartCol()==t.getStartCol()&&this.getEndRow()==t.getEndRow()&&this.getEndCol()==t.getEndCol()},intersect:function(t){var e=Math.max(this.getStartRow(),t.getStartRow()),i=Math.max(this.getStartCol(),t.getStartCol()),n=Math.min(this.getEndRow(),t.getEndRow()),s=Math.min(this.getEndCol(),t.getEndCol());return n>=e&&s>=i?new ZS_Range(e,i,n,s):null},isIntersect:function(t){return this.getStartRow()<=t.getEndRow()&&this.getStartCol()<=t.getEndCol()&&this.getEndRow()>=t.getStartRow()&&this.getEndCol()>=t.getStartCol()},isContains:function(t){return this.getStartRow()<=t.getStartRow()&&this.getStartCol()<=t.getStartCol()&&this.getEndRow()>=t.getEndRow()&&this.getEndCol()>=t.getEndCol()},isPartOfRange:function(t){var e=new Range(this.getStartRow(),this.getStartCol(),this.getEndRow(),this.getEndCol()),i=new Range(t.getStartRow(),t.getStartCol(),t.getEndRow(),t.getEndCol());return isPartOfRange(i,e)},isSingleCell:function(){return this.getStartRow()==this.getEndRow()&&this.getStartCol()==this.getEndCol()},isSheet:function(){return 0===this.getStartRow()&&0===this.getStartRow()&&this.getEndRow()===getRowMax()-1&&this.getEndCol()===getColMax()-1},insertRow:function(t,e){var i=!1;t<=this.getStartRow()?(this.startRow+=e,this.endRow+=e,i=!0):t>this.getEndRow()==0&&(this.endRow+=e,i=!0),1==i&&null!=this.divElement&&this.divElement.resizeByRowAction(this.startRow,this.endRow)},deleteRow:function(t,e){var i=!1,n=t+e-1;return this.getEndRow()<=n&&this.getStartRow()>=t?!1:(n<this.getStartRow()?(this.startRow-=e,this.endRow-=e,i=!0):t>this.getEndRow()==0&&(t<this.getStartRow()&&(this.startRow=t),n<=this.getEndRow()?this.endRow-=e:this.endRow=t-1,i=!0),1==i&&null!=this.divElement&&this.divElement.resizeByRowAction(this.startRow,this.endRow),!0)},insertCol:function(t,e){var i=!1;t<=this.getStartCol()?(this.startCol+=e,this.endCol+=e,i=!0):t>this.getEndCol()==0&&(this.endCol+=e,i=!0),1==i&&null!=this.divElement&&this.divElement.resizeByColAction(this.startCol,this.endCol)},deleteCol:function(t,e){var i=!1,n=t+e-1;return n>=this.getEndCol()&&t<=this.getStartCol()?!1:(n<this.getStartCol()?(this.startCol-=e,this.endCol-=e,i=!0):t>this.getEndCol()==0&&(t<this.getStartCol()&&(this.startCol=t),n<=this.getEndCol()?this.endCol-=e:this.endCol=t-1,i=!0),1==i&&null!=this.divElement&&this.divElement.resizeByColAction(this.startCol,this.endCol),!0)},resizeRow:function(t){null!=this.divElement&&t<=this.endRow&&this.divElement.resizeByRowAction(this.startRow,this.endRow)},resizeColumn:function(t){null!=this.divElement&&t<=this.endCol&&this.divElement.resizeByColAction(this.startCol,this.endCol)},freeze:function(){null!=this.divElement&&this.divElement.handleFreeze()},unFreeze:function(){null!=this.divElement&&this.divElement.handleUnfreeze()}};var ZS_Div=function(t,e){this.parentElementId=t,this.elements=[],this.rangeObj=e};ZS_Div.prototype={_addElement:function(t,e,i){var n;ObjectUtil.isUndefined(e)?(n=getObj(this.parentElementId),e=0):n=getObj(this.parentElementId+e),null!=n&&0==ObjectUtil.isUndefined(t)&&null!=t&&(0==ObjectUtil.isUndefined(i)&&1==i&&(t=$(t).clone(!0).get(0)),n.appendChild(t),this.elements[e]=t,this._setPosition(e))},_setPosition:function(t){var e=this._getElementObj(t);if(0==ObjectUtil.isUndefined(e)&&null!=e)if(e.style.top=getRowTop(this.rangeObj.getStartRow())+"px",e.style[isRTL?"right":"left"]=getColLeft(this.rangeObj.getStartCol())+"px",thirdPaneTop||secondPaneLeft){t=parseInt(t);var i=-1*thirdPaneTop+"px",n=-1*secondPaneLeft+"px";switch(t){case 1:e.style[isRTL?"marginRight":"marginLeft"]=0,e.style.marginTop=0;break;case 2:e.style.marginTop=0,e.style[isRTL?"marginRight":"marginLeft"]=n;break;case 3:e.style[isRTL?"marginRight":"marginLeft"]=0,e.style.marginTop=i;break;default:e.style[isRTL?"marginRight":"marginLeft"]=n,e.style.marginTop=i}}else e.style[isRTL?"marginRight":"marginLeft"]=0,e.style.marginTop=0},_getElementObj:function(t){return ObjectUtil.isUndefined(t)&&(t=0),this.elements[t]},_removeElement:function(t,e,i){var n=this.elements[i];if(0==ObjectUtil.isUndefined(n)&&null!=n&&null!=n.parentNode){if(e)return void(n.className="pRH");n.parentNode.removeChild(n)}return 1==t&&(delete n,delete this.elements[i]),n},_resizeHeight:function(t,e){var i=this._getElementObj(e);0==ObjectUtil.isUndefined(i)&&null!=i&&(i.style.height=t,this._setPosition(e))},_resizeWidth:function(t,e){var i=this._getElementObj(e);0==ObjectUtil.isUndefined(i)&&null!=i&&(i.style.width=t,this._setPosition(e))},_lock:function(t){var e=this._getElementObj(t);$(e).addClass("pR")},_highlight:function(t,e,i,n,s){var o=this._getElementObj(s);0==ObjectUtil.isUndefined(o)&&null!=o&&(i||(t?this._addHighlightDiv(o,n):$(o).removeClass("pRH")))},_getNewElement:function(t,e){var i=getColLeft(e.getStartCol()),n=getRowTop(e.getStartRow()),s=getRowTop(e.getEndRow())+getRowHeight(e.getEndRow())-getRowTop(e.getStartRow())-1,o=getColLeft(e.getEndCol())+getColWidth(e.getEndCol())-getColLeft(e.getStartCol())-1,l=document.createElement("SVG");return l.style.position="absolute",l.style.left=i+"px",l.style.top=n+"px",l.style.width=o+"px",l.style.height=s+"px",0==t&&(e.isLock()&&(l.className="pR"),ProtectedRanges.getObject().isHighlight()&&this._addHighlightDiv(l,e)),l},_addHighlightDiv:function(t,e){$(t).addClass("pRH"),$(t).append($("<div/>",{class:"pRHL"}).bind("click",function(){focusCellRange(e.getStartRow(),e.getStartCol(),e.getEndRow(),e.getEndCol(),void 0,!0),protectionDialog.setAlreadyProtected(!0),protectionDialog.showProtectedRangeDialog(!1,!1,e,null,!1)})),isRTL&&$(t).children().css("transform","scaleX(-1)")},_iterateAllElements:function(t,e){var i,n=this.elements.length;for(i=0;n>i;i++)if(null!=this.elements[i]){var s=[];e&&(s=e.slice()),s.push(i),t.apply(this,s)}},_iterateAllObjects:function(t,e){if(0==ISFREEZED)t.apply(this,e);else{var i=!1,n=e.length;(this.rangeObj.getStartRow()>=FREEZED_ROW&&this.rangeObj.getStartCol()>=FREEZED_COL||this.rangeObj.getEndRow()>=FREEZED_ROW&&this.rangeObj.getEndCol()>=FREEZED_COL)&&(t.apply(this,e),i=!0),FREEZED_COL>0&&FREEZED_ROW>0&&this.rangeObj.getStartRow()<FREEZED_ROW&&this.rangeObj.getStartCol()<FREEZED_COL&&(e.splice(n,2,"1",i),t.apply(this,e),i=!0),FREEZED_ROW>0&&this.rangeObj.getStartRow()<FREEZED_ROW&&(0>=FREEZED_COL||FREEZED_COL>0&&this.rangeObj.getEndCol()>=FREEZED_COL)&&(e.splice(n,2,"2",i),t.apply(this,e),i=!0),FREEZED_COL>0&&this.rangeObj.getStartCol()<FREEZED_COL&&(0>=FREEZED_ROW||FREEZED_ROW>0&&this.rangeObj.getEndRow()>=FREEZED_ROW)&&(e.splice(n,2,"3",i),t.apply(this,e))}},handleUnfreeze:function(){var t=this.elements.length;if(null==this.elements[0]){var e,i;for(i=1;t>i;i++)if(null!=this.elements[i]){e=this.elements[i];break}this.removeElement(),this._addElement(e,void 0,!1)}else{for(i=1;t>i;i++)this._removeElement(!0,!1,i);this._setPosition(0)}},handleFreeze:function(){var t=this.rangeObj,e=getSheetPaneIds(t.getStartRow(),t.getStartCol(),t.getEndRow(),t.getEndCol()),i=e.indexOf(0),n=this.elements[0];-1==i?this._removeElement(!0,!1,0):(this._setPosition(0),e.splice(i,1));for(var s=0;s<e.length;s++)this._addElement(n,e[s],!0)},resizeByRowAction:function(t,e){var i=getRowTop(e)+getRowHeight(e)-getRowTop(t)-1;i+="px",this._iterateAllElements(this._resizeHeight,[i])},resizeByColAction:function(t,e){var i=getColLeft(e)+getColWidth(e)-getColLeft(t)-1;i+="px",this._iterateAllElements(this._resizeWidth,[i])},removeElement:function(t){this._iterateAllElements(this._removeElement,[!0,t])},addElement:function(t){var e=this._getNewElement(t,this.rangeObj);this._iterateAllObjects(this._addElement,[e])},lock:function(){this._iterateAllElements(this._lock)},highlight:function(t,e,i,n){this._iterateAllElements(this._highlight,[t,e,i,n])},setPosition:function(){this._iterateAllElements(this._setPosition)}};var ZS_Iterator=function(t,e){ObjectUtil.isUndefined(t)?this.elements=[]:0==ObjectUtil.isUndefined(t.size)||0==ObjectUtil.isUndefined(t.length)?this.elements=t:(this.elements=[],this.elements[0]=t),this.index=0,this.reverseIteration=0==ObjectUtil.isUndefined(e)&&1==e?!0:!1,1==this.reverseIteration&&(this.index=this.size())};ZS_Iterator.prototype={size:function(){return 0==ObjectUtil.isUndefined(this.elements.size)?this.elements.size():0==ObjectUtil.isUndefined(this.elements.length)?this.elements.length:0},hasNext:function(){return 0!=this.size()&&(0==this.reverseIteration?this.index<this.size():this.index>0)},next:function(){return 0==this.reverseIteration?this.elements[this.index++]:this.elements[--index]},reset:function(){this.index=0==this.reverseIteration?0:this.size()},skip:function(t){0==this.reverseIteration?(this.index+=t,this.index>this.size()&&(this.index=this.size())):(this.index-=t,this.index<0&&(this.index=0))},move:function(t){t>=0&&t<this.size()&&(this.index=t)},nextIndex:function(){return this.index},removeLastIteratedElement:function(){var t=0==this.reverseIteration?this.index-1:this.index;t>=0&&t<this.size()&&this.elements.splice(t,1)}};var ZS_RangeList=function(t,e,i){this.list=[],0==ObjectUtil.isUndefined(t)&&(this.parentElementId=t),0==ObjectUtil.isUndefined(i)&&(this.type=i),this.manageDivElements=0==ObjectUtil.isUndefined(e)?e:!1};ZS_RangeList.prototype={initialize:function(t){if(this.clearList(),0==ObjectUtil.isUndefined(t))for(var e,i=new ZS_Iterator(t);i.hasNext();)e=this.getRangeFromJson(i.next()),this.addRangeInList(e)},addRangeInList:function(t){this.list.push(t),this.addElement(t)},addElement:function(t,e){1!=this.manageDivElements||1!=t.isLock()&&!ProtectedRanges.getObject().isHighlight()||t.addDivElement(this.parentElementId,this.type,e)},getRangeFromJson:function(t){return new ZS_Range(t[JSONConstants.START_ROW],t[JSONConstants.START_COLUMN],t[JSONConstants.END_ROW],t[JSONConstants.END_COLUMN],t[JSONConstants.LOCK])},getRangeFromObject:function(t,e,i,n,s){return new ZS_Range(t,e,i,n,s)},clearList:function(){if(1==this.manageDivElements&&0==ObjectUtil.isUndefined(this.list))for(var t,e=new ZS_Iterator(this.list);e.hasNext();)t=e.next(),t.removeDivElement(),t=null;this.list=[]},reset:function(t){ObjectUtil.isUndefined(t)?this.clearList():this.initialize(t)},add:function(t){return 0==ObjectUtil.isUndefined(t)?(this.addRangeInList(t),!0):!1},addAll:function(t){for(var e=new ZS_Iterator(t.list),i=null;e.hasNext();)i=e.next(),null!=i&&0==ObjectUtil.isUndefined(i)&&this.addRangeInList(i)},remove:function(t){if(!ObjectUtil.isUndefined(t)&&t>=0&&t<this.size()){var e=this.list[t];return 1==this.manageDivElements&&e.removeDivElement(),this.list.splice(t,1),e}return null},removeRange:function(t){for(var e,i=null,n=null,s=new ZS_Iterator(this.list),o=this.size();s.hasNext()&&s.nextIndex()<o;)if(i=s.next(),!ObjectUtil.isUndefined(i)){if(e=s.nextIndex()-1,i.equals(t)){this.remove(e);break}n=i.intersect(t),null!=n&&(0==n.equals(i)&&(i.getStartRow()<n.getStartRow()&&(this.addRangeInList(this.getRangeFromObject(i.getStartRow(),i.getStartCol(),n.getStartRow()-1,i.getEndCol(),i.isLock())),i.setStartRow(n.getStartRow())),i.getStartCol()<n.getStartCol()&&(this.addRangeInList(this.getRangeFromObject(i.getStartRow(),i.getStartCol(),i.getEndRow(),n.getStartCol()-1,i.isLock())),i.setStartCol(n.getStartCol())),i.getEndRow()>n.getEndRow()&&(this.addRangeInList(this.getRangeFromObject(n.getEndRow()+1,i.getStartCol(),i.getEndRow(),i.getEndCol(),i.isLock())),i.setEndRow(n.getEndRow())),i.getEndCol()>n.getEndCol()&&this.addRangeInList(this.getRangeFromObject(i.getStartRow(),n.getEndCol()+1,i.getEndRow(),i.getEndCol(),i.isLock()))),this.remove(e),s.move(s.nextIndex()-1),o-=1)}},size:function(){return this.list.length},isEmpty:function(){return 0==this.size()},getRange:function(t){return!ObjectUtil.isUndefined(t)&&t<=this.size()?this.list[t]:null},getIterator:function(){return new ZS_Iterator(this.list)},getActualRangeObject:function(t){var e=this.find(t);return-1!=e?this.list[e]:null},getIntersectedRanges:function(t){var e=new ZS_RangeList;if(ObjectUtil.isUndefined(t))return!1;for(var i=new ZS_Iterator(this.list),n=null,s=null,o=!1;0==o&&i.hasNext();)n=i.next(),ObjectUtil.isUndefined(n)||null==n||(s=n.intersect(t),null!=s&&e.add(n));return e},isIntersect:function(t){if(ObjectUtil.isUndefined(t))return!1;for(var e=new ZS_Iterator(this.list),i=null,n=!1;0==n&&e.hasNext();)i=e.next(),ObjectUtil.isUndefined(i)||null==i||(n=i.isIntersect(t));return n},find:function(t){var e=-1;if(ObjectUtil.isUndefined(t))return e;for(var i=null,n=new ZS_Iterator(this.list);-1==e&&n.hasNext();)i=n.next(),ObjectUtil.isUndefined(i)||null==i||(e=i.equals(t)?n.nextIndex()-1:-1);return e},applyMethod:function(t,e){for(var i=null,n=new ZS_Iterator(this.list);n.hasNext();)i=n.next(),ObjectUtil.isUndefined(i)||null==i||t.apply(i,e)},callMethodByParam:function(t,e){for(var i=null,n=new ZS_Iterator(this.list);n.hasNext();)i=n.next(),ObjectUtil.isUndefined(i)||null==i||t.call({},i,e)},iterateRangeMethods:function(t,e,i){for(var n=null,s=new ZS_Iterator(this.list);s.hasNext();)if(n=s.next(),!ObjectUtil.isUndefined(n)&&null!=n){var o=t.apply(n,e);0==ObjectUtil.isUndefined(i)&&i.call({},o,n)}},shiftCells:function(t,e,i,n,s,o){var l=n-e+1,r=e,h=t,a=h+(i-t),g=getColMax()-1;s&&(l=i-t+1,r=t,h=e,a=h+(n-e),g=getRowMax()-1);var d=r+l-1;l=o?-l:l;for(var c=new ZS_Iterator(this.list);c.hasNext();){var u=c.next(),f=c.nextIndex()-1,E=s?u.getStartRow():u.getStartCol(),R=s?u.getEndRow():u.getEndCol(),m=s?u.getStartCol():u.getStartRow(),S=s?u.getEndCol():u.getEndRow();if(E>=r&&m>=h&&a>=S){var v=E+l;if(o?d>=R:v>g)this.remove(f);else{var C=Math.min(R+l,g);u.setStartRow(s?v:m),u.setStartCol(s?m:v),u.setEndRow(s?C:S),u.setEndCol(s?S:C),u.getDivElement()&&u.getDivElement().setPosition()}}}},highlight:function(){for(var t,e=this.getIterator();e.hasNext();)t=e.next(),(ObjectUtil.isUndefined(t.getDivElement())||null==t.getDivElement())&&t.addDivElement(this.parentElementId,this.type),t.getDivElement().highlight(!0,t.lock,t.isSheet(),t)},removeHighlight:function(){var t,e=this.getIterator();for($(".pRHL").remove();e.hasNext();)t=e.next(),0==t.isLock()?t.removeDivElement():t.getDivElement().highlight(!1,!0,t.isSheet(),t)}};var ZS_ProtectedSheetList=function(){this.list=[]};ZS_ProtectedSheetList.prototype={initialize:function(t){this.removeAll();for(var e=new ZS_Iterator(t);e.hasNext();)this.add(ZS_ProtectedSheet.getSheetObj(e.next()))},getIterator:function(){return new ZS_Iterator(this.list)},getSheetObj:function(t){for(var e,i=this.getIterator();i.hasNext();)if(e=i.next(),e.getName()==t)return e;return null},isSheetProtected:function(t){var e=this.getSheetObj(t);return null!=e&&e.isLock()},add:function(t){for(var e=this.getIterator(),i=!1;e.hasNext();)tempSheetObj=e.next(),tempSheetObj.getName()===t.name&&(tempSheetObj=t,i=!0);i||this.list.push(t),t.lockSheetTab()},remove:function(t){for(var e,i=this.getIterator(),n=-1;i.hasNext();)if(e=i.next(),e.getName()==t){e.unlockSheetTab(),n=i.nextIndex()-1;break}-1!=n&&(this.list[n]=null,this.list.splice(n,1))},removeAll:function(){for(var t=this.getIterator();t.hasNext();)t.next().unlockSheetTab();this.list=[]},renameSheet:function(t,e){var i=this.getSheetObj(t);null!=i&&(i.setName(e),i.lockSheetTab())},deleteSheet:function(t){for(var e,i=this.getIterator();i.hasNext();)e=i.next(),e.getName()===t&&i.removeLastIteratedElement()},highlight:function(){for(var t=this.getIterator();t.hasNext();){var e=t.next();e.highlight()}},removeHighlight:function(){for(var t=this.getIterator();t.hasNext();){var e=t.next();e.removeHighlight()}}};var ZS_ProtectedSheet=function(t,e,i){this.name=t,this.lock=e,this.position=i};ZS_ProtectedSheet.prototype={lockSheetTab:function(){if(this.lock){var t=WorkSheets.getSheetObjByName(this.name);void 0!=t&&t.find("img.sheetLock").length&&t.children("div:first").prepend($("<img/>",{src:IMAGE_PATH+"spacer.gif",class:"sheetLock"})),CURRSHEETNAME===this.name&&(READ_WRITE=!1,mask.grid(!0,!1,!1,!0),menutabs.protectionBasedToggle(!0))}ProtectedRanges.getObject().isHighlight()&&this.highlight()},unlockSheetTab:function(t){var e=WorkSheets.getSheetObjByName(this.name);void 0!=e&&e.find("img.sheetLock").remove(),CURRSHEETNAME===this.name&&(READ_WRITE=!0,mask.grid(!1),menutabs.protectionBasedToggle(!1)),ProtectedRanges.getObject().isHighlight()&&!t&&this.removeHighlight()},isLock:function(){return this.lock},setLock:function(t){this.lock=t},setName:function(t){this.name=t},getName:function(){return this.name},highlight:function(){var t=WorkSheets.getSheetObjByName(this.name);t.addClass("pSH")},removeHighlight:function(){WorkSheets.getSheetObjByName(this.name).removeClass("pSH")}},ZS_ProtectedSheet.getSheetObj=function(t){return new ZS_ProtectedSheet(t[JSONConstants.SHEET_NAME],t[JSONConstants.LOCK],t[JSONConstants.POSITION])},ZS_ProtectedSheet.getSheetImgTag=function(){return"<img src='"+IMAGE_PATH+"spacer.gif' class='sheetLock'>"};
var checkbox=function(e){function t(t,n){n="undefined"==typeof n?t.getAttribute("cv"):n;var r="TRUE"===n?!0:!1;if(i(t))e(t).find(".cBC input").attr("checked",r);else{setCellContent(t,"");var c=(t.className,e("<label/>",{class:"cBC"}).append(e("<input/>",{type:"checkbox",checked:r}).after(e("<span/>")))),o=getCellContentNode(t);e(o).append(c);var l=getCSSStyleRegex("textAlign");addCssStyleValueForCell(t,"textAlign"," tac",l),l=getCSSStyleRegex("verticalAlign"),addCssStyleValueForCell(t,"verticalAlign"," vam",l),f||(a(),f=!0)}t.setAttribute("fn",n),t==currCell&&(exprField.value=n)}function n(e,t,n,a){var r=new Range(e,t,n,a),c=r.getIterator();c.iterate(function(e,t){new Cell(e,t).executeMethod(checkbox.add)})}function a(){e("#editorDIV").on("mousedown",".cBC",function(e){c(e.target.parentElement)})}function r(e){var t;"T"===e||"t"===e||"Y"===e||"y"===e||"1"===e?t=!0:"F"===e||"f"===e||"N"===e||"n"===e||"0"===e?t=!1:" "===e&&(t=!l()),"undefined"!=typeof t&&s(ActionConstants.CHECKBOX_EDIT,t?1:0)}function c(t){if(READ_WRITE&&documentBakeStatus.isBaked()){var n=getServerRange();if(ProtectedRanges.isRangeLocked(n.startRow,n.startCol,n.endRow,n.endCol))return!1;t.click(),s(ActionConstants.CHECKBOX_EDIT,e(t).find("input").is(":checked")?1:0)}}function i(t){return"undefined"==typeof t&&(t=currCell),1===e(t).find(".cBC").length}function o(t){return e(t).find(".cBC")}function l(t){return"undefined"==typeof t&&(t=currCell),e(t).find(".cBC input").is(":checked")}function s(e,t){var n=getServerRange(),a=n.startRow,r=n.startCol,c=n.endRow,i=n.endCol;if(ProtectedRanges.isRangeLocked(a,r,c,i))return!1;var o=new RequestParameters(1*e);o.setParameters(WorkSheets.getSheetCodeFromName(CURRSHEETNAME),a,r,c,i,t);var l=new AjaxRequest;l.init("POST",o.getURL(),!0,o.getParametersAsString()),actionManager.addRequest(l)}function d(e){var t=e.parentElement;return t?"cBC"===t.className:!1}function u(e){if(i(e)){var t=e.className,n=t.replace(" tac","").replace("vam",""),a=/( (fa|ta)[rc])(\b)/i;a.test(n)||-1!=n.indexOf(" W")||removeFlexBoxDiv(e),e.className=n}}var f=!1;return{add:t,addToRange:n,edit:r,toggle:c,isPresent:i,isOwnDiv:d,getFromCell:o,sendRequest:s,clear:u}}(jQuery);
var Goto=function(e){var t,n,o,l,a=[],s=-1,r=!1,f=!1,c=function(){a=NamedRange.getNamedRangesList(),a=a.sort()},u=function(){c();var t={width:"300px",title:jsMsg.Goto},n={init:function(){d(),g(),setTimeout(function(){e("#cellRef").focus()},200)}};sheetdialog.open("gotodialog",t,n)},d=function(){var t="style='padding:3px'",n="";if(0!=a.length){for(i=0;i<a.length;i++){var o=a[i];n+="<div id='definedNameTR_"+i+"' "+t+" onclick=\"Goto.gotoCellInit('"+o+"', 'NAME')\" title='"+o+"'>"+o+"</div>"}e("#nameListDIV").append(n),e("#nameContainerDIV").show()}},g=function(){e("#cellRef").on("keyup",function(e){v(e,this)}),e("#cellRef").on("keydown",function(e){if(browser_ie){var t=window.event.keyCode;13===t&&e.preventDefault()}}),e("#name_createBtn").on("click",function(){p(void 0,"CELLVALUE")})},C=function(t){var n=t?currCellIndicator.value.trim().toUpperCase():e("#cellRef").val().trim().toUpperCase();a.length||c();for(var o=0,l=0;l<a.length;l++){var i=e(t?"#defNameTR_"+l:"#definedNameTR_"+l);0!=a[l].toUpperCase().indexOf(n)?i.hide():(o++,i.show())}var s=e("#nameListDIV");s.length&&(0==o?s.hide():s.show())},v=function(t,n){var o=t.which;if(13===o){if(null!==e("#cellRef").val()&&0===e("#cellRef").val().trim().length)return;p(void 0,"CELLVALUE")}else h(n),C()},h=function(t){var n=e(t).val();n.trim()?e("#name_createBtn").enable():e("#name_createBtn").disable()},p=function(e,t){if(e||t)switch(t){case"CELLVALUE":R(e);break;case"LABEL":N(e);break;case"NAME":E(e);break;case"PARAM":m(e);break;default:R(e)}else{if(f)return f=!1,appEvent.preventDefault();if(r)return b(l),D(),r=!1,appEvent.preventDefault()}},R=function(t){var n=e("#cellRef"),o=t?t:n.val().trim();o=o.replace(/\$/g,"").replace(".","!"),m(o)},m=function(e){var t=e;if(-1!=t.indexOf("!")&&(t=t.substring(t.indexOf("!")+1,t.length)),CellUtils.isDefinedName(t))return E(t),!1;CellUtils.isDefinedSheet(e)&&(e+="!A1");var n=e.substring(0,e.indexOf("!"));return n&&!CellUtils.isDefinedSheet(n)?(showAlertDialog(jsMsg.InvalidSheetName),!1):void(CellUtils.checkCellLbl(e)?N(e):showAlertDialog(jsMsg.InvalidCellReference))},E=function(e){var l,i=!1;if(l=NamedRange.getNamedRangeInfo(e,"REFSHEET"),i=NamedRange.isNamedRange(e))if(l){var a=NamedRange.getRange(e);l=a.sheetName,s=a.startRow,t=a.startCol,n=a.endRow,o=a.endCol,L(l)}else{var r=ActiveCellInfo,f=new RequestParameters(ActionConstants.NAMEDRANGE_READ);f.setParameters(WorkSheets.getAssociatedActiveSheetName(),e,r.getStartRow(),r.getStartCol());var c=new AjaxRequest;c.init("POST",f.getURL(),!0,f.getParametersAsString()),c.addEventListener("onComplete",function(e){w(e,l)}),c.sendRequest()}},w=function(e,l){var i=parseJSON(e.responseText);l=i.sn,s=i.sr,t=i.sc,n=i.er,o=i.ec,L(l)},N=function(e){l=e,l=l.replace(".","!");var t=!0,n=CURRSHEETNAME;return-1!=l.indexOf("!")&&(n=l.substring(0,l.indexOf("!")),n=CellUtils.getRequiredSheetNames(n).sheetName,l=l.substring(l.indexOf("!")+1,l.length),t=!1),n!=CURRSHEETNAME||b(l)?(l.indexOf(":")>0&&getDataFrom2DRangeText(l)&&k(l),void(t||n===CURRSHEETNAME?D():(workbookData.switchSheet=!0,r=!0,showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(n),"open")))):!1},S=function(e,t){return e=parseInt(e),t=parseInt(t),t>totCols?(showAlertDialog(jsMsg.NotYetCreatedCell),!1):(Row.isAppendable(e)&&appendBlankRows("ROWS_EXCEEDED",e+1),isCustomScroll=!0,scrollRowIntoView(e),scrollColIntoView(t),!0)},b=function(e){var t,n=e;if(n.indexOf(":")>0){var o=n.substring(0,n.indexOf(":"));t=CellUtils.getCellPosByLabel(o)}else t=CellUtils.getCellPosByLabel(n);if(t.col>totCols-1){showAlertDialog(jsMsg.NotYetCreatedCell);var l=getObj("cellRef");return null!=l&&(l.focus(),l.select()),!1}return!0},A=function(e,l,i,a,r,c,u){s=l,t=a,n=i,o=r,f=c||u,e!=CURRSHEETNAME&&CellUtils.isDefinedSheet(e)?(showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open",!1,c),appEvent.on("book.sheetloaded",U)):D()},D=function(){null!=getObj("cellRef")&&getObj("cellRef").blur();var e=getRowMax(),i=getColMax();if(-1==s){var a=CellUtils.getCellPosByLabel(l);a.row>=e&&(a.row=e-1),a.col>=i&&(a.col=i-1),sheetdialog.allowToClose&&sheetdialog.close(),isCustomScroll=!0,focusCell(a.row,a.col)}else s>=e&&(s=e-1),n>=e&&(n=e-1),t>=i&&(t=i-1),o>=i&&(o=i-1),sheetdialog.allowToClose&&sheetdialog.close(),s==n&&t==o?(isCustomScroll=!0,focusCell(parseInt(s),parseInt(t))):(isCustomScroll=!0,focusCellRange(parseInt(n),parseInt(o),parseInt(s),parseInt(t))),s=-1,t=n=o=0;appEvent.trigger("onGotoDone")},L=function(e){e&&(0==e.indexOf("'")&&(e=e.substring(1,e.length-1)),""!=e&&CellUtils.isDefinedSheet(e)?e!=CURRSHEETNAME?(showsheet("sheetdiv-"+WorkSheets.getSheetCodeFromName(e),"open"),appEvent.on("book.sheetloaded",U)):D():sheetdialog.close())},U=function(){D(),appEvent.off("book.sheetloaded",U)},k=function(e,l){var i=e.split(":"),a=CellUtils.getCellPosByLabel(i[0]),r=CellUtils.getCellPosByLabel(i[1]);if(a.col<0||r.col<0){var f=getDataFrom2DRangeText(e);if(void 0==f)return!1;a={},r={},a.row=f.sR,a.col=f.sC,r.row=f.eR,r.col=f.eC}return"undefined"==typeof l&&(s=a.row,t=a.col,n=r.row,o=r.col),!0},I=function(){return l},x=function(){return r},O=function(){return r?!0:!1};return appEvent.on("grid.afterload",function(){return p()}),appEvent.on("goto.focused",function(){return p()}),appEvent.on("goto.fromdialog",function(){return x()}),appEvent.on("goto.getLbl",function(){return I()}),{showDialog:u,suggestNamedRanges:C,gotoCellInit:p,doGoto:A,gotoCellPosition:S,isPreventDefault:O,getLbl:I}}(jQuery);
function flipSheet(e){if(prevSheetStyle=isRTL,translateViewId($(e).attr("id"))!=prevSheetStyle){isRTL=!isRTL;var t=new RequestParameters(ActionConstants.SAVE_RTL_SHEET);t.setParameters(WorkSheets.getAssociatedActiveSheetName(),isRTL);var s=new AjaxRequest;s.init("POST",t.getURL(),!0,t.getParametersAsString()),actionManager.addRequest(s),changeAlignIcon(),toggleCellInsertOption(),setSheetDirectionLabel()}}function flipColHeaders(){for(var e=document.getElementById("cHT").children,t=0;t<e.length;t++)isRTL?(e[t].style.right=e[t].style.left,e[t].style.left=null,document.getElementsByClassName("selectAllBg")[0].style.right="23px",document.getElementsByClassName("selectAllBg")[0].style.transform="scaleX(-1)"):(e[t].style.left=e[t].style.right,e[t].style.right=null,document.getElementsByClassName("selectAllBg")[0].style.right="",document.getElementsByClassName("selectAllBg")[0].style.left="23px",document.getElementsByClassName("selectAllBg")[0].style.transform="")}function toggleWritingDirection(){$("#sheetDir").attr("checked",!$("#sheetDir").is(":checked"))}function toggleCellInsertOption(){isRTL?($("#cellOptMenus > #insertLeft").hide(),$("#cellOptMenus > #insertRight").show(),$("#cellOptMenus > #deleteRight").hide(),$("#cellOptMenus > #deleteLeft").show(),$("#insertCellSub > #insertLeft").hide(),$("#insertCellSub > #insertRight").show()):($("#cellOptMenus > #insertRight").hide(),$("#cellOptMenus > #insertLeft").show(),$("#cellOptMenus > #deleteLeft").hide(),$("#cellOptMenus > #deleteRight").show(),$("#insertCellSub > #insertLeft").show(),$("#insertCellSub > #insertRight").hide())}function getOffsetRight(e){for(var t=e.offsetWidth,s=0;e.offsetParent;)s+=e.offsetLeft,e=e.offsetParent;return s+=e.offsetLeft,s=clientDim.width-s,s-=t}function setSheetDirectionLabel(){var e=$("#shtDirectbtn").children();isRTL?($("#rtls").addClass("ui-state-active"),$("#ltrs").removeClass("ui-state-active"),0!=e.length&&(e[1].innerHTML=jsMsg["View.SheetDirection.Rtl"],$(e[0]).removeClass(" zicon-ltr"),$(e[0]).addClass(" zicon-rtl")),$(".zsicon-freeze-first-column").addClass("scaleX"),$(".zsicon-freeze-panes").addClass("scaleX"),$(".zsicon-merge-across").addClass("scaleX")):($("#ltrs").addClass("ui-state-active"),$("#rtls").removeClass("ui-state-active"),0!=e.length&&(e[1].innerHTML=jsMsg["View.SheetDirection.Ltr"],$(e[0]).addClass(" zicon-ltr"),$(e[0]).removeClass(" zicon-rtl")),$(".zsicon-freeze-first-column").removeClass("scaleX"),$(".zsicon-freeze-panes").removeClass("scaleX"),$(".zsicon-merge-across").removeClass("scaleX"))}function translateViewId(e){var t=null;return"ltrs"==e?t=!1:"rtls"==e&&(t=!0),t}var RTL={dirRtl:!1};Object.defineProperty(window,"isRTL",{set:function(e){RTL.dirRtl=e},get:function(){return RTL.dirRtl}}),appEvent.on("book.onaftersheetswitch",setSheetDirectionLabel);
!function(){function e(e,l,t){var n=getCell(e,l);n&&(n.style.zIndex=t,n.style.overflow="visible")}var l=4,t=3,n=3,o=0,a=[],r=0,E=!1;appEvent.on("cell.setZIndex",function(e,l,t){void 0==Merge.getCellInfo(l,t)||Merge.isCovered(l,t-1)?e.style.zIndex=l%ROWS_PER_TILE*256+(t+4):(e.style.zIndex=260,e.style.overflow="hidden")}),appEvent.on("setIndex",function(e){r=e%ROWS_PER_TILE,n=256*r+t,a[e]=[]}),appEvent.on("cell.construct.setProperty",function(e,t,E,g,i){if(0===getAvailableStartRow()&&(o=E),o=FREEZED_ROW>0&&FREEZED_ROW>E?E:E-getAvailableStartRow(),!i||void 0===i[7]&&void 0===i[5])e.style.zIndex=n,a[E]?a[E][t]=n:(a[E]=[],a[E][t]=n);else{var R=t+l+256*r;e.style.zIndex=R,n=R-1,a[E]?a[E][t]=R:(a[E]=[],a[E][t]=R)}}),appEvent.on("cell.setcontent",function(e,t,n,o,r,g){var i=getColMax(),R=0,v=e.className.indexOf("nW");if(g&&(E=g),R=FREEZED_ROW>0&&FREEZED_ROW>t?t:t-getAvailableStartRow(),""!==r||"'"===getCellFormula(e)||""===r&&""!==getCellFormula(e)){if(void 0===Merge.getCellInfo(t,n)){var C=e.style.zIndex,d=n+l+t%ROWS_PER_TILE*i;e.style.zIndex=d,v>0&&(e.style.overflow="visible"),a[t][n]=d;for(var f=n+1;o>f&&C>=a[t][f];f++)getCell(t,f).style.zIndex=d-1,a[t][f]=d-1}void 0!==Merge.getCellInfo(t,n)&&(e.style.zIndex=260,e.style.overflow="hidden")}else if(void 0===Merge.getCellInfo(t,n)){var C=a[t][n];if(v>0&&(e.style.overflow="visible"),C)a[t][n-1]===C+1||a[t][n-1]===C-1?(e.style.zIndex=n-1+l+t%ROWS_PER_TILE*i-1,a[t][n]=n-1+l+t%ROWS_PER_TILE*i-1):void 0===Merge.getCellInfo(t,n-1)?(e.style.zIndex=a[t][n-1],a[t][n]=a[t][n-1]):(e.style.zIndex=n+l,a[t][n]=n+l);else if(n-1>0){var s=getCell(t,n-1),I=s.style.zIndex;""!=getCellContent(s)||"'"==getCellContent(s)||void 0!=Merge.getCellInfo(t,n-1)?(e.style.zIndex=I-1,a[t][n]=I-1):(e.style.zIndex=I,a[t][n]=I)}else e.style.zIndex=3,a[t][n]=3;for(var f=n+1;o>f&&C>=a[t][f];f++)getCell(t,f).style.zIndex=a[t][n],a[t][f]=a[t][n]}}),appEvent.on("range.clearcontent",function(n,o,r,E,g){var i,R,v,C=getColMax(),d=new Range(n,o,r,g-1),f=d.getIterator();f.addEventListener("onRowBefore",function(e){var n=0;n=FREEZED_ROW>0&&FREEZED_ROW>e?e:e-getAvailableStartRow(),R=a[e][E],i=e%ROWS_PER_TILE*C+t,v=o+l+e%ROWS_PER_TILE*C,0!==o&&(i=a[e][o-1])}),f.iterate(function(n,r){var d=0;d=FREEZED_ROW>0&&FREEZED_ROW>n?n:n-getAvailableStartRow(),E+1>r?a[n][o]===i+1||a[n][o]===i-1?i!==n%ROWS_PER_TILE*C+t?(e(n,r,i-1),a[n][r]=i-1):(e(n,r,i),a[n][r]=i):0===o||void 0===Merge.getCellInfo(n,o-1)?(null!==getCell(n,r)&&null!==getCell(n,r-1)&&(e(n,r,i),a[n][r]=i),0===r&&(e(n,r,i),a[n][r]=i)):r===o?(e(n,o,v),a[n][r]=r+l+n%ROWS_PER_TILE*C):(e(n,r,v-1),a[n][r]=v-1):R>=a[n][r]&&void 0===Merge.getCellInfo(n,r)?(e(n,r,a[n][o]),a[n][r]=a[n][o]):f._skipColumn(g-1-r)})}),appEvent.on("grid.insertCol",function(n,o){var r,E,g=getColMax(),i=0;E=0!==n?n-1:n;var R=new Range(getAvailableStartRow(),0,getAvailableEndRow(),o-1),v=R.getIterator(),C=Row.getAvailableRowsInFrozenRange(FREEZED_ROW),d=C.length,f=(C[d-1],new Range(0,0,FREEZED_ROW-1,o-1)),s=f.getIterator();s.addEventListener("onRowBefore",function(){r=a[freezedrw][0],freezedrw=Row.findNextNonHiddenRow(freezedrw)}),v.iterate(function(o,E){if(n-1>=E)r<a[i][E]&&(r=a[i][E]);else if(0!==n&&void 0===Merge.getCellInfo(o,E)&&Merge.getCellInfo(o,E-1))e(o,E,E+l+o%ROWS_PER_TILE*g),a[i][E]=E+l+o%ROWS_PER_TILE*g,r=E+l+o%ROWS_PER_TILE*g;else if(""===getCellContent(getCell(o,E))&&"'"!==getCellFormula(getCell(o,E)))if(r!==o%ROWS_PER_TILE*g+t){var R=getCell(o,E);null!==R&&(R.style.zIndex=r-1,a[o][E]=r-1)}else{var R=getCell(o,E);null!==R&&(R.style.zIndex=r,a[o][E]=r)}else{var R=getCell(o,E);null!==R&&(getCell(o,E).style.zIndex=E+l+o%ROWS_PER_TILE*g,a[i][E]=E+l+o%ROWS_PER_TILE*g,r=E+l+o%ROWS_PER_TILE*g)}})}),appEvent.on("cell.merge.add",function(t,n,o,r){var E=getColMax(),g=new Range(t,n,o,getAvailableEndCol()),i=g.getIterator();i.iterate(function(t,n){var o=0;if(o=FREEZED_ROW>0&&FREEZED_ROW>t?t:t-getAvailableStartRow(),r>=n){var g=getCell(t,n);null!==g&&(g.style.overflow="hidden")}else if(n===r+1)e(t,r+1,r+1+l+t%ROWS_PER_TILE*E),a[t][r+1]=r+1+l+t%ROWS_PER_TILE*E,void 0!=Merge.getCellInfo(t,n)&&(getCell(t,n).style.overflow="hidden");else if(n+l+t%ROWS_PER_TILE*E>a[t][n])if(void 0===Merge.getCellInfo(t,n)){var R=r+1+l+t%ROWS_PER_TILE*E-1;e(t,n,R),a[t][n]=R}else getCell(t,n).style.overflow="hidden";else i._skipColumn(getAvailableEndCol()-n)})}),appEvent.on("cell.merge.remove",function(e,l,t,n){var o,r=new Range(e,l,t,getAvailableEndCol()),E=r.getIterator();E.addEventListener("onRowBefore",function(e){var l=0;l=FREEZED_ROW>0&&FREEZED_ROW>e?e:e-getAvailableStartRow(),a[l]&&(o=a[l][n+1])}),E.iterate(function(e,t){var r=0;if(r=FREEZED_ROW>0&&FREEZED_ROW>e?e:e-getAvailableStartRow(),n>=t){var E=getCell(e,t);null!==E&&(E.style.overflow="visible",""===getCellContent(getCell(e,l))&&"'"!==getCellFormula(getCell(e,l))||t===l||(E.style.zIndex=a[r][l]-1,a[r][t]=a[r][l]-1))}else if(""===getCellContent(getCell(e,n+1))&&"'"!==getCellFormula(getCell(e,n+1)))if(t===n+1){var E=getCell(e,n+1);null!==E&&(E.style.zIndex=a[e][n],a[e][n+1]=a[e][n])}else if(o>=a[e][t]){var E=getCell(e,t);null!==E&&(E.style.zIndex=a[e][n],a[e][t]=a[e][n])}})}),appEvent.on("grid.merge.removeDOM",function(e,l,t){var n=0;if(n=FREEZED_ROW>0&&FREEZED_ROW>e?e:e-getAvailableStartRow(),a[e]){var o=a[e][l];if(!getCellContent(t)){var r=getCell(e,l);null!==r&&(a[e][l-1]===o?(r.style.zIndex=a[e][l-1],a[e][l]=a[e][l-1]):(r.style.zIndex=a[e][l-1]-1,a[e][l]=a[e][l-1]-1))}}}),appEvent.on("protectRange.apply",function(e,t,n){setTimeout(function(){var o=new Range(e,t,n,getAvailableEndCol()),r=o.getIterator();if(0!==t){var E=3;r.addEventListener("onRowBefore",function(){E=3}),r.iterate(function(e,n){var o=0;if(o=FREEZED_ROW>0&&FREEZED_ROW>e?e:e-getAvailableStartRow(),n===t)getCell(e,n).style.zIndex=n+l,a[o][n]=n+l,E=n+l-1;else{var g=getCell(e,n);""!==getCellContent(g)||"'"==getCellContent(g)||void 0!=Merge.getCellInfo(e,n)?r._skipColumn(getAvailableEndCol()-n):(g.style.zIndex=E,a[o][n]=E)}})}},100)}),appEvent.on("protectRange.remove",function(e,l,t){var o=new Range(e,l,t,getAvailableEndCol()),r=o.getIterator();if(0!==l){var E=3;r.addEventListener("onRowBefore",function(e,l){E=""!==getCellContent(getCell(e,l))||"'"==getCellContent(getCell(e,l))?a[e][l-1]:a[e][l-1]-1}),r.iterate(function(e,l){var t=getCell(e,l);rowVal=FREEZED_ROW>0&&FREEZED_ROW>e?e:e-getAvailableStartRow(),""!==getCellContent(t)||"'"==getCellContent(t)||void 0!=Merge.getCellInfo(e,l)||void 0!=Merge.getCellInfo(e,l-1)||ProtectedRanges.isCellLocked(e,l,!0)?r._skipColumn(getAvailableEndCol()-l):(t.style.zIndex=E,a[rowVal][l]=n)})}})}();
function removeXTileIfExcessThanViewPort(e,t,l){var a=getRowRangeToRemove(e),o=a.firstRow,n=a.endRow;n-o>=0&&(FREEZED_ROW>0&&o>=FREEZED_ROW&&n>=FREEZED_ROW||0===FREEZED_ROW)&&removeXTiles(o,n,e,t,l),void 0==o&&("SCROLLDOWN"==e&&(availableStartRow=findRowInYPos(getSheetScrollTop()-getSheetHeight())),"SCROLLUP"==e&&(availableEndRow=findRowInYPos(getSheetScrollTop()+2*getSheetHeight())))}function removeXTiles(e,t,l,a,o,n,r){if(-1!=t||-1!=e){var i=Row.getAvailableRowsInRange(e,t,!0),s=i.length;if(s>0){if(a)sheetTable.innerHTML="",(isColsOnlyFreezed||isColsAndRowsFreezed)&&(sheetTable3.innerHTML="");else switch(l){case"SCROLLUP":var d=s/ROWS_PER_TILE;removeSheetTableTiles(d,l),(isColsOnlyFreezed||isColsAndRowsFreezed)&&removeSheetTableTiles(d,l,sheetPane3Id);break;case"SCROLLDOWN":var d=s/ROWS_PER_TILE;o&&(d=n),removeSheetTableTiles(d,l),(isColsOnlyFreezed||isColsAndRowsFreezed)&&(o&&(d=r),removeSheetTableTiles(d,l,sheetPane3Id))}o||updateAvailableRowRange("DELETE",l,i,void 0,a);var R=!0;Merge.remove(e,0,t-1,getTotalColumn(),R)}}}function removeSheetTableTiles(e,t,l){if("SCROLLUP"==t)var a=!0;else var a=!1;for(var o=0,n=e;n>o;o++){if(a)var r=getLastTile(l);else var r=getFirstTile(l);if(null!=r){var i=r.parentNode;i.removeChild(r)}}}function getCell(e,t,l){if(e=parseInt(e),t=parseInt(t),0>e||0>t)return null;l=getPaneId(e,t);var a=Merge.getCellInfo(e,t),o=getAvailableStartRow(),n=getAvailableEndRow(),r=FREEZED_ROW;if(!a||!(a.startRow<r)&&(a.startRow>n||a.endRow<o))if("undefined"==typeof l||l==sheetPaneId||l==sheetPane3Id){if(e>=totRows||t>=totCols||e>n||t>getAvailableEndCol())return null}else if(e>=totRows||t>=totCols)return null;if(isUndefined(arguments[3])&&a){t=a.startCol,e=a.startRow;var i=null,s=a.getDOM();if(s)switch(l){case sheetPane1Id:i=s.mC1;break;case sheetPane2Id:i=s.mC2;break;case sheetPane3Id:i=s.mC3;break;default:i=s.mC}return i}var d=getRowIndex(e,l,!0),R=ROWS_PER_TILE,g=R,h=rowsInPage,v=Row.getAvailableRowsInFrozenRange(),w=0,c=h[0];v&&v.length?(w=v.length,c=Row.findNextNonHiddenRow(r-1)):w=0;var f=d,b=0;if(b=FREEZED_ROW>e?d:0!=o?d:d-v.length,-1!==d){var C=getTile(b,l),E=0,p=t,T=totCols,u=FREEZED_COL;t>=u?(p=Math.abs(u-t),T-=u):T=u;var S=f%g;E=S*T+p;var F=getChildNode(C,E);return F}return null}function insertTiles(e,t,l,a,o,n,r){if(isStr(e)&&isObject(t)){var i=r&&r.fakeReload,s=l,d=Row.getAvailableRowsInFrozenRange(FREEZED_ROW).length,R=Row.getAvailableRowsInFrozenRange(FREEZED_ROW),g=R[d-1];d&&i&&Row.findNextNonHiddenRow(g)!==l[d]&&s.splice(0,d),updateAvailableRowRange("INSERT",e,s,r,i);var h=sheetTable.childNodes.length,v=sheetTable3.childNodes.length,w=constructTileFromJSON(t,l,a,o,n,r),c=w.docFragment,f=w.freezedFrags,b=ISFREEZED;if(!isUndefined(c)||f)switch((prevScrollTop<getSheetScrollTop()-2*getSheetHeight()||prevScrollTop>getSheetScrollTop()+2*getSheetHeight()||"SCROLLDOWN"===e)&&(f&&(f.table1||f.table2)&&b&&(f.table1&&f.table1.hasChildNodes()&&(sheetTable1.innerHTML="",sheetTable1.appendChild(f.table1)),f.table2&&f.table2.hasChildNodes()&&(sheetTable2.innerHTML="",sheetTable2.appendChild(f.table2))),f&&f.table3&&f.table3.hasChildNodes()&&sheetTable3.appendChild(f.table3),sheetTable.appendChild(b?f.table:c),setScrollLeft(colHead.scrollLeft)),e){case"SCROLLDOWN":prevScrollTop>=getSheetScrollTop()-2*getSheetHeight()&&(isColsOnlyFreezed||isColsAndRowsFreezed)&&b&&f.table3&&sheetTable3.appendChild(f.table3);break;case"SCROLLUP":b&&(f.table1||f.table2)&&(f.table1&&f.table1.hasChildNodes()&&(sheetTable1.innerHTML="",sheetTable1.appendChild(f.table1)),f.table2&&f.table2.hasChildNodes()&&(sheetTable2.innerHTML="",sheetTable2.appendChild(f.table2)));var C="";(isColsOnlyFreezed||isColsAndRowsFreezed)&&f.table3&&f.table3.hasChildNodes()&&(sheetTable3.childNodes.length?sheetTable3.insertBefore(f.table3,sheetTable3.childNodes[0]):sheetTable3.appendChild(f.table3)),C=getFirstTile();var E=c?c:f.table;sheetTable.childNodes.length?sheetTable.insertBefore(E,sheetTable.childNodes[0]):sheetTable.appendChild(E)}if(insertRowHdrs(l,e,r),i&&(removeXTiles(getAvailableStartRow(),getAvailableEndRow()+1,"SCROLLDOWN",void 0,!0,h,v),prevScrollTop=getSheetScrollTop(),setScrollTop(getSheetScrollTop())),loadXTileIfVacantInViewPort(i),isDocContainsArrayFormula){var p=endRow>startRow?startRow:endRow,T=o>a?a:o,u=startRow>endRow?startRow:endRow,S=a>o?a:o;fixArrayFormulaNotation(p,T,u,S)}for(var F in availChartRange)-1!=availChartRange[F]&&UpdateChartCellRange(availChartRange[F])}}function constructTileFromJSON(e,t,l,a,o,n){afterConstructTilesFromJson=!0;var r=[],i=ISFREEZED,s=FREEZED_ROW,d=FREEZED_COL;if(n){var R=n.reloadFrozenRows;r=n.frozenRows,r&&(A=r.length),R&&(r=Row.getAvailableRowsInFrozenRange(FREEZED_ROW),r[0]===t[0]&&(r=[]),t=r.concat(t))}{var g,h=t[0],v=(getRowTop(h),0),w=h,c=t.length;Row.getAvailableRows(i)}appEvent.trigger("constructTile",[t.length]);var f=getColMax();if(s)var b=document.createDocumentFragment(),C=a!=f-1?getColLeft(a+1):getColLeft(f-1)+getColWidth(f-1);if(d)var E=document.createDocumentFragment(),p=getColLeft(d);if(s&&d)var T=document.createDocumentFragment(),u=getColLeft(d);var S=document.createDocumentFragment(),F=a!=f-1?getColLeft(a+1):getColLeft(f-1)+getColWidth(f-1),R=!1,A=0,I=0,m=-1;if(A||(r=Row.getAvailableRowsInFrozenRange(FREEZED_ROW)),r&&r.length)A=r.length,m=r[A-1],I=Row.findNextNonHiddenRow(s-1);else{m=I=rowsInPage[0];var L=document.createDocumentFragment()}var N=TileUtil.getMarkup(),O=getCellMarkUp();do{if(w=t[v],g=getRowTop(w),i)if(s&&m>=w){if(d){var y=N.cloneNode("false");y.style.top=g+"px",y.style.height=getRowHeight(w)+"px",y.style.width=u+"px",T.appendChild(y)}var x=N.cloneNode("false");x.style.top=g+"px",x.style.height=getRowHeight(w)+"px",x.style.width=C+"px",b.appendChild(x)}else{if(d){var D=N.cloneNode("false");D.style.top=g+"px",D.style.height=getRowHeight(w)+"px",D.style.width=p+"px",E.appendChild(D)}var _=N.cloneNode("false");_.style.top=g+"px",_.style.height=getRowHeight(w)+"px",_.style.width=F+"px",S.appendChild(_)}else{var W=N.cloneNode("false");W.style.top=g+"px",W.style.height=getRowHeight(w)+"px",W.style.width=F+"px",L.appendChild(W)}appEvent.trigger("setIndex",[w]);var H=e[w],P=a-l+1,Z=l;if(H){var U=(getRowTop(w),getRowHeight(w)),k=!1,z=null;do{var M=H[Z],B=O.cloneNode(!1),V=B.style;if(isRTL&&k&&(B.style.borderRight=z,k=!1,z=null),isRTL?(V.right=getColLeft(Z)+"px",V.left=null):(V.left=getColLeft(Z)+"px",V.right=null),V.height=U+"px",V.width=getColWidth(Z)+"px",appEvent.trigger("cell.construct.setProperty",[B,Z,w,P,M]),M){var X=browser_ie?[]:"";X=concat(X,"cD");var Y=M[CellConstants.CLASSNAME]||"",J=M[CellConstants.WRAP],j=M[CellConstants.CELLHYPER],q=M[CellConstants.VALUEFORMAT],G=M[CellConstants.CELLANNOT],Q=M[CellConstants.CELLFORMULA],K=M[CellConstants.CELLSTYLE],$=M[CellConstants.CELLVALUE],et=M[CellConstants.ENCODEDCELLVALUE],tt=M[CellConstants.DATAVALIDATION];null===$&&($="null"),null===et&&(et="null"),$&&($=decodeURIComponent($)),et&&(et=decodeURIComponent(et)),tt&&(tt=decodeURIComponent(tt));var lt=isUndefined($)?"":$;isUndefined(et)?et=lt:lt=et,X=J?concat(X," W"):concat(X," nW"),J&&(B.style.overflow="hidden");var at=getCSSStyleRegex("utextAlign");at.test(Y)||q&&1!==q&&-1==Y.indexOf("tar")&&(X=concat(X," tar")),Y&&(X=concat(X,Y)),browser_ie&&(X=X.join("")),isRTL&&(-1!==X.indexOf("far")&&(X=X.replace("far","")),-1!==X.indexOf("tar")&&(X=X.replace("tar","")));var ot=isRTL?/( (fa|ta)[lc])(\b)/i:/( (fa|ta)[rc])(\b)/i;if((ot.test(X)||-1!=X.indexOf(" W"))&&addFlexBoxDiv(B,""),B.className=X,j){var nt=(j[0],j[1]);"multi"!=nt&&(lt=j[2],lt=decodeURIComponent(lt))}if(q){switch(q){case 1:q="STRING";break;case 2:q="FORMULA";break;case 3:q="DATE";break;case 4:q="PERCENT";break;case 5:q="FRACTION";break;case 6:q="CURRENCY";break;case 7:q="BOOLEAN";break;case 8:q="DATETIME";break;case 9:q="ERROR";break;case 10:q="TIME";break;case 11:q="MATRIX";break;case 12:q="SCIENTIFIC";break;case 13:q="FLOAT"}B.setAttribute("format",q)}if(isUndefined(Q)||(Q=decodeURIComponent(Q),B.setAttribute("fn",Q)),K)for(var rt in K)switch(rt){case"1":B.style.backgroundColor=K[rt],k=!1;break;case"2":B.style.color=K[rt],k=!1;break;case"3":B.style.fontFamily=K[rt],k=!1;break;case"4":B.style.fontSize=K[rt],k=!1;break;case"5":B.style.textAlign=K[rt],k=!1;break;case"6":B.style.verticalAlign=K[rt],k=!1;break;case"7":B.style.borderTop=K[rt],k=!1;break;case"8":B.style.borderBottom=K[rt],k=!1;break;case"9":B.style.borderLeft=K[rt],k=!1;break;case"10":isRTL?(k=!0,z=K[rt]):(B.style.borderRight=K[rt],k=!1);break;case"11":B.className+=" nFT"+K[rt],k=!1}if(isUndefined($)||B.setAttribute("cV",$),j){if("multi"!=nt?appEvent.trigger("addlink",[B,$,lt.replace(/\n/g,"<br>"),!0]):appEvent.trigger("addlink",[B,$]),(browser_ie||browser_safari)&&null!=B){var it=getHyperLinkInCell(B).childTag;if(it){{var st=B;B.className}st=getCellContentNode(B);for(var dt=getChildNodesLength(st),Rt=0;dt>Rt;Rt+=1)if(it=getChildItem(st.childNodes,Rt),null!=it&&"A"==it.nodeName){var gt="",ht=getCSSStyleRegex("fontSize").exec(X);null!=ht&&(gt=ht[0]),ht=getCSSStyleRegex("fontFamily").exec(X),null!=ht&&(gt+=ht[0]);var vt=B.style.fontSize,wt=B.style.fontfamily;""!=vt&&(it.style.fontSize=vt),""!=wt&&(it.style.fontfamily=wt)}}}}else{var lt=encodeBlankSpaces(lt.replace(/\n/g,"<br>"),!0);setCellInnerHTML(B,revertQuote(lt))}isUndefined(tt)||appEvent.trigger("cell.setDataValidation",[w,Z,B,tt]),isUndefined(G)||appEvent.trigger("annot.add",[B,G,w,Z])}else B.className="cD nW";s||d?s&&m>=w?d&&d>Z?y.appendChild(B):x.appendChild(B):d>0&&d>Z?D.appendChild(B):_.appendChild(B):W.appendChild(B);var ct=Merge.getRootCellInfo(w,Z);if(ct){var ft=ct.startRow,bt=ct.startCol,Ct=ct.endRow,Et=ct.endCol;Merge.remove(ft,bt,Ct,Et,void 0,!0)}Z++,P--}while(P)}else{{getRowTop(w)}do{var B=O.cloneNode(!1),U=getRowHeight(w);B.className="cD nW",B.style.height=U+"px",B.style.width=getColWidth(Z)+"px",B.style[isRTL?"right":"left"]=getColLeft(Z)+"px",appEvent.trigger("cell.construct.setProperty",[B,Z,w,P]),s||d?s&&m>=w?d&&d>Z?y.appendChild(B):x.appendChild(B):d&&d>Z?D.appendChild(B):_.appendChild(B):W.appendChild(B);var ct=Merge.getRootCellInfo(w,Z);if(ct){var ft=ct.startRow,bt=ct.startCol,Ct=ct.endRow,Et=ct.endCol;Merge.remove(ft,bt,Ct,Et,void 0,!0)}Z++,P--}while(P)}v++}while(c>v);if(i){var pt={};return s&&b.hasChildNodes()&&(pt.table2=b),d&&E.hasChildNodes()&&(pt.table3=E),s&&d&&T.hasChildNodes()&&(pt.table1=T),pt.table=S,{freezedFrags:pt}}return{docFragment:L}}function insertAndShiftRows(e,t,l,a){var o=e?getCloneRow(a):getDummyRow(),n=t;resetRowsInPage();var r=Row.getAvailableRows(),i=ArrayUtils.getSortedIndex(r,e),s=FREEZED_ROW,d=FREEZED_COL,R=ROWS_PER_TILE,g=R,h=Row.getAvailableRowsInFrozenRange(),v=0,w=0,c=Row.getAvailableRowsInFrozenRange(s).length;h&&h.length?(v=h.length,w=h[v-1]):w=r[0];var f=r[0]==h[0],b=f?r[v]:r[0],C=r.indexOf(b),E=i%R,p=g,T=i,u=TileUtil.getMarkup();i>=C&&R>i&&f&&(g=R-v,T=i-C,E=T%g,p=g);var S=0|T,F=totCols,A=getAvailableTiles(sheetPaneId);if(d)var I=getAvailableTiles(sheetPane3Id);for(var m=A.length;m>S;){var L=document.createDocumentFragment(),N=S*g,O=r[N],y=getRowTop(O),x=S++;if(d)var D=document.createDocumentFragment();var _="0px";if(t-->0){for(var W=0;F>W;W++){var H=o[W].cloneNode(!0);d>W?D.appendChild(H):L.appendChild(H),H.style.top=_}if(d){var P=u.cloneNode("false");P.appendChild(D),P.style.top=getRowTop(i)+"px",P.style.width=getColLeft(d)+"px",P.style.height=getRowHeight(i)+"px",0===getAvailableStartRow()?sheetTable3.insertBefore(P,sheetTable3.childNodes[i-c]):sheetTable3.insertBefore(P,sheetTable3.childNodes[i])}var Z=u.cloneNode("false");Z.appendChild(L),Z.style.top=getRowTop(i)+"px",Z.style.height=getRowHeight(i)+"px",Z.style.width=getColLeft(F-1)+getColWidth(F-1)+"px",0===getAvailableStartRow()?sheetTable.insertBefore(Z,sheetTable.childNodes[i-c]):sheetTable.insertBefore(Z,sheetTable.childNodes[i])}else{var U=A[x];if(d){var k=I[x];k.style.top=y+"px"}U.style.top=y+"px"}i++}for(var z=document.createDocumentFragment(),M=document.createDocumentFragment(),B=A.length,V=B-1,W=0;n>W;V--,W++){var X=A[V];if(d){var Y=I[V];M.appendChild(Y)}z.appendChild(X)}}function _getCellArrToInsert(e,t,l,a,o,n,r){isUndefined(r)&&(r=sheetPaneId);var i=0==l?!0:!1;if(i||n)var s=getDefaultCellHTML();var d,R=l==totCols,g=[],h=[],v=Row.getAvailableRows(ISFREEZED),w=ROWS_PER_TILE,c=Row.getAvailableRowsInFrozenRange(),f=0,b=0,C=0,E=0;c&&c.length?(f=c.length,E=c[f-1],b=Row.findNextNonHiddenRow(FREEZED_ROW-1),C=FREEZED_ROW):(b=E=v[0],C=Row.findNextNonHiddenRow(w));for(var p=0,T=0,u=v.length;u>T;T++){var S=v[T],F=w,A=T;if(c&&-1==v.indexOf(b)&&(A=Math.abs(T-f-1)),i||n){A%F===0&&(p=0);var I=getRowHeight(S),d=s.cloneNode(!0);d.style.height=I+"px",p+=I}else{var m=getCell(S,e,r,!0);d=m.cloneNode(!0)}if(!i&&Merge.getCellInfo(S,e)){var L=getColLeft(e),o=getColWidth(e);d.style.left=L+"px",d.style.width=o+"px"}setDefaultValueForCell(d);var N=null;if(R)if((A+1)%F===0)N=null;else{var O=v[T+1];N=getCell(O,FREEZED_COL,r,!0),appEvent.trigger("grid.insertCol",[currCol,totCols])}else N=getCell(S,l,r,!0);removeCSSStyle("cellComment",d),null!=d.getAttribute("comment")&&d.removeAttribute("comment"),null!=d.getAttribute("onmouseover")&&d.removeAttribute("onmouseover"),null!=d.getAttribute("onmouseout")&&d.removeAttribute("onmouseout"),handleBordersInInsertCol(d,N),g[S]=N,h[S]=d}return{insertCellArr:g,newCellArr:h}}function _insertCells(e,t,l,a,o,n,r){getAvailableStartRow(),getAvailableEndRow();isUndefined(r)&&(r=sheetPaneId);var i=[],s=t==totCols?!0:!1,d=Row.getAvailableRows(ISFREEZED),R=0,g=0,h=0,v=ROWS_PER_TILE,w=Row.getAvailableRowsInFrozenRange(),c=d[0];w&&w.length?(R=w.length,g=w[R-1],h=Row.findNextNonHiddenRow(g),c=w[0],firstRowOf2ndTile=FREEZED_ROW):(g=h=c,firstRowOf2ndTile=d[v]);for(var f=d.length,b=0;f>b;b++){var C=d[b],E=document.createDocumentFragment();if(s)var p=getColLeft(t-1)+getColWidth(t-1);else var p=getColLeft(t);for(var T=0,u=0;a>u;u+=1){var S=e[C].cloneNode(!0);S.style[isRTL?"right":"left"]=p+"px","append"==n&&(o=colWidthAry[t],S.style.width=o+"px"),E.appendChild(S),p+=o,T+=o}i[C]=E}shiftCellsHorizontally(t,totCols-1,{mode:"DIFF",val:T},r);for(var F=0,b=0;f>b;b++){{var A,C=d[b];getRowIndex(C)}(C==h||b===R)&&(F=0);var A;A=FREEZED_ROW&&h>C?getTile(F,sheetPane2Id):getTile(F),F++,A.insertBefore(i[C],l[C]),A.style.width=getColLeft(totCols+a-1)+getColWidth(totCols+a-1)+"px"}}function updateAvailableRowRange(e,t,l,a,o){var n=l[0],r=l[l.length-1];switch(e){case"DELETE":if(o)availableStartRow=-1,availableEndRow=-1;else switch(t){case"SCROLLDOWN":availableStartRow=Row.findNthNonHiddenRow(1,r,!0);break;case"SCROLLUP":availableEndRow=Row.findNthNonHiddenRow(1,n,!1)}break;case"INSERT":if(-1==availableStartRow&&-1==availableEndRow&&(o=!0),o)availableStartRow=n,availableEndRow=r;else switch(t){case"SCROLLDOWN":0===n&&(availableStartRow=0),availableEndRow=r,0==sheetTable.childNodes.length&&(availableStartRow=n);break;case"SCROLLUP":availableStartRow=n,0==availableEndRow&&(availableEndRow=r),0==sheetTable.childNodes.length&&(availableEndRow=r)}}Row.setAvailableRows(Row.getNonHiddenRowsInRange(getAvailableStartRow(),getAvailableEndRow()))}function reloadPage(e,t,l,a,o){if(responseManager.isRequestPending()){var n={fn:reloadPage,params:arguments,condn:function(){return!responseManager.isRequestPending()}};return void actionManager.addEventListener("onResponse",n)}var e=void 0===e?getSheetScrollTop():e;if(Row.isAllRowsHidden()){if(l&&l.onFailure){var r=l.onFailure.params?l.onFailure.params:[];l.onFailure.method.apply(void 0,r)}removeXTiles(getAvailableStartRow(),getAvailableEndRow()+1,"SCROLLDOWN",!0)}else{e>getSheetTableHeight()&&(e=getSheetTableHeight()-getSheetHeight());var i=rowRangetoLoad(e,!0),s=i.startRow,d=i.endRow,R=i.scrollType;submitScrollForm(getNonHiddenRowsInPage(s,d),R,"true",t,l,a,o)}}function _removeCellsDeleteCol(e,t,l){function a(e){return b=i>e?e%s:e>=i&&s>e&&R?(e-i)%s:R?(e-i)%s:e%s}function o(e,t){var l=i>e?sheetTable2:sheetTable;return l.childNodes[t]}var n=Row.getAvailableRows(),r=Row.getAvailableRowsInFrozenRange(),i=0,s=ROWS_PER_TILE,d=[],R=r[0]===n[0];r&&r.length?(i=r.length,d=R?n:r.concat(n)):d=n;for(var g=d.length,h="",v=t+e,w=[],c=totCols,f=[],b=-1,C=0,E=0;g>C;C++){var p=[];b=a(C),0===b&&(C==i&&(E=0),h=o(C,E),w=h.childNodes,E++);for(var T=t,u=0;v>T;T++,u++){var S=T-FREEZED_COL+b*(c-FREEZED_COL);p[u]=w[S]}f[C]=p}shiftCellsHorizontally(v,totCols-1,{mode:"DIFF",val:-l});for(var C=0,E=0;g>C;C++){var p=f[C];b=a(C),0===b&&(C==i&&(E=0),h=o(C,E),E++);for(var F=0;F<p.length;F++)h.removeChild(p[F])}}Row.getLoadedRowsInFrozenRange=function(){return visibleRowsInFrozenRange=[],FREEZED_ROW>0&&(visibleRowsInFrozenRange=Row.getNNonHiddenRows(FREEZED_ROW,0)),visibleRowsInFrozenRange},Row.dom.setRowsHeight=function(e,t){var l=Row.getAvailableRowsInRange(e,t,!0),a=Row.getAvailableRows(),o=Row.dom.getCellsInRows(e,getAvailableEndRow()),n=isRowInAvailableRowRange(e)?ArrayUtils.getSortedIndex(a,e):0,r=totCols,i=FREEZED_ROW,s=FREEZED_COL,d=0,R=Row.getAvailableRowsInFrozenRange(),g=0,h=0,v=Row.getAvailableRowsInFrozenRange(i).length;R&&R.length?(d=R.length,g=R[d-1],h=Row.findNextNonHiddenRow(i-1)):(g=a[0],h=g);for(var w=n,c=a.length,f=0;c>w;w++,f++){var b=o[f],C=a[w],E=-1!==l.indexOf(C),p=0,T=w;T=w,p=a[T];var u=getRowTop(C),S=getRowTop(C),F=getRowHeight(C),A=getTileIndex(C);i&&0===availableStartRow&&(A-=v);var I=getTile(A);if(C>=i&&s>0){var m=getTile(A,sheetPane3Id);m&&(m.style.top=S+"px",m.style.height=F+"px")}I&&(I.style.top=u+"px",I.style.height=F+"px");for(var L=0;r>L;L++){var N=b[L];E&&N&&(N.style.height=F+"px",setCellHeightForVAlignedCell(N))}}},Row.dom.getCellsInRows=function(e,t){var l=Row.getAvailableRows();if(!isArray(e)){var a=ArrayUtils.getSortedIndex;e=l.slice(a(l,e),a(l,t)+1)}var o=sheetTable.childNodes,n=FREEZED_COL,r=Row.getAvailableRowsInFrozenRange(FREEZED_ROW).length;if(FREEZED_ROW)var i=sheetTable2.childNodes;if(n)var s=sheetTable3.childNodes;if(FREEZED_ROW&&n)var d=sheetTable1.childNodes;var R=[],g=totCols-n,h=n;if(ISFREEZED){var v=Row.getAvailableRowsInFrozenRange(),w=l[0]<FREEZED_ROW;if(w)var c=l.slice(ArrayUtils.getSortedIndex(l,FREEZED_ROW),ROWS_PER_TILE)}for(var f=0,b=e.length;b>f;f++){var C=e[f],E=FREEZED_ROW>C,p=E?v.indexOf(C):getRowIndex(C);if(-1!==p){!E&&FREEZED_ROW&&C>=FREEZED_ROW&&0==getAvailableStartRow()&&(p-=r);var T=~~(p/ROWS_PER_TILE),u=w&&C>=c[0]&&C<=c[c.length-1],S=(u?c.indexOf(C):p%ROWS_PER_TILE,[]);if(n&&(ISFREEZED?E?d[T]&&(S=ArrayUtils.slice(d[T].childNodes,0,h)):s[T]&&(S=ArrayUtils.slice(s[T].childNodes,0,h)):S=[]),E){if(i[T])var F=ArrayUtils.slice(i[T].childNodes,0,g)}else if(o[T])var F=ArrayUtils.slice(o[T].childNodes,0,g);R.push(S.concat(F))}}return R},Row.dom.removeAndShiftRows=function(e,t){var l,a=FREEZED_COL,o=Row.getAvailableRowsInRange(e),n=getTilesCount(),r=n-o.length,i=Row.getAvailableRowsInFrozenRange(FREEZED_ROW).length,s=parseInt(r),d=n-s,R=o[0],g=Row.getAvailableRows();l=s>0?Row.predictNthNonHiddenRow(s+i,o,getAvailableStartRow()):Row.findNextNonHiddenRow(getAvailableEndRow(),!0);{var h,v=R;Row.getAvailableRowsInRange(getAvailableStartRow(),R).length-1}if(t||getAvailableStartRow()!==R||(h=!0),0===s&&(l=getAvailableStartRow()),s>0&&l>v)for(var w=g.indexOf(v),c=g.indexOf(l)>0?l:g.length,f=g.slice(w,c),b=this.getCellsInRows(f),C=0,E=0,p=f.length;p>E;E++){var T=f[E],u=(b[E],getRowIndex(T));if(FREEZED_ROW&&0==getAvailableStartRow()&&(u-=i),-1!==o.indexOf(T))C++,sheetTable.removeChild(sheetTable.childNodes[u-o.indexOf(T)]),a>0&&sheetTable3.removeChild(sheetTable3.childNodes[u-o.indexOf(T)]);else{h&&(availableStartRow=T,h=!1);var S=f[E-C],F=getTileIndex(S),A=getTileIndex(T);0===getAvailableStartRow()&&(F-=i,A-=i);var I=getTile(F);if(a){var m=getTile(F,sheetPane3Id);getTile(A,sheetPane3Id)}var L=t?T-ArrayUtils.getSortedIndex(e,T):T,N=getRowTop(L);I.style.top=N+"px",a&&(m.style.top=N+"px")}}if(d!==getTilesCount()){FREEZED_ROW&&0==getAvailableStartRow()&&(s+=i);var O=Row.getNNonHiddenRows(s,availableStartRow),y=Row.getNNonHiddenRows(d,l)}else var x=!0;return{rowsToLoad:y,availableRows:O,pageReload:x}};
function loadXTiles(e,o,t,l){Row.getAvailableRows().length;extraViewPorts=1;var r=findRowInYPos(getSheetScrollTop()+3*sheetHeight,!0,!0)-findRowInYPos(getSheetScrollTop(),!0,!0);extraViewPorts=r>1&&50>r&&getSheetScrollTop()>=0?2:1;var a=rowRangetoLoad(e,o,l);if(a&&a.isValidRequestRange){var i=a.startRow,R=a.endRow,S=a.scrollState,s=!1;(prevScrollTop>getSheetScrollTop()+(extraViewPorts+1)*sheetHeight||prevScrollTop<getSheetScrollTop()-(extraViewPorts+1)*sheetHeight)&&(s=!0),isRespondedInScroll&&removeXTileIfExcessThanViewPort(a.scrollState,s,o),clearTileLoadTimeout(),isTileLoaded=!1,tileLoadTimeoutId=isVScrollFaceClicked?setTimeout("onTileLoadTimeout('VSCROLLBAR_FACE_DRAG',"+i+","+R+")",500):setTimeout("onTileLoadTimeout('SCROLL_WITHOUT_VSCROLLBAR_FACE_DRAG',"+i+","+R+")",500),lastRequestedTileInfo={startRow:i,endRow:R},s||0!=!getAvailableStartRow()||0!=!getAvailableEndRow()||-1==getAvailableEndRow()||-1==getAvailableStartRow()||("SCROLLUP"==a.scrollState?R=getAvailableStartRow()-1:i=getAvailableEndRow()+1),submitScrollForm(Row.getNonHiddenRowsInRange(i,R),S,void 0,void 0,void 0),prevScrollTop=getSheetScrollTop()}else setRowInfoBoxTimeout()}function rowRangetoLoad(e,o,t){var l,r,a,i=!0,R=void 0===e?getSheetScrollTop():e,S=getSheetHeight();if(o)i=!0,l=R-extraViewPorts*S>0?findRowInYPos(R-extraViewPorts*S,!0,!0):0,r=findRowInYPos(R+(extraViewPorts+1)*S,!0,!0),a="SCROLLDOWN";else if(l=R-extraViewPorts*S>0?findRowInYPos(R-extraViewPorts*S,!0,!0):0,prevScrollTop<getSheetScrollTop()||prevScrollTop===getSheetScrollTop()&&l>availableStartRow||0===prevScrollTop&&0===getSheetScrollTop()&&l>=availableStartRow||t){r=findRowInYPos(R+(extraViewPorts+1)*S,!0,!0);var s=getAvailableEndRow(),w=getAvailableStartRow();(l>r-1||s>=r-1)&&(i=!1),s>0&&(s+=1),prevScrollTop<getSheetScrollTop()-2*getSheetHeight()||(s>l&&0!==s&&0!=getSheetScrollTop()&&(l=s),0==l&&s>0&&!o&&(l=s)),t&&(l=s),a="SCROLLDOWN"}else{l=R-extraViewPorts*S>0?findRowInYPos(R-extraViewPorts*S):0,r=findRowInYPos(R+(extraViewPorts+1)*S,!0,!0);var w=getAvailableStartRow();l>=w&&(i=!1),0===w&&0===getAvailableEndRow()&&(i=!0),prevScrollTop>getSheetScrollTop()+2*getSheetHeight()||(r=r>=w&&0!=w?w-1:r),FREEZED_ROW>l&&l>0&&(l=0,FREEZED_ROW>r&&(r=FREEZED_ROW)),FREEZED_ROW>r&&(r=FREEZED_ROW),a="SCROLLUP"}return{startRow:l,endRow:r,scrollState:a,isValidRequestRange:i}}function getRowRangeToRemove(e){var o,t;if(isStr(e)){switch(e){case"SCROLLDOWN":o=findRowInYPos(prevScrollTop-extraViewPorts*getSheetHeight(),!0),t=findRowInYPos(getSheetScrollTop()-extraViewPorts*getSheetHeight(),!0)-1,getAvailableStartRow()<o&&(o=getAvailableStartRow()),(getSheetScrollTop()-prevScrollTop===1||getSheetScrollTop()===prevScrollTop)&&(o=t),o>availableStartRow&&(o=availableStartRow),FREEZED_ROW>o&&t>=FREEZED_ROW&&(o=FREEZED_ROW);break;case"SCROLLUP":o=findRowInYPos(getSheetScrollTop()+(extraViewPorts+1)*getSheetHeight(),!0)+1,t=findRowInYPos(prevScrollTop+(extraViewPorts+1)*getSheetHeight(),!0),t<getAvailableEndRow()&&(t=getAvailableEndRow())}return{firstRow:o,endRow:t}}}
